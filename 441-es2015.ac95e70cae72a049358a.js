"use strict";(self.webpackChunk_4la=self.webpackChunk_4la||[]).push([[441],{16314:function(t,e,r){r.d(e,{W:function(){return l},H$:function(){return c},cf:function(){return u},pW:function(){return p},dw:function(){return h},yl:function(){return d}});var n=r(16738),o=r.n(n),s=r(74788),i=r(88638),a=r(91211);let l=(()=>{class t{transform(t){return(+`${t}`.replace(/\D/g,"")).toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=s.Yjl({name:"commas",type:t,pure:!0}),t})(),c=(()=>{class t{transform(t,e,r){return t?t.filter(t=>t[e]==r):[]}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=s.Yjl({name:"filterByKV",type:t,pure:!0}),t})(),u=(()=>{class t{transform(t){return"number"!=typeof t?o()(t).format("DD/MM/YYYY"):o()(new Date(86400*(t-25569)*1e3)).format("DD/MM/YYYY")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=s.Yjl({name:"excelDay",type:t,pure:!0}),t})(),p=(()=>{class t{constructor(t){this.plus=t}transform(t){const e=JSON.parse(localStorage.getItem("catalog"));return e?e.filter(e=>e.Nhom==t).sort((t,e)=>t.GiaTri<e.GiaTri?-1:t.GiaTri>e.GiaTri?1:0):(this.plus.reload("/taikhoan"),this.plus.getCatalog(),[])}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(i.T,16))},t.\u0275pipe=s.Yjl({name:"catalog",type:t,pure:!0}),t})(),h=(()=>{class t{transform(t){return o()(t).locale("vi").fromNow()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=s.Yjl({name:"fromNow",type:t,pure:!0}),t})(),d=(()=>{class t{constructor(t){this.sanitizer=t}transform(t){return this.sanitizer.bypassSecurityTrustResourceUrl(t)}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(a.H7,16))},t.\u0275pipe=s.Yjl({name:"safe",type:t,pure:!0}),t})()},97012:function(t,e,r){r.d(e,{t:function(){return d}});var n=r(16738),o=r.n(n),s=r(84487),i=r(74788),a=r(88638),l=r(12057),c=r(2895);function u(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"button",3),i.NdJ("click",function(){return i.CHM(t),i.oxw(2).export()}),i._uU(1,"Export Excel"),i.qZA()}}function p(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"button",3),i.NdJ("click",function(){return i.CHM(t),i.oxw(2).exportTar()}),i._uU(1,"Export BackupDB"),i.qZA()}}function h(t,e){if(1&t&&(i.TgZ(0,"span",1),i.YNc(1,u,2,0,"button",2),i.YNc(2,p,2,0,"button",2),i.qZA()),2&t){const t=i.oxw();i.xp6(1),i.Q6J("ngIf",t.check()),i.xp6(1),i.Q6J("ngIf",t.check())}}let d=(()=>{class t{constructor(t){this.plus=t}ngOnInit(){}export(){const t=[];this.dataJson.forEach(e=>{delete e.dateModify,delete e.status,delete e.sync,delete e.canEdit,delete e.keyWord,delete e.__v,t.push(e)});const e=s.utils.json_to_sheet(t),r=s.utils.book_new();s.utils.book_append_sheet(r,e,this.api),s.writeFile(r,o()(Date.now()).format("YYYYMMDDHHMM")+"-4la-"+this.api+".xlsx")}exportTar(){for(let o=0;o<this.dataJson.length;o++)delete this.dataJson[o].dateModify,delete this.dataJson[o].canEdit,delete this.dataJson[o].keyWord,delete this.dataJson[o].__v,delete this.dataJson[o]._id;let t=JSON.stringify(this.dataJson),e="data:application/json;charset=utf-8,"+encodeURIComponent(t);console.log(e);let r=`4la-${this.api?this.api:""}`+Date.now()+".tar",n=document.createElement("a");n.setAttribute("href",e),n.setAttribute("download",r),n.click()}check(){return this.plus.checkPer("admin",4)}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(a.T))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-export-ecxel"]],inputs:{dataJson:"dataJson",api:"api"},decls:1,vars:1,consts:[["class","d-print-none",4,"ngIf"],[1,"d-print-none"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,e){1&t&&i.YNc(0,h,3,2,"span",0),2&t&&i.Q6J("ngIf",e.dataJson.length>0)},directives:[l.O5,c.lW],styles:[""]}),t})()},55352:function(t,e,r){r.d(e,{y:function(){return _}});var n=r(28831),o=r(84487),s=r(16738),i=r.n(s),a=r(74788),l=r(88638),c=r(2895),u=r(12057),p=r(49356),h=function(t,e,r,n){return new(r||(r=Promise))(function(o,s){function i(t){try{l(n.next(t))}catch(e){s(e)}}function a(t){try{l(n.throw(t))}catch(e){s(e)}}function l(t){t.done?o(t.value):function(t){return t instanceof r?t:new r(function(e){e(t)})}(t.value).then(i,a)}l((n=n.apply(t,e||[])).next())})};function d(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"div",10),a.TgZ(1,"input",11),a.NdJ("change",function(e){return a.CHM(t),a.oxw(2).readXlsx(e)}),a.qZA(),a.TgZ(2,"label",12),a._uU(3,"Ch\u1ecdn file "),a.TgZ(4,"mat-icon"),a._uU(5,"attachment"),a.qZA(),a.qZA(),a.TgZ(6,"a",13),a.TgZ(7,"mat-icon"),a._uU(8,"cloud_download"),a.qZA(),a._uU(9,"M\u1eabu import "),a.qZA(),a._UZ(10,"hr"),a.qZA()}if(2&t){const t=a.oxw(2);a.xp6(6),a.MGl("href","https://github.com/thuctd/FileStore/raw/master/templates/",t.api,".xlsx",a.LSH)}}function f(t,e){if(1&t&&(a.TgZ(0,"td",17),a._uU(1),a.qZA()),2&t){const t=a.oxw().$implicit;a.xp6(1),a.hij(" ",t.err||"","")}}function g(t,e){if(1&t&&(a.TgZ(0,"tr"),a.YNc(1,f,2,1,"td",16),a.qZA()),2&t){const t=e.$implicit;a.Q6J("@slideIn",void 0),a.xp6(1),a.Q6J("ngIf",t.err)}}function m(t,e){if(1&t&&(a.TgZ(0,"table",14),a.TgZ(1,"h4"),a._uU(2,"L\u1ed7i d\u1eef li\u1ec7u file import"),a.qZA(),a.TgZ(3,"tbody"),a.YNc(4,g,2,2,"tr",15),a.qZA(),a.qZA()),2&t){const t=a.oxw(2);a.xp6(4),a.Q6J("ngForOf",t.errorData.length>0?t.errorData:t.dataJson)}}function x(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"button",18),a.NdJ("click",function(){return a.CHM(t),a.oxw(2).import()}),a._uU(1,"Import Excel"),a.qZA()}}function b(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"button",18),a.NdJ("click",function(){return a.CHM(t),a.oxw(2).importDBFile()}),a._uU(1,"Import BackupDB"),a.qZA()}}function y(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"button",19),a.NdJ("click",function(){return a.CHM(t),a.oxw(2).reload()}),a._uU(1,"L\xe0m l\u1ea1i"),a.qZA()}}function Z(t,e){if(1&t&&(a.TgZ(0,"div",3),a.TgZ(1,"h4",4),a._uU(2,"Import t\u1eeb file excel"),a.qZA(),a._UZ(3,"hr"),a.YNc(4,d,11,1,"div",5),a.YNc(5,m,5,1,"table",6),a.TgZ(6,"div",7),a.YNc(7,x,2,0,"button",8),a.YNc(8,b,2,0,"button",8),a.YNc(9,y,2,0,"button",9),a.qZA(),a.qZA()),2&t){const t=a.oxw();a.xp6(4),a.Q6J("ngIf",0===t.dataJson.length),a.xp6(1),a.Q6J("ngIf",t.errorData.length>0),a.xp6(2),a.Q6J("ngIf",t.checkPer(4)&&0==t.errorData.length&&t.dataJson.length>0),a.xp6(1),a.Q6J("ngIf",t.checkPer(4)&&0==t.errorData.length&&t.backup.length>0),a.xp6(1),a.Q6J("ngIf",t.errorData.length>0||t.dataJson.length>0||t.backup.length>0)}}function w(t,e){if(1&t&&(a.TgZ(0,"tr"),a.TgZ(1,"td"),a._uU(2),a.qZA(),a.TgZ(3,"td"),a._uU(4),a.qZA(),a.qZA()),2&t){const t=e.$implicit;a.xp6(2),a.Oqu(t.index),a.xp6(2),a.Oqu(t.msg)}}function k(t,e){if(1&t&&(a.TgZ(0,"table",20),a.TgZ(1,"thead"),a.TgZ(2,"tr"),a.TgZ(3,"th"),a._uU(4,"D\xf2ng"),a.qZA(),a.TgZ(5,"th"),a._uU(6,"L\u1ed7i"),a.qZA(),a.qZA(),a.qZA(),a.TgZ(7,"tbody"),a.YNc(8,w,5,2,"tr",15),a.qZA(),a.qZA()),2&t){const t=a.oxw();a.xp6(8),a.Q6J("ngForOf",t.errServer)}}let _=(()=>{class t{constructor(t){this.plus=t,this.global=!1,this.dataImport=[],this.dataJson=[],this.errorData=[],this.errServer=[],this.show=!1,this.header=[],this.backup=[]}ngOnInit(){this.dataJson=[],this.dataImport=[]}readXlsx(t){this.plus.load();const e=t.target.files[0];if(console.log(e.type),"text/plain"!=e.type)if("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"==e.type||"application/vnd.ms-excel"==e.type){let e=t.target;const r=new FileReader;r.onload=t=>{const r=o.read(t.target.result,{type:"binary"});this.dataImport=o.utils.sheet_to_json(r.Sheets[r.SheetNames[0]],{header:1}),this.selectedFile(this.dataImport),this.plus.loaded(),e=null},r.onerror=()=>this.plus.alertError("L\u1ed7i file excel import"),r.readAsBinaryString(e.files[0])}else{alert("L\u01b0u \xfd:\nB\u1ea1n s\u1ebd m\u1ea5t to\xe0n b\u1ed9 d\u1eef li\u1ec7u c\u0169 tr\u01b0\u1edbc khi import nh\xe9!");const e=new FileReader;e.readAsText(t.target.files[0],"UTF-8"),e.onload=t=>{const e=JSON.parse(t.target.result);this.backup=this.cleanData(e),this.plus.loaded()},e.onerror=t=>{this.plus.alertError("L\u1ed7i file import"),this.plus.loaded()}}else this.readFileText(t)}readFileText(t){const e=t.target,r=new FileReader;r.readAsText(e.files[0]),r.onload=()=>{const t=this.plus.Crypt_Decrypt(r.result);this.exportExcel(t),this.exportTar(t)}}selectedFile(t){this.header=t[0];for(let e=1;e<t.length;e++){const r={};t[0].forEach((n,o)=>{r[`${n}`]=t[e][o]}),delete r._id,delete r.__v,this.form.patchValue(r),console.log(r,this.form.valid),this.form.valid?(r.keyWord=this.plus.generateKeyWord(r),r.dateModify=Date.now()+e,this.dataJson.push(r)):(r.err=`T\u1ea1i h\xe0ng ${e}: ${this.plus.getErrValidateForm(this.form)}`,this.errorData.push(r))}}import(){return h(this,void 0,void 0,function*(){this.plus.subs.unsubscribe();const t=this.dataJson.length;let e=!1;const r=this.dataJson;for(let n=0;n<r.length;n++){let o=r.slice(n,n+=200);const s=this.plus.Arr_MaxValue(o);if(yield this.plus.httpPost(this.api+"/import",o).toPromise().then(t=>{if(1!=t.status)return e=!0;console.log(t.code),this.plus.FBS_PostByUser(this.api,s,this.global)}).catch(r=>{403==r.status&&(this.plus.alertError(r),localStorage.clear(),window.location.reload()),e=!0,this.errServer=JSON.parse(r.error.code),this.plus.alertError("Import kh\xf4ng th\xe0nh c\xf4ng!"),n>0&&this.export(this.dataImport.slice(n+1)),n=t}),e)break}0==e&&(this.plus.alertSuccess("Import th\xe0nh c\xf4ng!"),this.plus.reload("/taikhoan"))})}importDBFile(){return h(this,void 0,void 0,function*(){this.plus.subs.unsubscribe();const t=this.backup.length;let e=0,r=!1;const n=this.backup;for(;e<t;){let o=n.slice(e,e+200);const s=this.plus.Arr_MaxValue(o);if(this.plus.httpPost(this.api+"/import",o).subscribe(t=>{if(console.log(t),1!=t.status)return r=!0;console.log(t.code),this.plus.FBS_PostByUser(this.api,s,this.global),e+=200},n=>{console.log(n),r=!0,this.errServer=JSON.parse(n.error.code),this.plus.alertError("Import kh\xf4ng th\xe0nh c\xf4ng!"),e>0&&this.export(this.dataImport.slice(e+1)),e=t}),r)break;yield this.plus.sleep(3e3)}0==r&&(this.plus.alertSuccess("Import th\xe0nh c\xf4ng!"),this.plus.reload("/taikhoan"))})}checkPer(t){return this.plus.checkPer(this.api,t)}reload(){return this.plus.reload("/")}export(t){t.unshift(this.header);const e=o.utils.json_to_sheet(t,{skipHeader:!0}),r=o.utils.book_new();o.utils.book_append_sheet(r,e,"ChuaImport"),o.writeFile(r,"4la-"+this.api+"-ChuaImport.xlsx")}exportExcel(t){const e=o.utils.json_to_sheet(t),r=o.utils.book_new();o.utils.book_append_sheet(r,e,this.api),o.writeFile(r,i()(Date.now()).format("YYYYMMDDHHMM")+"-4la-"+this.api+".xlsx")}exportTar(t){let e=JSON.stringify(t),r="data:application/json;charset=utf-8,"+encodeURIComponent(e);console.log(r);let n=`4la-${this.api?this.api:""}`+Date.now()+".tar",o=document.createElement("a");o.setAttribute("href",r),o.setAttribute("download",n),o.click()}cleanData(t){const e=[];for(let r=0;r<t.length;r++){const n=t[r];n.keyWord=this.plus.generateKeyWord(n),n.dateModify=Date.now()+r,delete n._id,delete n.__v,this.form.patchValue(n),console.log(n,this.form.valid),this.form.valid?(n.keyWord=this.plus.generateKeyWord(n),n.dateModify=Date.now()+r,this.dataJson.push(n)):(n.err=`T\u1ea1i h\xe0ng ${r}: ${this.plus.getErrValidateForm(this.form)}`,this.errorData.push(n)),e.push(n)}return e}}return t.\u0275fac=function(e){return new(e||t)(a.Y36(l.T))},t.\u0275cmp=a.Xpm({type:t,selectors:[["app-import-database"]],inputs:{form:"form",api:"api",global:"global"},decls:4,vars:2,consts:[["mat-raised-button","","color","accent",3,"click"],["class","card",4,"ngIf"],["class","table",4,"ngIf"],[1,"card"],[1,"text-center","text-white","py-2","my-3","bg-primary","rounded-pill","justify-content-center"],["class","ix",4,"ngIf"],["class","table table-inverse table-responsive",4,"ngIf"],[1,"text-center","mx-3"],["class","text-center mx-3","mat-raised-button","","color","accent",3,"click",4,"ngIf"],["class","text-center mx-3","mat-raised-button","","color","primary",3,"click",4,"ngIf"],[1,"ix"],["hidden","","id","file-import","type","file","multiple","false",3,"change"],["for","file-import",1,"custom-file-upload","text-primary","mx-5"],["mat-button","","target","_blank",3,"href"],[1,"table","table-inverse","table-responsive"],[4,"ngFor","ngForOf"],["class","text-danger",4,"ngIf"],[1,"text-danger"],["mat-raised-button","","color","accent",1,"text-center","mx-3",3,"click"],["mat-raised-button","","color","primary",1,"text-center","mx-3",3,"click"],[1,"table"]],template:function(t,e){1&t&&(a.TgZ(0,"button",0),a.NdJ("click",function(){return e.show=!e.show}),a._uU(1,"Import Database"),a.qZA(),a.YNc(2,Z,10,5,"div",1),a.YNc(3,k,9,1,"table",2)),2&t&&(a.xp6(2),a.Q6J("ngIf",e.show),a.xp6(1),a.Q6J("ngIf",e.errServer.length>0))},directives:[c.lW,u.O5,p.Hw,c.zs,u.sg],styles:[""],data:{animation:[n.Ym]}}),t})()},85913:function(t,e,r){r.d(e,{m:function(){return a}});var n=r(39609),o=r(24751),s=r(12057),i=r(74788);let a=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[[s.ez,o.UX,n.qX]]}),t})()}}]);