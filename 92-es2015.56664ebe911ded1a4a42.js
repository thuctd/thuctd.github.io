"use strict";(self.webpackChunk_4la=self.webpackChunk_4la||[]).push([[92],{11092:function(t,n,i){i.r(n),i.d(n,{BanHangModule:function(){return un}});var e=i(83886),o=i(88817),a=i(11596),s=i(13397),r=i(48387),c=i(12057),u=i(15228),l=i(24751),h=i(74788),d=i(57922),g=i(84875);let p=(()=>{class t{constructor(t,n){this.plus=t,this.fb=n,this.dbName="ban-hang",this.db=null,this.user=this.plus.user.getValue(),this.main=this.fb.group({}),this.initDB()}initDB(){this.plus.IDB_InitDB(this.dbName).subscribe(t=>{this.db=t})}creatTable(t){"guest"!=t._id&&this.plus.IDB_InitDB(this.dbName).subscribe(n=>{const i=this.plus.sortArr(t.NhomBan,"ThuTu",1);for(let e=0;e<i.length;e++){const o=i[e];this.plus.IDB_DB_Add(this.db,"an-uong",{_id:o.NoiDung+"- MV",status:1,dateModify:t.dateModify,TenBan:o.NoiDung+"- MV",NhomBan:o.NoiDung,DonMua:[],ThanhTien:0,GioVao:0,SoKH:0,DaThanhToan:g.gp.unpaid});for(let i=1;i<o.SoLuong;i++)this.plus.IDB_DB_Add(n,"an-uong",{_id:o.NoiDung+"-"+i,status:1,dateModify:t.dateModify,TenBan:o.NoiDung+"-"+i,NhomBan:o.NoiDung,DonMua:[],ThanhTien:0,GioVao:0,SoKH:0,DaThanhToan:g.gp.unpaid})}this.plus.reload("/ban-hang/an-uong")})}clearAnUong(){this.plus.IDB_InitDB(this.dbName).subscribe(t=>{this.plus.IDB_DB_ClearCollection(t,"an-uong").subscribe(t=>console.log("clearAnUong",t))})}thanhToan(t){if(delete t.__v,t.DaThanhToan=g.hg.DaThanhToan,t.NguonThu=g.rP.AnUong,0==t.ThanhTien&&(this.main.patchValue(t),this.main.invalid)){const t=this.plus.getErrValidateForm(this.main);console.log(t)}void 0!==t._id?(delete t.__v,this.plus.httpPut("thanh-toan",t).subscribe(t=>{const n=this.plus.Crypt_DecryptRest(t);this.plus.IDB_DB_Add(this.db,"thanh-toan",n),this.plus.FBS_PostByUser("hang-hoa",n.dateModify).then(()=>{this.reload()})})):this.plus.httpPost("thanh-toan",t).subscribe(t=>{this.plus.IDB_DB_Add(this.db,"thanh-toan",this.plus.Crypt_DecryptRest(t))})}printBill(){if(confirm("B\u1ea1n c\xf3 mu\u1ed1n in h\xf3a \u0111\u01a1n ko?")){let n=window.document.getElementById("bill");var t=window.open("","PRINT");t.document.write(document.documentElement.innerHTML),setTimeout(()=>{t.document.body.innerHTML=n.outerHTML,t.document.close(),t.focus(),t.print(),t.close()},1e3)}}reload(){this.plus.reload("/ban-hang/an-uong")}}return t.\u0275fac=function(n){return new(n||t)(h.LFG(d.T),h.LFG(l.qu))},t.\u0275prov=h.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var m=i(23202),Z=i(2895),f=i(49356),T=i(46833),b=i(46113),A=i(61260),q=i(17935),x=i(73888);function _(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"mat-chip",27),h.NdJ("click",function(){const n=h.CHM(t).$implicit;return h.oxw().onEditArea(n)}),h._uU(1),h.qZA()}if(2&t){const t=n.$implicit;h.xp6(1),h.hij("Khu ",t.KhuVuc,"")}}function v(t,n){if(1&t&&(h.TgZ(0,"button",28),h._uU(1),h.qZA()),2&t){const t=n.index;h.xp6(1),h.hij(" ",t+1,"")}}function D(t,n){if(1&t&&(h.TgZ(0,"mat-option",29),h._uU(1),h.qZA()),2&t){const t=n.$implicit;h.Q6J("value",t.GiaTri),h.xp6(1),h.Oqu(t.NoiDung)}}function N(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"button",30),h.NdJ("click",function(){return h.CHM(t),h.oxw().saveArea()}),h.TgZ(1,"mat-icon"),h._uU(2,"save"),h.qZA(),h.qZA()}2&t&&h.Q6J("@slideIn",void 0)}function y(t,n){if(1&t&&(h.TgZ(0,"mat-option",29),h._uU(1),h.qZA()),2&t){const t=n.$implicit;h.Q6J("value",t.KhuVuc),h.xp6(1),h.hij("",t.KhuVuc," ")}}function B(t,n){if(1&t&&(h.TgZ(0,"mat-option",29),h._uU(1),h.qZA()),2&t){const t=n.$implicit;h.Q6J("value",t.GiaTri),h.xp6(1),h.Oqu(t.NoiDung)}}function I(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"button",30),h.NdJ("click",function(){return h.CHM(t),h.oxw().saveTable()}),h.TgZ(1,"mat-icon"),h._uU(2,"save"),h.qZA(),h.qZA()}2&t&&h.Q6J("@slideIn",void 0)}let C=(()=>{class t{constructor(t,n,i){this.plus=t,this.fb=n,this.bhSV=i,this.chart=[],this.areaForm=this.fb.group({_id:[,[]],KhuVuc:[,[l.kI.required]],TrangThai:[1,[l.kI.required]]}),this.tableForm=this.fb.group({_id:[,[]],KhuVuc:[,[l.kI.required]],TenBan:[,[l.kI.required]],TrangThai:[1,[l.kI.required]]}),this.title="Qu\u1ea3n l\xfd",this.dbName="ban-hang",this.api="quan-ly",this.apiArea="khu-vuc",this.apiTable="quan-ly/ban",this.db=null,this.areas=[],this.selectedItem=null,this.filter=[]}ngOnInit(){this.plus.setTiTle(this.title),this.getAllArea()}ngOnDestroy(){console.log("Destroy",this.api),this.plus.subs.unsubscribe()}getAllArea(){this.plus.httpGet(this.apiArea).subscribe(t=>{this.areas=this.plus.Crypt_DecryptRest(t),console.log(this.areas)})}saveArea(){if(this.areaForm.invalid)return;const t=this.areaForm.value;if(null==t._id)delete t._id,this.plus.httpPost(this.apiArea,t).subscribe(t=>{t.status&&this.plus.clickBtn("openModalA")});else{if(!confirm("C\u1eadp nh\u1eadt t\u1ea5t c\u1ea3 b\xe0n c\xf3 c\xf9ng khu v\u1ef1c?"))return this.plus.clickBtn("openModalA");this.plus.httpPut(this.apiArea,t).subscribe(t=>{t.status&&this.plus.clickBtn("openModalA")})}this.getAllArea()}onEditArea(t){this.selectedItem=t,this.areaForm.patchValue(t),this.plus.clickBtn("openModalA")}onDeleteArea(t){this.plus.httpDelete(this.apiArea,t._id).subscribe(t=>{console.log(t),this.getAllArea()})}saveTable(){}closeModal(){this.areaForm.reset(),this.tableForm.reset()}search(t){this.filter=t}find(t){this.areas=t}checkPer(t){return this.plus.checkPer(this.api,t)}patchForm(){}reload(){return this.plus.reload(this.dbName+"/"+this.api)}reset(){this.plus.loaded(),this.filter=[]}changePage(t){this.filter=this.areas.slice(t.pageIndex*t.pageSize,(t.pageIndex+1)*t.pageSize)}trackByFn(t,n){return n}}return t.\u0275fac=function(n){return new(n||t)(h.Y36(d.T),h.Y36(l.qu),h.Y36(p))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-quan-ly"]],decls:68,vars:16,consts:[[1,"container"],[1,"row"],["color","accent",3,"click",4,"ngFor","ngForOf"],["color","warn","mat-icon-button","","data-toggle","modal","data-target","#modelIdA"],[1,"list","text-center"],["color","warn","mat-icon-button","","data-toggle","modal","data-target","#modelIdT"],["data-dismiss","modal","mat-mini-fab","",4,"ngFor","ngForOf","ngForTrackBy"],["id","openModalA","type","button","data-toggle","modal","data-target","#modelIdA",1,"d-none"],["id","modelIdA","data-backdrop","static","tabindex","-1","role","dialog","aria-labelledby","modelTitleId","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-body"],[1,"container-fluid"],[3,"formGroup"],["hidden","","formControlName","_id"],["type","text","autocomplete","off","matInput","","formControlName","KhuVuc"],["matSuffix",""],["required","","formControlName","TrangThai"],[3,"value",4,"ngFor","ngForOf"],[1,"modal-footer"],["id","closeModal","mat-raised-button","","color","primary","data-dismiss","modal",3,"click"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["id","openModalT","type","button","data-toggle","modal","data-target","#modelIdT",1,"d-none"],["id","modelIdT","data-backdrop","static","tabindex","-1","role","dialog","aria-labelledby","modelTitleId","aria-hidden","true",1,"modal","fade"],[1,"tit"],["formControlName","KhuVuc"],["placeholder","VD: A-1, Vip-6","type","text","autocomplete","off","matInput","","formControlName","TenBan"],["color","accent",3,"click"],["data-dismiss","modal","mat-mini-fab",""],[3,"value"],["mat-raised-button","","color","warn",3,"click"]],template:function(t,n){1&t&&(h.TgZ(0,"div",0),h.TgZ(1,"div",1),h.TgZ(2,"mat-chip-list"),h.YNc(3,_,2,1,"mat-chip",2),h.TgZ(4,"button",3),h.TgZ(5,"mat-icon"),h._uU(6,"control_point"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(7,"div",1),h.TgZ(8,"div",4),h.TgZ(9,"button",5),h.TgZ(10,"mat-icon"),h._uU(11,"control_point"),h.qZA(),h.qZA(),h.YNc(12,v,2,1,"button",6),h.qZA(),h.qZA(),h.qZA(),h._UZ(13,"button",7),h.TgZ(14,"div",8),h.TgZ(15,"div",9),h.TgZ(16,"div",10),h.TgZ(17,"div",11),h.TgZ(18,"div",12),h.TgZ(19,"form",13),h._UZ(20,"input",14),h.TgZ(21,"mat-form-field"),h.TgZ(22,"mat-label"),h._uU(23,"Khu v\u1ef1c"),h.qZA(),h._UZ(24,"input",15),h._UZ(25,"span",16),h.qZA(),h.TgZ(26,"mat-form-field"),h.TgZ(27,"mat-label"),h._uU(28,"Tr\u1ea1ng th\xe1i"),h.qZA(),h.TgZ(29,"mat-select",17),h.YNc(30,D,2,2,"mat-option",18),h.ALo(31,"catalog"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(32,"div",19),h.TgZ(33,"button",20),h.NdJ("click",function(){return n.closeModal()}),h.TgZ(34,"mat-icon"),h._uU(35,"close"),h.qZA(),h.qZA(),h.YNc(36,N,3,1,"button",21),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h._UZ(37,"button",22),h.TgZ(38,"div",23),h.TgZ(39,"div",9),h.TgZ(40,"div",10),h.TgZ(41,"div",11),h.TgZ(42,"div",12),h.TgZ(43,"h5",24),h._uU(44,"Qu\u1ea3n l\xfd b\xe0n"),h.qZA(),h.TgZ(45,"form",13),h._UZ(46,"input",14),h.TgZ(47,"mat-form-field"),h.TgZ(48,"mat-label"),h._uU(49,"Khu v\u1ef1c"),h.qZA(),h.TgZ(50,"mat-select",25),h.YNc(51,y,2,2,"mat-option",18),h.qZA(),h.qZA(),h.TgZ(52,"mat-form-field"),h.TgZ(53,"mat-label"),h._uU(54,"T\xean b\xe0n"),h.qZA(),h._UZ(55,"input",26),h._UZ(56,"span",16),h.qZA(),h.TgZ(57,"mat-form-field"),h.TgZ(58,"mat-label"),h._uU(59,"Tr\u1ea1ng th\xe1i"),h.qZA(),h.TgZ(60,"mat-select",17),h.YNc(61,B,2,2,"mat-option",18),h.ALo(62,"catalog"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(63,"div",19),h.TgZ(64,"button",20),h.NdJ("click",function(){return n.closeModal()}),h.TgZ(65,"mat-icon"),h._uU(66,"close"),h.qZA(),h.qZA(),h.YNc(67,I,3,1,"button",21),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(3),h.Q6J("ngForOf",n.areas),h.xp6(9),h.Q6J("ngForOf",n.filter.length>0?n.filter:n.areas)("ngForTrackBy",n.trackByFn),h.xp6(7),h.Q6J("formGroup",n.areaForm),h.xp6(11),h.Q6J("ngForOf",h.lcZ(31,12,"TrangThaiHoatDong")),h.xp6(3),h.Q6J("@slideIn",void 0),h.xp6(3),h.Q6J("ngIf",n.checkPer(2)&&n.areaForm.valid),h.xp6(9),h.Q6J("formGroup",n.tableForm),h.xp6(6),h.Q6J("ngForOf",n.areas),h.xp6(10),h.Q6J("ngForOf",h.lcZ(62,14,"TrangThaiHoatDong")),h.xp6(3),h.Q6J("@slideIn",void 0),h.xp6(3),h.Q6J("ngIf",n.checkPer(2)&&n.tableForm.valid))},directives:[m.qn,c.sg,Z.lW,f.Hw,l._Y,l.JL,l.sg,l.Fj,l.JJ,l.u,T.KE,T.hX,b.Nt,T.R9,A.gD,l.Q7,c.O5,m.HS,q.ey],pipes:[x.pW],styles:[""],data:{animation:[u.Ym,u.Mq]}}),t})();var k=i(16738),w=i.n(k),U=i(18849),M=i(46926);let J=(()=>{class t{constructor(t){this.plus=t,this.db=null,this.title="B\xe1o c\xe1o b\xe1n h\xe0ng",this.dbName="ban-hang",this.items=[],this.DoanhThu=0,this.LoiNhuan=0,this.DoanhThuThang=[],this.LoiNhuanThang=[],this.BanChay=[],this.BanNgoiNhieu=[]}ngOnDestroy(){console.log("Destroy bao-cao"),this.plus.subs.unsubscribe()}ngOnInit(){this.plus.setTiTle(this.title),this.plus.IDB_InitDB(this.dbName).subscribe(t=>{this.plus.updateUserLocal(t,"thanh-toan"),this.db=t,this.plus.updateAPi.subscribe(t=>{this.getNhanDon()})})}getNhanDon(){this.plus.subs.add(this.plus.IDB_DB_GetAll(this.db,"thanh-toan").subscribe(t=>{null==t&&(t=[]),this.items=t,this.doanhThuNgay(1)}))}doanhThuNgay(t){const n=this.items,i=Date.now()-24*t*60*60*1e3,e=[];let o=[],a=[];for(let u=0;u<n.length;u++)if(n[u].dateModify>i&&n[u].LoiNhuan>0&&1==n[u].DaThanhToan){const t={LoiNhuan:1e3*n[u].LoiNhuan,ThanhTien:n[u].ThanhTien,Ngay:w()(n[u].dateModify).format("DD/MM")};e.push(t),n[u].DonMua.forEach(t=>{o.push({TenHangHoa:t.TenHangHoa,TongCong:t.TongCong})}),a.push({TenBan:n[u].TenBan,SoKH:n[u].SoKH})}this.DoanhThuThang=this.plus.generateChart(e,"Ngay","ThanhTien"),this.LoiNhuanThang=this.plus.generateChart(e,"Ngay","LoiNhuan");const s=this.plus.sumByKey(e,["ThanhTien","LoiNhuan"]);this.DoanhThu=s.ThanhTien,this.LoiNhuan=s.LoiNhuan;const r=this.plus.sortArr(o,"TongCong"),c=this.plus.generateChart(r,"TenHangHoa","TongCong");this.BanChay=this.plus.generateChart(c.slice(0,5),"x","y"),this.BanNgoiNhieu=this.plus.generateChart(a,"TenBan","SoKH")}}return t.\u0275fac=function(n){return new(n||t)(h.Y36(d.T))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-bao-cao"]],decls:30,vars:30,consts:[[1,"container"],[1,"tit"],[1,"row","text-center"],["mat-raised-button","","color","warn"],[1,"row"],[3,"day"],[1,"row","my-3"],[1,"col-md-6"],[3,"id","arr","label","type"],[3,"id","label","arr","type"],[1,"col-md-4"],[1,"col-md-8"],[3,"id","arr","type","label"]],template:function(t,n){1&t&&(h.TgZ(0,"div",0),h.TgZ(1,"h5",1),h._uU(2,"B\xc1O C\xc1O B\xc1N H\xc0NG"),h.qZA(),h.TgZ(3,"div",2),h.TgZ(4,"button",3),h._uU(5),h.ALo(6,"commas"),h.qZA(),h.TgZ(7,"button",3),h._uU(8),h.ALo(9,"commas"),h.qZA(),h.qZA(),h.TgZ(10,"div",4),h.TgZ(11,"app-chip",5),h.NdJ("day",function(t){return n.doanhThuNgay(t)}),h.qZA(),h.qZA(),h.TgZ(12,"div",6),h.TgZ(13,"div",7),h._UZ(14,"app-chart",8),h.qZA(),h.TgZ(15,"div",7),h._UZ(16,"app-chart",9),h.qZA(),h.qZA(),h._UZ(17,"hr"),h._UZ(18,"h6",1),h.TgZ(19,"div",6),h.TgZ(20,"div",10),h._UZ(21,"app-chart",8),h.qZA(),h.TgZ(22,"div",11),h._UZ(23,"app-chart",8),h.qZA(),h.qZA(),h._UZ(24,"hr"),h.TgZ(25,"div",6),h.TgZ(26,"div",10),h._UZ(27,"app-chart",8),h.qZA(),h.TgZ(28,"div",11),h._UZ(29,"app-chart",12),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(5),h.hij(" Doanh thu: ",h.lcZ(6,26,n.DoanhThu),""),h.xp6(3),h.hij(" L\u1ee3i nhu\u1eadn: ",h.lcZ(9,28,n.LoiNhuan),""),h.xp6(6),h.Q6J("id","doanhthuthang")("arr",n.DoanhThuThang)("label","B\u1ea3ng Doanh thu")("type","line"),h.xp6(2),h.Q6J("id","LoinhuanThan")("label","B\u1ea3ng L\u1ee3i nhu\u1eadn")("arr",n.LoiNhuanThang)("type","bar"),h.xp6(5),h.Q6J("id","BanChay")("arr",n.BanChay)("label","Top b\xe1n ch\u1ea1y")("type","doughnut"),h.xp6(2),h.Q6J("id","BanChayBar")("arr",n.BanChay)("label","Top b\xe1n ch\u1ea1y")("type","bar"),h.xp6(4),h.Q6J("id","BanNgoiNhieu")("arr",n.BanNgoiNhieu)("label","Top B\xe0n kh\xe1ch ch\u1ecdn")("type","doughnut"),h.xp6(2),h.Q6J("id","BanNgoiNhieuBar")("arr",n.BanNgoiNhieu)("type","bar")("label","Top B\xe0n kh\xe1ch ch\u1ecdn"))},directives:[Z.lW,U.Y,M.x],pipes:[x.W],styles:["mat-chip[_ngcontent-%COMP%]{max-width:200px}"]}),t})();function H(t,n){1&t&&(h.TgZ(0,"h4",4),h._uU(1,"\u0110\xe3 ho\xe0n th\xe0nh "),h.qZA())}function O(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"button",15),h.NdJ("click",function(){h.CHM(t);const n=h.oxw().index,i=h.oxw().$implicit;return h.oxw().onComplete(i,n)}),h.TgZ(1,"mat-icon"),h._uU(2,"done"),h.qZA(),h.qZA()}}function F(t,n){if(1&t&&(h.TgZ(0,"div",9),h.TgZ(1,"b",10),h._uU(2),h.TgZ(3,"b",11),h._uU(4),h.qZA(),h.qZA(),h.TgZ(5,"i",12),h._uU(6),h.qZA(),h._UZ(7,"br"),h.TgZ(8,"i",13),h._uU(9),h.ALo(10,"fromNow"),h.qZA(),h.YNc(11,O,3,0,"button",14),h.qZA()),2&t){const t=n.$implicit,i=h.oxw(2);h.Q6J("@slideIn",void 0),h.xp6(2),h.hij("",t.TenHangHoa,": "),h.xp6(2),h.AsE(" ",t.TongCong," ",t.DVT," "),h.xp6(2),h.Oqu(t.GhiChu),h.xp6(3),h.Oqu(h.lcZ(10,7,t.GioVao)),h.xp6(2),h.Q6J("ngIf",i.checkPer(2)&&0==t.DaLam)}}function Q(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"div"),h.TgZ(1,"div",5),h.TgZ(2,"h4",6),h._uU(3),h.qZA(),h.YNc(4,F,12,9,"div",7),h.TgZ(5,"button",8),h.NdJ("click",function(){const n=h.CHM(t).$implicit;return h.oxw().onCompleteAll(n)}),h.TgZ(6,"mat-icon"),h._uU(7,"done_all"),h.qZA(),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=n.$implicit;h.xp6(3),h.Oqu(t.TenBan),h.xp6(1),h.Q6J("ngForOf",t.DonMua)}}let P=(()=>{class t{constructor(t,n){this.plus=t,this.fb=n,this.dbName="ban-hang",this.db=null,this.api="an-uong",this.items=[],this.tittle="Pha ch\u1ebf",this.DonMua=[],this.groups=[],this.main=this.fb.group({_id:[,[]],idHangHoa:[,[l.kI.required]],TrangThai:[0,[l.kI.required]]})}ngOnDestroy(){this.plus.subs.unsubscribe(),console.log("Destroy pha-che")}ngOnInit(){this.plus.setTiTle(this.tittle),this.plus.IDB_InitDB(this.dbName).subscribe(t=>{this.db=t,this.plus.updateUserLocal(t,this.api),this.plus.updateAPi.subscribe(n=>{this.getIDB(t)})})}getIDB(t){this.groups=[],this.plus.IDB_DB_GetAll(t,this.api).subscribe(t=>{let n=[];for(let i=0;i<t.length;i++)if(0==t[i].DaThanhToan){const e=t[i].DonMua.filter(t=>(0==t.DaLam&&(this.addNewItem(t),this.groups.push(t),this.plus.notify_send("C\xf3 kh\xe1ch v\xe0o!"),this.plus.playUpdate()),0==t.DaLam));e.length>0&&(t[i].DonMua=e,n.push(t[i]))}this.items=n,console.log(this.groups),this.groupItems()})}groupItems(){const t=this.plus.obj_GroupByKey(this.groups,"TenHangHoa");console.log(t)}addNewItem(t){const n=this.DonMua.find(n=>n._id==t._id);if(window.navigator.vibrate(200),n){const i=this.DonMua.findIndex(t=>t._id==n._id);this.DonMua[i].TongCong+=t.TongCong}else t.TongCong=1,t.GioVao=Date.now(),t.DaLam=!1,this.DonMua.push(t)}onComplete(t,n){console.log(t,n);const i=t;delete i.__v,i.DonMua[n].DaLam=!0,console.log(i),this.plus.httpPut(this.api,i).subscribe(t=>{console.log(t),this.getIDB(this.db)})}onCompleteAll(t){const n=t;delete n.__v;for(let i=0;i<n.DonMua.length;i++)n.DonMua[i].DaLam=!0;console.log(n),this.plus.httpPut(this.api,n).subscribe(t=>{console.log(t),this.plus.IDB_DB_Add(this.db,this.api,n),this.getIDB(this.db)})}reload(){this.plus.reload("ban-hang/pha-che")}checkPer(t){return this.plus.checkPer(this.api,t)}}return t.\u0275fac=function(n){return new(n||t)(h.Y36(d.T),h.Y36(l.qu))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-pha-che"]],decls:4,vars:2,consts:[[1,"container"],["class","text-center text-primary",4,"ngIf"],[1,"card-group"],[4,"ngFor","ngForOf"],[1,"text-center","text-primary"],[1,"card","text-center","mx-3","mb-3"],[1,"card-title","bg-success"],["class","card-body text-left",4,"ngFor","ngForOf"],["mat-raised-button","","color","accent",3,"click"],[1,"card-body","text-left"],[1,"font-blue"],[1,"text-danger","mx-3"],[1,"font-red","font-note"],[1,"mx-3"],["hidden","","mat-raised-button","","color","accent",3,"click",4,"ngIf"],["hidden","","mat-raised-button","","color","accent",3,"click"]],template:function(t,n){1&t&&(h.TgZ(0,"div",0),h.YNc(1,H,2,0,"h4",1),h.TgZ(2,"div",2),h.YNc(3,Q,8,2,"div",3),h.qZA(),h.qZA()),2&t&&(h.xp6(1),h.Q6J("ngIf",0==n.items.length),h.xp6(2),h.Q6J("ngForOf",n.items))},directives:[c.O5,c.sg,Z.lW,f.Hw],pipes:[x.dw],styles:[".card[_ngcontent-%COMP%]{border-radius:1rem}.card-title[_ngcontent-%COMP%]{border-radius:1rem}"],data:{animation:[u.Ym]}}),t})();var G=i(33982),L=i(48842),Y=i(13269);function S(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"mat-chip",24),h.NdJ("click",function(){const n=h.CHM(t).$implicit;return h.oxw(2).showArea(n.NoiDung)}),h._uU(1),h.qZA()}if(2&t){const t=n.$implicit,i=h.oxw(2);h.Q6J("selected",i.area==t.NoiDung),h.xp6(1),h.hij("Khu ",t.NoiDung,"")}}function V(t,n){if(1&t&&(h.TgZ(0,"button",30),h._uU(1),h.ALo(2,"commas"),h.qZA()),2&t){const t=h.oxw().$implicit;h.xp6(1),h.Oqu(h.lcZ(2,1,t.ThanhTien))}}function E(t,n){if(1&t&&(h.TgZ(0,"span",31),h._uU(1),h.ALo(2,"fromNow"),h.qZA()),2&t){const t=h.oxw().$implicit;h.xp6(1),h.hij(" ",h.lcZ(2,1,t.GioVao),"")}}const $=function(t){return{"border-danger":t}};function K(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"div",25),h.TgZ(1,"div",26),h.NdJ("click",function(){const n=h.CHM(t).$implicit;return h.oxw(2).chooseTable(n)}),h.TgZ(2,"h4",27),h._uU(3),h.qZA(),h.YNc(4,V,3,3,"button",28),h.YNc(5,E,3,3,"span",29),h.qZA(),h.qZA()}if(2&t){const t=n.$implicit;h.xp6(1),h.Q6J("ngClass",h.VKq(4,$,t.ThanhTien>0)),h.xp6(2),h.Oqu(t.TenBan),h.xp6(1),h.Q6J("ngIf",t.ThanhTien>0),h.xp6(1),h.Q6J("ngIf",t.GioVao>0)}}function j(t,n){if(1&t&&(h.TgZ(0,"div",20),h.TgZ(1,"div",2),h.TgZ(2,"mat-chip-list"),h.YNc(3,S,2,2,"mat-chip",21),h.qZA(),h.TgZ(4,"button",22),h._uU(5,"Th\xeam b\xe0n"),h.qZA(),h.qZA(),h.TgZ(6,"div",2),h.YNc(7,K,6,6,"div",23),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(3),h.Q6J("ngForOf",t.TabBan),h.xp6(4),h.Q6J("ngForOf",t.ChiaBan)}}function z(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"mat-chip",24),h.NdJ("click",function(){const n=h.CHM(t).$implicit;return h.oxw(2).orderByGroup(n)}),h._uU(1),h.qZA()}if(2&t){const t=n.$implicit,i=n.index,e=h.oxw(2);h.Q6J("selected",e.indexNhomHang==i),h.xp6(1),h.Oqu(t.NoiDung)}}function R(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"div",1),h.NdJ("click",function(){h.CHM(t);const n=h.oxw().$implicit;return h.oxw(2).chooseProduct(n)}),h.TgZ(1,"div",37),h.TgZ(2,"h4",38),h._uU(3),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=h.oxw().$implicit;h.xp6(1),h.Udp("border-bottom-color",t.HinhAnh),h.xp6(2),h.hij("",t.TenHangHoa," ")}}function W(t,n){if(1&t&&(h.TgZ(0,"div",35),h.YNc(1,R,4,3,"div",36),h.qZA()),2&t){const t=n.$implicit;h.xp6(1),h.Q6J("ngIf",t.TrangThai)}}function X(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"div"),h.TgZ(1,"button",32),h.NdJ("click",function(){return h.CHM(t),h.oxw().reload()}),h._uU(2,"Ch\u1ecdn b\xe0n"),h.qZA(),h.TgZ(3,"button",33),h.NdJ("click",function(){return h.CHM(t),h.oxw().saveBill()}),h._uU(4,"L\u01b0u"),h.qZA(),h.TgZ(5,"mat-chip-list"),h.YNc(6,z,2,2,"mat-chip",21),h.qZA(),h._UZ(7,"hr"),h.TgZ(8,"div",2),h.YNc(9,W,2,1,"div",34),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.xp6(6),h.Q6J("ngForOf",t.NhomHang),h.xp6(3),h.Q6J("ngForOf",t.products)}}function tt(t,n){if(1&t&&(h.TgZ(0,"h6",42),h.TgZ(1,"i"),h._uU(2),h.ALo(3,"commas"),h.qZA(),h.qZA()),2&t){const t=h.oxw(2);h.xp6(2),h.hij(" T\u1ea1m t\xednh ",h.lcZ(3,1,t.table.ThanhTien)," K ")}}function nt(t,n){if(1&t&&(h.TgZ(0,"span"),h._uU(1),h.qZA()),2&t){const t=h.oxw().$implicit;h.xp6(1),h.hij(" (+ ",t.GhiChu.length-1,") ")}}function it(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"mat-option",49),h.NdJ("click",function(){const n=h.CHM(t).$implicit,i=h.oxw().$implicit;return h.oxw(2).addNote(i._id,n)}),h._uU(1),h.qZA()}if(2&t){const t=n.$implicit;h.Q6J("value",t.NoiDung),h.xp6(1),h.hij(" ",t.NoiDung," ")}}function et(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"mat-list-option"),h.TgZ(1,"table"),h.TgZ(2,"tr"),h.TgZ(3,"td"),h._uU(4),h.qZA(),h.TgZ(5,"td"),h._uU(6),h.ALo(7,"number"),h.qZA(),h.TgZ(8,"td"),h._uU(9),h.qZA(),h.TgZ(10,"td"),h.TgZ(11,"mat-icon",43),h._uU(12,"delete"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(13,"tr"),h.TgZ(14,"td"),h.TgZ(15,"mat-select",44),h.TgZ(16,"mat-select-trigger"),h._uU(17),h.YNc(18,nt,2,1,"span",5),h.qZA(),h.YNc(19,it,2,2,"mat-option",45),h.ALo(20,"catalog"),h.TgZ(21,"mat-form-field"),h._UZ(22,"input",46,47),h.TgZ(24,"mat-icon",48),h.NdJ("click",function(){const n=h.CHM(t).$implicit,i=h.MAs(23);return n.GhiChu[0]=i.value}),h._uU(25,"save"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=n.$implicit;h.xp6(4),h.hij("",t.TenHangHoa,":"),h.xp6(2),h.Oqu(h.lcZ(7,8,t.SoLuong)),h.xp6(3),h.hij(" ",t.DVT,""),h.xp6(6),h.Q6J("placeholder","\u270e"),h.xp6(2),h.hij("",t.GhiChu[1]," "),h.xp6(1),h.Q6J("ngIf",t.GhiChu.length>1),h.xp6(1),h.Q6J("ngForOf",h.lcZ(20,10,"GhiChuMon")),h.xp6(3),h.s9C("value",t.GhiChu[0])}}function ot(t,n){if(1&t&&(h.TgZ(0,"div"),h.YNc(1,tt,4,3,"h6",39),h._UZ(2,"hr"),h.TgZ(3,"mat-selection-list",40),h.YNc(4,et,26,12,"mat-list-option",41),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(1),h.Q6J("ngIf",t.table.ThanhTien>0),h.xp6(2),h.Q6J("multiple",!1),h.xp6(1),h.Q6J("ngForOf",null==t.table?null:t.table.DonMua)}}let at=(()=>{class t{constructor(t,n,i,e,o){this.plus=t,this.route=n,this.fb=i,this.bhsv=e,this.rtSv=o,this.global=!1,this.DonMua=[],this.ThanhTien=0,this.donHang=[],this.filter=[],this.ChiaBan=[],this.ban=0,this.xemBan=!0,this.xemMon=!1,this.db=null,this.title="D\u1ecbch v\u1ee5 \u0103n u\u1ed1ng",this.dbName="ban-hang",this.api="thanh-toan",this.room=this.global?this.api:this.plus.userId+this.api,this.user=this.plus.user.getValue(),this.items=[],this.TabBan=this.plus.sortArr(this.plus.user.getValue().NhomBan,"ThuTu",1),this.NhomHang=this.plus.user.getValue().NhomHang,this.step=0,this.area=this.TabBan[0].NoiDung,this.group=this.NhomHang[0],this.products=[],this.printTime=Date.now(),this.total=0}ngOnDestroy(){console.log("Destroy an-uong"),this.plus.subs.unsubscribe(),this.rtSv.leaveRoom(this.room)}ngOnInit(){this.plus.setTiTle(this.title),this.plus.IDB_InitDB(this.dbName).subscribe(t=>{this.db=t,this.showArea(this.area),this.plus.updateUserLocal(t,this.api),this.plus.updateAPi.subscribe(t=>{this.showArea(this.area)})})}get(){this.rtSv.get("thanh-toan",this.plus.user.value._id,!1)}set(){this.rtSv.set("thanh-toan",this.plus.user.value._id,Date.now(),!1)}print(){this.bhsv.printBill()}showArea(t){this.step=0,this.plus.IDB_DB_GetAllByIndexKey(this.bhsv.db,"an-uong","NhomBan",t).subscribe(n=>{this.ChiaBan=n,this.area=t})}chooseTable(t){this.step=1,this.table=t,this.table.GioVao=Date.now(),this.orderByGroup(this.group)}orderByGroup(t){this.plus.IDB_DB_GetAllByIndexKey(this.db,"hang-hoa","NhomHang",t.NoiDung).subscribe(t=>{this.products=t})}chooseProduct(t){let n=0,i=0;const e={_id:t._id,TenHangHoa:t.TenHangHoa,GiaBan:t.GiaBan,GiaVon:t.GiaVon,KhuyenMai:t.KhuyenMai,DaLam:0,DVT:t.DVT,SoLuong:0,GhiChu:[" "]},o=this.table.DonMua.findIndex(n=>n._id==t._id);-1==o?(e.SoLuong=1,this.table.DonMua.push(e)):this.table.DonMua[o].SoLuong+=1;const a=this.table.DonMua;for(let s=0;s<a.length;s++)n+=(a[s].GiaBan-a[s].GiaVon)*a[s].SoLuong,i+=a[s].GiaBan*a[s].SoLuong,this.table.SoKH+=a[s].SoLuong;this.table.ThanhTien=i,this.table.LoiNhuan=n}addNote(t,n){const i=this.table.DonMua.findIndex(n=>n._id==t),e=this.table.DonMua[i].GhiChu.findIndex(t=>t==n);this.table.DonMua[i].GhiChu.includes(n.NoiDung)?this.table.DonMua[i].GhiChu.splice(e,1):this.table.DonMua[i].GhiChu.push(n.NoiDung)}saveBill(){console.log(this.table)}addArea(){}thanhToan(){}removeItem(t){}addItem(t,n){}delItem(t){}updateList(t,n,i){const e=+i.target.textContent;if(console.log(e),"Enter"===i.key&&i.preventDefault(),"number"!=typeof e)return this.plus.alertError("Sai \u0111\u1ecbnh d\u1ea1ng"),this.DonMua[t][n]=0;this.DonMua[t][n]=+e}back(){this.step=this.step-1}reload(){this.plus.reload("ban-hang/an-uong")}}return t.\u0275fac=function(n){return new(n||t)(h.Y36(d.T),h.Y36(G.gz),h.Y36(l.qu),h.Y36(p),h.Y36(L.i))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-an-uong"]],decls:31,vars:6,consts:[[1,"container-fluid"],[3,"click"],[1,"row"],[1,"col-md-9"],["class","step0",4,"ngIf"],[4,"ngIf"],[1,"col-md-3","border","rounded","py-2"],[1,"text-center"],["mat-raised-button","","color","warn",3,"click"],["id","addArea","tabindex","-1","role","dialog","aria-labelledby","modelTitleId","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-body"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary"],[1,"step0"],["color","accent",3,"selected","click",4,"ngFor","ngForOf"],["id","add-btn","mat-raised-button","","data-toggle","modal","data-target","#addArea"],["class","card-group",4,"ngFor","ngForOf"],["color","accent",3,"selected","click"],[1,"card-group"],[1,"card","hangHoa",3,"ngClass","click"],[1,"text-center","pt-3"],["class","badge badge-warning",4,"ngIf"],["class","badge badge-light",4,"ngIf"],[1,"badge","badge-warning"],[1,"badge","badge-light"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","accent",3,"click"],["class","card-group clearfix","id","item",4,"ngFor","ngForOf"],["id","item",1,"card-group","clearfix"],[3,"click",4,"ngIf"],[1,"card","hangHoa"],[1,"text-center","py-3"],["class","text-center text-primary",4,"ngIf"],[3,"multiple"],[4,"ngFor","ngForOf"],[1,"text-center","text-primary"],["color","warn"],["multiple","",1,"mat-select-red",3,"placeholder"],[3,"value","click",4,"ngFor","ngForOf"],["matInput","","placeholder","Ghi ch\xfa kh\xe1c",3,"value"],["note",""],["matSuffix","",3,"click"],[3,"value","click"]],template:function(t,n){1&t&&(h.TgZ(0,"div",0),h.TgZ(1,"button",1),h.NdJ("click",function(){return n.set()}),h._uU(2," set"),h.qZA(),h.TgZ(3,"button",1),h.NdJ("click",function(){return n.get()}),h._uU(4," get"),h.qZA(),h.TgZ(5,"div",2),h.TgZ(6,"div",3),h.YNc(7,j,8,2,"div",4),h.YNc(8,X,10,2,"div",5),h.qZA(),h.TgZ(9,"div",6),h.TgZ(10,"div",7),h.TgZ(11,"button",8),h.NdJ("click",function(){return n.thanhToan()}),h._uU(12),h.ALo(13,"uppercase"),h.qZA(),h.qZA(),h.YNc(14,ot,5,3,"div",5),h.qZA(),h.qZA(),h.qZA(),h.TgZ(15,"div",9),h.TgZ(16,"div",10),h.TgZ(17,"div",11),h.TgZ(18,"div",12),h.TgZ(19,"h5",13),h._uU(20,"Th\xeam b\xe0n"),h.qZA(),h.TgZ(21,"button",14),h.TgZ(22,"span",15),h._uU(23,"\xd7"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(24,"div",16),h._uU(25," Body "),h.qZA(),h.TgZ(26,"div",17),h.TgZ(27,"button",18),h._uU(28,"Close"),h.qZA(),h.TgZ(29,"button",19),h._uU(30,"Save"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(7),h.Q6J("ngIf",n.step<1),h.xp6(1),h.Q6J("ngIf",1==n.step),h.xp6(4),h.hij("Th\u1ef1c \u0111\u01a1n ",h.lcZ(13,4,null==n.table?null:n.table.TenBan),""),h.xp6(2),h.Q6J("ngIf",n.table))},directives:[c.O5,Z.lW,m.qn,c.sg,m.HS,c.mk,Y.Ub,Y.vS,f.Hw,A.gD,A.$L,T.KE,b.Nt,T.R9,q.ey],pipes:[c.gd,x.W,x.dw,c.JJ,x.pW],styles:[".hangHoa[_ngcontent-%COMP%]{height:10rem;width:10rem;border-radius:1rem;border-bottom-width:3rem;border-color:#90ee90;color:#00f;float:none;align-items:center;justify-content:center}.hangHoa[_ngcontent-%COMP%]:active{transform:scale(1.1);opacity:50%;background-color:tomato}.new[_ngcontent-%COMP%]{height:10rem;width:10rem;border-radius:1rem;border-bottom-width:3rem;border-color:#90ee90;color:#00f;float:none;align-items:center;justify-content:center}.hoadon[_ngcontent-%COMP%]{width:200px}.mat-list-text[_ngcontent-%COMP%]{color:#00f!important;font-weight:bold;padding-bottom:3px;padding-top:3px}.mat-select-placeholder[_ngcontent-%COMP%]{color:#007bff}  .mat-pseudo-checkbox-checked, .mat-pseudo-checkbox-indeterminate[_ngcontent-%COMP%], .mat-accent[_ngcontent-%COMP%]   .mat-pseudo-checkbox-checked[_ngcontent-%COMP%], .mat-accent[_ngcontent-%COMP%]   .mat-pseudo-checkbox-indeterminate[_ngcontent-%COMP%]{background:tomato!important}.mat-select-red[_ngcontent-%COMP%]{color:tomato!important}  .mat-select-value{color:#00f!important;font-style:italic!important;font-size:small!important}  .mat-select-content{width:20px;background-color:red;font-size:10px}  .mat-select-placeholder{color:#00f!important;font-size:17px}"],data:{animation:[u.Ym,u.Mq]}}),t})();var st=i(46936),rt=i(23487),ct=i(97012),ut=i(15265),lt=i(73624),ht=i(25862),dt=i(55352);function gt(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"button",36),h.NdJ("click",function(){return h.CHM(t),h.oxw().reload()}),h.TgZ(1,"mat-icon"),h._uU(2,"undo"),h.qZA(),h.qZA()}2&t&&h.Q6J("@slideIn",void 0)}function pt(t,n){1&t&&(h.TgZ(0,"th"),h._uU(1,"M\xe3 v\u1ea1ch"),h.qZA())}function mt(t,n){1&t&&(h.TgZ(0,"th"),h._uU(1,"Nh\xf3m h\xe0ng"),h.qZA())}function Zt(t,n){1&t&&(h.TgZ(0,"th"),h._uU(1,"Khuy\u1ebfn m\xe3i"),h.qZA())}function ft(t,n){1&t&&(h.TgZ(0,"th"),h._uU(1,"\u0110\u01a1n v\u1ecb t\xednh"),h.qZA())}function Tt(t,n){1&t&&(h.TgZ(0,"th"),h._uU(1,"Gi\xe1 v\u1ed1n"),h.qZA())}function bt(t,n){1&t&&(h.TgZ(0,"th"),h._uU(1,"Quy \u0111\u1ed5i \u0111\u01a1n v\u1ecb"),h.qZA())}function At(t,n){1&t&&(h.TgZ(0,"th"),h._uU(1,"H\xecnh \u1ea3nh"),h.qZA())}function qt(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"td",44),h.NdJ("click",function(){h.CHM(t);const n=h.oxw().$implicit;return h.oxw(2).onEdit(n)}),h._uU(1),h.qZA()}if(2&t){const t=h.oxw().$implicit;h.xp6(1),h.Oqu(t.Barcode)}}function xt(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"td",44),h.NdJ("click",function(){h.CHM(t);const n=h.oxw().$implicit;return h.oxw(2).onEdit(n)}),h._uU(1),h.qZA()}if(2&t){const t=h.oxw().$implicit;h.xp6(1),h.Oqu(t.NhomHang)}}function _t(t,n){if(1&t&&(h.TgZ(0,"td"),h._uU(1),h.qZA()),2&t){const t=h.oxw().$implicit;h.xp6(1),h.Oqu(t.KhuyenMai)}}function vt(t,n){if(1&t&&(h.TgZ(0,"td"),h._uU(1),h.qZA()),2&t){const t=h.oxw().$implicit;h.xp6(1),h.Oqu(t.DVT)}}function Dt(t,n){if(1&t&&(h.TgZ(0,"td"),h._uU(1),h.qZA()),2&t){const t=h.oxw().$implicit;h.xp6(1),h.Oqu(t.GiaVon)}}function Nt(t,n){if(1&t&&(h.TgZ(0,"td"),h._uU(1),h.qZA()),2&t){const t=h.oxw().$implicit;h.xp6(1),h.Oqu(t.QuyDoi)}}function yt(t,n){if(1&t&&(h.TgZ(0,"td"),h._uU(1),h.qZA()),2&t){const t=h.oxw().$implicit;h.xp6(1),h.Oqu(t.HinhAnh)}}function Bt(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"mat-icon",47),h.NdJ("click",function(){h.CHM(t);const n=h.oxw().$implicit;return h.oxw(2).onDelete(n)}),h._uU(1,"delete"),h.qZA()}}function It(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"tr"),h.YNc(1,qt,2,1,"td",42),h.YNc(2,xt,2,1,"td",43),h.TgZ(3,"td",44),h.NdJ("click",function(){const n=h.CHM(t).$implicit;return h.oxw(2).onEdit(n)}),h._uU(4),h.qZA(),h.TgZ(5,"td",44),h.NdJ("click",function(){const n=h.CHM(t).$implicit;return h.oxw(2).onEdit(n)}),h._uU(6),h.qZA(),h.TgZ(7,"td",44),h.NdJ("click",function(){const n=h.CHM(t).$implicit;return h.oxw(2).onEdit(n)}),h._uU(8),h.qZA(),h.YNc(9,_t,2,1,"td",38),h.YNc(10,vt,2,1,"td",39),h.TgZ(11,"td"),h.TgZ(12,"mat-slide-toggle",45),h.NdJ("change",function(){const n=h.CHM(t).$implicit;return h.oxw(2).updateStatus(n)}),h.qZA(),h.qZA(),h.YNc(13,Dt,2,1,"td",38),h.YNc(14,Nt,2,1,"td",38),h.YNc(15,yt,2,1,"td",38),h.TgZ(16,"td"),h.YNc(17,Bt,2,0,"mat-icon",46),h.qZA(),h.qZA()}if(2&t){const t=n.$implicit,i=h.oxw(2);h.xp6(1),h.Q6J("ngIf",i.device),h.xp6(1),h.Q6J("Device",2),h.xp6(2),h.Oqu(t.TenHangHoa),h.xp6(2),h.Oqu(t.TonKho),h.xp6(2),h.Oqu(t.GiaBan),h.xp6(1),h.Q6J("ngIf",i.device),h.xp6(1),h.Q6J("Device",2),h.xp6(2),h.Q6J("checked",t.TrangThai),h.xp6(1),h.Q6J("ngIf",i.device),h.xp6(1),h.Q6J("ngIf",i.device),h.xp6(1),h.Q6J("ngIf",i.device),h.xp6(2),h.Q6J("ngIf",i.checkPer(4))}}function Ct(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"table",37),h.TgZ(1,"thead"),h.YNc(2,pt,2,0,"th",38),h.YNc(3,mt,2,0,"th",39),h.TgZ(4,"th"),h._uU(5,"T\xean"),h.qZA(),h.TgZ(6,"th"),h._uU(7,"T\u1ed3n kho"),h.qZA(),h.TgZ(8,"th"),h._uU(9,"Gi\xe1n B\xe1n"),h.qZA(),h.YNc(10,Zt,2,0,"th",38),h.YNc(11,ft,2,0,"th",39),h.TgZ(12,"th"),h._uU(13,"Cho b\xe1n"),h.qZA(),h.YNc(14,Tt,2,0,"th",38),h.YNc(15,bt,2,0,"th",38),h.YNc(16,At,2,0,"th",38),h.TgZ(17,"th"),h.TgZ(18,"mat-icon",40),h.NdJ("click",function(){return h.CHM(t),h.oxw().reload()}),h._uU(19,"cached"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(20,"tbody"),h.YNc(21,It,18,12,"tr",41),h.qZA(),h.qZA()}if(2&t){const t=h.oxw();h.Q6J("@slideIn",void 0),h.xp6(2),h.Q6J("ngIf",t.device),h.xp6(1),h.Q6J("Device",2),h.xp6(7),h.Q6J("ngIf",t.device),h.xp6(1),h.Q6J("Device",2),h.xp6(3),h.Q6J("ngIf",t.device),h.xp6(1),h.Q6J("ngIf",t.device),h.xp6(1),h.Q6J("ngIf",t.device),h.xp6(5),h.Q6J("ngForOf",t.filter.length>0?t.filter:t.items.slice(0,10))}}function kt(t,n){if(1&t&&h._UZ(0,"app-import-database",48),2&t){const t=h.oxw();h.Q6J("api",t.api)("form",t.main)("global",!1)}}function wt(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"button",49),h.NdJ("click",function(){return h.CHM(t),h.oxw().resetDB()}),h._uU(1,"X\xf3a to\xe0n b\u1ed9 d\u1eef li\u1ec7u"),h.qZA()}}function Ut(t,n){if(1&t&&(h.TgZ(0,"mat-option",50),h._uU(1),h.qZA()),2&t){const t=n.$implicit;h.s9C("value",t.NoiDung),h.xp6(1),h.hij("",t.NoiDung," ")}}function Mt(t,n){if(1&t&&(h.TgZ(0,"mat-option",50),h._uU(1),h.qZA()),2&t){const t=n.$implicit;h.s9C("value",t.NoiDung),h.xp6(1),h.hij("",t.NoiDung," ")}}function Jt(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"button",51),h.NdJ("click",function(){return h.CHM(t),h.oxw().save()}),h.TgZ(1,"mat-icon"),h._uU(2,"save"),h.qZA(),h.qZA()}2&t&&h.Q6J("@slideIn",void 0)}const Ht=function(){return[5,10,25,100]};let Ot=(()=>{class t{constructor(t,n){this.plus=t,this.fb=n,this.chart=[],this.nhomHang=this.plus.sortArr(this.plus.user.getValue().NhomHang,"ThuTu",1),this.main=this.fb.group({_id:[],Barcode:[""],NhomHang:[,[l.kI.required]],TenHangHoa:[,[l.kI.required]],TonKho:[0],GiaBan:[0,[l.kI.required]],KhuyenMai:[0],DVT:[,[l.kI.required]],TrangThai:[!0],GiaVon:[0,[l.kI.required]],QuyDoi:[],HinhAnh:[]}),this.device=window.innerWidth>1200,this.title="H\xe0ng h\xf3a",this.dbName="ban-hang",this.api="hang-hoa",this.db=null,this.items=[],this.selectedItem=null,this.filter=[],this.itemsAuto=[]}ngOnInit(){this.plus.setTiTle(this.title),this.plus.IDB_InitDB(this.dbName).subscribe(t=>function(t,n,i,e){return new(i||(i=Promise))(function(o,a){function s(t){try{c(e.next(t))}catch(n){a(n)}}function r(t){try{c(e.throw(t))}catch(n){a(n)}}function c(t){t.done?o(t.value):function(t){return t instanceof i?t:new i(function(n){n(t)})}(t.value).then(s,r)}c((e=e.apply(t,n||[])).next())})}(this,void 0,void 0,function*(){this.db=t,this.plus.syncOffline(this.api),this.getIDB(),this.plus.updateUserLocal(t,this.api),this.plus.updateAPi.subscribe(t=>{t&&this.getIDB()})}))}getIDB(){console.log("getIDB"),this.filter=[],this.plus.IDB_DB_GetAll(this.db,this.api).subscribe(t=>{this.items=t,this.plus.updateAPi.next(!1)})}ngOnDestroy(){console.log("Destroy",this.api),this.plus.subs.unsubscribe()}save(){if(this.main.invalid)return;const t=Object.assign({},this.main.value);if(0==this.plus.online.value){const n=[];return n.push(t),this.plus.IDB_DB_AddOff(this.db,this.api,n).subscribe(t=>{this.plus.clickBtn("closeModal")})}null==t._id?(delete t._id,this.plus.httpPost(this.api,t).subscribe(t=>{t.status&&this.plus.clickBtn("closeModal")})):this.plus.httpPut(this.api,t).subscribe(t=>{t.status&&this.plus.clickBtn("closeModal")})}onEdit(t){this.selectedItem=t;const n=this.plus.dateToHtmlObj(t,[""]);this.main.patchValue(n),this.plus.clickBtn("openModal")}onDelete(t){!confirm("B\u1ea1n mu\u1ed1n x\xf3a?")||(this.plus.load(),this.plus.httpDisable(this.api,t).then(t=>{console.log(t)}))}getAuto(t,n){!this.db||n.length<2||(this.itemsAuto=[],this.plus.IDB_DB_Search(this.db,t,n,4).subscribe(t=>{this.itemsAuto=t}))}getBarcode(t){this.main.patchValue({Barcode:t})}chooseOpt(t,n,i,e=!1){this.main.controls[n].setValue(t[i]),e&&this.main.controls[n+"ID"].setValue(t._id)}updateStatus(t){t.TrangThai=!t.TrangThai,delete t.__v,this.plus.httpPost(this.api+"/updateStatus",t).subscribe(t=>{})}closeModal(){this.main.reset()}search(t){this.filter=t}find(t){this.items=t}checkPer(t){return this.plus.checkPer(this.api,t)}patchForm(){}reload(){return this.plus.reload(this.dbName+"/"+this.api)}reset(){this.plus.loaded(),this.filter=[],this.getIDB(),this.main.reset({TonKho:0,TrangThai:!0,KhuyenMai:0,QuyDoi:1,HinhAnh:"#ffffff"})}changePage(t){this.filter=this.items.slice(t.pageIndex*t.pageSize,(t.pageIndex+1)*t.pageSize)}resetDB(){this.plus.resetDB(this.db,this.api)}}return t.\u0275fac=function(n){return new(n||t)(h.Y36(d.T),h.Y36(l.qu))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-hang-hoa"]],decls:82,vars:19,consts:[[1,"container"],["id","add-btn","color","accent","mat-raised-button","","data-toggle","modal","data-target","#modelId",3,"click"],["id","back-btn","mat-raised-button","","color","primary",3,"click",4,"ngIf"],[3,"db","api","filter"],[1,"row"],["class","table table-hover ",4,"ngIf"],[3,"length","pageSize","pageSizeOptions","page"],[3,"api","form","global",4,"ngIf"],[3,"dataJson"],["mat-button","","color","warn",3,"click",4,"ngIf"],["id","openModal","type","button","data-toggle","modal","data-target","#modelId",1,"d-none"],["id","modelId","data-backdrop","static","tabindex","-1","role","dialog","aria-labelledby","modelTitleId","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-body"],[1,"container-fluid"],[3,"formGroup"],["hidden","","formControlName","_id"],["required","","matInput","","formControlName","TenHangHoa"],[1,"col-6"],["required","","formControlName","NhomHang"],[3,"value",4,"ngFor","ngForOf"],["required","","formControlName","DVT"],["type","number","autocomplete","off","matInput","","formControlName","GiaVon",2,"float","right"],["matSuffix",""],["type","number","autocomplete","off","matInput","","formControlName","TonKho",2,"float","right"],["required","","type","number","autocomplete","off","matInput","","formControlName","GiaBan",2,"float","right"],["type","number","autocomplete","off","matInput","","formControlName","KhuyenMai",2,"float","right"],["type","text","autocomplete","off","matInput","","formControlName","QuyDoi"],["type","color","matInput","","formControlName","HinhAnh"],["type","text","autocomplete","off","matInput","","formControlName","Barcode"],[3,"barcodeResult"],["matPrefix","","formControlName","TrangThai","color","primary",1,"mx-2"],[1,"modal-footer"],["id","closeModal","mat-raised-button","","color","primary","data-dismiss","modal",3,"click"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["id","back-btn","mat-raised-button","","color","primary",3,"click"],[1,"table","table-hover"],[4,"ngIf"],[4,"Device"],["color","primary",3,"click"],[4,"ngFor","ngForOf"],[3,"click",4,"ngIf"],[3,"click",4,"Device"],[3,"click"],["matPrefix","","color","primary",1,"mx-2",3,"checked","change"],["color","warn",3,"click",4,"ngIf"],["color","warn",3,"click"],[3,"api","form","global"],["mat-button","","color","warn",3,"click"],[3,"value"],["mat-raised-button","","color","warn",3,"click"]],template:function(t,n){1&t&&(h.TgZ(0,"div",0),h.TgZ(1,"button",1),h.NdJ("click",function(){return n.reset()}),h.TgZ(2,"mat-icon"),h._uU(3,"control_point"),h.qZA(),h.qZA(),h.YNc(4,gt,3,1,"button",2),h.TgZ(5,"app-search-table",3),h.NdJ("filter",function(t){return n.search(t)}),h.qZA(),h.TgZ(6,"div",4),h.YNc(7,Ct,22,9,"table",5),h.qZA(),h.TgZ(8,"mat-paginator",6),h.NdJ("page",function(t){return n.changePage(t)}),h.qZA(),h.YNc(9,kt,1,3,"app-import-database",7),h._UZ(10,"app-export-ecxel",8),h.qZA(),h.YNc(11,wt,2,0,"button",9),h._UZ(12,"button",10),h.TgZ(13,"div",11),h.TgZ(14,"div",12),h.TgZ(15,"div",13),h.TgZ(16,"div",14),h.TgZ(17,"div",15),h.TgZ(18,"form",16),h._UZ(19,"input",17),h.TgZ(20,"mat-form-field"),h.TgZ(21,"mat-label"),h._uU(22,"T\xean"),h.qZA(),h._UZ(23,"textarea",18),h.qZA(),h.TgZ(24,"div",4),h.TgZ(25,"div",19),h.TgZ(26,"mat-form-field"),h.TgZ(27,"mat-label"),h._uU(28,"Nh\xf3m h\xe0ng"),h.qZA(),h.TgZ(29,"mat-select",20),h.YNc(30,Ut,2,2,"mat-option",21),h.qZA(),h.qZA(),h.TgZ(31,"mat-form-field"),h.TgZ(32,"mat-label"),h._uU(33,"\u0110\u01a1n v\u1ecb t\xednh"),h.qZA(),h.TgZ(34,"mat-select",22),h.YNc(35,Mt,2,2,"mat-option",21),h.ALo(36,"catalog"),h.qZA(),h.qZA(),h.TgZ(37,"mat-form-field"),h.TgZ(38,"mat-label"),h._uU(39,"Gi\xe1 v\u1ed1n"),h.qZA(),h._UZ(40,"input",23),h.TgZ(41,"span",24),h._uU(42,".000"),h.qZA(),h.qZA(),h.TgZ(43,"mat-form-field"),h.TgZ(44,"mat-label"),h._uU(45,"T\u1ed3n kho"),h.qZA(),h._UZ(46,"input",25),h._UZ(47,"span",24),h.qZA(),h.TgZ(48,"mat-form-field"),h.TgZ(49,"mat-label"),h._uU(50,"Gi\xe1n B\xe1n"),h.qZA(),h._UZ(51,"input",26),h._UZ(52,"span",24),h.qZA(),h.qZA(),h.TgZ(53,"div",19),h.TgZ(54,"mat-form-field"),h.TgZ(55,"mat-label"),h._uU(56,"Khuy\u1ebfn m\xe3i"),h.qZA(),h._UZ(57,"input",27),h.TgZ(58,"span",24),h._uU(59,"%"),h.qZA(),h.qZA(),h.TgZ(60,"mat-form-field"),h.TgZ(61,"mat-label"),h._uU(62,"Quy \u0111\u1ed5i \u0111\u01a1n v\u1ecb"),h.qZA(),h._UZ(63,"input",28),h._UZ(64,"span",24),h.qZA(),h.TgZ(65,"mat-form-field"),h.TgZ(66,"mat-label"),h._uU(67,"M\xe0u \u0111\u1ea1i di\u1ec7n"),h.qZA(),h._UZ(68,"input",29),h.qZA(),h.TgZ(69,"mat-form-field"),h.TgZ(70,"mat-label"),h._uU(71,"M\xe3 v\u1ea1ch"),h.qZA(),h._UZ(72,"input",30),h.qZA(),h.TgZ(73,"app-barcode-scanner",31),h.NdJ("barcodeResult",function(t){return n.getBarcode(t)}),h.qZA(),h._UZ(74,"hr"),h.TgZ(75,"mat-slide-toggle",32),h._uU(76),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(77,"div",33),h.TgZ(78,"button",34),h.NdJ("click",function(){return n.closeModal()}),h.TgZ(79,"mat-icon"),h._uU(80,"close"),h.qZA(),h.qZA(),h.YNc(81,Jt,3,1,"button",35),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(4),h.Q6J("ngIf",n.filter.length>0),h.xp6(1),h.Q6J("db",n.db)("api",n.api),h.xp6(2),h.Q6J("ngIf",n.items.length+n.filter.length>0),h.xp6(1),h.Q6J("length",n.items.length)("pageSize",10)("pageSizeOptions",h.DdM(18,Ht)),h.xp6(1),h.Q6J("ngIf",n.checkPer(4)),h.xp6(1),h.Q6J("dataJson",n.items),h.xp6(1),h.Q6J("ngIf",n.checkPer(5)),h.xp6(7),h.Q6J("formGroup",n.main),h.xp6(12),h.Q6J("ngForOf",n.nhomHang),h.xp6(5),h.Q6J("ngForOf",h.lcZ(36,16,"DVT")),h.xp6(41),h.hij(" ",n.main.controls.TrangThai.value?"C\xf2n h\xe0ng":"H\u1ebft h\xe0ng",""),h.xp6(2),h.Q6J("@slideIn",void 0),h.xp6(3),h.Q6J("ngIf",n.checkPer(2)&&n.main.valid))},directives:[Z.lW,f.Hw,c.O5,st.D,rt.NW,ct.t,l._Y,l.JL,l.sg,l.Fj,l.JJ,l.u,T.KE,T.hX,b.Nt,l.Q7,A.gD,c.sg,l.wV,T.R9,ut.O,lt.Rr,T.qo,ht.HP,dt.y,q.ey],pipes:[x.pW],styles:[""],data:{animation:[u.Ym,u.Mq]}}),t})();function Ft(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"div",2),h.TgZ(1,"button",3),h.NdJ("click",function(){return h.CHM(t),h.oxw().resetNhanDon()}),h._uU(2,"nhan-don"),h.qZA(),h.TgZ(3,"button",3),h.NdJ("click",function(){return h.CHM(t),h.oxw().resetHangHoa()}),h._uU(4,"hang-hoa"),h.qZA(),h.qZA()}}let Qt=(()=>{class t{constructor(t){this.plus=t,this.db=null,this.dbName="ban-hang",this.isAdmin=this.plus.isAdmin()}ngOnInit(){this.plus.IDB_InitDB(this.dbName).subscribe(t=>{this.db=t})}resetNhanDon(){const t="an-uong";!confirm("Reset DB"+t)||this.plus.httpDelete(t,"del").subscribe(n=>{console.log("Clear DB"),this.plus.FBS_PostByUser(t,0).then(n=>{console.log("Clear FBS"),console.log(n),this.plus.IDB_DB_ClearCollection(this.db,t).subscribe(t=>{console.log("Clear IDB")})})})}resetHangHoa(){const t="hang-hoa";!confirm("Reset DB"+t)||this.plus.httpDelete(t,"del").subscribe(n=>{console.log("Clear DB"),this.plus.FBS_PostByUser(t,0).then(n=>{console.log("Clear FBS"),console.log(n),this.plus.IDB_DB_ClearCollection(this.db,t).subscribe(t=>{console.log("Clear IDB")})})})}checkPer(t,n){return this.plus.checkPer(t,n)}onDetect(t){console.log(t)}}return t.\u0275fac=function(n){return new(n||t)(h.Y36(d.T))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-ban-hang"]],decls:2,vars:1,consts:[[1,"container"],["class","row",4,"ngIf"],[1,"row"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(t,n){1&t&&(h.TgZ(0,"div",0),h.YNc(1,Ft,5,0,"div",1),h.qZA()),2&t&&(h.xp6(1),h.Q6J("ngIf",n.checkPer("hang-hoa",7)))},directives:[c.O5],styles:[""]}),t})();var Pt=i(83550),Gt=i(50296);function Lt(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"b",36),h.NdJ("click",function(n){h.CHM(t);const i=h.oxw().$implicit;return h.oxw().addNewItem(i,n)}),h._uU(1),h.qZA()}if(2&t){const t=h.oxw().$implicit;h.xp6(1),h.lnq(" ",t.TenHangHoa," [",t.GiaBan,"k/",t.DVT,"]")}}function Yt(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"mat-option",34),h.NdJ("keyup.enter",function(n){const i=h.CHM(t).$implicit;return h.oxw().addNewItem(i,n)})("onSelectionChange",function(n){const i=h.CHM(t).$implicit;return h.oxw().addNewItem(i,n)}),h.YNc(1,Lt,2,3,"b",35),h.qZA()}if(2&t){const t=n.$implicit;h.xp6(1),h.Q6J("ngIf",t.TrangThai)}}function St(t,n){1&t&&(h.TgZ(0,"mat-option"),h._uU(1," Kh\xf4ng c\xf2n k\u1ebft qu\u1ea3 ph\xf9 h\u1ee3p! "),h.qZA())}function Vt(t,n){if(1&t&&(h.TgZ(0,"b",37),h._uU(1),h.ALo(2,"commas"),h.qZA()),2&t){const t=h.oxw();h.xp6(1),h.hij("Ti\u1ec1n th\u1eeba: ",h.lcZ(2,1,1e3*+t.khachDua-t.ThanhTien),"")}}function Et(t,n){if(1&t){const t=h.EpF();h.TgZ(0,"tr"),h.TgZ(1,"td",38),h._uU(2),h.qZA(),h.TgZ(3,"td",39),h._uU(4),h._UZ(5,"br"),h.TgZ(6,"b",40),h.NdJ("blur",function(n){const i=h.CHM(t).index;return h.oxw().updateGiaBan(i,"GiaBan",n)})("keydown.enter",function(n){const i=h.CHM(t).index;return h.oxw().updateGiaBan(i,"GiaBan",n)})("keydown.enter",function(n){const i=h.CHM(t).index;return h.oxw().updateList(i,"GiaBan",n)})("blur",function(n){const i=h.CHM(t).index;return h.oxw().updateList(i,"GiaBan",n)}),h._uU(7),h.ALo(8,"number"),h.qZA(),h._uU(9),h.qZA(),h.TgZ(10,"td",17),h.TgZ(11,"mat-icon",41),h.NdJ("click",function(){const n=h.CHM(t).index;return h.oxw().removeItem(n)}),h._uU(12,"arrow_left"),h.qZA(),h.TgZ(13,"b",42),h.NdJ("keydown.enter",function(n){const i=h.CHM(t).index;return h.oxw().updateList(i,"TongCong",n)})("blur",function(n){const i=h.CHM(t).index;return h.oxw().updateList(i,"TongCong",n)}),h._uU(14),h.ALo(15,"number"),h.qZA(),h.TgZ(16,"mat-icon",43),h.NdJ("click",function(){const n=h.CHM(t),i=n.$implicit,e=n.index;return h.oxw().addItem(i,e)}),h._uU(17,"arrow_right"),h.qZA(),h.qZA(),h.TgZ(18,"td",44),h.TgZ(19,"b"),h._uU(20),h.ALo(21,"commas"),h.qZA(),h.TgZ(22,"span",45),h.NdJ("click",function(){const n=h.CHM(t).index;return h.oxw().delItem(n)}),h.TgZ(23,"mat-icon",46),h._uU(24,"delete"),h.qZA(),h.qZA(),h.qZA(),h.qZA()}if(2&t){const t=n.$implicit,i=n.index;h.xp6(2),h.Oqu(i+1),h.xp6(2),h.Oqu(t.TenHangHoa),h.xp6(3),h.Oqu(h.lcZ(8,6,t.GiaBan)),h.xp6(2),h.hij("k/",t.DVT," "),h.xp6(5),h.hij(" ",h.lcZ(15,8,t.TongCong)," "),h.xp6(6),h.Oqu(h.lcZ(21,10,t.TongCong*t.GiaBan*1e3))}}function $t(t,n){if(1&t&&(h.TgZ(0,"tr"),h.TgZ(1,"td"),h._uU(2),h.qZA(),h.TgZ(3,"td"),h._uU(4),h._UZ(5,"br"),h._uU(6),h.ALo(7,"commas"),h.qZA(),h.TgZ(8,"td",48),h._uU(9),h.qZA(),h.TgZ(10,"td",50),h._uU(11),h.ALo(12,"commas"),h.qZA(),h.qZA()),2&t){const t=n.$implicit,i=n.index;h.xp6(2),h.hij("",i+1," "),h.xp6(2),h.hij("",t.TenHangHoa," "),h.xp6(2),h.hij(" ",h.lcZ(7,5,1e3*t.GiaBan)," "),h.xp6(3),h.Oqu(t.TongCong),h.xp6(2),h.Oqu(h.lcZ(12,7,t.TongCong*t.GiaBan*1e3))}}function Kt(t,n){if(1&t&&(h.TgZ(0,"tbody"),h.YNc(1,$t,13,9,"tr",19),h.TgZ(2,"tr"),h.TgZ(3,"td",47),h.TgZ(4,"h5"),h._uU(5,"T\u1ed5ng c\u1ed9ng:"),h.qZA(),h.qZA(),h.TgZ(6,"td"),h.TgZ(7,"h5"),h._uU(8),h.qZA(),h.qZA(),h.TgZ(9,"td",48),h.TgZ(10,"h5"),h._uU(11),h.ALo(12,"commas"),h.qZA(),h.TgZ(13,"h6"),h.TgZ(14,"i"),h._uU(15),h.ALo(16,"titlecase"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(17,"td",49),h.TgZ(18,"h6"),h._uU(19,"Xin c\u1ea3m \u01a1n qu\xfd kh\xe1ch"),h.qZA(),h.TgZ(20,"h6"),h._uU(21,"S\u1ea3n ph\u1ea9m c\u1ee7a 4la.vn"),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.oxw();h.xp6(1),h.Q6J("ngForOf",t.DonMua),h.xp6(7),h.hij("",t.total," m\xf3n"),h.xp6(3),h.hij(" ",h.lcZ(12,4,t.ThanhTien),""),h.xp6(4),h.Oqu(h.lcZ(16,6,t.bangchu))}}const jt=function(t){return{loading:t}};let zt=(()=>{class t{constructor(t,n,i){this.plus=t,this.route=n,this.fb=i,this.subs=(new Pt.y).subscribe(),this.db=null,this.title="B\xe1n h\xe0ng t\u1ea1p h\xf3a",this.dbName="ban-hang",this.api="tap-hoa",this.tabs=[],this.items=[],this.DonMua=[],this.total=0,this.ThanhTien=0,this.donHang=[],this.bangchu="",this.filter=[],this.audio=new Audio,this.nhapThuCong=!1,this.xemHoaDon=!0,this.user=this.plus.user.getValue(),this.printTime=Date.now(),this.NhomHang=this.plus.user.getValue().NhomHang,this.TabBan=this.plus.sortArr(this.plus.user.getValue().NhomBan,"ThuTu",1),this.ChiaBan=[],this.ban=0,this.width=window.innerWidth,this.count=0,this.now=Date.now(),this.xemBan=!0,this.xemMon=!1,this.donHangFB=this.fb.group({ThanhTien:[,[l.kI.required]],LoiNhuan:[,[l.kI.required]],SoKH:[,[l.kI.required]],GioVao:[,[l.kI.required]],DaThanhToan:[,[l.kI.required]],DonMua:this.fb.array([this.fb.group({idHangHoa:[,[l.kI.required]],DVT:[,[l.kI.required]],GiaBan:[,[l.kI.required]],GiaVon:[,[l.kI.required]],KhuyenMai:[,[l.kI.required]],TenHangHoa:[,[l.kI.required]],TongCong:[,[l.kI.required]]})])}),this.searchForm=this.fb.group({input:[,[l.kI.minLength(3),l.kI.maxLength(50)]]})}ngOnDestroy(){console.log("Destroy an-uong"),this.plus.subs.unsubscribe()}test(t){console.log(+t.replace(/\D/g,"")),this.khachDua=+t}ngOnInit(){this.plus.setTiTle(this.title),this.getBillLocal(),this.plus.IDB_InitDB(this.dbName).subscribe(t=>{this.db=t,document.getElementById("search-api").focus(),this.plus.updateUserLocal(t,"hang-hoa")}),this.search(),this.audio.src="assets/audio/beep.mp3",this.audio.load()}getBillLocal(){const t=JSON.parse(localStorage.getItem("tapHoaBill"));console.log("getBillLocal",t),null==t?this.DonMua=[]:(this.DonMua=t,this.getTongCong())}search(){this.subs.add(this.searchForm.valueChanges.subscribe(t=>{const n=this.plus.removeAccents(t.input);n.trim().length<2||this.plus.IDB_DB_GetByBarCode(this.db,"hang-hoa",n).subscribe(t=>{t?(this.searchForm.reset(),t.TrangThai?this.addNewItem(t,{}):this.plus.alertMatSnackBar("T\u1ea1m h\u1ebft h\xe0ng")):(this.filter=[],this.plus.IDB_DB_Search(this.db,"hang-hoa",n,5).subscribe(t=>{this.filter=t}))})}))}thanhToan(){const t=confirm("In h\xf3a \u0111\u01a1n?");let n=Object.assign({DonMua:this.DonMua.map(t=>({idHangHoa:t._id,TenHangHoa:t.TenHangHoa,GiaBan:t.GiaBan,GiaVon:t.GiaVon,KhuyenMai:t.KhuyenMai,DVT:t.DVT,TongCong:t.TongCong})),LoiNhuan:this.DonMua.map(t=>t.GiaBan-t.GiaVon-t.GiaBan*t.KhuyenMai/100).reduce((t,n)=>t+n),ThanhTien:this.ThanhTien,GioVao:Date.now(),SoKH:this.total,DaThanhToan:!0});if(this.donHangFB.patchValue(n),this.donHangFB.invalid){const t=this.plus.getErrValidateForm(this.donHangFB);console.log(t,this.donHangFB.status)}else this.plus.httpPost("thanh-toan/new",n).subscribe(t=>{const n=this.plus.Crypt_DecryptRest(t);this.plus.FBS_PostByUser("hang-hoa",n.dateModify),this.DonMua=[],this.reload()});localStorage.removeItem("tapHoaBill"),t?(this.PrintDiv("HoaDon"),console.log(0,n)):console.log(1,n)}addNewItem(t,n){console.log(n),this.filter=[],this.playAudio(),this.xemHoaDon=!0,window.navigator.vibrate(100);const i=this.DonMua.find(n=>n._id==t._id);if(!i)return t.TongCong=1,this.DonMua.unshift(t),this.getTongCong();{const t=this.DonMua.findIndex(t=>t._id==i._id);this.DonMua[t].TongCong+=1}this.getTongCong(),this.filter=[],this.searchForm.controls.input.setValue("")}removeItem(t){this.playAudio(),this.DonMua[t].TongCong>0&&(this.DonMua[t].TongCong-=1),this.getTongCong()}addItem(t,n){this.playAudio(),this.DonMua[n].TongCong+=1,this.getTongCong()}delItem(t){this.DonMua.splice(t,1),this.getTongCong()}getTongCong(){this.total=this.plus.sumByKey(this.DonMua,["TongCong"]).TongCong,this.getThanhTien()}getThanhTien(){let t=0;return this.DonMua.forEach(n=>{t+=n.GiaBan*n.TongCong*1e3}),this.bangchu=this.plus.numToVi(t),localStorage.setItem("tapHoaBill",JSON.stringify(this.DonMua)),this.ThanhTien=t}PrintDiv(t){this.plus.load();let n=window.document.getElementById(t);var i=window.open("","PRINT");i.document.write(document.documentElement.innerHTML),setTimeout(()=>{i.document.body.innerHTML=n.outerHTML,i.document.close(),i.focus(),i.print(),i.close()},1e3),this.plus.loaded()}getBarcode(t){this.searchForm.controls.input.setValue(t)}find(t){this.filter=t}getByBarcode(t){}reload(){this.plus.reload("ban-hang/tap-hoa")}updateList(t,n,i){const e=+i.target.textContent;if(console.log(e),"Enter"===i.key&&i.preventDefault(),"number"!=typeof e)return this.plus.alertError("Sai \u0111\u1ecbnh d\u1ea1ng"),this.DonMua[t][n]=0;this.DonMua[t][n]=+e,this.getTongCong()}updateGiaBan(t,n,i){if(this.DonMua[t][n]==+i.target.textContent)return;const e=this.DonMua[t].TongCong,o=this.DonMua[t];delete o.__v,delete o.TongCong,o.GiaBan=+i.target.textContent,this.plus.httpPut("hang-hoa",o).subscribe(n=>{document.getElementById("search-api").focus(),console.log(this.DonMua[t])}),this.DonMua[t][n]=+i.target.textContent,this.DonMua[t].TongCong=+e,this.getTongCong()}updateKhachDua(t){const n=+t.target.textContent;console.log(n,typeof n),"Enter"===t.key&&t.preventDefault(),("number"!=typeof n||Number.isNaN(n))&&this.plus.alertError("B\u1ea1n ph\u1ea3i nh\u1eadp s\u1ed1 ti\u1ec1n"),this.khachDua=+n}playAudio(){this.audio.play()}}return t.\u0275fac=function(n){return new(n||t)(h.Y36(d.T),h.Y36(G.gz),h.Y36(l.qu))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-tap-hoa"]],decls:69,vars:22,consts:[[1,"container-fluid"],[1,"row",2,"padding-top","10px"],[1,"col-lg-6"],[1,"form-group",3,"formGroup"],["type","text","id","search-api","autocomplete","off","formControlName","input","placeholder","T\xecm ki\u1ebfm (F2)",1,"form-control",3,"readonly","matAutocomplete","ngClass"],["autoActiveFirstOption",""],["auto","matAutocomplete"],[3,"keyup.enter","onSelectionChange",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"barcodeResult"],["id","thanh-toan","mat-raised-button","","color","warn",1,"float-rigth",3,"disabled","click"],["contentEditable","true",1,"font-blue","inputSpan",3,"keydown.enter","blur"],["style","padding-left: 15px; color: blue;",4,"ngIf"],[1,"row"],[1,"table","table-hover"],["width","10%"],["width","35%"],["width","30%"],["width","25%",2,"text-align","center"],[4,"ngFor","ngForOf"],["id","modelId","tabindex","-1","role","dialog","aria-labelledby","modelTitleId","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-body","hoadon"],["id","HoaDon",1,"div"],[1,"text-left"],[1,"thead-inverse"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary"],[3,"keyup.enter","onSelectionChange"],[3,"click",4,"ngIf"],[3,"click"],[2,"padding-left","15px","color","blue"],["width","10%",2,"padding-left","5px"],["width","35%",2,"font-size","16px"],["contenteditable","true",1,"px-2","font-blue",3,"blur","keydown.enter"],["matPrefix","",1,"ar",3,"click"],["contenteditable","true",1,"font-blue",3,"keydown.enter","blur"],["matSuffix","",1,"ar",3,"click"],["width","25%",1,"text-right"],[2,"margin-left","20px",3,"click"],["color","warn"],["colspan","2",1,"text-center"],[1,"text-center"],["colspan","4",1,"text-center"],[1,"text-rigth"]],template:function(t,n){if(1&t&&(h.TgZ(0,"div",0),h.TgZ(1,"div",1),h.TgZ(2,"div",2),h.TgZ(3,"div",3),h._UZ(4,"input",4),h.TgZ(5,"mat-autocomplete",5,6),h.YNc(7,Yt,2,1,"mat-option",7),h.YNc(8,St,2,0,"mat-option",8),h.qZA(),h.qZA(),h.qZA(),h.TgZ(9,"div",2),h.TgZ(10,"app-barcode-scanner",9),h.NdJ("barcodeResult",function(t){return n.getBarcode(t)}),h.qZA(),h.TgZ(11,"button",10),h.NdJ("click",function(){return n.thanhToan()}),h._uU(12),h.ALo(13,"commas"),h.qZA(),h.TgZ(14,"b"),h._uU(15,"Kh\xe1ch \u0111\u01b0a: "),h.TgZ(16,"span",11),h.NdJ("keydown.enter",function(t){return n.updateKhachDua(t)})("blur",function(t){return n.updateKhachDua(t)}),h.qZA(),h._uU(17,".000\u0111"),h.qZA(),h.YNc(18,Vt,3,3,"b",12),h.qZA(),h.qZA(),h.TgZ(19,"div",13),h.TgZ(20,"table",14),h.TgZ(21,"thead"),h.TgZ(22,"tr"),h.TgZ(23,"th",15),h._uU(24,"TT "),h.qZA(),h.TgZ(25,"th",16),h._uU(26,"H\u1ea1ng m\u1ee5c"),h.qZA(),h.TgZ(27,"th",17),h._uU(28,"S\u1ed1 l\u01b0\u1ee3ng"),h.qZA(),h.TgZ(29,"th",18),h._uU(30,"Th\xe0nh ti\u1ec1n"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(31,"tbody"),h.YNc(32,Et,25,12,"tr",19),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(33,"div",20),h.TgZ(34,"div",21),h.TgZ(35,"div",22),h.TgZ(36,"div",23),h.TgZ(37,"h5",24),h._uU(38,"Modal title"),h.qZA(),h.TgZ(39,"button",25),h.TgZ(40,"span",26),h._uU(41,"\xd7"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(42,"div",27),h.TgZ(43,"div",28),h.TgZ(44,"div",29),h.TgZ(45,"h6"),h._uU(46),h.qZA(),h.TgZ(47,"h6"),h._uU(48),h.qZA(),h.TgZ(49,"h6"),h._uU(50),h.ALo(51,"date"),h.qZA(),h.qZA(),h.TgZ(52,"table",14),h.TgZ(53,"thead",30),h.TgZ(54,"tr"),h.TgZ(55,"th"),h._uU(56,"TT"),h.qZA(),h.TgZ(57,"th"),h._uU(58,"H\u1ea1ng m\u1ee5c"),h.qZA(),h.TgZ(59,"th"),h._uU(60,"S\u1ed1 l\u01b0\u1ee3ng"),h.qZA(),h.TgZ(61,"th"),h._uU(62,"Th\xe0nh ti\u1ec1n"),h.qZA(),h.qZA(),h.qZA(),h.YNc(63,Kt,22,8,"tbody",8),h.qZA(),h.qZA(),h.qZA(),h.TgZ(64,"div",31),h.TgZ(65,"button",32),h._uU(66,"Close"),h.qZA(),h.TgZ(67,"button",33),h._uU(68,"Save"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t){const t=h.MAs(6);h.xp6(3),h.Q6J("formGroup",n.searchForm),h.xp6(1),h.Q6J("readonly",!1)("matAutocomplete",t)("ngClass",h.VKq(20,jt,n.filter.length>1&&n.filter.length<5)),h.xp6(3),h.Q6J("ngForOf",n.filter),h.xp6(1),h.Q6J("ngIf",0==n.filter.length&&n.searchForm.value.input),h.xp6(3),h.Q6J("disabled",0==n.ThanhTien),h.xp6(1),h.AsE(" ",n.DonMua.length," | ",h.lcZ(13,15,n.ThanhTien)," "),h.xp6(6),h.Q6J("ngIf",n.khachDua>0&&1e3*n.khachDua>n.ThanhTien),h.xp6(14),h.Q6J("ngForOf",n.DonMua),h.xp6(14),h.Oqu(n.user.title),h.xp6(2),h.Oqu(n.user.phoneNumber),h.xp6(2),h.hij("Gi\u1edd in:",h.xi3(51,17,n.printTime,"hh:mm dd/MM/yyyy"),""),h.xp6(13),h.Q6J("ngIf",n.DonMua)}},directives:[l.JL,l.sg,l.Fj,Gt.ZL,l.JJ,l.u,c.mk,Gt.XC,c.sg,c.O5,ut.O,Z.lW,q.ey,f.Hw,T.qo,T.R9],pipes:[x.W,c.uU,c.JJ,c.rS],styles:[".hangHoa[_ngcontent-%COMP%]{height:8rem;width:8rem;border-radius:1rem;margin:.2rem;border-bottom-width:1rem;border-color:#90ee90;color:#00f;float:left;display:flex;align-items:center;justify-content:center}.hangHoa[_ngcontent-%COMP%]:active{transform:scale(1.1);opacity:50%}.hoadon[_ngcontent-%COMP%]{width:200px}.font-mat[_ngcontent-%COMP%]{color:#fff;font-size:medium}.font-blue[_ngcontent-%COMP%]{font-size:16px;padding-left:10px;padding-right:10px}.arrow-bt[_ngcontent-%COMP%]{font-size:larger;color:#00f;font-weight:700;padding:.5rem}.arrow-bt[_ngcontent-%COMP%]:hover{border:brown;border-radius:.5rem;background-color:#0ff}.example-form-field[_ngcontent-%COMP%]{max-width:8rem}.row[_ngcontent-%COMP%]{margin-left:5px!important;margin-right:5px!important}td[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{padding:0;vertical-align:middle}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding-bottom:0!important}.ar[_ngcontent-%COMP%]{transform:scale(1.5);color:tomato}.ar[_ngcontent-%COMP%]:active{transform:scale(2.2);color:#00f}.inputSpan[_ngcontent-%COMP%]{border-bottom:solid;border-color:#00f;padding-left:10px;text-align:right}.inputSpan[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:focus{border:rgb(255,0,0)}"],data:{animation:[u.Ym]}}),t})(),Rt=(()=>{class t{constructor(t){this.plus=t}canActivate(){return this.plus.checkPer("hang-hoa")}}return t.\u0275fac=function(n){return new(n||t)(h.LFG(d.T))},t.\u0275prov=h.Yz7({token:t,factory:t.\u0275fac}),t})(),Wt=(()=>{class t{constructor(t){this.plus=t}canActivate(){return this.plus.checkPer("an-uong")}}return t.\u0275fac=function(n){return new(n||t)(h.LFG(d.T))},t.\u0275prov=h.Yz7({token:t,factory:t.\u0275fac}),t})(),Xt=(()=>{class t{constructor(t){this.plus=t}canActivate(){return this.plus.checkPer("pha-che")}}return t.\u0275fac=function(n){return new(n||t)(h.LFG(d.T))},t.\u0275prov=h.Yz7({token:t,factory:t.\u0275fac}),t})(),tn=(()=>{class t{constructor(t){this.plus=t}canActivate(){return this.plus.checkPer("tap-hoa")}}return t.\u0275fac=function(n){return new(n||t)(h.LFG(d.T))},t.\u0275prov=h.Yz7({token:t,factory:t.\u0275fac}),t})(),nn=(()=>{class t{constructor(t){this.plus=t}canActivate(){return this.plus.checkPer("thanh-toan")}}return t.\u0275fac=function(n){return new(n||t)(h.LFG(d.T))},t.\u0275prov=h.Yz7({token:t,factory:t.\u0275fac}),t})(),en=(()=>{class t{constructor(t){this.plus=t}canActivate(){return this.plus.checkPer("quan-ly")}}return t.\u0275fac=function(n){return new(n||t)(h.LFG(d.T))},t.\u0275prov=h.Yz7({token:t,factory:t.\u0275fac}),t})();const on=[{path:"",component:Qt},{path:"hang-hoa",component:Ot,canActivate:[Rt]},{path:"an-uong/:ten-ban",component:at,canActivate:[Wt]},{path:"an-uong",component:at,canActivate:[Wt]},{path:"pha-che",component:P,canActivate:[Xt]},{path:"tap-hoa",component:zt,canActivate:[tn]},{path:"bao-cao",component:J,canActivate:[nn]},{path:"quan-ly",component:C,canActivate:[en]}];let an=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=h.oAB({type:t}),t.\u0275inj=h.cJS({providers:[Rt,Wt,Xt,tn,nn,en],imports:[[G.Bz.forChild(on)],G.Bz]}),t})();var sn=i(85913),rn=i(24561),cn=i(60929);let un=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=h.oAB({type:t}),t.\u0275inj=h.cJS({providers:[cn.F],imports:[[c.ez,o.ShareModule,s.qX,an,r.D,sn.m,cn.F,rn.k,a.k,e.N]]}),t})()}}]);