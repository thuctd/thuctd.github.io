"use strict";(self.webpackChunkdlxl=self.webpackChunkdlxl||[]).push([[878],{88446:(An,N,l)=>{l.r(N),l.d(N,{BanHangModule:()=>Cn});var P=l(83886),L=l(34291),G=l(22167),Y=l(51372),S=l(48387),p=l(69808),g=l(15228),c=l(93075),t=l(5e3),m=l(45230),Z=l(84875);let q=(()=>{class e{constructor(n,o){this.plus=n,this.fb=o,this.dbName="ban-hang",this.db=null,this.user=this.plus.user.getValue(),this.main=this.fb.group({}),this.initDB()}initDB(){this.plus.IDB_InitDB(this.dbName).subscribe(n=>{this.db=n})}creatTable(n){"guest"!=n._id&&this.plus.IDB_InitDB(this.dbName).subscribe(o=>{const i=this.plus.sortArr(n.NhomBan,"ThuTu",1);for(let s=0;s<i.length;s++){const r=i[s];this.plus.IDB_DB_Add(this.db,"an-uong",{_id:r.NoiDung+"- MV",status:1,dateModify:n.dateModify,TenBan:r.NoiDung+"- MV",NhomBan:r.NoiDung,DonMua:[],ThanhTien:0,GioVao:0,SoKH:0,DaThanhToan:Z.gp.unpaid});for(let h=1;h<r.SoLuong;h++)this.plus.IDB_DB_Add(o,"an-uong",{_id:r.NoiDung+"-"+h,status:1,dateModify:n.dateModify,TenBan:r.NoiDung+"-"+h,NhomBan:r.NoiDung,DonMua:[],ThanhTien:0,GioVao:0,SoKH:0,DaThanhToan:Z.gp.unpaid})}this.plus.reload("/ban-hang/an-uong")})}clearAnUong(){this.plus.IDB_InitDB(this.dbName).subscribe(n=>{this.plus.IDB_DB_ClearCollection(n,"an-uong").subscribe(o=>console.log("clearAnUong",o))})}thanhToan(n){if(delete n.__v,n.DaThanhToan=Z.hg.DaThanhToan,n.NguonThu=Z.rP.AnUong,0==n.ThanhTien&&(this.main.patchValue(n),this.main.invalid)){const o=this.plus.getErrValidateForm(this.main);console.log(o)}void 0!==n._id?(delete n.__v,this.plus.httpPut("thanh-toan",n).subscribe(o=>{const i=this.plus.Crypt_DecryptRest(o);this.plus.IDB_DB_Add(this.db,"thanh-toan",i),this.plus.FBS_PostByUser("hang-hoa",i.dateModify).then(()=>{this.reload()})})):this.plus.httpPost("thanh-toan",n).subscribe(o=>{this.plus.IDB_DB_Add(this.db,"thanh-toan",this.plus.Crypt_DecryptRest(o))})}printBill(){if(confirm("B\u1ea1n c\xf3 mu\u1ed1n in h\xf3a \u0111\u01a1n ko?")){let i=window.document.getElementById("bill");var o=window.open("","PRINT");o.document.write(document.documentElement.innerHTML),setTimeout(()=>{o.document.body.innerHTML=i.outerHTML,o.document.close(),o.focus(),o.print(),o.close()},1e3)}}reload(){this.plus.reload("/ban-hang/an-uong")}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(m.T),t.LFG(c.qu))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var A=l(26688),x=l(47423),C=l(25245),_=l(67322),y=l(77531),v=l(74107),D=l(90508),f=l(30627);function V(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"mat-chip",27),t.NdJ("click",function(){const s=t.CHM(n).$implicit;return t.oxw().onEditArea(s)}),t._uU(1),t.qZA()}if(2&e){const n=a.$implicit;t.xp6(1),t.hij("Khu ",n.KhuVuc,"")}}function $(e,a){if(1&e&&(t.TgZ(0,"button",28),t._uU(1),t.qZA()),2&e){const n=a.index;t.xp6(1),t.hij(" ",n+1,"")}}function K(e,a){if(1&e&&(t.TgZ(0,"mat-option",29),t._uU(1),t.qZA()),2&e){const n=a.$implicit;t.Q6J("value",n.GiaTri),t.xp6(1),t.Oqu(n.NoiDung)}}function j(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"button",30),t.NdJ("click",function(){return t.CHM(n),t.oxw().saveArea()}),t.TgZ(1,"mat-icon"),t._uU(2,"save"),t.qZA()()}2&e&&t.Q6J("@slideIn",void 0)}function z(e,a){if(1&e&&(t.TgZ(0,"mat-option",29),t._uU(1),t.qZA()),2&e){const n=a.$implicit;t.Q6J("value",n.KhuVuc),t.xp6(1),t.hij("",n.KhuVuc," ")}}function R(e,a){if(1&e&&(t.TgZ(0,"mat-option",29),t._uU(1),t.qZA()),2&e){const n=a.$implicit;t.Q6J("value",n.GiaTri),t.xp6(1),t.Oqu(n.NoiDung)}}function X(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"button",30),t.NdJ("click",function(){return t.CHM(n),t.oxw().saveTable()}),t.TgZ(1,"mat-icon"),t._uU(2,"save"),t.qZA()()}2&e&&t.Q6J("@slideIn",void 0)}let W=(()=>{class e{constructor(n,o,i){this.plus=n,this.fb=o,this.bhSV=i,this.chart=[],this.areaForm=this.fb.group({_id:[,[]],KhuVuc:[,[c.kI.required]],TrangThai:[1,[c.kI.required]]}),this.tableForm=this.fb.group({_id:[,[]],KhuVuc:[,[c.kI.required]],TenBan:[,[c.kI.required]],TrangThai:[1,[c.kI.required]]}),this.title="Qu\u1ea3n l\xfd",this.dbName="ban-hang",this.api="quan-ly",this.global=!1,this.apiArea="khu-vuc",this.apiTable="quan-ly/ban",this.db=null,this.areas=[],this.selectedItem=null,this.filter=[]}ngOnInit(){this.plus.setTiTle(this.title),this.getAllArea()}ngOnDestroy(){console.log("Destroy",this.api),this.plus.subs.unsubscribe()}getAllArea(){this.plus.httpGet(this.apiArea).subscribe(n=>{this.areas=this.plus.Crypt_DecryptRest(n),console.log(this.areas)})}saveArea(){if(this.areaForm.invalid)return;const n=this.areaForm.value;if(null==n._id)delete n._id,this.plus.httpPost(this.apiArea,n).subscribe(o=>{o.status&&this.plus.clickBtn("openModalA")});else{if(!confirm("C\u1eadp nh\u1eadt t\u1ea5t c\u1ea3 b\xe0n c\xf3 c\xf9ng khu v\u1ef1c?"))return this.plus.clickBtn("openModalA");this.plus.httpPut(this.apiArea,n).subscribe(i=>{i.status&&this.plus.clickBtn("openModalA")})}this.getAllArea()}onEditArea(n){this.selectedItem=n,this.areaForm.patchValue(n),this.plus.clickBtn("openModalA")}onDeleteArea(n){this.plus.httpDelete(this.apiArea,n._id,this.global).subscribe(o=>{console.log(o),this.getAllArea()})}saveTable(){}closeModal(){this.areaForm.reset(),this.tableForm.reset()}search(n){this.filter=n}find(n){this.areas=n}checkPer(n){return this.plus.checkPer(this.api,n)}patchForm(){}reload(){return this.plus.reload(this.dbName+"/"+this.api)}reset(){this.plus.loaded(),this.filter=[]}changePage(n){this.filter=this.areas.slice(n.pageIndex*n.pageSize,(n.pageIndex+1)*n.pageSize)}trackByFn(n,o){return o}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(m.T),t.Y36(c.qu),t.Y36(q))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-quan-ly"]],decls:68,vars:16,consts:[[1,"container"],[1,"row"],["color","accent",3,"click",4,"ngFor","ngForOf"],["color","warn","mat-icon-button","","data-toggle","modal","data-target","#modelIdA"],[1,"list","text-center"],["color","warn","mat-icon-button","","data-toggle","modal","data-target","#modelIdT"],["data-dismiss","modal","mat-mini-fab","",4,"ngFor","ngForOf","ngForTrackBy"],["id","openModalA","type","button","data-toggle","modal","data-target","#modelIdA",1,"d-none"],["id","modelIdA","data-backdrop","static","tabindex","-1","role","dialog","aria-labelledby","modelTitleId","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-body"],[1,"container-fluid"],[3,"formGroup"],["hidden","","formControlName","_id"],["type","text","autocomplete","off","matInput","","formControlName","KhuVuc"],["matSuffix",""],["required","","formControlName","TrangThai"],[3,"value",4,"ngFor","ngForOf"],[1,"modal-footer"],["id","closeModal","mat-raised-button","","color","primary","data-dismiss","modal",3,"click"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["id","openModalT","type","button","data-toggle","modal","data-target","#modelIdT",1,"d-none"],["id","modelIdT","data-backdrop","static","tabindex","-1","role","dialog","aria-labelledby","modelTitleId","aria-hidden","true",1,"modal","fade"],[1,"tit"],["formControlName","KhuVuc"],["placeholder","VD: A-1, Vip-6","type","text","autocomplete","off","matInput","","formControlName","TenBan"],["color","accent",3,"click"],["data-dismiss","modal","mat-mini-fab",""],[3,"value"],["mat-raised-button","","color","warn",3,"click"]],template:function(n,o){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"mat-chip-list"),t.YNc(3,V,2,1,"mat-chip",2),t.TgZ(4,"button",3)(5,"mat-icon"),t._uU(6,"control_point"),t.qZA()()()(),t.TgZ(7,"div",1)(8,"div",4)(9,"button",5)(10,"mat-icon"),t._uU(11,"control_point"),t.qZA()(),t.YNc(12,$,2,1,"button",6),t.qZA()()(),t._UZ(13,"button",7),t.TgZ(14,"div",8)(15,"div",9)(16,"div",10)(17,"div",11)(18,"div",12)(19,"form",13),t._UZ(20,"input",14),t.TgZ(21,"mat-form-field")(22,"mat-label"),t._uU(23,"Khu v\u1ef1c"),t.qZA(),t._UZ(24,"input",15)(25,"span",16),t.qZA(),t.TgZ(26,"mat-form-field")(27,"mat-label"),t._uU(28,"Tr\u1ea1ng th\xe1i"),t.qZA(),t.TgZ(29,"mat-select",17),t.YNc(30,K,2,2,"mat-option",18),t.ALo(31,"catalog"),t.qZA()()()()(),t.TgZ(32,"div",19)(33,"button",20),t.NdJ("click",function(){return o.closeModal()}),t.TgZ(34,"mat-icon"),t._uU(35,"close"),t.qZA()(),t.YNc(36,j,3,1,"button",21),t.qZA()()()(),t._UZ(37,"button",22),t.TgZ(38,"div",23)(39,"div",9)(40,"div",10)(41,"div",11)(42,"div",12)(43,"h5",24),t._uU(44,"Qu\u1ea3n l\xfd b\xe0n"),t.qZA(),t.TgZ(45,"form",13),t._UZ(46,"input",14),t.TgZ(47,"mat-form-field")(48,"mat-label"),t._uU(49,"Khu v\u1ef1c"),t.qZA(),t.TgZ(50,"mat-select",25),t.YNc(51,z,2,2,"mat-option",18),t.qZA()(),t.TgZ(52,"mat-form-field")(53,"mat-label"),t._uU(54,"T\xean b\xe0n"),t.qZA(),t._UZ(55,"input",26)(56,"span",16),t.qZA(),t.TgZ(57,"mat-form-field")(58,"mat-label"),t._uU(59,"Tr\u1ea1ng th\xe1i"),t.qZA(),t.TgZ(60,"mat-select",17),t.YNc(61,R,2,2,"mat-option",18),t.ALo(62,"catalog"),t.qZA()()()()(),t.TgZ(63,"div",19)(64,"button",20),t.NdJ("click",function(){return o.closeModal()}),t.TgZ(65,"mat-icon"),t._uU(66,"close"),t.qZA()(),t.YNc(67,X,3,1,"button",21),t.qZA()()()()),2&n&&(t.xp6(3),t.Q6J("ngForOf",o.areas),t.xp6(9),t.Q6J("ngForOf",o.filter.length>0?o.filter:o.areas)("ngForTrackBy",o.trackByFn),t.xp6(7),t.Q6J("formGroup",o.areaForm),t.xp6(11),t.Q6J("ngForOf",t.lcZ(31,12,"TrangThaiHoatDong")),t.xp6(3),t.Q6J("@slideIn",void 0),t.xp6(3),t.Q6J("ngIf",o.checkPer(2)&&o.areaForm.valid),t.xp6(9),t.Q6J("formGroup",o.tableForm),t.xp6(6),t.Q6J("ngForOf",o.areas),t.xp6(10),t.Q6J("ngForOf",t.lcZ(62,14,"TrangThaiHoatDong")),t.xp6(3),t.Q6J("@slideIn",void 0),t.xp6(3),t.Q6J("ngIf",o.checkPer(2)&&o.tableForm.valid))},directives:[A.qn,p.sg,A.HS,x.lW,C.Hw,c._Y,c.JL,c.sg,c.Fj,c.JJ,c.u,_.KE,_.hX,y.Nt,_.R9,v.gD,c.Q7,D.ey,p.O5],pipes:[f.pW],styles:[""],data:{animation:[g.Ym,g.Mq]}}),e})();var tt=l(15439),nt=l.n(tt),ot=l(18849),et=l(30358);let it=(()=>{class e{constructor(n){this.plus=n,this.db=null,this.title="B\xe1o c\xe1o b\xe1n h\xe0ng",this.dbName="ban-hang",this.items=[],this.DoanhThu=0,this.LoiNhuan=0}ngOnDestroy(){console.log("Destroy bao-cao"),this.plus.subs.unsubscribe()}ngOnInit(){this.plus.setTiTle(this.title),this.plus.IDB_InitDB(this.dbName).subscribe(n=>{this.plus.updateUserLocal(n,"thanh-toan"),this.db=n,this.plus.updateAPi.subscribe(o=>{this.getNhanDon()})})}getNhanDon(){this.plus.subs.add(this.plus.IDB_DB_GetAll(this.db,"thanh-toan").subscribe(n=>{null==n&&(n=[]),this.items=n,this.doanhThuNgay(1)}))}doanhThuNgay(n){const o=this.items,i=Date.now()-24*n*60*60*1e3,s=[];let r=[],u=[];for(let d=0;d<o.length;d++)if(o[d].dateModify>i&&o[d].LoiNhuan>0&&1==o[d].DaThanhToan){const Zn={LoiNhuan:1e3*o[d].LoiNhuan,ThanhTien:o[d].ThanhTien,Ngay:nt()(o[d].dateModify).format("DD/MM")};s.push(Zn),o[d].DonMua.forEach(Q=>{r.push({TenHangHoa:Q.TenHangHoa,TongCong:Q.TongCong})}),u.push({TenBan:o[d].TenBan,SoKH:o[d].SoKH})}this.DoanhThuThang=this.plus.generateChart(s,"Ngay","ThanhTien"),this.LoiNhuanThang=this.plus.generateChart(s,"Ngay","LoiNhuan");const h=this.plus.sumByKeys(s,["ThanhTien","LoiNhuan"]);this.DoanhThu=h.ThanhTien,this.LoiNhuan=h.LoiNhuan;const b=this.plus.sortArr(r,"TongCong");this.plus.generateChart(b,"TenHangHoa","TongCong"),this.BanNgoiNhieu=this.plus.generateChart(u,"TenBan","SoKH")}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(m.T))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-bao-cao"]],decls:30,vars:30,consts:[[1,"container"],[1,"tit"],[1,"row","text-center"],["mat-raised-button","","color","warn"],[1,"row"],[3,"day"],[1,"row","my-3"],[1,"col-md-6"],[3,"id","arr","label","type"],[3,"id","label","arr","type"],[1,"col-md-4"],[1,"col-md-8"],[3,"id","arr","type","label"]],template:function(n,o){1&n&&(t.TgZ(0,"div",0)(1,"h5",1),t._uU(2,"B\xc1O C\xc1O B\xc1N H\xc0NG"),t.qZA(),t.TgZ(3,"div",2)(4,"button",3),t._uU(5),t.ALo(6,"commas"),t.qZA(),t.TgZ(7,"button",3),t._uU(8),t.ALo(9,"commas"),t.qZA()(),t.TgZ(10,"div",4)(11,"app-chip",5),t.NdJ("day",function(s){return o.doanhThuNgay(s)}),t.qZA()(),t.TgZ(12,"div",6)(13,"div",7),t._UZ(14,"app-chart",8),t.qZA(),t.TgZ(15,"div",7),t._UZ(16,"app-chart",9),t.qZA()(),t._UZ(17,"hr")(18,"h6",1),t.TgZ(19,"div",6)(20,"div",10),t._UZ(21,"app-chart",8),t.qZA(),t.TgZ(22,"div",11),t._UZ(23,"app-chart",8),t.qZA()(),t._UZ(24,"hr"),t.TgZ(25,"div",6)(26,"div",10),t._UZ(27,"app-chart",8),t.qZA(),t.TgZ(28,"div",11),t._UZ(29,"app-chart",12),t.qZA()()()),2&n&&(t.xp6(5),t.hij(" Doanh thu: ",t.lcZ(6,26,o.DoanhThu),""),t.xp6(3),t.hij(" L\u1ee3i nhu\u1eadn: ",t.lcZ(9,28,o.LoiNhuan),""),t.xp6(6),t.Q6J("id","doanhthuthang")("arr",o.DoanhThuThang)("label","B\u1ea3ng Doanh thu")("type","line"),t.xp6(2),t.Q6J("id","LoinhuanThan")("label","B\u1ea3ng L\u1ee3i nhu\u1eadn")("arr",o.LoiNhuanThang)("type","bar"),t.xp6(5),t.Q6J("id","BanChay")("arr",o.BanChay)("label","Top b\xe1n ch\u1ea1y")("type","doughnut"),t.xp6(2),t.Q6J("id","BanChayBar")("arr",o.BanChay)("label","Top b\xe1n ch\u1ea1y")("type","bar"),t.xp6(4),t.Q6J("id","BanNgoiNhieu")("arr",o.BanNgoiNhieu)("label","Top B\xe0n kh\xe1ch ch\u1ecdn")("type","doughnut"),t.xp6(2),t.Q6J("id","BanNgoiNhieuBar")("arr",o.BanNgoiNhieu)("type","bar")("label","Top B\xe0n kh\xe1ch ch\u1ecdn"))},directives:[x.lW,ot.Y,et.x],pipes:[f.W],styles:["mat-chip[_ngcontent-%COMP%]{max-width:200px}"]}),e})();function at(e,a){1&e&&(t.TgZ(0,"h4",4),t._uU(1,"\u0110\xe3 ho\xe0n th\xe0nh "),t.qZA())}function st(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"button",15),t.NdJ("click",function(){t.CHM(n);const i=t.oxw().index,s=t.oxw().$implicit;return t.oxw().onComplete(s,i)}),t.TgZ(1,"mat-icon"),t._uU(2,"done"),t.qZA()()}}function rt(e,a){if(1&e&&(t.TgZ(0,"div",9)(1,"b",10),t._uU(2),t.TgZ(3,"b",11),t._uU(4),t.qZA()(),t.TgZ(5,"i",12),t._uU(6),t.qZA(),t._UZ(7,"br"),t.TgZ(8,"i",13),t._uU(9),t.ALo(10,"fromNow"),t.qZA(),t.YNc(11,st,3,0,"button",14),t.qZA()),2&e){const n=a.$implicit,o=t.oxw(2);t.Q6J("@slideIn",void 0),t.xp6(2),t.hij("",n.TenHangHoa,": "),t.xp6(2),t.AsE(" ",n.TongCong," ",n.DVT," "),t.xp6(2),t.Oqu(n.GhiChu),t.xp6(3),t.Oqu(t.lcZ(10,7,n.GioVao)),t.xp6(2),t.Q6J("ngIf",o.checkPer(2)&&0==n.DaLam)}}function ct(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"div")(1,"div",5)(2,"h4",6),t._uU(3),t.qZA(),t.YNc(4,rt,12,9,"div",7),t.TgZ(5,"button",8),t.NdJ("click",function(){const s=t.CHM(n).$implicit;return t.oxw().onCompleteAll(s)}),t.TgZ(6,"mat-icon"),t._uU(7,"done_all"),t.qZA()()()()}if(2&e){const n=a.$implicit;t.xp6(3),t.Oqu(n.TenBan),t.xp6(1),t.Q6J("ngForOf",n.DonMua)}}let lt=(()=>{class e{constructor(n,o){this.plus=n,this.fb=o,this.dbName="ban-hang",this.db=null,this.api="an-uong",this.items=[],this.tittle="Pha ch\u1ebf",this.DonMua=[],this.groups=[],this.main=this.fb.group({_id:[,[]],idHangHoa:[,[c.kI.required]],TrangThai:[0,[c.kI.required]]})}ngOnDestroy(){this.plus.subs.unsubscribe(),console.log("Destroy pha-che")}ngOnInit(){this.plus.setTiTle(this.tittle),this.plus.IDB_InitDB(this.dbName).subscribe(n=>{this.db=n,this.plus.updateUserLocal(n,this.api),this.plus.updateAPi.subscribe(o=>{this.getIDB(n)})})}getIDB(n){this.groups=[],this.plus.IDB_DB_GetAll(n,this.api).subscribe(o=>{let i=[];for(let s=0;s<o.length;s++)if(0==o[s].DaThanhToan){const r=o[s].DonMua.filter(u=>(0==u.DaLam&&(this.addNewItem(u),this.groups.push(u),this.plus.notify_send("C\xf3 kh\xe1ch v\xe0o!"),this.plus.playUpdate()),0==u.DaLam));r.length>0&&(o[s].DonMua=r,i.push(o[s]))}this.items=i,console.log(this.groups),this.groupItems()})}groupItems(){const o=this.plus.obj_GroupByKey(this.groups,"TenHangHoa");console.log(o)}addNewItem(n){const o=this.DonMua.find(i=>i._id==n._id);if(window.navigator.vibrate(200),o){const i=this.DonMua.findIndex(s=>s._id==o._id);this.DonMua[i].TongCong+=n.TongCong}else n.TongCong=1,n.GioVao=Date.now(),n.DaLam=!1,this.DonMua.push(n)}onComplete(n,o){console.log(n,o);const i=n;delete i.__v,i.DonMua[o].DaLam=!0,console.log(i),this.plus.httpPut(this.api,i).subscribe(s=>{console.log(s),this.getIDB(this.db)})}onCompleteAll(n){const o=n;delete o.__v;for(let i=0;i<o.DonMua.length;i++)o.DonMua[i].DaLam=!0;console.log(o),this.plus.httpPut(this.api,o).subscribe(i=>{console.log(i),this.plus.IDB_DB_Add(this.db,this.api,o),this.getIDB(this.db)})}reload(){this.plus.reload("ban-hang/pha-che")}checkPer(n){return this.plus.checkPer(this.api,n)}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(m.T),t.Y36(c.qu))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-pha-che"]],decls:4,vars:2,consts:[[1,"container"],["class","text-center text-primary",4,"ngIf"],[1,"card-group"],[4,"ngFor","ngForOf"],[1,"text-center","text-primary"],[1,"card","text-center","mx-3","mb-3"],[1,"card-title","bg-success"],["class","card-body text-left",4,"ngFor","ngForOf"],["mat-raised-button","","color","accent",3,"click"],[1,"card-body","text-left"],[1,"font-blue"],[1,"text-danger","mx-3"],[1,"font-red","font-note"],[1,"mx-3"],["hidden","","mat-raised-button","","color","accent",3,"click",4,"ngIf"],["hidden","","mat-raised-button","","color","accent",3,"click"]],template:function(n,o){1&n&&(t.TgZ(0,"div",0),t.YNc(1,at,2,0,"h4",1),t.TgZ(2,"div",2),t.YNc(3,ct,8,2,"div",3),t.qZA()()),2&n&&(t.xp6(1),t.Q6J("ngIf",0==o.items.length),t.xp6(2),t.Q6J("ngForOf",o.items))},directives:[p.O5,p.sg,x.lW,C.Hw],pipes:[f.dw],styles:[".card[_ngcontent-%COMP%], .card-title[_ngcontent-%COMP%]{border-radius:1rem}"],data:{animation:[g.Ym]}}),e})();var H=l(99826),ut=l(69798),U=l(64449);function ht(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"mat-chip",24),t.NdJ("click",function(){const s=t.CHM(n).$implicit;return t.oxw(2).showArea(s.NoiDung)}),t._uU(1),t.qZA()}if(2&e){const n=a.$implicit,o=t.oxw(2);t.Q6J("selected",o.area==n.NoiDung),t.xp6(1),t.hij("Khu ",n.NoiDung,"")}}function pt(e,a){if(1&e&&(t.TgZ(0,"button",30),t._uU(1),t.ALo(2,"commas"),t.qZA()),2&e){const n=t.oxw().$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,n.ThanhTien))}}function dt(e,a){if(1&e&&(t.TgZ(0,"span",31),t._uU(1),t.ALo(2,"fromNow"),t.qZA()),2&e){const n=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,n.GioVao),"")}}const mt=function(e){return{"border-danger":e}};function _t(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"div",25)(1,"div",26),t.NdJ("click",function(){const s=t.CHM(n).$implicit;return t.oxw(2).chooseTable(s)}),t.TgZ(2,"h4",27),t._uU(3),t.qZA(),t.YNc(4,pt,3,3,"button",28),t.YNc(5,dt,3,3,"span",29),t.qZA()()}if(2&e){const n=a.$implicit;t.xp6(1),t.Q6J("ngClass",t.VKq(4,mt,n.ThanhTien>0)),t.xp6(2),t.Oqu(n.TenBan),t.xp6(1),t.Q6J("ngIf",n.ThanhTien>0),t.xp6(1),t.Q6J("ngIf",n.GioVao>0)}}function gt(e,a){if(1&e&&(t.TgZ(0,"div",20)(1,"div",2)(2,"mat-chip-list"),t.YNc(3,ht,2,2,"mat-chip",21),t.qZA(),t.TgZ(4,"button",22),t._uU(5,"Th\xeam b\xe0n"),t.qZA()(),t.TgZ(6,"div",2),t.YNc(7,_t,6,6,"div",23),t.qZA()()),2&e){const n=t.oxw();t.xp6(3),t.Q6J("ngForOf",n.TabBan),t.xp6(4),t.Q6J("ngForOf",n.ChiaBan)}}function ft(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"mat-chip",24),t.NdJ("click",function(){const s=t.CHM(n).$implicit;return t.oxw(2).orderByGroup(s)}),t._uU(1),t.qZA()}if(2&e){const n=a.$implicit,o=a.index,i=t.oxw(2);t.Q6J("selected",i.indexNhomHang==o),t.xp6(1),t.Oqu(n.NoiDung)}}function Tt(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"div",1),t.NdJ("click",function(){t.CHM(n);const i=t.oxw().$implicit;return t.oxw(2).chooseProduct(i)}),t.TgZ(1,"div",37)(2,"h4",38),t._uU(3),t.qZA()()()}if(2&e){const n=t.oxw().$implicit;t.xp6(1),t.Udp("border-bottom-color",n.HinhAnh),t.xp6(2),t.hij("",n.TenHangHoa," ")}}function bt(e,a){if(1&e&&(t.TgZ(0,"div",35),t.YNc(1,Tt,4,3,"div",36),t.qZA()),2&e){const n=a.$implicit;t.xp6(1),t.Q6J("ngIf",n.TrangThai)}}function xt(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"div")(1,"button",32),t.NdJ("click",function(){return t.CHM(n),t.oxw().reload()}),t._uU(2,"Ch\u1ecdn b\xe0n"),t.qZA(),t.TgZ(3,"button",33),t.NdJ("click",function(){return t.CHM(n),t.oxw().saveBill()}),t._uU(4,"L\u01b0u"),t.qZA(),t.TgZ(5,"mat-chip-list"),t.YNc(6,ft,2,2,"mat-chip",21),t.qZA(),t._UZ(7,"hr"),t.TgZ(8,"div",2),t.YNc(9,bt,2,1,"div",34),t.qZA()()}if(2&e){const n=t.oxw();t.xp6(6),t.Q6J("ngForOf",n.NhomHang),t.xp6(3),t.Q6J("ngForOf",n.products)}}function Ct(e,a){if(1&e&&(t.TgZ(0,"h6",42)(1,"i"),t._uU(2),t.ALo(3,"commas"),t.qZA()()),2&e){const n=t.oxw(2);t.xp6(2),t.hij(" T\u1ea1m t\xednh ",t.lcZ(3,1,n.table.ThanhTien)," K ")}}function Zt(e,a){if(1&e&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&e){const n=t.oxw().$implicit;t.xp6(1),t.hij(" (+ ",n.GhiChu.length-1,") ")}}function At(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"mat-option",49),t.NdJ("click",function(){const s=t.CHM(n).$implicit,r=t.oxw().$implicit;return t.oxw(2).addNote(r._id,s)}),t._uU(1),t.qZA()}if(2&e){const n=a.$implicit;t.Q6J("value",n.NoiDung),t.xp6(1),t.hij(" ",n.NoiDung," ")}}function vt(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"mat-list-option")(1,"table")(2,"tr")(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.ALo(7,"number"),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA(),t.TgZ(10,"td")(11,"mat-icon",43),t._uU(12,"delete"),t.qZA()()(),t.TgZ(13,"tr")(14,"td")(15,"mat-select",44)(16,"mat-select-trigger"),t._uU(17),t.YNc(18,Zt,2,1,"span",5),t.qZA(),t.YNc(19,At,2,2,"mat-option",45),t.ALo(20,"catalog"),t.TgZ(21,"mat-form-field"),t._UZ(22,"input",46,47),t.TgZ(24,"mat-icon",48),t.NdJ("click",function(){const s=t.CHM(n).$implicit,r=t.MAs(23);return s.GhiChu[0]=r.value}),t._uU(25,"save"),t.qZA()()()()()()()}if(2&e){const n=a.$implicit;t.xp6(4),t.hij("",n.TenHangHoa,":"),t.xp6(2),t.Oqu(t.lcZ(7,8,n.SoLuong)),t.xp6(3),t.hij(" ",n.DVT,""),t.xp6(6),t.Q6J("placeholder","\u270e"),t.xp6(2),t.hij("",n.GhiChu[1]," "),t.xp6(1),t.Q6J("ngIf",n.GhiChu.length>1),t.xp6(1),t.Q6J("ngForOf",t.lcZ(20,10,"GhiChuMon")),t.xp6(3),t.s9C("value",n.GhiChu[0])}}function Dt(e,a){if(1&e&&(t.TgZ(0,"div"),t.YNc(1,Ct,4,3,"h6",39),t._UZ(2,"hr"),t.TgZ(3,"mat-selection-list",40),t.YNc(4,vt,26,12,"mat-list-option",41),t.qZA()()),2&e){const n=t.oxw();t.xp6(1),t.Q6J("ngIf",n.table.ThanhTien>0),t.xp6(2),t.Q6J("multiple",!1),t.xp6(1),t.Q6J("ngForOf",null==n.table?null:n.table.DonMua)}}let I=(()=>{class e{constructor(n,o,i,s,r){this.plus=n,this.route=o,this.fb=i,this.bhsv=s,this.rtSv=r,this.global=!1,this.DonMua=[],this.ThanhTien=0,this.donHang=[],this.filter=[],this.ChiaBan=[],this.ban=0,this.xemBan=!0,this.xemMon=!1,this.db=null,this.title="D\u1ecbch v\u1ee5 \u0103n u\u1ed1ng",this.dbName="ban-hang",this.api="thanh-toan",this.room=this.global?this.api:this.plus.userId+this.api,this.user=this.plus.user.getValue(),this.items=[],this.TabBan=this.plus.sortArr(this.plus.user.getValue().NhomBan,"ThuTu",1),this.NhomHang=this.plus.user.getValue().NhomHang,this.step=0,this.area=this.TabBan[0].NoiDung,this.group=this.NhomHang[0],this.products=[],this.printTime=Date.now(),this.total=0}ngOnDestroy(){console.log("Destroy an-uong"),this.plus.subs.unsubscribe(),this.rtSv.leaveRoom(this.room)}ngOnInit(){this.plus.setTiTle(this.title),this.plus.IDB_InitDB(this.dbName).subscribe(n=>{this.db=n,this.showArea(this.area),this.plus.updateUserLocal(n,this.api),this.plus.updateAPi.subscribe(o=>{this.showArea(this.area)})})}get(){this.rtSv.get("thanh-toan",this.plus.user.value._id,!1)}set(){this.rtSv.set("thanh-toan",this.plus.user.value._id,Date.now(),!1)}print(){this.bhsv.printBill()}showArea(n){this.step=0,this.plus.IDB_DB_GetAllByIndexKey(this.bhsv.db,"an-uong","NhomBan","=",n).subscribe(o=>{this.ChiaBan=o,this.area=n})}chooseTable(n){this.step=1,this.table=n,this.table.GioVao=Date.now(),this.orderByGroup(this.group)}orderByGroup(n){this.plus.IDB_DB_GetAllByIndexKey(this.db,"hang-hoa","NhomHang","=",n.NoiDung).subscribe(o=>{this.products=o})}chooseProduct(n){let o=0,i=0;const s={_id:n._id,TenHangHoa:n.TenHangHoa,GiaBan:n.GiaBan,GiaVon:n.GiaVon,KhuyenMai:n.KhuyenMai,DaLam:0,DVT:n.DVT,SoLuong:0,GhiChu:[" "]},r=this.table.DonMua.findIndex(h=>h._id==n._id);-1==r?(s.SoLuong=1,this.table.DonMua.push(s)):this.table.DonMua[r].SoLuong+=1;const u=this.table.DonMua;for(let h=0;h<u.length;h++)o+=(u[h].GiaBan-u[h].GiaVon)*u[h].SoLuong,i+=u[h].GiaBan*u[h].SoLuong,this.table.SoKH+=u[h].SoLuong;this.table.ThanhTien=i,this.table.LoiNhuan=o}addNote(n,o){const i=this.table.DonMua.findIndex(r=>r._id==n),s=this.table.DonMua[i].GhiChu.findIndex(r=>r==o);this.table.DonMua[i].GhiChu.includes(o.NoiDung)?this.table.DonMua[i].GhiChu.splice(s,1):this.table.DonMua[i].GhiChu.push(o.NoiDung)}saveBill(){console.log(this.table)}addArea(){}thanhToan(){}removeItem(n){}addItem(n,o){}delItem(n){}updateList(n,o,i){const s=+i.target.textContent;if(console.log(s),"Enter"===i.key&&i.preventDefault(),"number"!=typeof s)return this.plus.alertError("Sai \u0111\u1ecbnh d\u1ea1ng"),this.DonMua[n][o]=0;this.DonMua[n][o]=+s}back(){this.step=this.step-1}reload(){this.plus.reload("ban-hang/an-uong")}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(m.T),t.Y36(H.gz),t.Y36(c.qu),t.Y36(q),t.Y36(ut.i))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-an-uong"]],decls:31,vars:6,consts:[[1,"container-fluid"],[3,"click"],[1,"row"],[1,"col-md-9"],["class","step0",4,"ngIf"],[4,"ngIf"],[1,"col-md-3","border","rounded","py-2"],[1,"text-center"],["mat-raised-button","","color","warn",3,"click"],["id","addArea","tabindex","-1","role","dialog","aria-labelledby","modelTitleId","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-body"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary"],[1,"step0"],["color","accent",3,"selected","click",4,"ngFor","ngForOf"],["id","add-btn","mat-raised-button","","data-toggle","modal","data-target","#addArea"],["class","card-group",4,"ngFor","ngForOf"],["color","accent",3,"selected","click"],[1,"card-group"],[1,"card","hangHoa",3,"ngClass","click"],[1,"text-center","pt-3"],["class","badge badge-warning",4,"ngIf"],["class","badge badge-light",4,"ngIf"],[1,"badge","badge-warning"],[1,"badge","badge-light"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","accent",3,"click"],["class","card-group clearfix","id","item",4,"ngFor","ngForOf"],["id","item",1,"card-group","clearfix"],[3,"click",4,"ngIf"],[1,"card","hangHoa"],[1,"text-center","py-3"],["class","text-center text-primary",4,"ngIf"],[3,"multiple"],[4,"ngFor","ngForOf"],[1,"text-center","text-primary"],["color","warn"],["multiple","",1,"mat-select-red",3,"placeholder"],[3,"value","click",4,"ngFor","ngForOf"],["matInput","","placeholder","Ghi ch\xfa kh\xe1c",3,"value"],["note",""],["matSuffix","",3,"click"],[3,"value","click"]],template:function(n,o){1&n&&(t.TgZ(0,"div",0)(1,"button",1),t.NdJ("click",function(){return o.set()}),t._uU(2," set"),t.qZA(),t.TgZ(3,"button",1),t.NdJ("click",function(){return o.get()}),t._uU(4," get"),t.qZA(),t.TgZ(5,"div",2)(6,"div",3),t.YNc(7,gt,8,2,"div",4),t.YNc(8,xt,10,2,"div",5),t.qZA(),t.TgZ(9,"div",6)(10,"div",7)(11,"button",8),t.NdJ("click",function(){return o.thanhToan()}),t._uU(12),t.ALo(13,"uppercase"),t.qZA()(),t.YNc(14,Dt,5,3,"div",5),t.qZA()()(),t.TgZ(15,"div",9)(16,"div",10)(17,"div",11)(18,"div",12)(19,"h5",13),t._uU(20,"Th\xeam b\xe0n"),t.qZA(),t.TgZ(21,"button",14)(22,"span",15),t._uU(23,"\xd7"),t.qZA()()(),t.TgZ(24,"div",16),t._uU(25," Body "),t.qZA(),t.TgZ(26,"div",17)(27,"button",18),t._uU(28,"Close"),t.qZA(),t.TgZ(29,"button",19),t._uU(30,"Save"),t.qZA()()()()()),2&n&&(t.xp6(7),t.Q6J("ngIf",o.step<1),t.xp6(1),t.Q6J("ngIf",1==o.step),t.xp6(4),t.hij("Th\u1ef1c \u0111\u01a1n ",t.lcZ(13,4,null==o.table?null:o.table.TenBan),""),t.xp6(2),t.Q6J("ngIf",o.table))},directives:[p.O5,A.qn,p.sg,A.HS,x.lW,p.mk,U.Ub,U.vS,C.Hw,v.gD,v.$L,D.ey,_.KE,y.Nt,_.R9],pipes:[f.W,f.dw,p.gd,p.JJ,f.pW],styles:[".hangHoa[_ngcontent-%COMP%]{height:10rem;width:10rem;border-radius:1rem;border-bottom-width:3rem;border-color:#90ee90;color:#00f;float:none;align-items:center;justify-content:center}.hangHoa[_ngcontent-%COMP%]:active{transform:scale(1.1);opacity:50%;background-color:tomato}.new[_ngcontent-%COMP%]{height:10rem;width:10rem;border-radius:1rem;border-bottom-width:3rem;border-color:#90ee90;color:#00f;float:none;align-items:center;justify-content:center}.hoadon[_ngcontent-%COMP%]{width:200px}.mat-list-text[_ngcontent-%COMP%]{color:#00f!important;font-weight:700;padding-bottom:3px;padding-top:3px}.mat-select-placeholder[_ngcontent-%COMP%]{color:#007bff}  .mat-pseudo-checkbox-checked, .mat-pseudo-checkbox-indeterminate[_ngcontent-%COMP%], .mat-accent[_ngcontent-%COMP%]   .mat-pseudo-checkbox-checked[_ngcontent-%COMP%], .mat-accent[_ngcontent-%COMP%]   .mat-pseudo-checkbox-indeterminate[_ngcontent-%COMP%]{background:tomato!important}.mat-select-red[_ngcontent-%COMP%]{color:tomato!important}  .mat-select-value{color:#00f!important;font-style:italic!important;font-size:small!important}  .mat-select-content{width:20px;background-color:red;font-size:10px}  .mat-select-placeholder{color:#00f!important;font-size:17px}"],data:{animation:[g.Ym,g.Mq]}}),e})();var Ht=l(46936),yt=l(25862),Bt=l(32368),Nt=l(86087),qt=l(87654),Ut=l(97012);function kt(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"button",35),t.NdJ("click",function(){return t.CHM(n),t.oxw().reload()}),t.TgZ(1,"mat-icon"),t._uU(2,"undo"),t.qZA()()}2&e&&t.Q6J("@slideIn",void 0)}function Mt(e,a){1&e&&(t.TgZ(0,"th"),t._uU(1,"M\xe3 v\u1ea1ch"),t.qZA())}function Et(e,a){1&e&&(t.TgZ(0,"th"),t._uU(1,"Nh\xf3m h\xe0ng"),t.qZA())}function wt(e,a){1&e&&(t.TgZ(0,"th"),t._uU(1,"Khuy\u1ebfn m\xe3i"),t.qZA())}function Ft(e,a){1&e&&(t.TgZ(0,"th"),t._uU(1,"\u0110\u01a1n v\u1ecb t\xednh"),t.qZA())}function Jt(e,a){1&e&&(t.TgZ(0,"th"),t._uU(1,"Gi\xe1 v\u1ed1n"),t.qZA())}function Ot(e,a){1&e&&(t.TgZ(0,"th"),t._uU(1,"Quy \u0111\u1ed5i \u0111\u01a1n v\u1ecb"),t.qZA())}function Qt(e,a){1&e&&(t.TgZ(0,"th"),t._uU(1,"H\xecnh \u1ea3nh"),t.qZA())}function Pt(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"td",43),t.NdJ("click",function(){t.CHM(n);const i=t.oxw().$implicit;return t.oxw(2).onEdit(i)}),t._uU(1),t.qZA()}if(2&e){const n=t.oxw().$implicit;t.xp6(1),t.Oqu(n.Barcode)}}function Lt(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"td",43),t.NdJ("click",function(){t.CHM(n);const i=t.oxw().$implicit;return t.oxw(2).onEdit(i)}),t._uU(1),t.qZA()}if(2&e){const n=t.oxw().$implicit;t.xp6(1),t.Oqu(n.NhomHang)}}function Gt(e,a){if(1&e&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&e){const n=t.oxw().$implicit;t.xp6(1),t.Oqu(n.KhuyenMai)}}function Yt(e,a){if(1&e&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&e){const n=t.oxw().$implicit;t.xp6(1),t.Oqu(n.DVT)}}function St(e,a){if(1&e&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&e){const n=t.oxw().$implicit;t.xp6(1),t.Oqu(n.GiaVon)}}function Vt(e,a){if(1&e&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&e){const n=t.oxw().$implicit;t.xp6(1),t.Oqu(n.QuyDoi)}}function $t(e,a){if(1&e&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&e){const n=t.oxw().$implicit;t.xp6(1),t.Oqu(n.HinhAnh)}}function Kt(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"mat-icon",46),t.NdJ("click",function(){t.CHM(n);const i=t.oxw().$implicit;return t.oxw(2).onDelete(i)}),t._uU(1,"delete"),t.qZA()}}function jt(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"tr"),t.YNc(1,Pt,2,1,"td",41),t.YNc(2,Lt,2,1,"td",42),t.TgZ(3,"td",43),t.NdJ("click",function(){const s=t.CHM(n).$implicit;return t.oxw(2).onEdit(s)}),t._uU(4),t.qZA(),t.TgZ(5,"td",43),t.NdJ("click",function(){const s=t.CHM(n).$implicit;return t.oxw(2).onEdit(s)}),t._uU(6),t.qZA(),t.TgZ(7,"td",43),t.NdJ("click",function(){const s=t.CHM(n).$implicit;return t.oxw(2).onEdit(s)}),t._uU(8),t.qZA(),t.YNc(9,Gt,2,1,"td",37),t.YNc(10,Yt,2,1,"td",38),t.TgZ(11,"td")(12,"mat-slide-toggle",44),t.NdJ("change",function(){const s=t.CHM(n).$implicit;return t.oxw(2).updateStatus(s)}),t.qZA()(),t.YNc(13,St,2,1,"td",37),t.YNc(14,Vt,2,1,"td",37),t.YNc(15,$t,2,1,"td",37),t.TgZ(16,"td"),t.YNc(17,Kt,2,0,"mat-icon",45),t.qZA()()}if(2&e){const n=a.$implicit,o=t.oxw(2);t.xp6(1),t.Q6J("ngIf",o.device),t.xp6(1),t.Q6J("Device",2),t.xp6(2),t.Oqu(n.TenHangHoa),t.xp6(2),t.Oqu(n.TonKho),t.xp6(2),t.Oqu(n.GiaBan),t.xp6(1),t.Q6J("ngIf",o.device),t.xp6(1),t.Q6J("Device",2),t.xp6(2),t.Q6J("checked",n.TrangThai),t.xp6(1),t.Q6J("ngIf",o.device),t.xp6(1),t.Q6J("ngIf",o.device),t.xp6(1),t.Q6J("ngIf",o.device),t.xp6(2),t.Q6J("ngIf",o.checkPer(4))}}function zt(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"table",36)(1,"thead"),t.YNc(2,Mt,2,0,"th",37),t.YNc(3,Et,2,0,"th",38),t.TgZ(4,"th"),t._uU(5,"T\xean"),t.qZA(),t.TgZ(6,"th"),t._uU(7,"T\u1ed3n kho"),t.qZA(),t.TgZ(8,"th"),t._uU(9,"Gi\xe1n B\xe1n"),t.qZA(),t.YNc(10,wt,2,0,"th",37),t.YNc(11,Ft,2,0,"th",38),t.TgZ(12,"th"),t._uU(13,"Cho b\xe1n"),t.qZA(),t.YNc(14,Jt,2,0,"th",37),t.YNc(15,Ot,2,0,"th",37),t.YNc(16,Qt,2,0,"th",37),t.TgZ(17,"th")(18,"mat-icon",39),t.NdJ("click",function(){return t.CHM(n),t.oxw().reload()}),t._uU(19,"cached"),t.qZA()()(),t.TgZ(20,"tbody"),t.YNc(21,jt,18,12,"tr",40),t.qZA()()}if(2&e){const n=t.oxw();t.Q6J("@slideIn",void 0),t.xp6(2),t.Q6J("ngIf",n.device),t.xp6(1),t.Q6J("Device",2),t.xp6(7),t.Q6J("ngIf",n.device),t.xp6(1),t.Q6J("Device",2),t.xp6(3),t.Q6J("ngIf",n.device),t.xp6(1),t.Q6J("ngIf",n.device),t.xp6(1),t.Q6J("ngIf",n.device),t.xp6(5),t.Q6J("ngForOf",n.filter.length>0?n.filter:n.items.slice(0,10))}}function Rt(e,a){if(1&e&&t._UZ(0,"app-import-database",47),2&e){const n=t.oxw();t.Q6J("api",n.api)("form",n.main)("global",!1)}}function Xt(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"button",48),t.NdJ("click",function(){return t.CHM(n),t.oxw().resetDB()}),t._uU(1,"X\xf3a to\xe0n b\u1ed9 d\u1eef li\u1ec7u"),t.qZA()}}function Wt(e,a){if(1&e&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&e){const n=a.$implicit;t.s9C("value",n.NoiDung),t.xp6(1),t.hij("",n.NoiDung," ")}}function tn(e,a){if(1&e&&(t.TgZ(0,"mat-option",49),t._uU(1),t.qZA()),2&e){const n=a.$implicit;t.s9C("value",n.NoiDung),t.xp6(1),t.hij("",n.NoiDung," ")}}function nn(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"button",50),t.NdJ("click",function(){return t.CHM(n),t.oxw().save()}),t.TgZ(1,"mat-icon"),t._uU(2,"save"),t.qZA()()}2&e&&t.Q6J("@slideIn",void 0)}const on=function(){return[5,10,25,100]};let en=(()=>{class e{constructor(n,o){this.plus=n,this.fb=o,this.chart=[],this.nhomHang=this.plus.sortArr(this.plus.user.getValue().NhomHang,"ThuTu",1),this.main=this.fb.group({_id:[],Barcode:[""],NhomHang:[,[c.kI.required]],TenHangHoa:[,[c.kI.required]],TonKho:[0],GiaBan:[0,[c.kI.required]],KhuyenMai:[0],DVT:[,[c.kI.required]],TrangThai:[!0],GiaVon:[0,[c.kI.required]],QuyDoi:[],HinhAnh:[]}),this.device=window.innerWidth>1200,this.title="H\xe0ng h\xf3a",this.dbName="ban-hang",this.api="hang-hoa",this.db=null,this.items=[],this.selectedItem=null,this.filter=[],this.itemsAuto=[]}ngOnInit(){this.plus.setTiTle(this.title),this.plus.IDB_InitDB(this.dbName).subscribe(n=>function(e,a,n,o){return new(n||(n=Promise))(function(s,r){function u(T){try{b(o.next(T))}catch(d){r(d)}}function h(T){try{b(o.throw(T))}catch(d){r(d)}}function b(T){T.done?s(T.value):function i(s){return s instanceof n?s:new n(function(r){r(s)})}(T.value).then(u,h)}b((o=o.apply(e,a||[])).next())})}(this,void 0,void 0,function*(){this.db=n,this.plus.syncOffline(this.api),this.getIDB(),this.plus.updateUserLocal(n,this.api),this.plus.updateAPi.subscribe(o=>{o&&this.getIDB()})}))}getIDB(){console.log("getIDB"),this.filter=[],this.plus.IDB_DB_GetAll(this.db,this.api).subscribe(n=>{this.items=n,this.plus.updateAPi.next(!1)})}ngOnDestroy(){console.log("Destroy",this.api),this.plus.subs.unsubscribe()}save(){if(this.main.invalid)return;const n=Object.assign({},this.main.value);if(0==this.plus.online.value){const o=[];return o.push(n),this.plus.IDB_DB_AddOff(this.db,this.api,o).subscribe(i=>{this.plus.clickBtn("closeModal")})}null==n._id?(delete n._id,this.plus.httpPost(this.api,n).subscribe(o=>{o.status&&this.plus.clickBtn("closeModal")})):this.plus.httpPut(this.api,n).subscribe(o=>{o.status&&this.plus.clickBtn("closeModal")})}onEdit(n){this.selectedItem=n;const o=this.plus.dateToHtmlObj(n,[""]);this.main.patchValue(o),this.plus.clickBtn("openModal")}onDelete(n){!confirm("B\u1ea1n mu\u1ed1n x\xf3a?")||(this.plus.load(),this.plus.httpDisable(this.api,n).then(i=>{console.log(i)}))}getAuto(n,o){!this.db||o.length<2||(this.itemsAuto=[],this.plus.IDB_DB_Search(this.db,n,o,4).subscribe(i=>{this.itemsAuto=i}))}getBarcode(n){this.main.patchValue({Barcode:n})}chooseOpt(n,o,i,s=!1){this.main.controls[o].setValue(n[i]),s&&this.main.controls[o+"ID"].setValue(n._id)}updateStatus(n){n.TrangThai=!n.TrangThai,delete n.__v,this.plus.httpPost(this.api+"/updateStatus",n).subscribe(o=>{})}closeModal(){this.main.reset()}search(n){this.filter=n}find(n){this.items=n}checkPer(n){return this.plus.checkPer(this.api,n)}patchForm(){}reload(){return this.plus.reload(this.dbName+"/"+this.api)}reset(){this.plus.loaded(),this.filter=[],this.getIDB(),this.main.reset({TonKho:0,TrangThai:!0,KhuyenMai:0,QuyDoi:1,HinhAnh:"#ffffff"})}changePage(n){this.filter=this.items.slice(n.pageIndex*n.pageSize,(n.pageIndex+1)*n.pageSize)}resetDB(){this.plus.resetDB(this.db,this.api)}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(m.T),t.Y36(c.qu))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-hang-hoa"]],decls:80,vars:19,consts:[[1,"container"],["id","add-btn","color","accent","mat-raised-button","","data-toggle","modal","data-target","#modelId",3,"click"],["id","back-btn","mat-raised-button","","color","primary",3,"click",4,"ngIf"],[3,"db","api","filter"],[1,"row"],["class","table table-hover ",4,"ngIf"],[3,"length","pageSize","pageSizeOptions","page"],[3,"api","form","global",4,"ngIf"],[3,"dataJson"],["mat-button","","color","warn",3,"click",4,"ngIf"],["id","openModal","type","button","data-toggle","modal","data-target","#modelId",1,"d-none"],["id","modelId","data-backdrop","static","tabindex","-1","role","dialog","aria-labelledby","modelTitleId","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-body"],[1,"container-fluid"],[3,"formGroup"],["hidden","","formControlName","_id"],["required","","matInput","","formControlName","TenHangHoa"],[1,"col-6"],["required","","formControlName","NhomHang"],[3,"value",4,"ngFor","ngForOf"],["required","","formControlName","DVT"],["type","number","autocomplete","off","matInput","","formControlName","GiaVon",2,"float","right"],["matSuffix",""],["type","number","autocomplete","off","matInput","","formControlName","TonKho",2,"float","right"],["required","","type","number","autocomplete","off","matInput","","formControlName","GiaBan",2,"float","right"],["type","number","autocomplete","off","matInput","","formControlName","KhuyenMai",2,"float","right"],["type","text","autocomplete","off","matInput","","formControlName","QuyDoi"],["type","color","matInput","","formControlName","HinhAnh"],["type","text","autocomplete","off","matInput","","formControlName","Barcode"],["matPrefix","","formControlName","TrangThai","color","primary",1,"mx-2"],[1,"modal-footer"],["id","closeModal","mat-raised-button","","color","primary","data-dismiss","modal",3,"click"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["id","back-btn","mat-raised-button","","color","primary",3,"click"],[1,"table","table-hover"],[4,"ngIf"],[4,"Device"],["color","primary",3,"click"],[4,"ngFor","ngForOf"],[3,"click",4,"ngIf"],[3,"click",4,"Device"],[3,"click"],["matPrefix","","color","primary",1,"mx-2",3,"checked","change"],["color","warn",3,"click",4,"ngIf"],["color","warn",3,"click"],[3,"api","form","global"],["mat-button","","color","warn",3,"click"],[3,"value"],["mat-raised-button","","color","warn",3,"click"]],template:function(n,o){1&n&&(t.TgZ(0,"div",0)(1,"button",1),t.NdJ("click",function(){return o.reset()}),t.TgZ(2,"mat-icon"),t._uU(3,"control_point"),t.qZA()(),t.YNc(4,kt,3,1,"button",2),t.TgZ(5,"app-search-table",3),t.NdJ("filter",function(s){return o.search(s)}),t.qZA(),t.TgZ(6,"div",4),t.YNc(7,zt,22,9,"table",5),t.qZA(),t.TgZ(8,"mat-paginator",6),t.NdJ("page",function(s){return o.changePage(s)}),t.qZA(),t.YNc(9,Rt,1,3,"app-import-database",7),t._UZ(10,"app-export-ecxel",8),t.qZA(),t.YNc(11,Xt,2,0,"button",9),t._UZ(12,"button",10),t.TgZ(13,"div",11)(14,"div",12)(15,"div",13)(16,"div",14)(17,"div",15)(18,"form",16),t._UZ(19,"input",17),t.TgZ(20,"mat-form-field")(21,"mat-label"),t._uU(22,"T\xean"),t.qZA(),t._UZ(23,"textarea",18),t.qZA(),t.TgZ(24,"div",4)(25,"div",19)(26,"mat-form-field")(27,"mat-label"),t._uU(28,"Nh\xf3m h\xe0ng"),t.qZA(),t.TgZ(29,"mat-select",20),t.YNc(30,Wt,2,2,"mat-option",21),t.qZA()(),t.TgZ(31,"mat-form-field")(32,"mat-label"),t._uU(33,"\u0110\u01a1n v\u1ecb t\xednh"),t.qZA(),t.TgZ(34,"mat-select",22),t.YNc(35,tn,2,2,"mat-option",21),t.ALo(36,"catalog"),t.qZA()(),t.TgZ(37,"mat-form-field")(38,"mat-label"),t._uU(39,"Gi\xe1 v\u1ed1n"),t.qZA(),t._UZ(40,"input",23),t.TgZ(41,"span",24),t._uU(42,".000"),t.qZA()(),t.TgZ(43,"mat-form-field")(44,"mat-label"),t._uU(45,"T\u1ed3n kho"),t.qZA(),t._UZ(46,"input",25)(47,"span",24),t.qZA(),t.TgZ(48,"mat-form-field")(49,"mat-label"),t._uU(50,"Gi\xe1n B\xe1n"),t.qZA(),t._UZ(51,"input",26)(52,"span",24),t.qZA()(),t.TgZ(53,"div",19)(54,"mat-form-field")(55,"mat-label"),t._uU(56,"Khuy\u1ebfn m\xe3i"),t.qZA(),t._UZ(57,"input",27),t.TgZ(58,"span",24),t._uU(59,"%"),t.qZA()(),t.TgZ(60,"mat-form-field")(61,"mat-label"),t._uU(62,"Quy \u0111\u1ed5i \u0111\u01a1n v\u1ecb"),t.qZA(),t._UZ(63,"input",28)(64,"span",24),t.qZA(),t.TgZ(65,"mat-form-field")(66,"mat-label"),t._uU(67,"M\xe0u \u0111\u1ea1i di\u1ec7n"),t.qZA(),t._UZ(68,"input",29),t.qZA(),t.TgZ(69,"mat-form-field")(70,"mat-label"),t._uU(71,"M\xe3 v\u1ea1ch"),t.qZA(),t._UZ(72,"input",30),t.qZA(),t.TgZ(73,"mat-slide-toggle",31),t._uU(74),t.qZA()()()()()(),t.TgZ(75,"div",32)(76,"button",33),t.NdJ("click",function(){return o.closeModal()}),t.TgZ(77,"mat-icon"),t._uU(78,"close"),t.qZA()(),t.YNc(79,nn,3,1,"button",34),t.qZA()()()()),2&n&&(t.xp6(4),t.Q6J("ngIf",o.filter.length>0),t.xp6(1),t.Q6J("db",o.db)("api",o.api),t.xp6(2),t.Q6J("ngIf",o.items.length+o.filter.length>0),t.xp6(1),t.Q6J("length",o.items.length)("pageSize",10)("pageSizeOptions",t.DdM(18,on)),t.xp6(1),t.Q6J("ngIf",o.checkPer(4)),t.xp6(1),t.Q6J("dataJson",o.items),t.xp6(1),t.Q6J("ngIf",o.checkPer(5)),t.xp6(7),t.Q6J("formGroup",o.main),t.xp6(12),t.Q6J("ngForOf",o.nhomHang),t.xp6(5),t.Q6J("ngForOf",t.lcZ(36,16,"DVT")),t.xp6(39),t.hij(" ",o.main.controls.TrangThai.value?"C\xf2n h\xe0ng":"H\u1ebft h\xe0ng",""),t.xp6(2),t.Q6J("@slideIn",void 0),t.xp6(3),t.Q6J("ngIf",o.checkPer(2)&&o.main.valid))},directives:[x.lW,C.Hw,p.O5,Ht.D,yt.HP,p.sg,Bt.Rr,_.qo,Nt.NW,qt.y,Ut.t,c._Y,c.JL,c.sg,c.Fj,c.JJ,c.u,_.KE,_.hX,y.Nt,c.Q7,v.gD,D.ey,c.wV,_.R9],pipes:[f.pW],styles:[""],data:{animation:[g.Ym,g.Mq]}}),e})();function an(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"div",2)(1,"button",3),t.NdJ("click",function(){return t.CHM(n),t.oxw().resetNhanDon()}),t._uU(2,"nhan-don"),t.qZA(),t.TgZ(3,"button",3),t.NdJ("click",function(){return t.CHM(n),t.oxw().resetHangHoa()}),t._uU(4,"hang-hoa"),t.qZA()()}}let sn=(()=>{class e{constructor(n){this.plus=n,this.db=null,this.dbName="ban-hang",this.global=!1,this.isAdmin=this.plus.isAdmin()}ngOnInit(){this.plus.IDB_InitDB(this.dbName).subscribe(n=>{this.db=n})}resetNhanDon(){const n="an-uong";!confirm("Reset DB"+n)||this.plus.httpDelete(n,"del",this.global).subscribe(i=>{console.log("Clear DB"),this.plus.FBS_PostByUser(n,0).then(s=>{console.log("Clear FBS"),console.log(s),this.plus.IDB_DB_ClearCollection(this.db,n).subscribe(r=>{console.log("Clear IDB")})})})}resetHangHoa(){const n="hang-hoa";!confirm("Reset DB"+n)||this.plus.httpDelete(n,"del",this.global).subscribe(i=>{console.log("Clear DB"),this.plus.FBS_PostByUser(n,0).then(s=>{console.log("Clear FBS"),console.log(s),this.plus.IDB_DB_ClearCollection(this.db,n).subscribe(r=>{console.log("Clear IDB")})})})}checkPer(n,o){return this.plus.checkPer(n,o)}onDetect(n){console.log(n)}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(m.T))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-ban-hang"]],decls:2,vars:1,consts:[[1,"container"],["class","row",4,"ngIf"],[1,"row"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(n,o){1&n&&(t.TgZ(0,"div",0),t.YNc(1,an,5,0,"div",1),t.qZA()),2&n&&(t.xp6(1),t.Q6J("ngIf",o.checkPer("hang-hoa",7)))},directives:[p.O5],styles:[""]}),e})();var rn=l(68306),k=l(91079);function cn(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"b",35),t.NdJ("click",function(i){t.CHM(n);const s=t.oxw().$implicit;return t.oxw().addNewItem(s,i)}),t._uU(1),t.qZA()}if(2&e){const n=t.oxw().$implicit;t.xp6(1),t.lnq(" ",n.TenHangHoa," [",n.GiaBan,"k/",n.DVT,"]")}}function ln(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"mat-option",33),t.NdJ("keyup.enter",function(i){const r=t.CHM(n).$implicit;return t.oxw().addNewItem(r,i)})("onSelectionChange",function(i){const r=t.CHM(n).$implicit;return t.oxw().addNewItem(r,i)}),t.YNc(1,cn,2,3,"b",34),t.qZA()}if(2&e){const n=a.$implicit;t.xp6(1),t.Q6J("ngIf",n.TrangThai)}}function un(e,a){1&e&&(t.TgZ(0,"mat-option"),t._uU(1," Kh\xf4ng c\xf2n k\u1ebft qu\u1ea3 ph\xf9 h\u1ee3p! "),t.qZA())}function hn(e,a){if(1&e&&(t.TgZ(0,"b",36),t._uU(1),t.ALo(2,"commas"),t.qZA()),2&e){const n=t.oxw();t.xp6(1),t.hij("Ti\u1ec1n th\u1eeba: ",t.lcZ(2,1,1e3*+n.khachDua-n.ThanhTien),"")}}function pn(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"tr")(1,"td",37),t._uU(2),t.qZA(),t.TgZ(3,"td",38),t._uU(4),t._UZ(5,"br"),t.TgZ(6,"b",39),t.NdJ("blur",function(i){const r=t.CHM(n).index;return t.oxw().updateGiaBan(r,"GiaBan",i)})("keydown.enter",function(i){const r=t.CHM(n).index;return t.oxw().updateGiaBan(r,"GiaBan",i)})("keydown.enter",function(i){const r=t.CHM(n).index;return t.oxw().updateList(r,"GiaBan",i)})("blur",function(i){const r=t.CHM(n).index;return t.oxw().updateList(r,"GiaBan",i)}),t._uU(7),t.ALo(8,"number"),t.qZA(),t._uU(9),t.qZA(),t.TgZ(10,"td",16)(11,"mat-icon",40),t.NdJ("click",function(){const s=t.CHM(n).index;return t.oxw().removeItem(s)}),t._uU(12,"arrow_left"),t.qZA(),t.TgZ(13,"b",41),t.NdJ("keydown.enter",function(i){const r=t.CHM(n).index;return t.oxw().updateList(r,"TongCong",i)})("blur",function(i){const r=t.CHM(n).index;return t.oxw().updateList(r,"TongCong",i)}),t._uU(14),t.ALo(15,"number"),t.qZA(),t.TgZ(16,"mat-icon",42),t.NdJ("click",function(){const i=t.CHM(n),s=i.$implicit,r=i.index;return t.oxw().addItem(s,r)}),t._uU(17,"arrow_right"),t.qZA()(),t.TgZ(18,"td",43)(19,"b"),t._uU(20),t.ALo(21,"commas"),t.qZA(),t.TgZ(22,"span",44),t.NdJ("click",function(){const s=t.CHM(n).index;return t.oxw().delItem(s)}),t.TgZ(23,"mat-icon",45),t._uU(24,"delete"),t.qZA()()()()}if(2&e){const n=a.$implicit,o=a.index;t.xp6(2),t.Oqu(o+1),t.xp6(2),t.Oqu(n.TenHangHoa),t.xp6(3),t.Oqu(t.lcZ(8,6,n.GiaBan)),t.xp6(2),t.hij("k/",n.DVT," "),t.xp6(5),t.hij(" ",t.lcZ(15,8,n.TongCong)," "),t.xp6(6),t.Oqu(t.lcZ(21,10,n.TongCong*n.GiaBan*1e3))}}function dn(e,a){if(1&e&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t._UZ(5,"br"),t._uU(6),t.ALo(7,"commas"),t.qZA(),t.TgZ(8,"td",47),t._uU(9),t.qZA(),t.TgZ(10,"td",49),t._uU(11),t.ALo(12,"commas"),t.qZA()()),2&e){const n=a.$implicit,o=a.index;t.xp6(2),t.hij("",o+1," "),t.xp6(2),t.hij("",n.TenHangHoa," "),t.xp6(2),t.hij(" ",t.lcZ(7,5,1e3*n.GiaBan)," "),t.xp6(3),t.Oqu(n.TongCong),t.xp6(2),t.Oqu(t.lcZ(12,7,n.TongCong*n.GiaBan*1e3))}}function mn(e,a){if(1&e&&(t.TgZ(0,"tbody"),t.YNc(1,dn,13,9,"tr",18),t.TgZ(2,"tr")(3,"td",46)(4,"h5"),t._uU(5,"T\u1ed5ng c\u1ed9ng:"),t.qZA()(),t.TgZ(6,"td")(7,"h5"),t._uU(8),t.qZA()(),t.TgZ(9,"td",47)(10,"h5"),t._uU(11),t.ALo(12,"commas"),t.qZA(),t.TgZ(13,"h6")(14,"i"),t._uU(15),t.ALo(16,"titlecase"),t.qZA()()()(),t.TgZ(17,"td",48)(18,"h6"),t._uU(19,"Xin c\u1ea3m \u01a1n qu\xfd kh\xe1ch"),t.qZA(),t.TgZ(20,"h6"),t._uU(21,"S\u1ea3n ph\u1ea9m c\u1ee7a 4la.vn"),t.qZA()()()),2&e){const n=t.oxw();t.xp6(1),t.Q6J("ngForOf",n.DonMua),t.xp6(7),t.hij("",n.total," m\xf3n"),t.xp6(3),t.hij(" ",t.lcZ(12,4,n.ThanhTien),""),t.xp6(4),t.Oqu(t.lcZ(16,6,n.bangchu))}}const _n=function(e){return{loading:e}};let gn=(()=>{class e{constructor(n,o,i){this.plus=n,this.route=o,this.fb=i,this.subs=(new rn.y).subscribe(),this.db=null,this.title="B\xe1n h\xe0ng t\u1ea1p h\xf3a",this.dbName="ban-hang",this.api="tap-hoa",this.tabs=[],this.items=[],this.DonMua=[],this.total=0,this.ThanhTien=0,this.donHang=[],this.bangchu="",this.filter=[],this.audio=new Audio,this.nhapThuCong=!1,this.xemHoaDon=!0,this.user=this.plus.user.getValue(),this.printTime=Date.now(),this.NhomHang=this.plus.user.getValue().NhomHang,this.TabBan=this.plus.sortArr(this.plus.user.getValue().NhomBan,"ThuTu",1),this.ChiaBan=[],this.ban=0,this.width=window.innerWidth,this.count=0,this.now=Date.now(),this.xemBan=!0,this.xemMon=!1,this.donHangFB=this.fb.group({ThanhTien:[,[c.kI.required]],LoiNhuan:[,[c.kI.required]],SoKH:[,[c.kI.required]],GioVao:[,[c.kI.required]],DaThanhToan:[,[c.kI.required]],DonMua:this.fb.array([this.fb.group({idHangHoa:[,[c.kI.required]],DVT:[,[c.kI.required]],GiaBan:[,[c.kI.required]],GiaVon:[,[c.kI.required]],KhuyenMai:[,[c.kI.required]],TenHangHoa:[,[c.kI.required]],TongCong:[,[c.kI.required]]})])}),this.searchForm=this.fb.group({input:[,[c.kI.minLength(3),c.kI.maxLength(50)]]})}ngOnDestroy(){console.log("Destroy an-uong"),this.plus.subs.unsubscribe()}test(n){console.log(+n.replace(/\D/g,"")),this.khachDua=+n}ngOnInit(){this.plus.setTiTle(this.title),this.getBillLocal(),this.plus.IDB_InitDB(this.dbName).subscribe(n=>{this.db=n,document.getElementById("search-api").focus(),this.plus.updateUserLocal(n,"hang-hoa")}),this.search(),this.audio.src="assets/audio/beep.mp3",this.audio.load()}getBillLocal(){const n=JSON.parse(localStorage.getItem("tapHoaBill"));console.log("getBillLocal",n),null==n?this.DonMua=[]:(this.DonMua=n,this.getTongCong())}search(){this.subs.add(this.searchForm.valueChanges.subscribe(n=>{const o=this.plus.removeAccents(n.input);o.trim().length<2||this.plus.IDB_DB_GetByBarCode(this.db,"hang-hoa",o).subscribe(i=>{i?(this.searchForm.reset(),i.TrangThai?this.addNewItem(i,{}):this.plus.alertMatSnackBar("T\u1ea1m h\u1ebft h\xe0ng")):(this.filter=[],this.plus.IDB_DB_Search(this.db,"hang-hoa",o,5).subscribe(s=>{this.filter=s}))})}))}thanhToan(){const n=confirm("In h\xf3a \u0111\u01a1n?");let o=Object.assign({DonMua:this.DonMua.map(i=>({idHangHoa:i._id,TenHangHoa:i.TenHangHoa,GiaBan:i.GiaBan,GiaVon:i.GiaVon,KhuyenMai:i.KhuyenMai,DVT:i.DVT,TongCong:i.TongCong})),LoiNhuan:this.DonMua.map(i=>i.GiaBan-i.GiaVon-i.GiaBan*i.KhuyenMai/100).reduce((i,s)=>i+s),ThanhTien:this.ThanhTien,GioVao:Date.now(),SoKH:this.total,DaThanhToan:!0});if(this.donHangFB.patchValue(o),this.donHangFB.invalid){const i=this.plus.getErrValidateForm(this.donHangFB);console.log(i,this.donHangFB.status)}else this.plus.httpPost("thanh-toan/new",o).subscribe(i=>{const s=this.plus.Crypt_DecryptRest(i);this.plus.FBS_PostByUser("hang-hoa",s.dateModify),this.DonMua=[],this.reload()});localStorage.removeItem("tapHoaBill"),n?(this.PrintDiv("HoaDon"),console.log(0,o)):console.log(1,o)}addNewItem(n,o){console.log(o),this.filter=[],this.playAudio(),this.xemHoaDon=!0,window.navigator.vibrate(100);const i=this.DonMua.find(s=>s._id==n._id);if(!i)return n.TongCong=1,this.DonMua.unshift(n),this.getTongCong();{const s=this.DonMua.findIndex(r=>r._id==i._id);this.DonMua[s].TongCong+=1}this.getTongCong(),this.filter=[],this.searchForm.controls.input.setValue("")}removeItem(n){this.playAudio(),this.DonMua[n].TongCong>0&&(this.DonMua[n].TongCong-=1),this.getTongCong()}addItem(n,o){this.playAudio(),this.DonMua[o].TongCong+=1,this.getTongCong()}delItem(n){this.DonMua.splice(n,1),this.getTongCong()}getTongCong(){this.total=this.plus.sumByKey(this.DonMua,"TongCong").TongCong,this.getThanhTien()}getThanhTien(){let n=0;return this.DonMua.forEach(o=>{n+=o.GiaBan*o.TongCong*1e3}),this.bangchu=this.plus.numToVi(n),localStorage.setItem("tapHoaBill",JSON.stringify(this.DonMua)),this.ThanhTien=n}PrintDiv(n){this.plus.load();let o=window.document.getElementById(n);var i=window.open("","PRINT");i.document.write(document.documentElement.innerHTML),setTimeout(()=>{i.document.body.innerHTML=o.outerHTML,i.document.close(),i.focus(),i.print(),i.close()},1e3),this.plus.loaded()}getBarcode(n){this.searchForm.controls.input.setValue(n)}find(n){this.filter=n}getByBarcode(n){}reload(){this.plus.reload("ban-hang/tap-hoa")}updateList(n,o,i){const s=+i.target.textContent;if(console.log(s),"Enter"===i.key&&i.preventDefault(),"number"!=typeof s)return this.plus.alertError("Sai \u0111\u1ecbnh d\u1ea1ng"),this.DonMua[n][o]=0;this.DonMua[n][o]=+s,this.getTongCong()}updateGiaBan(n,o,i){if(this.DonMua[n][o]==+i.target.textContent)return;const s=this.DonMua[n].TongCong,r=this.DonMua[n];delete r.__v,delete r.TongCong,r.GiaBan=+i.target.textContent,this.plus.httpPut("hang-hoa",r).subscribe(u=>{document.getElementById("search-api").focus(),console.log(this.DonMua[n])}),this.DonMua[n][o]=+i.target.textContent,this.DonMua[n].TongCong=+s,this.getTongCong()}updateKhachDua(n){const o=+n.target.textContent;console.log(o,typeof o),"Enter"===n.key&&n.preventDefault(),("number"!=typeof o||Number.isNaN(o))&&this.plus.alertError("B\u1ea1n ph\u1ea3i nh\u1eadp s\u1ed1 ti\u1ec1n"),this.khachDua=+o}playAudio(){this.audio.play()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(m.T),t.Y36(H.gz),t.Y36(c.qu))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-tap-hoa"]],decls:68,vars:22,consts:[[1,"container-fluid"],[1,"row",2,"padding-top","10px"],[1,"col-lg-6"],[1,"form-group",3,"formGroup"],["type","text","id","search-api","autocomplete","off","formControlName","input","placeholder","T\xecm ki\u1ebfm (F2)",1,"form-control",3,"readonly","matAutocomplete","ngClass"],["autoActiveFirstOption",""],["auto","matAutocomplete"],[3,"keyup.enter","onSelectionChange",4,"ngFor","ngForOf"],[4,"ngIf"],["id","thanh-toan","mat-raised-button","","color","warn",1,"float-rigth",3,"disabled","click"],["contentEditable","true",1,"font-blue","inputSpan",3,"keydown.enter","blur"],["style","padding-left: 15px; color: blue;",4,"ngIf"],[1,"row"],[1,"table","table-hover"],["width","10%"],["width","35%"],["width","30%"],["width","25%",2,"text-align","center"],[4,"ngFor","ngForOf"],["id","modelId","tabindex","-1","role","dialog","aria-labelledby","modelTitleId","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-body","hoadon"],["id","HoaDon",1,"div"],[1,"text-left"],[1,"thead-inverse"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary"],[3,"keyup.enter","onSelectionChange"],[3,"click",4,"ngIf"],[3,"click"],[2,"padding-left","15px","color","blue"],["width","10%",2,"padding-left","5px"],["width","35%",2,"font-size","16px"],["contenteditable","true",1,"px-2","font-blue",3,"blur","keydown.enter"],["matPrefix","",1,"ar",3,"click"],["contenteditable","true",1,"font-blue",3,"keydown.enter","blur"],["matSuffix","",1,"ar",3,"click"],["width","25%",1,"text-right"],[2,"margin-left","20px",3,"click"],["color","warn"],["colspan","2",1,"text-center"],[1,"text-center"],["colspan","4",1,"text-center"],[1,"text-rigth"]],template:function(n,o){if(1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),t._UZ(4,"input",4),t.TgZ(5,"mat-autocomplete",5,6),t.YNc(7,ln,2,1,"mat-option",7),t.YNc(8,un,2,0,"mat-option",8),t.qZA()()(),t.TgZ(9,"div",2)(10,"button",9),t.NdJ("click",function(){return o.thanhToan()}),t._uU(11),t.ALo(12,"commas"),t.qZA(),t.TgZ(13,"b"),t._uU(14,"Kh\xe1ch \u0111\u01b0a: "),t.TgZ(15,"span",10),t.NdJ("keydown.enter",function(s){return o.updateKhachDua(s)})("blur",function(s){return o.updateKhachDua(s)}),t.qZA(),t._uU(16,".000\u0111"),t.qZA(),t.YNc(17,hn,3,3,"b",11),t.qZA()(),t.TgZ(18,"div",12)(19,"table",13)(20,"thead")(21,"tr")(22,"th",14),t._uU(23,"TT "),t.qZA(),t.TgZ(24,"th",15),t._uU(25,"H\u1ea1ng m\u1ee5c"),t.qZA(),t.TgZ(26,"th",16),t._uU(27,"S\u1ed1 l\u01b0\u1ee3ng"),t.qZA(),t.TgZ(28,"th",17),t._uU(29,"Th\xe0nh ti\u1ec1n"),t.qZA()()(),t.TgZ(30,"tbody"),t.YNc(31,pn,25,12,"tr",18),t.qZA()()()(),t.TgZ(32,"div",19)(33,"div",20)(34,"div",21)(35,"div",22)(36,"h5",23),t._uU(37,"Modal title"),t.qZA(),t.TgZ(38,"button",24)(39,"span",25),t._uU(40,"\xd7"),t.qZA()()(),t.TgZ(41,"div",26)(42,"div",27)(43,"div",28)(44,"h6"),t._uU(45),t.qZA(),t.TgZ(46,"h6"),t._uU(47),t.qZA(),t.TgZ(48,"h6"),t._uU(49),t.ALo(50,"date"),t.qZA()(),t.TgZ(51,"table",13)(52,"thead",29)(53,"tr")(54,"th"),t._uU(55,"TT"),t.qZA(),t.TgZ(56,"th"),t._uU(57,"H\u1ea1ng m\u1ee5c"),t.qZA(),t.TgZ(58,"th"),t._uU(59,"S\u1ed1 l\u01b0\u1ee3ng"),t.qZA(),t.TgZ(60,"th"),t._uU(61,"Th\xe0nh ti\u1ec1n"),t.qZA()()(),t.YNc(62,mn,22,8,"tbody",8),t.qZA()()(),t.TgZ(63,"div",30)(64,"button",31),t._uU(65,"Close"),t.qZA(),t.TgZ(66,"button",32),t._uU(67,"Save"),t.qZA()()()()()),2&n){const i=t.MAs(6);t.xp6(3),t.Q6J("formGroup",o.searchForm),t.xp6(1),t.Q6J("readonly",!1)("matAutocomplete",i)("ngClass",t.VKq(20,_n,o.filter.length>1&&o.filter.length<5)),t.xp6(3),t.Q6J("ngForOf",o.filter),t.xp6(1),t.Q6J("ngIf",0==o.filter.length&&o.searchForm.value.input),t.xp6(2),t.Q6J("disabled",0==o.ThanhTien),t.xp6(1),t.AsE(" ",o.DonMua.length," | ",t.lcZ(12,15,o.ThanhTien)," "),t.xp6(6),t.Q6J("ngIf",o.khachDua>0&&1e3*o.khachDua>o.ThanhTien),t.xp6(14),t.Q6J("ngForOf",o.DonMua),t.xp6(14),t.Oqu(o.user.title),t.xp6(2),t.Oqu(o.user.phoneNumber),t.xp6(2),t.hij("Gi\u1edd in:",t.xi3(50,17,o.printTime,"hh:mm dd/MM/yyyy"),""),t.xp6(13),t.Q6J("ngIf",o.DonMua)}},directives:[c.JL,c.sg,c.Fj,k.ZL,c.JJ,c.u,p.mk,k.XC,p.sg,D.ey,p.O5,x.lW,C.Hw,_.qo,_.R9],pipes:[f.W,p.JJ,p.uU,p.rS],styles:[".hangHoa[_ngcontent-%COMP%]{height:8rem;width:8rem;border-radius:1rem;margin:.2rem;border-bottom-width:1rem;border-color:#90ee90;color:#00f;float:left;display:flex;align-items:center;justify-content:center}.hangHoa[_ngcontent-%COMP%]:active{transform:scale(1.1);opacity:50%}.hoadon[_ngcontent-%COMP%]{width:200px}.font-mat[_ngcontent-%COMP%]{color:#fff;font-size:medium}.font-blue[_ngcontent-%COMP%]{font-size:16px;padding-left:10px;padding-right:10px}.arrow-bt[_ngcontent-%COMP%]{font-size:larger;color:#00f;font-weight:700;padding:.5rem}.arrow-bt[_ngcontent-%COMP%]:hover{border:brown;border-radius:.5rem;background-color:#0ff}.example-form-field[_ngcontent-%COMP%]{max-width:8rem}.row[_ngcontent-%COMP%]{margin-left:5px!important;margin-right:5px!important}td[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{padding:0;vertical-align:middle}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding-bottom:0!important}.ar[_ngcontent-%COMP%]{transform:scale(1.5);color:tomato}.ar[_ngcontent-%COMP%]:active{transform:scale(2.2);color:#00f}.inputSpan[_ngcontent-%COMP%]{border-bottom:solid;border-color:#00f;padding-left:10px;text-align:right}.inputSpan[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:focus{border:rgb(255,0,0)}"],data:{animation:[g.Ym]}}),e})(),M=(()=>{class e{constructor(n){this.plus=n}canActivate(){return this.plus.checkPer("hang-hoa")}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(m.T))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})(),B=(()=>{class e{constructor(n){this.plus=n}canActivate(){return this.plus.checkPer("an-uong")}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(m.T))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})(),E=(()=>{class e{constructor(n){this.plus=n}canActivate(){return this.plus.checkPer("pha-che")}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(m.T))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})(),w=(()=>{class e{constructor(n){this.plus=n}canActivate(){return this.plus.checkPer("tap-hoa")}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(m.T))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})(),F=(()=>{class e{constructor(n){this.plus=n}canActivate(){return this.plus.checkPer("thanh-toan")}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(m.T))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})(),J=(()=>{class e{constructor(n){this.plus=n}canActivate(){return this.plus.checkPer("quan-ly")}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(m.T))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})();const fn=[{path:"",component:sn},{path:"hang-hoa",component:en,canActivate:[M]},{path:"an-uong/:ten-ban",component:I,canActivate:[B]},{path:"an-uong",component:I,canActivate:[B]},{path:"pha-che",component:lt,canActivate:[E]},{path:"tap-hoa",component:gn,canActivate:[w]},{path:"bao-cao",component:it,canActivate:[F]},{path:"quan-ly",component:W,canActivate:[J]}];let Tn=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({providers:[M,B,E,w,F,J],imports:[[H.Bz.forChild(fn)],H.Bz]}),e})();var bn=l(85913),xn=l(24561),O=l(60929);let Cn=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({providers:[O.F],imports:[[p.ez,L.ShareModule,Y.qX,Tn,S.D,bn.m,O.F,xn.k,G.k,P.N]]}),e})()}}]);