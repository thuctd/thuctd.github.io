"use strict";(self.webpackChunk_4la=self.webpackChunk_4la||[]).push([[96,511],{51511:function(t,e,o){o.d(e,{k:function(){return a}});var n=o(74788),r=o(57922),s=o(31409),i=o(15194);let a=(()=>{class t{constructor(t,e){this.plus=t,this.excel=e,this.files=new n.vpe}ngOnInit(){}ngOnDestroy(){this.files.unsubscribe(),console.log("ngOnDestroy app-drop-files")}onDrop(t){this.files.emit(t),document.getElementById("dropZone").setAttribute("drop-active","false")}selectedFile(t){this.files.emit(t.target.files)}ondragover(){document.getElementById("dropZone").setAttribute("drop-active","true")}}return t.\u0275fac=function(e){return new(e||t)(n.Y36(r.T),n.Y36(s.x))},t.\u0275cmp=n.Xpm({type:t,selectors:[["app-drop-files"]],outputs:{files:"files"},decls:10,vars:0,consts:[[1,"row","justify-content-center","d-none-print"],["id","dropZone",1,"col-6",3,"appDropZone","dragover"],["for","file-import"],["for","file-import",1,"custom-file-upload","text-primary","mx-5"],["hidden","","id","file-import","type","file","multiple","false",3,"change"]],template:function(t,e){1&t&&(n.TgZ(0,"div",0),n.TgZ(1,"div",1),n.NdJ("appDropZone",function(t){return e.onDrop(t)})("dragover",function(){return e.ondragover()}),n.TgZ(2,"label",2),n._uU(3," K\xe9o th\u1ea3 file v\xe0o \u0111\xe2y ho\u1eb7c "),n.TgZ(4,"span"),n._uU(5,"\u2794"),n.qZA(),n.TgZ(6,"a"),n._uU(7," Ch\u1ecdn file "),n.qZA(),n.qZA(),n._UZ(8,"label",3),n.TgZ(9,"input",4),n.NdJ("change",function(t){return e.selectedFile(t)}),n.qZA(),n.qZA(),n.qZA())},directives:[i.i],styles:["label[_ngcontent-%COMP%]{width:100%;height:100%;text-align:center;line-height:170px;color:#00f;font-weight:bolder}#dropZone[_ngcontent-%COMP%]{width:40%;height:15%;border:2px dashed rgb(38,16,165);border-radius:3%}#dropZone[drop-active=true][_ngcontent-%COMP%]{box-shadow:inset 0 0 0 2px #00c;border:solid blue}"]}),t})()},15194:function(t,e,o){o.d(e,{i:function(){return r}});var n=o(74788);let r=(()=>{class t{constructor(){this.fileDrop=new n.vpe,this.preventBodyDrop=!0,this.active=!1}onDrop(t){t.preventDefault(),this.active=!1;const{dataTransfer:e}=t;if(e.items){const t=[];for(let o=0;o<e.items.length;o++)"file"===e.items[o].kind&&t.push(e.items[o].getAsFile());e.items.clear(),this.fileDrop.emit(t)}else{const t=e.files;e.clearData(),this.fileDrop.emit(Array.from(t))}}onDragOver(t){t.stopPropagation(),t.preventDefault(),this.active=!0}onDragLeave(t){this.active=!1}onBodyDragOver(t){this.preventBodyDrop&&(t.preventDefault(),t.stopPropagation())}onBodyDrop(t){this.preventBodyDrop&&t.preventDefault()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=n.lG2({type:t,selectors:[["","appDropZone",""]],hostVars:2,hostBindings:function(t,e){1&t&&n.NdJ("drop",function(t){return e.onDrop(t)})("dragover",function(t){return e.onDragOver(t)})("dragleave",function(t){return e.onDragLeave(t)})("dragover",function(t){return e.onBodyDragOver(t)},!1,n.pYS)("drop",function(t){return e.onBodyDrop(t)},!1,n.pYS),2&t&&n.ekj("drop-zone-active",e.active)},inputs:{preventBodyDrop:"preventBodyDrop"},outputs:{fileDrop:"appDropZone"}}),t})()},31409:function(t,e,o){o.d(e,{x:function(){return i}});var n=o(84487),r=o(74788),s=o(57922);let i=(()=>{class t{constructor(t){this.plus=t}readXlsx(t,e=!0){return new Promise((o,r)=>{let s={};if(this.plus.load(),null!=t&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"!=t.type&&"application/vnd.ms-excel"!=t.type)return this.plus.alertError("Kh\xf4ng ph\u1ea3i file excel");const i=new FileReader;i.readAsBinaryString(t),i.onloadend=t=>{const r=n.read(t.target.result,{type:"binary",cellDates:!0,dateNF:"DD/MM/YYYY"}),i=r.SheetNames;for(let o=0;o<i.length;o++){const t=i[o],a=n.utils.sheet_to_json(r.Sheets[t],{header:1,raw:e});s[`${t}`]=this.convertJSon(a)}this.plus.loaded(),o(s)}})}convertJSon(t){const e=[];for(let o=1;o<t.length;o++){const n={};t[0].forEach((e,r)=>{n[`${e}`]=t[o][r]}),e.push(n)}return e}convertJSonByX(t){const e=[];for(let o=1;o<t.length;o++)if("x"==t[o][0]){const n={};t[0].forEach((e,r)=>{n[`${e}`]=t[o][r]}),e.push(n)}return e}readXlsxToMerge(t){return console.log(t),new Promise((e,o)=>{this.plus.load();let r={};if(null!=t&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"!=t.type&&"application/vnd.ms-excel"!=t.type)return this.plus.alertError("Kh\xf4ng ph\u1ea3i file excel");const s=new FileReader;s.readAsBinaryString(t),s.onloadend=t=>{const o=n.read(t.target.result,{type:"binary",cellDates:!0,dateNF:"DD/MM/YYYY"}),s=o.SheetNames;for(let e=0;e<s.length;e++){const t=s[e];if("_Merge"==t)return this.plus.alertError("Vui l\xf2ng \u0111\u1ed5i t\xean sheet _Merge th\xe0nh t\xean kh\xe1c");const i=n.utils.sheet_to_json(o.Sheets[t],{header:1,raw:!0});r[`${0==e?"_Merge":t}`]=this.convertJSon(i)}e(r),this.plus.loaded()}})}export(t,e=""){const o=n.utils.json_to_sheet(t,{skipHeader:!0}),r=n.utils.book_new();n.utils.book_append_sheet(r,o,"ChuaImport"),n.writeFile(r,"4la-"+e+"-ChuaImport.xlsx")}exportTar(t,e=""){for(let i=0;i<t.length;i++)delete t[i].dateModify,delete t[i].canEdit,delete t[i].keyWord,delete t[i].__v,delete t[i]._id;let o=JSON.stringify(t),n="data:application/json;charset=utf-8,"+encodeURIComponent(o);console.log(n);let r=`4la-${e||""}`+Date.now()+".tar",s=document.createElement("a");s.setAttribute("href",n),s.setAttribute("download",r),s.click()}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(s.T))},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},97012:function(t,e,o){o.d(e,{t:function(){return h}});var n=o(16738),r=o.n(n),s=o(84487),i=o(74788),a=o(57922),l=o(12057),c=o(2895);function p(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"button",3),i.NdJ("click",function(){return i.CHM(t),i.oxw(2).export()}),i._uU(1,"Export Excel"),i.qZA()}}function u(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"button",3),i.NdJ("click",function(){return i.CHM(t),i.oxw(2).exportTar()}),i._uU(1,"Export BackupDB"),i.qZA()}}function d(t,e){if(1&t&&(i.TgZ(0,"span",1),i.YNc(1,p,2,0,"button",2),i.YNc(2,u,2,0,"button",2),i.qZA()),2&t){const t=i.oxw();i.xp6(1),i.Q6J("ngIf",t.check()),i.xp6(1),i.Q6J("ngIf",t.check())}}let h=(()=>{class t{constructor(t){this.plus=t}ngOnInit(){}export(){const t=[];this.dataJson.forEach(e=>{delete e.dateModify,delete e.status,delete e.sync,delete e.canEdit,delete e.keyWord,delete e.__v,t.push(e)});const e=s.utils.json_to_sheet(t),o=s.utils.book_new();s.utils.book_append_sheet(o,e,this.api),s.writeFile(o,r()(Date.now()).format("YYYYMMDDHHMM")+"-4la-"+this.api+".xlsx")}exportTar(){for(let r=0;r<this.dataJson.length;r++)delete this.dataJson[r].dateModify,delete this.dataJson[r].canEdit,delete this.dataJson[r].keyWord,delete this.dataJson[r].__v,delete this.dataJson[r]._id;let t=JSON.stringify(this.dataJson),e="data:application/json;charset=utf-8,"+encodeURIComponent(t);console.log(e);let o=`4la-${this.api?this.api:""}`+Date.now()+".tar",n=document.createElement("a");n.setAttribute("href",e),n.setAttribute("download",o),n.click()}check(){return this.plus.checkPer("admin",4)}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(a.T))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-export-ecxel"]],inputs:{dataJson:"dataJson",api:"api"},decls:1,vars:1,consts:[["class","d-print-none",4,"ngIf"],[1,"d-print-none"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,e){1&t&&i.YNc(0,d,3,2,"span",0),2&t&&i.Q6J("ngIf",e.dataJson.length>0)},directives:[l.O5,c.lW],styles:[""]}),t})()},55352:function(t,e,o){o.d(e,{y:function(){return w}});var n=o(15228),r=o(84487),s=o(16738),i=o.n(s),a=o(74788),l=o(57922),c=o(31409),p=o(2895),u=o(12057),d=o(49356),h=o(51511),f=function(t,e,o,n){return new(o||(o=Promise))(function(r,s){function i(t){try{l(n.next(t))}catch(e){s(e)}}function a(t){try{l(n.throw(t))}catch(e){s(e)}}function l(t){t.done?r(t.value):function(t){return t instanceof o?t:new o(function(e){e(t)})}(t.value).then(i,a)}l((n=n.apply(t,e||[])).next())})};function g(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"button",10),a.NdJ("click",function(){return a.CHM(t),a.oxw(2).reload()}),a._uU(1,"L\xe0m l\u1ea1i"),a.qZA()}}function m(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"div",11),a.TgZ(1,"app-drop-files",12),a.NdJ("files",function(e){return a.CHM(t),a.oxw(2).onDrop(e)}),a.qZA(),a.qZA()}}function x(t,e){if(1&t&&(a.TgZ(0,"td",16),a._uU(1),a.qZA()),2&t){const t=a.oxw().$implicit;a.xp6(1),a.hij(" ",t.err||"","")}}function b(t,e){if(1&t&&(a.TgZ(0,"tr"),a.YNc(1,x,2,1,"td",15),a.qZA()),2&t){const t=e.$implicit;a.Q6J("@slideIn",void 0),a.xp6(1),a.Q6J("ngIf",t.err)}}function v(t,e){if(1&t&&(a.TgZ(0,"table",13),a.TgZ(1,"h4"),a._uU(2,"L\u1ed7i d\u1eef li\u1ec7u file import"),a.qZA(),a.TgZ(3,"tbody"),a.YNc(4,b,2,2,"tr",14),a.qZA(),a.qZA()),2&t){const t=a.oxw(2);a.xp6(4),a.Q6J("ngForOf",t.errorData.length>0?t.errorData:t.dataJson)}}function y(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"button",17),a.NdJ("click",function(){return a.CHM(t),a.oxw(2).import()}),a._uU(1,"Import Excel"),a.qZA()}}function Z(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"button",17),a.NdJ("click",function(){return a.CHM(t),a.oxw(2).importDBFile()}),a._uU(1,"Import BackupDB"),a.qZA()}}function _(t,e){if(1&t&&(a.TgZ(0,"div"),a.TgZ(1,"h4",3),a._uU(2,"Import t\u1eeb file excel"),a.qZA(),a.TgZ(3,"a",4),a.TgZ(4,"mat-icon"),a._uU(5,"cloud_download"),a.qZA(),a._uU(6,"M\u1eabu import "),a.qZA(),a._UZ(7,"hr"),a.YNc(8,g,2,0,"button",5),a.YNc(9,m,2,0,"div",6),a.YNc(10,v,5,1,"table",7),a.TgZ(11,"div",8),a.YNc(12,y,2,0,"button",9),a.YNc(13,Z,2,0,"button",9),a.qZA(),a.qZA()),2&t){const t=a.oxw();a.xp6(3),a.MGl("href","https://github.com/thuctd/FileStore/raw/master/templates/",t.api,".xlsx",a.LSH),a.xp6(5),a.Q6J("ngIf",t.errorData.length>0||t.dataJson.length>0||t.backup.length>0),a.xp6(1),a.Q6J("ngIf",0===t.dataJson.length),a.xp6(1),a.Q6J("ngIf",t.errorData.length>0),a.xp6(2),a.Q6J("ngIf",t.checkPer(2)&&0==t.errorData.length&&t.dataJson.length>0),a.xp6(1),a.Q6J("ngIf",t.checkPer(7)&&0==t.errorData.length&&t.backup.length>0)}}function D(t,e){if(1&t&&(a.TgZ(0,"tr"),a.TgZ(1,"td"),a._uU(2),a.qZA(),a.TgZ(3,"td"),a._uU(4),a.qZA(),a.qZA()),2&t){const t=e.$implicit;a.xp6(2),a.Oqu(t.index),a.xp6(2),a.Oqu(t.msg)}}function k(t,e){if(1&t&&(a.TgZ(0,"table",18),a.TgZ(1,"thead"),a.TgZ(2,"tr"),a.TgZ(3,"th"),a._uU(4,"D\xf2ng"),a.qZA(),a.TgZ(5,"th"),a._uU(6,"L\u1ed7i"),a.qZA(),a.qZA(),a.qZA(),a.TgZ(7,"tbody"),a.YNc(8,D,5,2,"tr",14),a.qZA(),a.qZA()),2&t){const t=a.oxw();a.xp6(8),a.Q6J("ngForOf",t.errServer)}}let w=(()=>{class t{constructor(t,e){this.plus=t,this.excel=e,this.global=!1,this.dataImport=[],this.dataJson=[],this.errorData=[],this.errServer=[],this.show=!1,this.header=[],this.backup=[]}ngOnInit(){this.dataJson=[],this.dataImport=[]}readXlsx(t){this.plus.load();const e=t.target.files[0];if(console.log(e.type),"text/plain"!=e.type)if("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"==e.type||"application/vnd.ms-excel"==e.type){let e=t.target;const o=new FileReader;o.onload=t=>{const o=r.read(t.target.result,{type:"binary"});this.dataImport=r.utils.sheet_to_json(o.Sheets[o.SheetNames[0]],{header:1}),this.selectedFile(this.dataImport),this.plus.loaded(),e=null},o.onerror=()=>this.plus.alertError("L\u1ed7i file excel import"),o.readAsBinaryString(e.files[0])}else{alert("L\u01b0u \xfd:\nB\u1ea1n s\u1ebd m\u1ea5t to\xe0n b\u1ed9 d\u1eef li\u1ec7u c\u0169 tr\u01b0\u1edbc khi import nh\xe9!");const e=new FileReader;e.readAsText(t.target.files[0],"UTF-8"),e.onload=t=>{const e=JSON.parse(t.target.result);this.backup=this.cleanData(e),this.plus.loaded()},e.onerror=t=>{this.plus.alertError("L\u1ed7i file import"),this.plus.loaded()}}else this.readFileText(t)}readFileText(t){const e=t.target,o=new FileReader;o.readAsText(e.files[0]),o.onload=()=>{const t=this.plus.Crypt_Decrypt(o.result);this.exportExcel(t),this.exportTar(t)}}selectedFile(t){this.header=t[0],Date.now();for(let e=1;e<t.length;e++){const o={};t[0].forEach((n,r)=>{o[`${n}`]=t[e][r]}),delete o._id,delete o.__v,this.form.patchValue(o),this.form.valid?(o.keyWord=this.plus.generateKeyWord(o),o.dateModify=Date.now()+e,this.dataJson.push(o)):(o.err=`T\u1ea1i h\xe0ng ${e}: ${this.plus.getErrValidateForm(this.form)}`,this.errorData.push(o))}console.log(this.checkPer(2),this.errorData.length,this.dataJson.length)}import(){return f(this,void 0,void 0,function*(){this.plus.subs.unsubscribe();const t=this.dataJson;let e=0;const o=[];for(let n=0;n<t.length;n++){let r=t.slice(n,n+=200);yield this.plus.httpPost(this.api+"/import",r).toPromise().then(t=>{o.concat(t.errArr),1==t.status&&(e=t.lastModify,this.plus.FBS_PostByUser(this.api,e,this.global))}).catch(t=>{401==t.status&&(this.plus.alertError(t),localStorage.clear(),window.location.reload()),this.plus.alertMatSnackBar("Import kh\xf4ng th\xe0nh c\xf4ng!\nB\u1ea1n vui l\xf2ng ki\u1ec3m tra c\xe1c l\u1ed7i th\xf4ng b\xe1o tr\xean file excel")})}o.length>0&&(o.unshift(this.header),this.excel.export(o)),this.plus.alertSuccess("Import th\xe0nh c\xf4ng!"),this.plus.reload("/taikhoan")})}importDBFile(){return f(this,void 0,void 0,function*(){if(1==this.plus.loading.value)return;this.plus.subs.unsubscribe();const t=this.backup.length;let e=0,o=!1;const n=this.backup;for(;e<t;){let r=n.slice(e,e+200);const s=this.plus.Arr_MaxValue(r);if(this.plus.httpPost(this.api+"/import",r).subscribe(t=>{if(console.log(t),1!=t.status)return o=!0;console.log(t.code),this.plus.FBS_PostByUser(this.api,s,this.global),e+=200},n=>{console.log(n),o=!0,this.errServer=JSON.parse(n.error.code),this.plus.alertError("Import kh\xf4ng th\xe0nh c\xf4ng!"),e>0&&this.export(this.dataImport.slice(e+1)),e=t}),o)break;yield this.plus.sleep(3e3)}0==o&&(this.plus.alertSuccess("Import th\xe0nh c\xf4ng!"),this.plus.reload("/taikhoan"))})}checkPer(t){return this.plus.checkPer(this.api,t)}reload(){return this.plus.reload("/")}export(t){t.unshift(this.header);const e=r.utils.json_to_sheet(t,{skipHeader:!0}),o=r.utils.book_new();r.utils.book_append_sheet(o,e,"ChuaImport"),r.writeFile(o,"4la-"+this.api+"-ChuaImport.xlsx")}exportExcel(t){const e=r.utils.json_to_sheet(t),o=r.utils.book_new();r.utils.book_append_sheet(o,e,this.api),r.writeFile(o,i()(Date.now()).format("YYYYMMDDHHMM")+"-4la-"+this.api+".xlsx")}exportTar(t){let e=JSON.stringify(t),o="data:application/json;charset=utf-8,"+encodeURIComponent(e);console.log(o);let n=`4la-${this.api?this.api:""}`+Date.now()+".tar",r=document.createElement("a");r.setAttribute("href",o),r.setAttribute("download",n),r.click()}cleanData(t){const e=[];for(let o=0;o<t.length;o++){const n=t[o];n.keyWord=this.plus.generateKeyWord(n),n.dateModify=Date.now()+o,delete n._id,delete n.__v,this.form.patchValue(n),console.log(n,this.form.valid),this.form.valid?(n.keyWord=this.plus.generateKeyWord(n),n.dateModify=Date.now()+o,this.dataJson.push(n)):(n.err=`T\u1ea1i h\xe0ng ${o}: ${this.plus.getErrValidateForm(this.form)}`,this.errorData.push(n)),e.push(n)}return e}onDrop(t){const e=t[0];if(console.log(e),this.plus.load(),"text/plain"!=e.type)if("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"==e.type||"application/vnd.ms-excel"==e.type){let t=e;const o=new FileReader;o.onload=e=>{const o=r.read(e.target.result,{type:"binary"});this.dataImport=r.utils.sheet_to_json(o.Sheets[o.SheetNames[0]],{header:1}),this.selectedFile(this.dataImport),this.plus.loaded(),t=null},o.onerror=()=>this.plus.alertError("L\u1ed7i file excel import"),o.readAsBinaryString(e)}else{alert("L\u01b0u \xfd:\nB\u1ea1n s\u1ebd m\u1ea5t to\xe0n b\u1ed9 d\u1eef li\u1ec7u c\u0169 tr\u01b0\u1edbc khi import nh\xe9!");const t=new FileReader;t.readAsText(e,"UTF-8"),t.onload=t=>{const e=JSON.parse(t.target.result);this.backup=this.cleanData(e),this.plus.loaded()},t.onerror=t=>{this.plus.alertError("L\u1ed7i file import"),this.plus.loaded()}}else this.readFileText(e)}}return t.\u0275fac=function(e){return new(e||t)(a.Y36(l.T),a.Y36(c.x))},t.\u0275cmp=a.Xpm({type:t,selectors:[["app-import-database"]],inputs:{form:"form",api:"api",global:"global"},decls:4,vars:2,consts:[["mat-raised-button","","color","accent",3,"click"],[4,"ngIf"],["class","table",4,"ngIf"],[1,"text-center","text-white","py-2","my-3","bg-primary","rounded-pill","justify-content-center"],["mat-button","","target","_blank",3,"href"],["class","text-center mx-3","mat-raised-button","","color","primary",3,"click",4,"ngIf"],["class","ix",4,"ngIf"],["class","table table-inverse table-responsive",4,"ngIf"],[1,"text-center","mx-3"],["class","text-center mx-3","mat-raised-button","","color","accent",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",1,"text-center","mx-3",3,"click"],[1,"ix"],[3,"files"],[1,"table","table-inverse","table-responsive"],[4,"ngFor","ngForOf"],["class","text-danger",4,"ngIf"],[1,"text-danger"],["mat-raised-button","","color","accent",1,"text-center","mx-3",3,"click"],[1,"table"]],template:function(t,e){1&t&&(a.TgZ(0,"button",0),a.NdJ("click",function(){return e.show=!e.show}),a._uU(1,"Import Database"),a.qZA(),a.YNc(2,_,14,6,"div",1),a.YNc(3,k,9,1,"table",2)),2&t&&(a.xp6(2),a.Q6J("ngIf",e.show),a.xp6(1),a.Q6J("ngIf",e.errServer.length>0))},directives:[p.lW,u.O5,p.zs,d.Hw,h.k,u.sg],styles:[""],data:{animation:[n.Ym]}}),t})()},85913:function(t,e,o){o.d(e,{m:function(){return a}});var n=o(39609),r=o(24751),s=o(12057),i=o(74788);let a=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[[s.ez,r.UX,n.qX]]}),t})()}}]);