"use strict";(self.webpackChunkdlxl=self.webpackChunkdlxl||[]).push([[414,511],{51511:(B,y,a)=>{a.d(y,{k:()=>E});var i=a(5e3),m=a(15194);let E=(()=>{class u{constructor(){this.files=new i.vpe}ngOnInit(){}ngOnDestroy(){this.files.unsubscribe(),console.log("ngOnDestroy app-drop-files")}onDrop(p){this.files.emit(p),document.getElementById("dropZone").setAttribute("drop-active","false")}selectedFile(p){this.files.emit(p.target.files)}ondragover(){document.getElementById("dropZone").setAttribute("drop-active","true")}}return u.\u0275fac=function(p){return new(p||u)},u.\u0275cmp=i.Xpm({type:u,selectors:[["app-drop-files"]],inputs:{label:"label"},outputs:{files:"files"},decls:9,vars:1,consts:[[1,"row","justify-content-center","d-none-print"],["id","dropZone",3,"appDropZone","dragover"],["for","file-import"],["hidden","","id","file-import","type","file","multiple","false",3,"change"]],template:function(p,o){1&p&&(i.TgZ(0,"div",0)(1,"div",1),i.NdJ("appDropZone",function(_){return o.onDrop(_)})("dragover",function(){return o.ondragover()}),i.TgZ(2,"label",2),i._uU(3),i.TgZ(4,"span"),i._uU(5,"\u2794"),i.qZA(),i.TgZ(6,"a"),i._uU(7," Ch\u1ecdn file "),i.qZA()(),i.TgZ(8,"input",3),i.NdJ("change",function(_){return o.selectedFile(_)}),i.qZA()()()),2&p&&(i.xp6(3),i.hij(" K\xe9o th\u1ea3 file ",o.label," v\xe0o \u0111\xe2y ho\u1eb7c "))},directives:[m.i],styles:["label[_ngcontent-%COMP%]{width:100%;height:100%;text-align:center;line-height:170px;color:#00f;font-weight:bolder}#dropZone[_ngcontent-%COMP%]{top:20%;left:10%;width:80%;height:200px;border-radius:3%;border:2px dashed rgb(38,16,165)}#dropZone[drop-active=true][_ngcontent-%COMP%]{box-shadow:inset 0 0 0 2px #00c;border:2px dashed rgb(38,16,165);background-color:#c9eccb}"],changeDetection:0}),u})()},15194:(B,y,a)=>{a.d(y,{i:()=>m});var i=a(5e3);let m=(()=>{class E{constructor(){this.fileDrop=new i.vpe,this.preventBodyDrop=!0,this.active=!1}onDrop(t){t.preventDefault(),this.active=!1;const{dataTransfer:p}=t;if(p.items){const o=[];for(let s=0;s<p.items.length;s++)"file"===p.items[s].kind&&o.push(p.items[s].getAsFile());p.items.clear(),this.fileDrop.emit(o)}else{const o=p.files;p.clearData(),this.fileDrop.emit(Array.from(o))}}onDragOver(t){t.stopPropagation(),t.preventDefault(),this.active=!0}onDragLeave(t){this.active=!1}onBodyDragOver(t){this.preventBodyDrop&&(t.preventDefault(),t.stopPropagation())}onBodyDrop(t){this.preventBodyDrop&&t.preventDefault()}}return E.\u0275fac=function(t){return new(t||E)},E.\u0275dir=i.lG2({type:E,selectors:[["","appDropZone",""]],hostVars:2,hostBindings:function(t,p){1&t&&i.NdJ("drop",function(s){return p.onDrop(s)})("dragover",function(s){return p.onDragOver(s)})("dragleave",function(s){return p.onDragLeave(s)})("dragover",function(s){return p.onBodyDragOver(s)},!1,i.pYS)("drop",function(s){return p.onBodyDrop(s)},!1,i.pYS),2&t&&i.ekj("drop-zone-active",p.active)},inputs:{preventBodyDrop:"preventBodyDrop"},outputs:{fileDrop:"appDropZone"}}),E})()},31409:(B,y,a)=>{a.d(y,{x:()=>u});var i=a(80574),m=a(5e3),E=a(45230);let u=(()=>{class t{constructor(o){this.plus=o}toJsonArray(o,s=!0){return new Promise(_=>{let c={};if(this.plus.load(),null!=o&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"!=o.type&&"application/vnd.ms-excel"!=o.type)return this.plus.alertError("Kh\xf4ng ph\u1ea3i file excel");const f=new FileReader;f.readAsBinaryString(o),f.onloadend=D=>{const v=i.ij(D.target.result,{type:"binary",cellDates:!0,dateNF:"DD/MM/YYYY"}),T=v.SheetNames;for(let b=0;b<T.length;b++){const M=T[b],O=i.P6.sheet_to_json(v.Sheets[M],{header:1,raw:s});c[`${M}`]=this.convertJSon(O)}this.plus.loaded(),_(c)}})}read(o,s=2){return new Promise(_=>{let c=[];if(this.plus.load(),null!=o&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"!=o.type&&"application/vnd.ms-excel"!=o.type)return this.plus.alertError("Kh\xf4ng ph\u1ea3i file excel");const f=new FileReader;f.readAsBinaryString(o),f.onloadend=D=>{const v=i.ij(D.target.result,{type:"binary",cellDates:!0,dateNF:"DD/MM/YYYY"}),T=v.SheetNames;for(let b=0;b<s;b++){const O=i.P6.sheet_to_json(v.Sheets[T[b]],{header:1});c.push(O)}this.plus.loaded(),_(c)}})}convertJSon(o){const s=[];for(let _=1;_<o.length;_++){const c={};o[0].forEach((f,D)=>{c[`${f}`]=o[_][D]}),s.push(c)}return s}convertJSonByX(o){const s=[];for(let _=1;_<o.length;_++)if("x"==o[_][0]){const c={};o[0].forEach((f,D)=>{c[`${f}`]=o[_][D]}),s.push(c)}return s}readXlsxToMerge(o){return console.log(o),new Promise((s,_)=>{this.plus.load();let c={};if(null!=o&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"!=o.type&&"application/vnd.ms-excel"!=o.type)return this.plus.alertError("Kh\xf4ng ph\u1ea3i file excel");const f=new FileReader;f.readAsBinaryString(o),f.onloadend=D=>{const v=i.ij(D.target.result,{type:"binary",cellDates:!0,dateNF:"DD/MM/YYYY"}),T=v.SheetNames;for(let b=0;b<T.length;b++){const M=T[b];if("_Merge"==M)return this.plus.alertError("Vui l\xf2ng \u0111\u1ed5i t\xean sheet _Merge th\xe0nh t\xean kh\xe1c");const O=i.P6.sheet_to_json(v.Sheets[M],{header:1,raw:!0});c[`${0==b?"_Merge":M}`]=this.convertJSonByX(O)}s(c),this.plus.loaded()}})}export(o,s=""){const _=i.P6.json_to_sheet(o,{skipHeader:!0,dateNF:"mm/dd/yyyy;@",cellDates:!0}),c=i.P6.book_new();i.P6.book_append_sheet(c,_,"ChuaImport"),i.NC(c,"4la-"+s+"-ChuaImport.xlsx")}exportTar(o,s=""){for(let h=0;h<o.length;h++)delete o[h].dateModify,delete o[h].canEdit,delete o[h].keyWord,delete o[h].__v,delete o[h]._id;let _=JSON.stringify(o),c="data:application/json;charset=utf-8,"+encodeURIComponent(_);console.log(c);let f=`4la-${s||""}`+Date.now()+".tar",D=document.createElement("a");D.setAttribute("href",c),D.setAttribute("download",f),D.click()}}return t.\u0275fac=function(o){return new(o||t)(m.LFG(E.T))},t.\u0275prov=m.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},97012:(B,y,a)=>{a.d(y,{t:()=>o});var i=a(15439),m=a.n(i),E=a(80574),u=a(5e3),t=a(45230),p=a(47423);let o=(()=>{class s{constructor(c){this.plus=c}ngOnInit(){}export(){const c=[];this.dataJson.forEach(h=>{delete h.dateModify,delete h.status,delete h.sync,delete h.canEdit,delete h.keyWord,delete h.__v,c.push(h)});const f=E.P6.json_to_sheet(c,{dateNF:"dd/mm/yyyy;@",cellDates:!0}),D=E.P6.book_new();E.P6.book_append_sheet(D,f,this.api),E.NC(D,m()(Date.now()).format("YYYYMMDDHHMM")+"-4la-"+this.api+".xlsx")}exportTar(){for(let v=0;v<this.dataJson.length;v++)delete this.dataJson[v].dateModify,delete this.dataJson[v].canEdit,delete this.dataJson[v].keyWord,delete this.dataJson[v].__v,delete this.dataJson[v]._id;let c=JSON.stringify(this.dataJson),f="data:application/json;charset=utf-8,"+encodeURIComponent(c);console.log(f);let D=`4la-${this.api?this.api:""}`+Date.now()+".json",h=document.createElement("a");h.setAttribute("href",f),h.setAttribute("download",D),h.click()}check(){return this.plus.checkPer("admin",4)}}return s.\u0275fac=function(c){return new(c||s)(u.Y36(t.T))},s.\u0275cmp=u.Xpm({type:s,selectors:[["app-export-ecxel"]],inputs:{dataJson:"dataJson",api:"api"},decls:5,vars:0,consts:[[1,"d-print-none"],["mat-raised-button","","color","primary",3,"click"]],template:function(c,f){1&c&&(u.TgZ(0,"span",0)(1,"button",1),u.NdJ("click",function(){return f.export()}),u._uU(2,"Export Excel"),u.qZA(),u.TgZ(3,"button",1),u.NdJ("click",function(){return f.exportTar()}),u._uU(4,"Export BackupDB"),u.qZA()())},directives:[p.lW],styles:[""]}),s})()},87654:(B,y,a)=>{a.d(y,{y:()=>k});var i=a(15228),m=a(80574),E=a(15439),u=a.n(E),t=a(5e3),p=a(45230),o=a(31409),s=a(69798),_=a(47423),c=a(69808),f=a(25245),D=a(51511);function v(d,x){if(1&d){const e=t.EpF();t.TgZ(0,"button",10),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).reload()}),t._uU(1,"L\xe0m l\u1ea1i"),t.qZA()}}function T(d,x){if(1&d){const e=t.EpF();t.TgZ(0,"div",11)(1,"app-drop-files",12),t.NdJ("files",function(n){return t.CHM(e),t.oxw(2).onDrop(n)}),t.qZA()()}}function b(d,x){if(1&d&&(t.TgZ(0,"td",16),t._uU(1),t.qZA()),2&d){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.err||"","")}}function M(d,x){if(1&d&&(t.TgZ(0,"tr"),t.YNc(1,b,2,1,"td",15),t.qZA()),2&d){const e=x.$implicit;t.Q6J("@slideIn",void 0),t.xp6(1),t.Q6J("ngIf",e.err)}}function C(d,x){if(1&d&&(t.TgZ(0,"table",13)(1,"h4"),t._uU(2,"L\u1ed7i d\u1eef li\u1ec7u file import"),t.qZA(),t.TgZ(3,"tbody"),t.YNc(4,M,2,2,"tr",14),t.qZA()()),2&d){const e=t.oxw(2);t.xp6(4),t.Q6J("ngForOf",e.errorData.length>0?e.errorData:e.dataJson)}}function O(d,x){if(1&d){const e=t.EpF();t.TgZ(0,"button",10),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).import()}),t._uU(1,"Import Excel"),t.qZA()}}function U(d,x){if(1&d){const e=t.EpF();t.TgZ(0,"button",17),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).importDBFile()}),t._uU(1,"Import BackupDB"),t.qZA()}}function F(d,x){if(1&d&&(t.TgZ(0,"div")(1,"h4",3),t._uU(2,"Import t\u1eeb file excel"),t.qZA(),t.TgZ(3,"a",4)(4,"mat-icon"),t._uU(5,"cloud_download"),t.qZA(),t._uU(6,"M\u1eabu import "),t.qZA(),t._UZ(7,"hr"),t.YNc(8,v,2,0,"button",5),t.YNc(9,T,2,0,"div",6),t.YNc(10,C,5,1,"table",7),t.TgZ(11,"div",8),t.YNc(12,O,2,0,"button",5),t.YNc(13,U,2,0,"button",9),t.qZA()()),2&d){const e=t.oxw();t.xp6(3),t.MGl("href","https://github.com/thuctd/FileStore/raw/master/templates/",e.api,".xlsx",t.LSH),t.xp6(5),t.Q6J("ngIf",e.errorData.length>0||e.dataJson.length>0||e.backup.length>0),t.xp6(1),t.Q6J("ngIf",0===e.dataJson.length),t.xp6(1),t.Q6J("ngIf",e.errorData.length>0),t.xp6(2),t.Q6J("ngIf",e.checkPer(2)&&0==e.errorData.length&&e.dataJson.length>0),t.xp6(1),t.Q6J("ngIf",e.checkPer(7)&&0==e.errorData.length&&e.backup.length>0)}}function J(d,x){if(1&d&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA()()),2&d){const e=x.$implicit;t.xp6(2),t.Oqu(e.index),t.xp6(2),t.Oqu(e._ThongBaoLoi)}}function L(d,x){if(1&d&&(t.TgZ(0,"table",18)(1,"thead")(2,"tr")(3,"th"),t._uU(4,"D\xf2ng"),t.qZA(),t.TgZ(5,"th"),t._uU(6,"L\u1ed7i"),t.qZA()()(),t.TgZ(7,"tbody"),t.YNc(8,J,5,2,"tr",14),t.qZA()()),2&d){const e=t.oxw();t.xp6(8),t.Q6J("ngForOf",e.errServer)}}let k=(()=>{class d{constructor(e,l,n){this.plus=e,this.excel=l,this.rtSV=n,this.global=!1,this.dataImport=[],this.dataJson=[],this.errorData=[],this.errServer=[],this.show=!1,this.header=[],this.backup=[]}ngOnInit(){this.dataJson=[],this.dataImport=[]}readXlsx(e){this.plus.load();const l=e.target.files[0];if(console.log(l.type),"text/plain"!=l.type)if("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"==l.type||"application/vnd.ms-excel"==l.type){let n=e.target;const r=new FileReader;r.onload=g=>{const Z=m.ij(g.target.result,{type:"binary"});this.dataImport=m.P6.sheet_to_json(Z.Sheets[Z.SheetNames[0]],{header:1}),this.selectedFile(this.dataImport),this.plus.loaded(),n=null},r.onerror=()=>this.plus.alertError("L\u1ed7i file excel import"),r.readAsBinaryString(n.files[0])}else{alert("L\u01b0u \xfd:\nB\u1ea1n s\u1ebd m\u1ea5t to\xe0n b\u1ed9 d\u1eef li\u1ec7u c\u0169 tr\u01b0\u1edbc khi import nh\xe9!");const n=new FileReader;n.readAsText(e.target.files[0],"UTF-8"),n.onload=r=>{const g=JSON.parse(r.target.result);this.backup=g,this.plus.loaded()},n.onerror=r=>{this.plus.alertError("L\u1ed7i file import"),this.plus.loaded()}}else this.readFileText(e)}readFileText(e){const l=e.target,n=new FileReader;n.readAsText(l.files[0]),n.onload=()=>{const g=this.plus.Crypt_Decrypt(n.result);this.exportExcel(g),this.exportTar(g)}}selectedFile(e){this.header=e[0],Date.now();for(let n=1;n<e.length;n++){const r={};e[0].forEach((g,I)=>{r[`${g}`]=e[n][I]}),delete r._id,delete r.__v,this.form.patchValue(r),this.form.valid?(r.keyWord=this.plus.generateKeyWord(r),r.dateModify=Date.now()+n,this.dataJson.push(r)):(r.err=`T\u1ea1i h\xe0ng ${n}: ${this.plus.getErrValidateForm(this.form)}`,this.errorData.push(r))}console.log(this.checkPer(2),this.errorData.length,this.dataJson)}import(){this.plus.subs.unsubscribe(),this.plus.httpPost(this.api+"/import",this.dataJson,this.global).subscribe(e=>{e.status?this.plus.goBack():console.log(e)})}importDBFile(){return function(d,x,e,l){return new(e||(e=Promise))(function(r,g){function I(P){try{A(l.next(P))}catch(w){g(w)}}function Z(P){try{A(l.throw(P))}catch(w){g(w)}}function A(P){P.done?r(P.value):function n(r){return r instanceof e?r:new e(function(g){g(r)})}(P.value).then(I,Z)}A((l=l.apply(d,x||[])).next())})}(this,void 0,void 0,function*(){this.plus.subs.unsubscribe(),this.plus.httpPost(this.api+"/import",this.backup,this.global).subscribe(e=>{e.status?this.plus.goBack():console.log(e)})})}checkPer(e){return this.plus.checkPer(this.api,e)}reload(){return this.plus.reload("/")}export(e){e.unshift(this.header);const l=m.P6.json_to_sheet(e,{skipHeader:!0}),n=m.P6.book_new();m.P6.book_append_sheet(n,l,"ChuaImport"),m.NC(n,"4la-"+this.api+"-ChuaImport.xlsx")}exportExcel(e){const l=m.P6.json_to_sheet(e),n=m.P6.book_new();m.P6.book_append_sheet(n,l,this.api),m.NC(n,u()(Date.now()).format("YYYYMMDDHHMM")+"-4la-"+this.api+".xlsx")}exportTar(e){let l=JSON.stringify(e),n="data:application/json;charset=utf-8,"+encodeURIComponent(l);console.log(n);let r=`4la-${this.api?this.api:""}`+Date.now()+".tar",g=document.createElement("a");g.setAttribute("href",n),g.setAttribute("download",r),g.click()}cleanData(e){const l=[];for(let n=0;n<e.length;n++){const r=e[n];r.keyWord=this.plus.generateKeyWord(r),r.dateModify=Date.now()+n,delete r._id,delete r.__v,this.form.patchValue(r),console.log(r,this.form.valid),this.form.valid?(r.keyWord=this.plus.generateKeyWord(r),r.dateModify=Date.now()+n,this.dataJson.push(r)):(r.err=`T\u1ea1i h\xe0ng ${n}: ${this.plus.getErrValidateForm(this.form)}`,this.errorData.push(r)),l.push(r)}return l}onDrop(e){const l=e[0];if(console.log(l),this.plus.load(),"text/plain"!=l.type)if("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"==l.type||"application/vnd.ms-excel"==l.type){const n=new FileReader;n.onload=r=>{const I=m.ij(r.target.result,{type:"binary"});this.dataImport=m.P6.sheet_to_json(I.Sheets[I.SheetNames[0]],{header:1}),this.selectedFile(this.dataImport),this.plus.loaded()},n.onerror=()=>this.plus.alertError("L\u1ed7i file excel import"),n.readAsBinaryString(l)}else{alert("L\u01b0u \xfd:\nB\u1ea1n s\u1ebd m\u1ea5t to\xe0n b\u1ed9 d\u1eef li\u1ec7u c\u0169 tr\u01b0\u1edbc khi import nh\xe9!");const n=new FileReader;n.readAsText(l,"UTF-8"),n.onload=r=>{const g=JSON.parse(r.target.result);this.backup=this.cleanData(g),this.plus.loaded()},n.onerror=r=>{this.plus.alertError("L\u1ed7i file import"),this.plus.loaded()}}else this.readFileText(l)}}return d.\u0275fac=function(e){return new(e||d)(t.Y36(p.T),t.Y36(o.x),t.Y36(s.i))},d.\u0275cmp=t.Xpm({type:d,selectors:[["app-import-database"]],inputs:{form:"form",api:"api",global:"global"},decls:4,vars:2,consts:[["mat-raised-button","","color","accent",3,"click"],[4,"ngIf"],["class","table",4,"ngIf"],[1,"text-center","text-white","py-2","my-3","bg-primary","rounded-pill","justify-content-center"],["mat-button","","target","_blank",3,"href"],["class","text-center mx-3","mat-raised-button","","color","primary",3,"click",4,"ngIf"],["class","ix",4,"ngIf"],["class","table table-inverse table-responsive",4,"ngIf"],[1,"text-center","mx-3"],["class","text-center mx-3","mat-raised-button","","color","accent",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",1,"text-center","mx-3",3,"click"],[1,"ix"],[3,"files"],[1,"table","table-inverse","table-responsive"],[4,"ngFor","ngForOf"],["class","text-danger",4,"ngIf"],[1,"text-danger"],["mat-raised-button","","color","accent",1,"text-center","mx-3",3,"click"],[1,"table"]],template:function(e,l){1&e&&(t.TgZ(0,"button",0),t.NdJ("click",function(){return l.show=!l.show}),t._uU(1,"Import Database"),t.qZA(),t.YNc(2,F,14,6,"div",1),t.YNc(3,L,9,1,"table",2)),2&e&&(t.xp6(2),t.Q6J("ngIf",l.show),t.xp6(1),t.Q6J("ngIf",(null==l.errServer?null:l.errServer.length)>0))},directives:[_.lW,c.O5,_.zs,f.Hw,D.k,c.sg],styles:[""],data:{animation:[i.Ym]}}),d})()},48387:(B,y,a)=>{a.d(y,{D:()=>p});var i=a(51372),m=a(69808),E=a(93075),u=a(5923),t=a(5e3);let p=(()=>{class o{}return o.\u0275fac=function(_){return new(_||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[m.ez,E.u5,i.qX,u.X]]}),o})()},85913:(B,y,a)=>{a.d(y,{m:()=>t});var i=a(51372),m=a(93075),E=a(69808),u=a(5e3);let t=(()=>{class p{}return p.\u0275fac=function(s){return new(s||p)},p.\u0275mod=u.oAB({type:p}),p.\u0275inj=u.cJS({imports:[[E.ez,m.UX,i.qX]]}),p})()}}]);