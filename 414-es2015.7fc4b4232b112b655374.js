"use strict";(self.webpackChunk_4la=self.webpackChunk_4la||[]).push([[414,511],{51511:function(t,e,r){r.d(e,{k:function(){return s}});var o=r(74788),n=r(15194);let s=(()=>{class t{constructor(){this.files=new o.vpe}ngOnInit(){}ngOnDestroy(){this.files.unsubscribe(),console.log("ngOnDestroy app-drop-files")}onDrop(t){this.files.emit(t),document.getElementById("dropZone").setAttribute("drop-active","false")}selectedFile(t){this.files.emit(t.target.files)}ondragover(){document.getElementById("dropZone").setAttribute("drop-active","true")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-drop-files"]],inputs:{label:"label"},outputs:{files:"files"},decls:10,vars:1,consts:[[1,"row","justify-content-center","d-none-print"],["id","dropZone",3,"appDropZone","dragover"],["for","file-import"],["for","file-import",1,"custom-file-upload","text-primary","mx-5"],["hidden","","id","file-import","type","file","multiple","false",3,"change"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0),o.TgZ(1,"div",1),o.NdJ("appDropZone",function(t){return e.onDrop(t)})("dragover",function(){return e.ondragover()}),o.TgZ(2,"label",2),o._uU(3),o.TgZ(4,"span"),o._uU(5,"\u2794"),o.qZA(),o.TgZ(6,"a"),o._uU(7," Ch\u1ecdn file "),o.qZA(),o.qZA(),o._UZ(8,"label",3),o.TgZ(9,"input",4),o.NdJ("change",function(t){return e.selectedFile(t)}),o.qZA(),o.qZA(),o.qZA()),2&t&&(o.xp6(3),o.hij(" K\xe9o th\u1ea3 file ",e.label," v\xe0o \u0111\xe2y ho\u1eb7c "))},directives:[n.i],styles:["label[_ngcontent-%COMP%]{width:100%;height:100%;text-align:center;line-height:170px;color:#00f;font-weight:bolder}#dropZone[_ngcontent-%COMP%]{top:20%;left:10%;width:80%;height:200px;border-radius:3%;border:2px dashed rgb(38,16,165)}#dropZone[drop-active=true][_ngcontent-%COMP%]{box-shadow:inset 0 0 0 2px #00c;border:2px dashed rgb(38,16,165);background-color:#c9eccb}"],changeDetection:0}),t})()},15194:function(t,e,r){r.d(e,{i:function(){return n}});var o=r(74788);let n=(()=>{class t{constructor(){this.fileDrop=new o.vpe,this.preventBodyDrop=!0,this.active=!1}onDrop(t){t.preventDefault(),this.active=!1;const{dataTransfer:e}=t;if(e.items){const t=[];for(let r=0;r<e.items.length;r++)"file"===e.items[r].kind&&t.push(e.items[r].getAsFile());e.items.clear(),this.fileDrop.emit(t)}else{const t=e.files;e.clearData(),this.fileDrop.emit(Array.from(t))}}onDragOver(t){t.stopPropagation(),t.preventDefault(),this.active=!0}onDragLeave(t){this.active=!1}onBodyDragOver(t){this.preventBodyDrop&&(t.preventDefault(),t.stopPropagation())}onBodyDrop(t){this.preventBodyDrop&&t.preventDefault()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=o.lG2({type:t,selectors:[["","appDropZone",""]],hostVars:2,hostBindings:function(t,e){1&t&&o.NdJ("drop",function(t){return e.onDrop(t)})("dragover",function(t){return e.onDragOver(t)})("dragleave",function(t){return e.onDragLeave(t)})("dragover",function(t){return e.onBodyDragOver(t)},!1,o.pYS)("drop",function(t){return e.onBodyDrop(t)},!1,o.pYS),2&t&&o.ekj("drop-zone-active",e.active)},inputs:{preventBodyDrop:"preventBodyDrop"},outputs:{fileDrop:"appDropZone"}}),t})()},31409:function(t,e,r){r.d(e,{x:function(){return i}});var o=r(84487),n=r(74788),s=r(57922);let i=(()=>{class t{constructor(t){this.plus=t}toJsonArray(t,e=!0){return new Promise(r=>{let n={};if(this.plus.load(),null!=t&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"!=t.type&&"application/vnd.ms-excel"!=t.type)return this.plus.alertError("Kh\xf4ng ph\u1ea3i file excel");const s=new FileReader;s.readAsBinaryString(t),s.onloadend=t=>{const s=o.read(t.target.result,{type:"binary",cellDates:!0,dateNF:"DD/MM/YYYY"}),i=s.SheetNames;for(let r=0;r<i.length;r++){const t=i[r],a=o.utils.sheet_to_json(s.Sheets[t],{header:1,raw:e});n[`${t}`]=this.convertJSon(a)}this.plus.loaded(),r(n)}})}read(t,e=2){return new Promise(r=>{let n=[];if(this.plus.load(),null!=t&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"!=t.type&&"application/vnd.ms-excel"!=t.type)return this.plus.alertError("Kh\xf4ng ph\u1ea3i file excel");const s=new FileReader;s.readAsBinaryString(t),s.onloadend=t=>{const s=o.read(t.target.result,{type:"binary",cellDates:!0,dateNF:"DD/MM/YYYY"}),i=s.SheetNames;for(let r=0;r<e;r++){const t=o.utils.sheet_to_json(s.Sheets[i[r]],{header:1});n.push(t)}this.plus.loaded(),r(n)}})}convertJSon(t){const e=[];for(let r=1;r<t.length;r++){const o={};t[0].forEach((e,n)=>{o[`${e}`]=t[r][n]}),e.push(o)}return e}convertJSonByX(t){const e=[];for(let r=1;r<t.length;r++)if("x"==t[r][0]){const o={};t[0].forEach((e,n)=>{o[`${e}`]=t[r][n]}),e.push(o)}return e}readXlsxToMerge(t){return console.log(t),new Promise((e,r)=>{this.plus.load();let n={};if(null!=t&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"!=t.type&&"application/vnd.ms-excel"!=t.type)return this.plus.alertError("Kh\xf4ng ph\u1ea3i file excel");const s=new FileReader;s.readAsBinaryString(t),s.onloadend=t=>{const r=o.read(t.target.result,{type:"binary",cellDates:!0,dateNF:"DD/MM/YYYY"}),s=r.SheetNames;for(let e=0;e<s.length;e++){const t=s[e];if("_Merge"==t)return this.plus.alertError("Vui l\xf2ng \u0111\u1ed5i t\xean sheet _Merge th\xe0nh t\xean kh\xe1c");const i=o.utils.sheet_to_json(r.Sheets[t],{header:1,raw:!0});n[`${0==e?"_Merge":t}`]=this.convertJSonByX(i)}e(n),this.plus.loaded()}})}export(t,e=""){const r=o.utils.json_to_sheet(t,{skipHeader:!0,dateNF:"mm/dd/yyyy;@",cellDates:!0}),n=o.utils.book_new();o.utils.book_append_sheet(n,r,"ChuaImport"),o.writeFile(n,"4la-"+e+"-ChuaImport.xlsx")}exportTar(t,e=""){for(let i=0;i<t.length;i++)delete t[i].dateModify,delete t[i].canEdit,delete t[i].keyWord,delete t[i].__v,delete t[i]._id;let r=JSON.stringify(t),o="data:application/json;charset=utf-8,"+encodeURIComponent(r);console.log(o);let n=`4la-${e||""}`+Date.now()+".tar",s=document.createElement("a");s.setAttribute("href",o),s.setAttribute("download",n),s.click()}}return t.\u0275fac=function(e){return new(e||t)(n.LFG(s.T))},t.\u0275prov=n.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},97012:function(t,e,r){r.d(e,{t:function(){return c}});var o=r(16738),n=r.n(o),s=r(84487),i=r(74788),a=r(57922),l=r(2895);let c=(()=>{class t{constructor(t){this.plus=t}ngOnInit(){}export(){const t=[];this.dataJson.forEach(e=>{delete e.dateModify,delete e.status,delete e.sync,delete e.canEdit,delete e.keyWord,delete e.__v,t.push(e)});const e=s.utils.json_to_sheet(t,{dateNF:"dd/mm/yyyy;@",cellDates:!0}),r=s.utils.book_new();s.utils.book_append_sheet(r,e,this.api),s.writeFile(r,n()(Date.now()).format("YYYYMMDDHHMM")+"-4la-"+this.api+".xlsx")}exportTar(){for(let n=0;n<this.dataJson.length;n++)delete this.dataJson[n].dateModify,delete this.dataJson[n].canEdit,delete this.dataJson[n].keyWord,delete this.dataJson[n].__v,delete this.dataJson[n]._id;let t=JSON.stringify(this.dataJson),e="data:application/json;charset=utf-8,"+encodeURIComponent(t);console.log(e);let r=`4la-${this.api?this.api:""}`+Date.now()+".tar",o=document.createElement("a");o.setAttribute("href",e),o.setAttribute("download",r),o.click()}check(){return this.plus.checkPer("admin",4)}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(a.T))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-export-ecxel"]],inputs:{dataJson:"dataJson",api:"api"},decls:5,vars:0,consts:[[1,"d-print-none"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,e){1&t&&(i.TgZ(0,"span",0),i.TgZ(1,"button",1),i.NdJ("click",function(){return e.export()}),i._uU(2,"Export Excel"),i.qZA(),i.TgZ(3,"button",1),i.NdJ("click",function(){return e.exportTar()}),i._uU(4,"Export BackupDB"),i.qZA(),i.qZA())},directives:[l.lW],styles:[""]}),t})()},55352:function(t,e,r){r.d(e,{y:function(){return w}});var o=r(15228),n=r(84487),s=r(16738),i=r.n(s),a=r(74788),l=r(57922),c=r(31409),p=r(2895),d=r(12057),u=r(49356),h=r(51511),f=function(t,e,r,o){return new(r||(r=Promise))(function(n,s){function i(t){try{l(o.next(t))}catch(e){s(e)}}function a(t){try{l(o.throw(t))}catch(e){s(e)}}function l(t){t.done?n(t.value):function(t){return t instanceof r?t:new r(function(e){e(t)})}(t.value).then(i,a)}l((o=o.apply(t,e||[])).next())})};function g(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"button",10),a.NdJ("click",function(){return a.CHM(t),a.oxw(2).reload()}),a._uU(1,"L\xe0m l\u1ea1i"),a.qZA()}}function m(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"div",11),a.TgZ(1,"app-drop-files",12),a.NdJ("files",function(e){return a.CHM(t),a.oxw(2).onDrop(e)}),a.qZA(),a.qZA()}}function x(t,e){if(1&t&&(a.TgZ(0,"td",16),a._uU(1),a.qZA()),2&t){const t=a.oxw().$implicit;a.xp6(1),a.hij(" ",t.err||"","")}}function y(t,e){if(1&t&&(a.TgZ(0,"tr"),a.YNc(1,x,2,1,"td",15),a.qZA()),2&t){const t=e.$implicit;a.Q6J("@slideIn",void 0),a.xp6(1),a.Q6J("ngIf",t.err)}}function b(t,e){if(1&t&&(a.TgZ(0,"table",13),a.TgZ(1,"h4"),a._uU(2,"L\u1ed7i d\u1eef li\u1ec7u file import"),a.qZA(),a.TgZ(3,"tbody"),a.YNc(4,y,2,2,"tr",14),a.qZA(),a.qZA()),2&t){const t=a.oxw(2);a.xp6(4),a.Q6J("ngForOf",t.errorData.length>0?t.errorData:t.dataJson)}}function v(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"button",17),a.NdJ("click",function(){return a.CHM(t),a.oxw(2).import()}),a._uU(1,"Import Excel"),a.qZA()}}function D(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"button",17),a.NdJ("click",function(){return a.CHM(t),a.oxw(2).importDBFile()}),a._uU(1,"Import BackupDB"),a.qZA()}}function Z(t,e){if(1&t&&(a.TgZ(0,"div"),a.TgZ(1,"h4",3),a._uU(2,"Import t\u1eeb file excel"),a.qZA(),a.TgZ(3,"a",4),a.TgZ(4,"mat-icon"),a._uU(5,"cloud_download"),a.qZA(),a._uU(6,"M\u1eabu import "),a.qZA(),a._UZ(7,"hr"),a.YNc(8,g,2,0,"button",5),a.YNc(9,m,2,0,"div",6),a.YNc(10,b,5,1,"table",7),a.TgZ(11,"div",8),a.YNc(12,v,2,0,"button",9),a.YNc(13,D,2,0,"button",9),a.qZA(),a.qZA()),2&t){const t=a.oxw();a.xp6(3),a.MGl("href","https://github.com/thuctd/FileStore/raw/master/templates/",t.api,".xlsx",a.LSH),a.xp6(5),a.Q6J("ngIf",t.errorData.length>0||t.dataJson.length>0||t.backup.length>0),a.xp6(1),a.Q6J("ngIf",0===t.dataJson.length),a.xp6(1),a.Q6J("ngIf",t.errorData.length>0),a.xp6(2),a.Q6J("ngIf",t.checkPer(2)&&0==t.errorData.length&&t.dataJson.length>0),a.xp6(1),a.Q6J("ngIf",t.checkPer(7)&&0==t.errorData.length&&t.backup.length>0)}}function _(t,e){if(1&t&&(a.TgZ(0,"tr"),a.TgZ(1,"td"),a._uU(2),a.qZA(),a.TgZ(3,"td"),a._uU(4),a.qZA(),a.qZA()),2&t){const t=e.$implicit;a.xp6(2),a.Oqu(t.index),a.xp6(2),a.Oqu(t._ThongBaoLoi)}}function k(t,e){if(1&t&&(a.TgZ(0,"table",18),a.TgZ(1,"thead"),a.TgZ(2,"tr"),a.TgZ(3,"th"),a._uU(4,"D\xf2ng"),a.qZA(),a.TgZ(5,"th"),a._uU(6,"L\u1ed7i"),a.qZA(),a.qZA(),a.qZA(),a.TgZ(7,"tbody"),a.YNc(8,_,5,2,"tr",14),a.qZA(),a.qZA()),2&t){const t=a.oxw();a.xp6(8),a.Q6J("ngForOf",t.errServer)}}let w=(()=>{class t{constructor(t,e){this.plus=t,this.excel=e,this.global=!1,this.dataImport=[],this.dataJson=[],this.errorData=[],this.errServer=[],this.show=!1,this.header=[],this.backup=[]}ngOnInit(){this.dataJson=[],this.dataImport=[]}readXlsx(t){this.plus.load();const e=t.target.files[0];if(console.log(e.type),"text/plain"!=e.type)if("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"==e.type||"application/vnd.ms-excel"==e.type){let e=t.target;const r=new FileReader;r.onload=t=>{const r=n.read(t.target.result,{type:"binary"});this.dataImport=n.utils.sheet_to_json(r.Sheets[r.SheetNames[0]],{header:1}),this.selectedFile(this.dataImport),this.plus.loaded(),e=null},r.onerror=()=>this.plus.alertError("L\u1ed7i file excel import"),r.readAsBinaryString(e.files[0])}else{alert("L\u01b0u \xfd:\nB\u1ea1n s\u1ebd m\u1ea5t to\xe0n b\u1ed9 d\u1eef li\u1ec7u c\u0169 tr\u01b0\u1edbc khi import nh\xe9!");const e=new FileReader;e.readAsText(t.target.files[0],"UTF-8"),e.onload=t=>{const e=JSON.parse(t.target.result);this.backup=this.cleanData(e),this.plus.loaded()},e.onerror=t=>{this.plus.alertError("L\u1ed7i file import"),this.plus.loaded()}}else this.readFileText(t)}readFileText(t){const e=t.target,r=new FileReader;r.readAsText(e.files[0]),r.onload=()=>{const t=this.plus.Crypt_Decrypt(r.result);this.exportExcel(t),this.exportTar(t)}}selectedFile(t){this.header=t[0],Date.now();for(let e=1;e<t.length;e++){const r={};t[0].forEach((o,n)=>{r[`${o}`]=t[e][n]}),delete r._id,delete r.__v,this.form.patchValue(r),this.form.valid?(r.keyWord=this.plus.generateKeyWord(r),r.dateModify=Date.now()+e,this.dataJson.push(r)):(r.err=`T\u1ea1i h\xe0ng ${e}: ${this.plus.getErrValidateForm(this.form)}`,this.errorData.push(r))}console.log(this.checkPer(2),this.errorData.length,this.dataJson.length)}import(){return f(this,void 0,void 0,function*(){this.plus.subs.unsubscribe();let t=!1;const e=this.dataJson;let r=0;const o=[];for(let n=0;n<e.length;n++){let s=e.slice(n,n+=200);yield this.plus.httpPost(this.api+"/import",s).toPromise().then(t=>{o.concat(t.errArr),1==t.status&&(r=t.lastModify,this.plus.FBS_PostByUser(this.api,r,this.global))}).catch(e=>{t=!0,console.log(e),this.errServer=JSON.parse(e.error.code),401==e.status&&(this.plus.alertError(e),localStorage.clear()),this.plus.alertMatSnackBar("Import kh\xf4ng th\xe0nh c\xf4ng!\nB\u1ea1n vui l\xf2ng ki\u1ec3m tra c\xe1c l\u1ed7i th\xf4ng b\xe1o tr\xean file excel")})}o.length>0&&(o.unshift(this.header),this.excel.export(o)),0==t&&(this.plus.alertSuccess("Import th\xe0nh c\xf4ng!"),this.plus.reload("/taikhoan"))})}importDBFile(){return f(this,void 0,void 0,function*(){if(1==this.plus.loading.value)return;this.plus.subs.unsubscribe();const t=this.backup.length;let e=0,r=!1;const o=this.backup;for(;e<t;){let n=o.slice(e,e+200);const s=this.plus.Arr_MaxValue(n);if(this.plus.httpPost(this.api+"/import",n).subscribe(t=>{if(console.log(t),1!=t.status)return r=!0;console.log(t.code),this.plus.FBS_PostByUser(this.api,s,this.global),e+=200},o=>{console.log(o),r=!0,this.errServer=JSON.parse(o.error.code),this.plus.alertError("Import kh\xf4ng th\xe0nh c\xf4ng!"),e>0&&this.export(this.dataImport.slice(e+1)),e=t}),r)break;yield this.plus.sleep(3e3)}0==r&&(this.plus.alertSuccess("Import th\xe0nh c\xf4ng!"),this.plus.reload("/taikhoan"))})}checkPer(t){return this.plus.checkPer(this.api,t)}reload(){return this.plus.reload("/")}export(t){t.unshift(this.header);const e=n.utils.json_to_sheet(t,{skipHeader:!0}),r=n.utils.book_new();n.utils.book_append_sheet(r,e,"ChuaImport"),n.writeFile(r,"4la-"+this.api+"-ChuaImport.xlsx")}exportExcel(t){const e=n.utils.json_to_sheet(t),r=n.utils.book_new();n.utils.book_append_sheet(r,e,this.api),n.writeFile(r,i()(Date.now()).format("YYYYMMDDHHMM")+"-4la-"+this.api+".xlsx")}exportTar(t){let e=JSON.stringify(t),r="data:application/json;charset=utf-8,"+encodeURIComponent(e);console.log(r);let o=`4la-${this.api?this.api:""}`+Date.now()+".tar",n=document.createElement("a");n.setAttribute("href",r),n.setAttribute("download",o),n.click()}cleanData(t){const e=[];for(let r=0;r<t.length;r++){const o=t[r];o.keyWord=this.plus.generateKeyWord(o),o.dateModify=Date.now()+r,delete o._id,delete o.__v,this.form.patchValue(o),console.log(o,this.form.valid),this.form.valid?(o.keyWord=this.plus.generateKeyWord(o),o.dateModify=Date.now()+r,this.dataJson.push(o)):(o.err=`T\u1ea1i h\xe0ng ${r}: ${this.plus.getErrValidateForm(this.form)}`,this.errorData.push(o)),e.push(o)}return e}onDrop(t){const e=t[0];if(console.log(e),this.plus.load(),"text/plain"!=e.type)if("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"==e.type||"application/vnd.ms-excel"==e.type){const t=new FileReader;t.onload=t=>{const e=n.read(t.target.result,{type:"binary"});this.dataImport=n.utils.sheet_to_json(e.Sheets[e.SheetNames[0]],{header:1}),this.selectedFile(this.dataImport),this.plus.loaded(),console.log(this.dataImport)},t.onerror=()=>this.plus.alertError("L\u1ed7i file excel import"),t.readAsBinaryString(e)}else{alert("L\u01b0u \xfd:\nB\u1ea1n s\u1ebd m\u1ea5t to\xe0n b\u1ed9 d\u1eef li\u1ec7u c\u0169 tr\u01b0\u1edbc khi import nh\xe9!");const t=new FileReader;t.readAsText(e,"UTF-8"),t.onload=t=>{const e=JSON.parse(t.target.result);this.backup=this.cleanData(e),this.plus.loaded()},t.onerror=t=>{this.plus.alertError("L\u1ed7i file import"),this.plus.loaded()}}else this.readFileText(e)}}return t.\u0275fac=function(e){return new(e||t)(a.Y36(l.T),a.Y36(c.x))},t.\u0275cmp=a.Xpm({type:t,selectors:[["app-import-database"]],inputs:{form:"form",api:"api",global:"global"},decls:4,vars:2,consts:[["mat-raised-button","","color","accent",3,"click"],[4,"ngIf"],["class","table",4,"ngIf"],[1,"text-center","text-white","py-2","my-3","bg-primary","rounded-pill","justify-content-center"],["mat-button","","target","_blank",3,"href"],["class","text-center mx-3","mat-raised-button","","color","primary",3,"click",4,"ngIf"],["class","ix",4,"ngIf"],["class","table table-inverse table-responsive",4,"ngIf"],[1,"text-center","mx-3"],["class","text-center mx-3","mat-raised-button","","color","accent",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",1,"text-center","mx-3",3,"click"],[1,"ix"],[3,"files"],[1,"table","table-inverse","table-responsive"],[4,"ngFor","ngForOf"],["class","text-danger",4,"ngIf"],[1,"text-danger"],["mat-raised-button","","color","accent",1,"text-center","mx-3",3,"click"],[1,"table"]],template:function(t,e){1&t&&(a.TgZ(0,"button",0),a.NdJ("click",function(){return e.show=!e.show}),a._uU(1,"Import Database"),a.qZA(),a.YNc(2,Z,14,6,"div",1),a.YNc(3,k,9,1,"table",2)),2&t&&(a.xp6(2),a.Q6J("ngIf",e.show),a.xp6(1),a.Q6J("ngIf",(null==e.errServer?null:e.errServer.length)>0))},directives:[p.lW,d.O5,p.zs,u.Hw,h.k,d.sg],styles:[""],data:{animation:[o.Ym]}}),t})()},48387:function(t,e,r){r.d(e,{D:function(){return l}});var o=r(13397),n=r(12057),s=r(24751),i=r(5923),a=r(74788);let l=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=a.oAB({type:t}),t.\u0275inj=a.cJS({imports:[[n.ez,s.u5,o.qX,i.X]]}),t})()},85913:function(t,e,r){r.d(e,{m:function(){return a}});var o=r(13397),n=r(24751),s=r(12057),i=r(74788);let a=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[[s.ez,n.UX,o.qX]]}),t})()}}]);