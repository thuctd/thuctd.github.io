!function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}(self.webpackChunk_4la=self.webpackChunk_4la||[]).push([[441],{16314:function(e,r,a){a.d(r,{W:function(){return p},H$:function(){return f},cf:function(){return d},pW:function(){return h},dw:function(){return g},yl:function(){return m}});var o,i=a(16738),u=a.n(i),c=a(74788),s=a(88638),l=a(91211),p=((o=function(){function e(){t(this,e)}return n(e,[{key:"transform",value:function(t){return(+"".concat(t).replace(/\D/g,"")).toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}}]),e}()).\u0275fac=function(t){return new(t||o)},o.\u0275pipe=c.Yjl({name:"commas",type:o,pure:!0}),o),f=function(){var e=function(){function e(){t(this,e)}return n(e,[{key:"transform",value:function(t,e,n){return t?t.filter(function(t){return t[e]==n}):[]}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=c.Yjl({name:"filterByKV",type:e,pure:!0}),e}(),d=function(){var e=function(){function e(){t(this,e)}return n(e,[{key:"transform",value:function(t){return"number"!=typeof t?u()(t).format("DD/MM/YYYY"):u()(new Date(86400*(t-25569)*1e3)).format("DD/MM/YYYY")}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=c.Yjl({name:"excelDay",type:e,pure:!0}),e}(),h=function(){var e=function(){function e(n){t(this,e),this.plus=n}return n(e,[{key:"transform",value:function(t){var e=JSON.parse(localStorage.getItem("catalog"));return e?e.filter(function(e){return e.Nhom==t}).sort(function(t,e){return t.GiaTri<e.GiaTri?-1:t.GiaTri>e.GiaTri?1:0}):(this.plus.reload("/taikhoan"),this.plus.getCatalog(),[])}}]),e}();return e.\u0275fac=function(t){return new(t||e)(c.Y36(s.T,16))},e.\u0275pipe=c.Yjl({name:"catalog",type:e,pure:!0}),e}(),g=function(){var e=function(){function e(){t(this,e)}return n(e,[{key:"transform",value:function(t){return u()(t).locale("vi").fromNow()}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=c.Yjl({name:"fromNow",type:e,pure:!0}),e}(),m=function(){var e=function(){function e(n){t(this,e),this.sanitizer=n}return n(e,[{key:"transform",value:function(t){return this.sanitizer.bypassSecurityTrustResourceUrl(t)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(c.Y36(l.H7,16))},e.\u0275pipe=c.Yjl({name:"safe",type:e,pure:!0}),e}()},97012:function(e,r,a){a.d(r,{t:function(){return m}});var o=a(16738),i=a.n(o),u=a(84487),c=a(74788),s=a(88638),l=a(12057),p=a(2895);function f(t,e){if(1&t){var n=c.EpF();c.TgZ(0,"button",3),c.NdJ("click",function(){return c.CHM(n),c.oxw(2).export()}),c._uU(1,"Export Excel"),c.qZA()}}function d(t,e){if(1&t){var n=c.EpF();c.TgZ(0,"button",3),c.NdJ("click",function(){return c.CHM(n),c.oxw(2).exportTar()}),c._uU(1,"Export BackupDB"),c.qZA()}}function h(t,e){if(1&t&&(c.TgZ(0,"span",1),c.YNc(1,f,2,0,"button",2),c.YNc(2,d,2,0,"button",2),c.qZA()),2&t){var n=c.oxw();c.xp6(1),c.Q6J("ngIf",n.check()),c.xp6(1),c.Q6J("ngIf",n.check())}}var g,m=((g=function(){function e(n){t(this,e),this.plus=n}return n(e,[{key:"ngOnInit",value:function(){}},{key:"export",value:function(){var t=[];this.dataJson.forEach(function(e){delete e.dateModify,delete e.status,delete e.sync,delete e.canEdit,delete e.keyWord,delete e.__v,t.push(e)});var e=u.utils.json_to_sheet(t),n=u.utils.book_new();u.utils.book_append_sheet(n,e,this.api),u.writeFile(n,i()(Date.now()).format("YYYYMMDDHHMM")+"-4la-"+this.api+".xlsx")}},{key:"exportTar",value:function(){for(var t=0;t<this.dataJson.length;t++)delete this.dataJson[t].dateModify,delete this.dataJson[t].canEdit,delete this.dataJson[t].keyWord,delete this.dataJson[t].__v,delete this.dataJson[t]._id;var e=JSON.stringify(this.dataJson),n="data:application/json;charset=utf-8,"+encodeURIComponent(e);console.log(n);var r="4la-".concat(this.api?this.api:"")+Date.now()+".tar",a=document.createElement("a");a.setAttribute("href",n),a.setAttribute("download",r),a.click()}},{key:"check",value:function(){return this.plus.checkPer("admin",4)}}]),e}()).\u0275fac=function(t){return new(t||g)(c.Y36(s.T))},g.\u0275cmp=c.Xpm({type:g,selectors:[["app-export-ecxel"]],inputs:{dataJson:"dataJson",api:"api"},decls:1,vars:1,consts:[["class","d-print-none",4,"ngIf"],[1,"d-print-none"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,e){1&t&&c.YNc(0,h,3,2,"span",0),2&t&&c.Q6J("ngIf",e.dataJson.length>0)},directives:[l.O5,p.lW],styles:[""]}),g)},55352:function(e,r,a){a.d(r,{y:function(){return J}});var o=a(28831),i=a(84487),u=a(16738),c=a.n(u),s=a(74788),l=a(88638),p=a(2895),f=a(12057),d=a(49356),h=function(t,e,n,r){return new(n||(n=Promise))(function(a,o){function i(t){try{c(r.next(t))}catch(e){o(e)}}function u(t){try{c(r.throw(t))}catch(e){o(e)}}function c(t){t.done?a(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(i,u)}c((r=r.apply(t,e||[])).next())})};function g(t,e){if(1&t){var n=s.EpF();s.TgZ(0,"div",10),s.TgZ(1,"input",11),s.NdJ("change",function(t){return s.CHM(n),s.oxw(2).readXlsx(t)}),s.qZA(),s.TgZ(2,"label",12),s._uU(3,"Ch\u1ecdn file "),s.TgZ(4,"mat-icon"),s._uU(5,"attachment"),s.qZA(),s.qZA(),s.TgZ(6,"a",13),s.TgZ(7,"mat-icon"),s._uU(8,"cloud_download"),s.qZA(),s._uU(9,"M\u1eabu import "),s.qZA(),s._UZ(10,"hr"),s.qZA()}if(2&t){var r=s.oxw(2);s.xp6(6),s.MGl("href","https://github.com/thuctd/FileStore/raw/master/templates/",r.api,".xlsx",s.LSH)}}function m(t,e){if(1&t&&(s.TgZ(0,"td",17),s._uU(1),s.qZA()),2&t){var n=s.oxw().$implicit;s.xp6(1),s.hij(" ",n.err||"","")}}function v(t,e){if(1&t&&(s.TgZ(0,"tr"),s.YNc(1,m,2,1,"td",16),s.qZA()),2&t){var n=e.$implicit;s.Q6J("@slideIn",void 0),s.xp6(1),s.Q6J("ngIf",n.err)}}function x(t,e){if(1&t&&(s.TgZ(0,"table",14),s.TgZ(1,"h4"),s._uU(2,"L\u1ed7i d\u1eef li\u1ec7u file import"),s.qZA(),s.TgZ(3,"tbody"),s.YNc(4,v,2,2,"tr",15),s.qZA(),s.qZA()),2&t){var n=s.oxw(2);s.xp6(4),s.Q6J("ngForOf",n.errorData.length>0?n.errorData:n.dataJson)}}function b(t,e){if(1&t){var n=s.EpF();s.TgZ(0,"button",18),s.NdJ("click",function(){return s.CHM(n),s.oxw(2).import()}),s._uU(1,"Import Excel"),s.qZA()}}function k(t,e){if(1&t){var n=s.EpF();s.TgZ(0,"button",18),s.NdJ("click",function(){return s.CHM(n),s.oxw(2).importDBFile()}),s._uU(1,"Import BackupDB"),s.qZA()}}function y(t,e){if(1&t){var n=s.EpF();s.TgZ(0,"button",19),s.NdJ("click",function(){return s.CHM(n),s.oxw(2).reload()}),s._uU(1,"L\xe0m l\u1ea1i"),s.qZA()}}function w(t,e){if(1&t&&(s.TgZ(0,"div",3),s.TgZ(1,"h4",4),s._uU(2,"Import t\u1eeb file excel"),s.qZA(),s._UZ(3,"hr"),s.YNc(4,g,11,1,"div",5),s.YNc(5,x,5,1,"table",6),s.TgZ(6,"div",7),s.YNc(7,b,2,0,"button",8),s.YNc(8,k,2,0,"button",8),s.YNc(9,y,2,0,"button",9),s.qZA(),s.qZA()),2&t){var n=s.oxw();s.xp6(4),s.Q6J("ngIf",0===n.dataJson.length),s.xp6(1),s.Q6J("ngIf",n.errorData.length>0),s.xp6(2),s.Q6J("ngIf",n.checkPer(4)&&0==n.errorData.length&&n.dataJson.length>0),s.xp6(1),s.Q6J("ngIf",n.checkPer(4)&&0==n.errorData.length&&n.backup.length>0),s.xp6(1),s.Q6J("ngIf",n.errorData.length>0||n.dataJson.length>0||n.backup.length>0)}}function Z(t,e){if(1&t&&(s.TgZ(0,"tr"),s.TgZ(1,"td"),s._uU(2),s.qZA(),s.TgZ(3,"td"),s._uU(4),s.qZA(),s.qZA()),2&t){var n=e.$implicit;s.xp6(2),s.Oqu(n.index),s.xp6(2),s.Oqu(n.msg)}}function _(t,e){if(1&t&&(s.TgZ(0,"table",20),s.TgZ(1,"thead"),s.TgZ(2,"tr"),s.TgZ(3,"th"),s._uU(4,"D\xf2ng"),s.qZA(),s.TgZ(5,"th"),s._uU(6,"L\u1ed7i"),s.qZA(),s.qZA(),s.qZA(),s.TgZ(7,"tbody"),s.YNc(8,Z,5,2,"tr",15),s.qZA(),s.qZA()),2&t){var n=s.oxw();s.xp6(8),s.Q6J("ngForOf",n.errServer)}}var T,J=((T=function(){function e(n){t(this,e),this.plus=n,this.global=!1,this.dataImport=[],this.dataJson=[],this.errorData=[],this.errServer=[],this.show=!1,this.header=[],this.backup=[]}return n(e,[{key:"ngOnInit",value:function(){this.dataJson=[],this.dataImport=[]}},{key:"readXlsx",value:function(t){var e=this;this.plus.load();var n=t.target.files[0];if(console.log(n.type),"text/plain"!=n.type)if("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"==n.type||"application/vnd.ms-excel"==n.type){var r=t.target,a=new FileReader;a.onload=function(t){var n=i.read(t.target.result,{type:"binary"});e.dataImport=i.utils.sheet_to_json(n.Sheets[n.SheetNames[0]],{header:1}),e.selectedFile(e.dataImport),e.plus.loaded(),r=null},a.onerror=function(){return e.plus.alertError("L\u1ed7i file excel import")},a.readAsBinaryString(r.files[0])}else{alert("L\u01b0u \xfd:\nB\u1ea1n s\u1ebd m\u1ea5t to\xe0n b\u1ed9 d\u1eef li\u1ec7u c\u0169 tr\u01b0\u1edbc khi import nh\xe9!");var o=new FileReader;o.readAsText(t.target.files[0],"UTF-8"),o.onload=function(t){var n=JSON.parse(t.target.result);e.backup=e.cleanData(n),e.plus.loaded()},o.onerror=function(t){e.plus.alertError("L\u1ed7i file import"),e.plus.loaded()}}else this.readFileText(t)}},{key:"readFileText",value:function(t){var e=this,n=t.target,r=new FileReader;r.readAsText(n.files[0]),r.onload=function(){var t=e.plus.Crypt_Decrypt(r.result);e.exportExcel(t),e.exportTar(t)}}},{key:"selectedFile",value:function(t){var e=this;this.header=t[0];for(var n=function(n){var r={};t[0].forEach(function(e,a){r["".concat(e)]=t[n][a]}),delete r._id,delete r.__v,e.form.patchValue(r),console.log(r,e.form.valid),e.form.valid?(r.keyWord=e.plus.generateKeyWord(r),r.dateModify=Date.now()+n,e.dataJson.push(r)):(r.err="T\u1ea1i h\xe0ng ".concat(n,": ").concat(e.plus.getErrValidateForm(e.form)),e.errorData.push(r))},r=1;r<t.length;r++)n(r)}},{key:"import",value:function(){return h(this,void 0,void 0,regeneratorRuntime.mark(function t(){var e,n,r,a,o,i=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.plus.subs.unsubscribe(),e=this.dataJson.length,n=!1,r=this.dataJson,a=regeneratorRuntime.mark(function t(a){var u,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return u=r.slice(a,a+=200),c=i.plus.Arr_MaxValue(u),t.next=4,i.plus.httpPost(i.api+"/import",u).toPromise().then(function(t){if(1!=t.status)return o=a,n=!0;console.log(t.code),i.plus.FBS_PostByUser(i.api,c,i.global)}).catch(function(t){403==t.status&&(i.plus.alertError(t),localStorage.clear(),window.location.reload()),n=!0,i.errServer=JSON.parse(t.error.code),i.plus.alertError("Import kh\xf4ng th\xe0nh c\xf4ng!"),a>0&&i.export(i.dataImport.slice(a+1)),a=e});case 4:if(!n){t.next=7;break}return o=a,t.abrupt("return","break");case 7:o=a;case 8:case"end":return t.stop()}},t)}),o=0;case 6:if(!(o<r.length)){t.next=14;break}return t.delegateYield(a(o),"t0",8);case 8:if("break"!==t.t0){t.next=11;break}return t.abrupt("break",14);case 11:o++,t.next=6;break;case 14:0==n&&(this.plus.alertSuccess("Import th\xe0nh c\xf4ng!"),this.plus.reload("/taikhoan"));case 15:case"end":return t.stop()}},t,this)}))}},{key:"importDBFile",value:function(){return h(this,void 0,void 0,regeneratorRuntime.mark(function t(){var e,n,r,a,o,i=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.plus.subs.unsubscribe(),e=this.backup.length,n=0,r=!1,a=this.backup,o=regeneratorRuntime.mark(function t(){var o,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=a.slice(n,n+200),u=i.plus.Arr_MaxValue(o),i.plus.httpPost(i.api+"/import",o).subscribe(function(t){if(console.log(t),1!=t.status)return r=!0;console.log(t.code),i.plus.FBS_PostByUser(i.api,u,i.global),n+=200},function(t){console.log(t),r=!0,i.errServer=JSON.parse(t.error.code),i.plus.alertError("Import kh\xf4ng th\xe0nh c\xf4ng!"),n>0&&i.export(i.dataImport.slice(n+1)),n=e}),!r){t.next=4;break}return t.abrupt("return","break");case 4:return t.next=6,i.plus.sleep(3e3);case 6:case"end":return t.stop()}},t)});case 5:if(!(n<e)){t.next=12;break}return t.delegateYield(o(),"t0",7);case 7:if("break"!==t.t0){t.next=10;break}return t.abrupt("break",12);case 10:t.next=5;break;case 12:0==r&&(this.plus.alertSuccess("Import th\xe0nh c\xf4ng!"),this.plus.reload("/taikhoan"));case 13:case"end":return t.stop()}},t,this)}))}},{key:"checkPer",value:function(t){return this.plus.checkPer(this.api,t)}},{key:"reload",value:function(){return this.plus.reload("/")}},{key:"export",value:function(t){t.unshift(this.header);var e=i.utils.json_to_sheet(t,{skipHeader:!0}),n=i.utils.book_new();i.utils.book_append_sheet(n,e,"ChuaImport"),i.writeFile(n,"4la-"+this.api+"-ChuaImport.xlsx")}},{key:"exportExcel",value:function(t){var e=i.utils.json_to_sheet(t),n=i.utils.book_new();i.utils.book_append_sheet(n,e,this.api),i.writeFile(n,c()(Date.now()).format("YYYYMMDDHHMM")+"-4la-"+this.api+".xlsx")}},{key:"exportTar",value:function(t){var e=JSON.stringify(t),n="data:application/json;charset=utf-8,"+encodeURIComponent(e);console.log(n);var r="4la-".concat(this.api?this.api:"")+Date.now()+".tar",a=document.createElement("a");a.setAttribute("href",n),a.setAttribute("download",r),a.click()}},{key:"cleanData",value:function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];r.keyWord=this.plus.generateKeyWord(r),r.dateModify=Date.now()+n,delete r._id,delete r.__v,this.form.patchValue(r),console.log(r,this.form.valid),this.form.valid?(r.keyWord=this.plus.generateKeyWord(r),r.dateModify=Date.now()+n,this.dataJson.push(r)):(r.err="T\u1ea1i h\xe0ng ".concat(n,": ").concat(this.plus.getErrValidateForm(this.form)),this.errorData.push(r)),e.push(r)}return e}}]),e}()).\u0275fac=function(t){return new(t||T)(s.Y36(l.T))},T.\u0275cmp=s.Xpm({type:T,selectors:[["app-import-database"]],inputs:{form:"form",api:"api",global:"global"},decls:4,vars:2,consts:[["mat-raised-button","","color","accent",3,"click"],["class","card",4,"ngIf"],["class","table",4,"ngIf"],[1,"card"],[1,"text-center","text-white","py-2","my-3","bg-primary","rounded-pill","justify-content-center"],["class","ix",4,"ngIf"],["class","table table-inverse table-responsive",4,"ngIf"],[1,"text-center","mx-3"],["class","text-center mx-3","mat-raised-button","","color","accent",3,"click",4,"ngIf"],["class","text-center mx-3","mat-raised-button","","color","primary",3,"click",4,"ngIf"],[1,"ix"],["hidden","","id","file-import","type","file","multiple","false",3,"change"],["for","file-import",1,"custom-file-upload","text-primary","mx-5"],["mat-button","","target","_blank",3,"href"],[1,"table","table-inverse","table-responsive"],[4,"ngFor","ngForOf"],["class","text-danger",4,"ngIf"],[1,"text-danger"],["mat-raised-button","","color","accent",1,"text-center","mx-3",3,"click"],["mat-raised-button","","color","primary",1,"text-center","mx-3",3,"click"],[1,"table"]],template:function(t,e){1&t&&(s.TgZ(0,"button",0),s.NdJ("click",function(){return e.show=!e.show}),s._uU(1,"Import Database"),s.qZA(),s.YNc(2,w,10,5,"div",1),s.YNc(3,_,9,1,"table",2)),2&t&&(s.xp6(2),s.Q6J("ngIf",e.show),s.xp6(1),s.Q6J("ngIf",e.errServer.length>0))},directives:[p.lW,f.O5,d.Hw,p.zs,f.sg],styles:[""],data:{animation:[o.Ym]}}),T)},85913:function(e,n,r){r.d(n,{m:function(){return s}});var a,o=r(39609),i=r(24751),u=r(12057),c=r(74788),s=((a=function e(){t(this,e)}).\u0275fac=function(t){return new(t||a)},a.\u0275mod=c.oAB({type:a}),a.\u0275inj=c.cJS({imports:[[u.ez,i.UX,o.qX]]}),a)}}])}();