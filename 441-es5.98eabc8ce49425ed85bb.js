!function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}(self.webpackChunk_4la=self.webpackChunk_4la||[]).push([[441],{16314:function(e,n,a){a.d(n,{W:function(){return p},H$:function(){return f},cf:function(){return d},pW:function(){return h},dw:function(){return m},yl:function(){return g}});var o,i=a(16738),u=a.n(i),c=a(74788),s=a(88638),l=a(91211),p=((o=function(){function e(){t(this,e)}return r(e,[{key:"transform",value:function(t){return(+"".concat(t).replace(/\D/g,"")).toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}}]),e}()).\u0275fac=function(t){return new(t||o)},o.\u0275pipe=c.Yjl({name:"commas",type:o,pure:!0}),o),f=function(){var e=function(){function e(){t(this,e)}return r(e,[{key:"transform",value:function(t,e,r){return t?t.filter(function(t){return t[e]==r}):[]}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=c.Yjl({name:"filterByKV",type:e,pure:!0}),e}(),d=function(){var e=function(){function e(){t(this,e)}return r(e,[{key:"transform",value:function(t){return"number"!=typeof t?u()(t).format("DD/MM/YYYY"):u()(new Date(86400*(t-25569)*1e3)).format("DD/MM/YYYY")}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=c.Yjl({name:"excelDay",type:e,pure:!0}),e}(),h=function(){var e=function(){function e(r){t(this,e),this.plus=r}return r(e,[{key:"transform",value:function(t){var e=JSON.parse(localStorage.getItem("catalog"));return e?e.filter(function(e){return e.Nhom==t}).sort(function(t,e){return t.GiaTri<e.GiaTri?-1:t.GiaTri>e.GiaTri?1:0}):(this.plus.reload("/taikhoan"),this.plus.getCatalog(),[])}}]),e}();return e.\u0275fac=function(t){return new(t||e)(c.Y36(s.T,16))},e.\u0275pipe=c.Yjl({name:"catalog",type:e,pure:!0}),e}(),m=function(){var e=function(){function e(){t(this,e)}return r(e,[{key:"transform",value:function(t){return u()(t).locale("vi").fromNow()}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=c.Yjl({name:"fromNow",type:e,pure:!0}),e}(),g=function(){var e=function(){function e(r){t(this,e),this.sanitizer=r}return r(e,[{key:"transform",value:function(t){return this.sanitizer.bypassSecurityTrustResourceUrl(t)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(c.Y36(l.H7,16))},e.\u0275pipe=c.Yjl({name:"safe",type:e,pure:!0}),e}()},97012:function(e,n,a){a.d(n,{t:function(){return m}});var o=a(16738),i=a.n(o),u=a(84487),c=a(74788),s=a(88638),l=a(12057),p=a(2895);function f(t,e){if(1&t){var r=c.EpF();c.TgZ(0,"button",1),c.NdJ("click",function(){return c.CHM(r),c.oxw().export()}),c._uU(1,"Export Excel"),c.qZA()}}function d(t,e){if(1&t){var r=c.EpF();c.TgZ(0,"button",1),c.NdJ("click",function(){return c.CHM(r),c.oxw().exportTar()}),c._uU(1,"Export BackupDB"),c.qZA()}}var h,m=((h=function(){function e(r){t(this,e),this.plus=r}return r(e,[{key:"ngOnInit",value:function(){}},{key:"export",value:function(){var t=[];this.dataJson.forEach(function(e){delete e.dateModify,delete e.status,delete e.sync,delete e.canEdit,delete e.keyWord,delete e.__v,t.push(e)});var e=u.utils.json_to_sheet(t),r=u.utils.book_new();u.utils.book_append_sheet(r,e,this.api),u.writeFile(r,i()(Date.now()).format("YYYYMMDDHHMM")+"-4la-"+this.api+".xlsx")}},{key:"exportTar",value:function(){for(var t=0;t<this.dataJson.length;t++)delete this.dataJson[t].dateModify,delete this.dataJson[t].canEdit,delete this.dataJson[t].keyWord,delete this.dataJson[t].__v,delete this.dataJson[t]._id;var e=JSON.stringify(this.dataJson),r="data:application/json;charset=utf-8,"+encodeURIComponent(e);console.log(r);var n="4la-".concat(this.api?this.api:"")+Date.now()+".tar",a=document.createElement("a");a.setAttribute("href",r),a.setAttribute("download",n),a.click()}},{key:"check",value:function(){return this.plus.checkPer("admin",4)}}]),e}()).\u0275fac=function(t){return new(t||h)(c.Y36(s.T))},h.\u0275cmp=c.Xpm({type:h,selectors:[["app-export-ecxel"]],inputs:{dataJson:"dataJson",api:"api"},decls:2,vars:2,consts:[["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,e){1&t&&(c.YNc(0,f,2,0,"button",0),c.YNc(1,d,2,0,"button",0)),2&t&&(c.Q6J("ngIf",e.check()),c.xp6(1),c.Q6J("ngIf",e.check()))},directives:[l.O5,p.lW],styles:[""]}),h)},55352:function(e,n,a){a.d(n,{y:function(){return J}});var o=a(28831),i=a(84487),u=a(16738),c=a.n(u),s=a(74788),l=a(88638),p=a(2895),f=a(12057),d=a(49356),h=function(t,e,r,n){return new(r||(r=Promise))(function(a,o){function i(t){try{c(n.next(t))}catch(e){o(e)}}function u(t){try{c(n.throw(t))}catch(e){o(e)}}function c(t){t.done?a(t.value):function(t){return t instanceof r?t:new r(function(e){e(t)})}(t.value).then(i,u)}c((n=n.apply(t,e||[])).next())})};function m(t,e){if(1&t){var r=s.EpF();s.TgZ(0,"div",10),s.TgZ(1,"input",11),s.NdJ("change",function(t){return s.CHM(r),s.oxw(2).readXlsx(t)}),s.qZA(),s.TgZ(2,"label",12),s._uU(3,"Ch\u1ecdn file "),s.TgZ(4,"mat-icon"),s._uU(5,"attachment"),s.qZA(),s.qZA(),s.TgZ(6,"a",13),s.TgZ(7,"mat-icon"),s._uU(8,"cloud_download"),s.qZA(),s._uU(9,"M\u1eabu import "),s.qZA(),s._UZ(10,"hr"),s.qZA()}if(2&t){var n=s.oxw(2);s.xp6(6),s.MGl("href","https://github.com/thuctd/FileStore/raw/master/templates/",n.api,".xlsx",s.LSH)}}function g(t,e){if(1&t&&(s.TgZ(0,"td",17),s._uU(1),s.qZA()),2&t){var r=s.oxw().$implicit;s.xp6(1),s.hij(" ",r.err||"","")}}function v(t,e){if(1&t&&(s.TgZ(0,"tr"),s.YNc(1,g,2,1,"td",16),s.qZA()),2&t){var r=e.$implicit;s.Q6J("@slideIn",void 0),s.xp6(1),s.Q6J("ngIf",r.err)}}function x(t,e){if(1&t&&(s.TgZ(0,"table",14),s.TgZ(1,"h4"),s._uU(2,"L\u1ed7i d\u1eef li\u1ec7u file import"),s.qZA(),s.TgZ(3,"tbody"),s.YNc(4,v,2,2,"tr",15),s.qZA(),s.qZA()),2&t){var r=s.oxw(2);s.xp6(4),s.Q6J("ngForOf",r.errorData.length>0?r.errorData:r.dataJson)}}function b(t,e){if(1&t){var r=s.EpF();s.TgZ(0,"button",18),s.NdJ("click",function(){return s.CHM(r),s.oxw(2).import()}),s._uU(1,"Import Excel"),s.qZA()}}function k(t,e){if(1&t){var r=s.EpF();s.TgZ(0,"button",18),s.NdJ("click",function(){return s.CHM(r),s.oxw(2).importDBFile()}),s._uU(1,"Import BackupDB"),s.qZA()}}function y(t,e){if(1&t){var r=s.EpF();s.TgZ(0,"button",19),s.NdJ("click",function(){return s.CHM(r),s.oxw(2).reload()}),s._uU(1,"L\xe0m l\u1ea1i"),s.qZA()}}function w(t,e){if(1&t&&(s.TgZ(0,"div",3),s.TgZ(1,"h4",4),s._uU(2,"Import t\u1eeb file excel"),s.qZA(),s._UZ(3,"hr"),s.YNc(4,m,11,1,"div",5),s.YNc(5,x,5,1,"table",6),s.TgZ(6,"div",7),s.YNc(7,b,2,0,"button",8),s.YNc(8,k,2,0,"button",8),s.YNc(9,y,2,0,"button",9),s.qZA(),s.qZA()),2&t){var r=s.oxw();s.xp6(4),s.Q6J("ngIf",0===r.dataJson.length),s.xp6(1),s.Q6J("ngIf",r.errorData.length>0),s.xp6(2),s.Q6J("ngIf",r.checkPer(4)&&0==r.errorData.length&&r.dataJson.length>0),s.xp6(1),s.Q6J("ngIf",r.checkPer(4)&&0==r.errorData.length&&r.backup.length>0),s.xp6(1),s.Q6J("ngIf",r.errorData.length>0||r.dataJson.length>0||r.backup.length>0)}}function Z(t,e){if(1&t&&(s.TgZ(0,"tr"),s.TgZ(1,"td"),s._uU(2),s.qZA(),s.TgZ(3,"td"),s._uU(4),s.qZA(),s.qZA()),2&t){var r=e.$implicit;s.xp6(2),s.Oqu(r.index),s.xp6(2),s.Oqu(r.msg)}}function _(t,e){if(1&t&&(s.TgZ(0,"table",20),s.TgZ(1,"thead"),s.TgZ(2,"tr"),s.TgZ(3,"th"),s._uU(4,"D\xf2ng"),s.qZA(),s.TgZ(5,"th"),s._uU(6,"L\u1ed7i"),s.qZA(),s.qZA(),s.qZA(),s.TgZ(7,"tbody"),s.YNc(8,Z,5,2,"tr",15),s.qZA(),s.qZA()),2&t){var r=s.oxw();s.xp6(8),s.Q6J("ngForOf",r.errServer)}}var T,J=((T=function(){function e(r){t(this,e),this.plus=r,this.global=!1,this.dataImport=[],this.dataJson=[],this.errorData=[],this.errServer=[],this.show=!1,this.header=[],this.backup=[]}return r(e,[{key:"ngOnInit",value:function(){this.dataJson=[],this.dataImport=[]}},{key:"readXlsx",value:function(t){var e=this;this.plus.load();var r=t.target.files[0];if(console.log(r.type),"text/plain"!=r.type)if("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"==r.type||"application/vnd.ms-excel"==r.type){var n=t.target,a=new FileReader;a.onload=function(t){var r=i.read(t.target.result,{type:"binary"});e.dataImport=i.utils.sheet_to_json(r.Sheets[r.SheetNames[0]],{header:1}),e.selectedFile(e.dataImport),e.plus.loaded(),n=null},a.onerror=function(){return e.plus.alertError("L\u1ed7i file excel import")},a.readAsBinaryString(n.files[0])}else{alert("L\u01b0u \xfd:\nB\u1ea1n s\u1ebd m\u1ea5t to\xe0n b\u1ed9 d\u1eef li\u1ec7u c\u0169 tr\u01b0\u1edbc khi import nh\xe9!");var o=new FileReader;o.readAsText(t.target.files[0],"UTF-8"),o.onload=function(t){var r=JSON.parse(t.target.result);e.backup=e.cleanData(r),e.plus.loaded()},o.onerror=function(t){e.plus.alertError("L\u1ed7i file import"),e.plus.loaded()}}else this.readFileText(t)}},{key:"readFileText",value:function(t){var e=this,r=t.target,n=new FileReader;n.readAsText(r.files[0]),n.onload=function(){var t=e.plus.Crypt_Decrypt(n.result);e.exportExcel(t),e.exportTar(t)}}},{key:"selectedFile",value:function(t){var e=this;this.header=t[0];for(var r=function(r){var n={};t[0].forEach(function(e,a){n["".concat(e)]=t[r][a]}),delete n._id,delete n.__v,e.form.patchValue(n),console.log(n,e.form.valid),e.form.valid?(n.keyWord=e.plus.generateKeyWord(n),n.dateModify=Date.now()+r,e.dataJson.push(n)):(n.err="T\u1ea1i h\xe0ng ".concat(r,": ").concat(e.plus.getErrValidateForm(e.form)),e.errorData.push(n))},n=1;n<t.length;n++)r(n)}},{key:"import",value:function(){return h(this,void 0,void 0,regeneratorRuntime.mark(function t(){var e,r,n,a,o,i=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.plus.subs.unsubscribe(),e=this.dataJson.length,r=!1,n=this.dataJson,a=regeneratorRuntime.mark(function t(a){var u,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return u=n.slice(a,a+=200),c=i.plus.Arr_MaxValue(u),t.next=4,i.plus.httpPost(i.api+"/import",u).toPromise().then(function(t){if(1!=t.status)return o=a,r=!0;console.log(t.code),i.plus.FBS_PostByUser(i.api,c,i.global)}).catch(function(t){403==t.status&&(i.plus.alertError(t),localStorage.clear(),window.location.reload()),r=!0,i.errServer=JSON.parse(t.error.code),i.plus.alertError("Import kh\xf4ng th\xe0nh c\xf4ng!"),a>0&&i.export(i.dataImport.slice(a+1)),a=e});case 4:if(!r){t.next=7;break}return o=a,t.abrupt("return","break");case 7:o=a;case 8:case"end":return t.stop()}},t)}),o=0;case 6:if(!(o<n.length)){t.next=14;break}return t.delegateYield(a(o),"t0",8);case 8:if("break"!==t.t0){t.next=11;break}return t.abrupt("break",14);case 11:o++,t.next=6;break;case 14:0==r&&(this.plus.alertSuccess("Import th\xe0nh c\xf4ng!"),this.plus.reload("/taikhoan"));case 15:case"end":return t.stop()}},t,this)}))}},{key:"importDBFile",value:function(){return h(this,void 0,void 0,regeneratorRuntime.mark(function t(){var e,r,n,a,o,i=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.plus.subs.unsubscribe(),e=this.backup.length,r=0,n=!1,a=this.backup,o=regeneratorRuntime.mark(function t(){var o,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=a.slice(r,r+200),u=i.plus.Arr_MaxValue(o),i.plus.httpPost(i.api+"/import",o).subscribe(function(t){if(console.log(t),1!=t.status)return n=!0;console.log(t.code),i.plus.FBS_PostByUser(i.api,u,i.global),r+=200},function(t){console.log(t),n=!0,i.errServer=JSON.parse(t.error.code),i.plus.alertError("Import kh\xf4ng th\xe0nh c\xf4ng!"),r>0&&i.export(i.dataImport.slice(r+1)),r=e}),!n){t.next=4;break}return t.abrupt("return","break");case 4:return t.next=6,i.plus.sleep(3e3);case 6:case"end":return t.stop()}},t)});case 5:if(!(r<e)){t.next=12;break}return t.delegateYield(o(),"t0",7);case 7:if("break"!==t.t0){t.next=10;break}return t.abrupt("break",12);case 10:t.next=5;break;case 12:0==n&&(this.plus.alertSuccess("Import th\xe0nh c\xf4ng!"),this.plus.reload("/taikhoan"));case 13:case"end":return t.stop()}},t,this)}))}},{key:"checkPer",value:function(t){return this.plus.checkPer(this.api,t)}},{key:"reload",value:function(){return this.plus.reload("/")}},{key:"export",value:function(t){t.unshift(this.header);var e=i.utils.json_to_sheet(t,{skipHeader:!0}),r=i.utils.book_new();i.utils.book_append_sheet(r,e,"ChuaImport"),i.writeFile(r,"4la-"+this.api+"-ChuaImport.xlsx")}},{key:"exportExcel",value:function(t){var e=i.utils.json_to_sheet(t),r=i.utils.book_new();i.utils.book_append_sheet(r,e,this.api),i.writeFile(r,c()(Date.now()).format("YYYYMMDDHHMM")+"-4la-"+this.api+".xlsx")}},{key:"exportTar",value:function(t){var e=JSON.stringify(t),r="data:application/json;charset=utf-8,"+encodeURIComponent(e);console.log(r);var n="4la-".concat(this.api?this.api:"")+Date.now()+".tar",a=document.createElement("a");a.setAttribute("href",r),a.setAttribute("download",n),a.click()}},{key:"cleanData",value:function(t){for(var e=[],r=0;r<t.length;r++){var n=t[r];n.keyWord=this.plus.generateKeyWord(n),n.dateModify=Date.now()+r,delete n._id,delete n.__v,this.form.patchValue(n),console.log(n,this.form.valid),this.form.valid?(n.keyWord=this.plus.generateKeyWord(n),n.dateModify=Date.now()+r,this.dataJson.push(n)):(n.err="T\u1ea1i h\xe0ng ".concat(r,": ").concat(this.plus.getErrValidateForm(this.form)),this.errorData.push(n)),e.push(n)}return e}}]),e}()).\u0275fac=function(t){return new(t||T)(s.Y36(l.T))},T.\u0275cmp=s.Xpm({type:T,selectors:[["app-import-database"]],inputs:{form:"form",api:"api",global:"global"},decls:4,vars:2,consts:[["mat-raised-button","","color","accent",3,"click"],["class","card",4,"ngIf"],["class","table",4,"ngIf"],[1,"card"],[1,"text-center","text-white","py-2","my-3","bg-primary","rounded-pill","justify-content-center"],["class","ix",4,"ngIf"],["class","table table-inverse table-responsive",4,"ngIf"],[1,"text-center","mx-3"],["class","text-center mx-3","mat-raised-button","","color","accent",3,"click",4,"ngIf"],["class","text-center mx-3","mat-raised-button","","color","primary",3,"click",4,"ngIf"],[1,"ix"],["hidden","","id","file-import","type","file","multiple","false",3,"change"],["for","file-import",1,"custom-file-upload","text-primary","mx-5"],["mat-button","","target","_blank",3,"href"],[1,"table","table-inverse","table-responsive"],[4,"ngFor","ngForOf"],["class","text-danger",4,"ngIf"],[1,"text-danger"],["mat-raised-button","","color","accent",1,"text-center","mx-3",3,"click"],["mat-raised-button","","color","primary",1,"text-center","mx-3",3,"click"],[1,"table"]],template:function(t,e){1&t&&(s.TgZ(0,"button",0),s.NdJ("click",function(){return e.show=!e.show}),s._uU(1,"Import Database"),s.qZA(),s.YNc(2,w,10,5,"div",1),s.YNc(3,_,9,1,"table",2)),2&t&&(s.xp6(2),s.Q6J("ngIf",e.show),s.xp6(1),s.Q6J("ngIf",e.errServer.length>0))},directives:[p.lW,f.O5,d.Hw,p.zs,f.sg],styles:[""],data:{animation:[o.Ym]}}),T)},85913:function(e,r,n){n.d(r,{m:function(){return s}});var a,o=n(39609),i=n(24751),u=n(12057),c=n(74788),s=((a=function e(){t(this,e)}).\u0275fac=function(t){return new(t||a)},a.\u0275mod=c.oAB({type:a}),a.\u0275inj=c.cJS({imports:[[u.ez,i.UX,o.qX]]}),a)}}])}();