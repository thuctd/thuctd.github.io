(self.webpackChunk_4la=self.webpackChunk_4la||[]).push([[32],{66909:function(t,n,i){"use strict";i.r(n),i.d(n,{BanHangModule:function(){return Vt}});var o=i(94803),e=i(35180),a=i(62283),s=i(35845),h=i(43552),c=i(61511),r=i(7171),u=i(529),l=i(82393),g=i(31572),d=i(16073),p=i(68591);let Z=(()=>{class t{constructor(t,n,i,o){this.fb=t,this.plus=n,this.route=i,this.location=o,this.permissions=u.N.nav,this.api="user",this.perUser={}}ngOnInit(){this.getById()}getById(){this.plus.load();const t=this.route.snapshot.paramMap.get("id");this.userId=t,this.plus.httpGet("user/"+t).subscribe(t=>{const n=this.plus.Crypt_DecryptRest(t);console.log(n.opt),this.user=n,this.perUser=n.opt,this.lock=n.lock,this.fullName=n.fullName,this.phoneNumber=n.phoneNumber,this.unit=n.unit,this.plus.loaded()},t=>this.plus.alertError())}onSelect(t,n,i){const o={};if(o[t]=n,i.target.checked)this.perUser=Object.assign(Object.assign({},this.perUser),o);else switch(n){case 1:delete this.perUser[t];break;case 2:this.perUser[t]=1;break;case 4:this.perUser[t]=2;break;case 7:this.perUser[t]=4}}checked(t,n){return this.perUser[t]>=n}deletePer(){this.perUser={}}lockUser(){let t=this.user;t.lock=this.lock,this.plus.httpPut(this.api,t).subscribe(t=>{this.plus.alertToasrt(t)})}update(){const t={_id:this.user._id,opt:this.perUser,lock:this.lock,fullName:this.fullName,email:this.user.email,unit:this.unit,phoneNumber:this.phoneNumber,dateModify:Date.now()};this.plus.httpPut(this.api,t).subscribe(n=>{this.plus.FBS_SetData("login",this.user._id,{dateModify:t.dateModify}),this.plus.alertToasrt(n)})}}return t.\u0275fac=function(n){return new(n||t)(g.Y36(d.qu),g.Y36(l.T),g.Y36(p.gz),g.Y36(c.Ye))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-khach-hang"]],decls:15,vars:0,consts:[["type","button","data-toggle","modal","data-target","#themKH",1,"btn","btn-primary","btn-lg"],["id","themKH","tabindex","-1","role","dialog","aria-labelledby","modelTitleId","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary"]],template:function(t,n){1&t&&(g.TgZ(0,"button",0),g._uU(1," Th\xeam KH\n"),g.qZA(),g.TgZ(2,"div",1),g.TgZ(3,"div",2),g.TgZ(4,"div",3),g.TgZ(5,"div",4),g.TgZ(6,"h5",5),g._uU(7,"Th\xeam KH"),g.qZA(),g.qZA(),g.TgZ(8,"div",6),g._uU(9," Body "),g.qZA(),g.TgZ(10,"div",7),g.TgZ(11,"button",8),g._uU(12,"Close"),g.qZA(),g.TgZ(13,"button",9),g._uU(14,"Save"),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.qZA())},styles:[""],data:{animation:[r.Y]}}),t})();var m=i(29609),T=i.n(m),f=i(15980),b=i(84521),A=i(99194),q=i(85354);let x=(()=>{class t{constructor(t){this.plus=t,this.db=null,this.title="B\xe1o c\xe1o b\xe1n h\xe0ng",this.dbName="ban-hang",this.items=[],this.DoanhThu=0,this.LoiNhuan=0,this.DoanhThuThang=[],this.LoiNhuanThang=[],this.BanChay=[],this.BanNgoiNhieu=[]}ngOnDestroy(){console.log("Destroy bao-cao"),this.plus.subs.unsubscribe()}ngOnInit(){this.plus.setTiTle(this.title),this.plus.IDB_InitDB(this.dbName).subscribe(t=>{this.plus.updateUserLocal(t,"nhan-don"),this.db=t,this.plus.updateAPi.subscribe(t=>{this.getNhanDon()})})}getNhanDon(){this.plus.subs.add(this.plus.IDB_DB_GetAll(this.db,"nhan-don").subscribe(t=>{null==t&&(t=[]),this.items=t,this.doanhThuNgay(1)}))}doanhThuNgay(t){const n=this.items,i=Date.now()-24*t*60*60*1e3,o=[];let e=[],a=[];for(let c=0;c<n.length;c++)if(n[c].dateModify>i&&n[c].LoiNhuan>0&&1==n[c].DaThanhToan){const t={LoiNhuan:1e3*n[c].LoiNhuan,ThanhTien:n[c].ThanhTien,Ngay:T()(n[c].dateModify).format("DD/MM")};o.push(t),n[c].DonMua.forEach(t=>{e.push({TenHangHoa:t.TenHangHoa,TongCong:t.TongCong})}),a.push({TenBan:n[c].TenBan,SoKH:n[c].SoKH})}this.DoanhThuThang=this.plus.generateChart(o,"Ngay","ThanhTien"),this.LoiNhuanThang=this.plus.generateChart(o,"Ngay","LoiNhuan"),this.DoanhThu=this.plus.sumByKey(o,"ThanhTien"),this.LoiNhuan=this.plus.sumByKey(o,"LoiNhuan");const s=this.plus.sortArr(e,"TongCong"),h=this.plus.generateChart(s,"TenHangHoa","TongCong");this.BanChay=this.plus.generateChart(h.slice(0,5),"x","y"),this.BanNgoiNhieu=this.plus.generateChart(a,"TenBan","SoKH")}}return t.\u0275fac=function(n){return new(n||t)(g.Y36(l.T))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-bao-cao"]],decls:37,vars:24,consts:[[1,"container"],[1,"tit"],[1,"row","text-center"],["mat-raised-button","","color","warn"],[1,"row"],[3,"day"],[1,"row","my-3"],[1,"col-md-6"],[3,"id","arr","type"],[1,"col-md-4"],[1,"col-md-8"]],template:function(t,n){1&t&&(g.TgZ(0,"div",0),g.TgZ(1,"h5",1),g._uU(2,"B\xc1O C\xc1O B\xc1N H\xc0NG"),g.qZA(),g.TgZ(3,"div",2),g.TgZ(4,"button",3),g._uU(5),g.ALo(6,"commas"),g.qZA(),g.TgZ(7,"button",3),g._uU(8),g.ALo(9,"commas"),g.qZA(),g.qZA(),g.TgZ(10,"div",4),g.TgZ(11,"app-chip",5),g.NdJ("day",function(t){return n.doanhThuNgay(t)}),g.qZA(),g.qZA(),g.TgZ(12,"div",6),g.TgZ(13,"div",7),g.TgZ(14,"h6",1),g._uU(15,"B\u1ea3ng Doanh thu"),g.qZA(),g._UZ(16,"app-chart",8),g.qZA(),g.TgZ(17,"div",7),g.TgZ(18,"h6",1),g._uU(19,"B\u1ea3ng L\u1ee3i nhu\u1eadn"),g.qZA(),g._UZ(20,"app-chart",8),g.qZA(),g.qZA(),g._UZ(21,"hr"),g.TgZ(22,"h6",1),g._uU(23,"Top b\xe1n ch\u1ea1y"),g.qZA(),g.TgZ(24,"div",6),g.TgZ(25,"div",9),g._UZ(26,"app-chart",8),g.qZA(),g.TgZ(27,"div",10),g._UZ(28,"app-chart",8),g.qZA(),g.qZA(),g._UZ(29,"hr"),g.TgZ(30,"h6",1),g._uU(31,"Top B\xe0n kh\xe1ch ch\u1ecdn"),g.qZA(),g.TgZ(32,"div",6),g.TgZ(33,"div",9),g._UZ(34,"app-chart",8),g.qZA(),g.TgZ(35,"div",10),g._UZ(36,"app-chart",8),g.qZA(),g.qZA(),g.qZA()),2&t&&(g.xp6(5),g.hij(" Doanh thu: ",g.lcZ(6,20,n.DoanhThu),""),g.xp6(3),g.hij(" L\u1ee3i nhu\u1eadn: ",g.lcZ(9,22,n.LoiNhuan),""),g.xp6(8),g.Q6J("id","doanhthuthang")("arr",n.DoanhThuThang)("type","line"),g.xp6(4),g.Q6J("id","LoinhuanThan")("arr",n.LoiNhuanThang)("type","bar"),g.xp6(6),g.Q6J("id","BanChay")("arr",n.BanChay)("type","doughnut"),g.xp6(2),g.Q6J("id","BanChayBar")("arr",n.BanChay)("type","bar"),g.xp6(6),g.Q6J("id","BanNgoiNhieu")("arr",n.BanNgoiNhieu)("type","doughnut"),g.xp6(2),g.Q6J("id","BanNgoiNhieuBar")("arr",n.BanNgoiNhieu)("type","bar"))},directives:[f.lW,b.Y,A.x],pipes:[q.W],styles:["mat-chip[_ngcontent-%COMP%]{max-width:200px}"]}),t})();var D=i(43691);function _(t,n){1&t&&(g.TgZ(0,"h4",4),g._uU(1,"\u0110\xe3 ho\xe0n th\xe0nh "),g.qZA())}function y(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"button",15),g.NdJ("click",function(){g.CHM(t);const n=g.oxw().index,i=g.oxw().$implicit;return g.oxw().onComplete(i,n)}),g.TgZ(1,"mat-icon"),g._uU(2,"done"),g.qZA(),g.qZA()}}function C(t,n){if(1&t&&(g.TgZ(0,"div",9),g.TgZ(1,"b",10),g._uU(2),g.TgZ(3,"b",11),g._uU(4),g.qZA(),g.qZA(),g.TgZ(5,"i",12),g._uU(6),g.qZA(),g._UZ(7,"br"),g.TgZ(8,"i",13),g._uU(9),g.ALo(10,"fromNow"),g.qZA(),g.YNc(11,y,3,0,"button",14),g.qZA()),2&t){const t=n.$implicit,i=g.oxw(2);g.Q6J("@slideIn",void 0),g.xp6(2),g.hij("",t.TenHangHoa,": "),g.xp6(2),g.AsE(" ",t.TongCong," ",t.DVT," "),g.xp6(2),g.Oqu(t.GhiChu),g.xp6(3),g.Oqu(g.lcZ(10,7,t.GioVao)),g.xp6(2),g.Q6J("ngIf",i.checkPer(2)&&0==t.DaLam)}}function B(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"div"),g.TgZ(1,"div",5),g.TgZ(2,"h4",6),g._uU(3),g.qZA(),g.YNc(4,C,12,9,"div",7),g.TgZ(5,"button",8),g.NdJ("click",function(){const n=g.CHM(t).$implicit;return g.oxw().onCompleteAll(n)}),g.TgZ(6,"mat-icon"),g._uU(7,"done_all"),g.qZA(),g.qZA(),g.qZA(),g.qZA()}if(2&t){const t=n.$implicit;g.xp6(3),g.Oqu(t.TenBan),g.xp6(1),g.Q6J("ngForOf",t.DonMua)}}let v=(()=>{class t{constructor(t,n){this.plus=t,this.fb=n,this.dbName="ban-hang",this.db=null,this.api="nhan-don",this.items=[],this.tittle="Pha ch\u1ebf",this.DonMua=[],this.groups=[],this.main=this.fb.group({_id:[,[]],idHangHoa:[,[d.kI.required]],TrangThai:[0,[d.kI.required]]})}ngOnDestroy(){console.log("Destroy pha-che")}ngOnInit(){this.plus.setTiTle(this.tittle),this.plus.IDB_InitDB(this.dbName).subscribe(t=>{this.db=t,this.plus.updateUserLocal(t,this.api),this.plus.updateAPi.subscribe(n=>{this.plus.notify_send("C\xf3 kh\xe1ch v\xe0o!"),this.getIDB(t),this.plus.playUpdate()})})}getIDB(t){this.groups=[],this.plus.IDB_DB_GetAll(t,this.api).subscribe(t=>{let n=[];for(let i=0;i<t.length;i++)if(0==t[i].DaThanhToan){const o=t[i].DonMua.filter(t=>(0==t.DaLam&&(this.addNewItem(t),this.groups.push(t)),0==t.DaLam));o.length>0&&(t[i].DonMua=o,n.push(t[i]))}this.items=n,console.log(this.groups),this.groupItems()})}groupItems(){const t=this.plus.obj_GroupByKey(this.groups,"TenHangHoa");console.log(t)}addNewItem(t){const n=this.DonMua.find(n=>n._id==t._id);if(window.navigator.vibrate(200),n){const i=this.DonMua.findIndex(t=>t._id==n._id);this.DonMua[i].TongCong+=t.TongCong}else t.TongCong=1,t.GioVao=Date.now(),t.DaLam=!1,this.DonMua.push(t)}onComplete(t,n){console.log(t,n);const i=t;delete i.__v,i.DonMua[n].DaLam=!0,console.log(i),this.plus.httpPut(this.api,i).subscribe(t=>{console.log(t),this.getIDB(this.db)})}onCompleteAll(t){const n=t;delete n.__v;for(let i=0;i<n.DonMua.length;i++)n.DonMua[i].DaLam=!0;console.log(n),this.plus.httpPut(this.api,n).subscribe(t=>{console.log(t),this.plus.IDB_DB_Add(this.db,this.api,n),this.getIDB(this.db)})}reload(){this.plus.reload("ban-hang/pha-che")}checkPer(t){return this.plus.checkPer(this.api,t)}}return t.\u0275fac=function(n){return new(n||t)(g.Y36(l.T),g.Y36(d.qu))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-pha-che"]],decls:4,vars:2,consts:[[1,"container"],["class","text-center text-primary",4,"ngIf"],[1,"card-group"],[4,"ngFor","ngForOf"],[1,"text-center","text-primary"],[1,"card","text-center","mx-3","mb-3"],[1,"card-title","bg-success"],["class","card-body text-left",4,"ngFor","ngForOf"],["mat-raised-button","","color","accent",3,"click"],[1,"card-body","text-left"],[1,"font-blue"],[1,"text-danger","mx-3"],[1,"font-red","font-note"],[1,"mx-3"],["hidden","","mat-raised-button","","color","accent",3,"click",4,"ngIf"],["hidden","","mat-raised-button","","color","accent",3,"click"]],template:function(t,n){1&t&&(g.TgZ(0,"div",0),g.YNc(1,_,2,0,"h4",1),g.TgZ(2,"div",2),g.YNc(3,B,8,2,"div",3),g.qZA(),g.qZA()),2&t&&(g.xp6(1),g.Q6J("ngIf",0==n.items.length),g.xp6(2),g.Q6J("ngForOf",n.items))},directives:[c.O5,c.sg,f.lW,D.Hw],pipes:[q.dw],styles:[".card[_ngcontent-%COMP%], .card-title[_ngcontent-%COMP%]{border-radius:1rem}"],data:{animation:[r.Y]}}),t})();var N=i(43605),k=i(55109),M=i(66283),U=i(26756);function w(t,n){if(1&t&&(g.TgZ(0,"button",32),g._uU(1),g.qZA()),2&t){const t=g.oxw();g.xp6(1),g.hij("B\xe0n hi\u1ec7n t\u1ea1i: ",t.BanDuocChon.TenBan,"")}}function I(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"div"),g.TgZ(1,"button",33),g.NdJ("click",function(){return g.CHM(t),g.oxw().LuuTam()}),g._uU(2),g.qZA(),g.TgZ(3,"button",33),g.NdJ("click",function(){return g.CHM(t),g.oxw().LuuCho()}),g._uU(4,"L\u01b0u"),g.qZA(),g.TgZ(5,"button",34),g.NdJ("click",function(){return g.CHM(t),g.oxw().thanhToan()}),g._uU(6),g.ALo(7,"commas"),g.qZA(),g.qZA()}if(2&t){const t=g.oxw();g.xp6(2),g.Oqu(t.xemMon?"Th\xeam ghi ch\xfa":"Ch\u1ecdn th\xeam m\xf3n"),g.xp6(4),g.AsE("",t.total," m\xf3n: ",g.lcZ(7,3,t.ThanhTien),"")}}function H(t,n){if(1&t&&(g.TgZ(0,"button",47),g._uU(1),g.ALo(2,"commas"),g.qZA()),2&t){const t=g.oxw(2).$implicit;g.xp6(1),g.Oqu(g.lcZ(2,1,t.ThanhTien))}}function J(t,n){if(1&t&&(g.TgZ(0,"span",48),g._uU(1),g.ALo(2,"fromNow"),g.qZA()),2&t){const t=g.oxw(2).$implicit;g.xp6(1),g.hij(" ",g.lcZ(2,1,t.GioVao),"")}}const O=function(t){return{"border border-danger":t}};function F(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"div",42),g.NdJ("click",function(){g.CHM(t);const n=g.oxw().index;return g.oxw(3).chonBan(n)}),g.TgZ(1,"h4",43),g._uU(2),g.qZA(),g.YNc(3,H,3,3,"button",44),g.YNc(4,J,3,3,"span",45),g._UZ(5,"div",46),g.qZA()}if(2&t){const t=g.oxw().$implicit;g.Q6J("ngClass",g.VKq(4,O,t.ThanhTien>0)),g.xp6(2),g.Oqu(t.TenBan),g.xp6(1),g.Q6J("ngIf",t.ThanhTien>0),g.xp6(1),g.Q6J("ngIf",t.GioVao>0)}}function L(t,n){if(1&t&&(g.TgZ(0,"div",40),g.YNc(1,F,6,6,"div",41),g.qZA()),2&t){const t=n.$implicit,i=g.oxw().$implicit;g.xp6(1),g.Q6J("ngIf",t.NhomBan==i.NoiDung)}}function G(t,n){if(1&t&&(g.TgZ(0,"mat-tab",38),g.TgZ(1,"div",27),g.YNc(2,L,2,1,"div",39),g.qZA(),g.qZA()),2&t){const t=n.$implicit,i=g.oxw(2);g.s9C("label",t.NoiDung),g.xp6(2),g.Q6J("ngForOf",i.ChiaBan)}}function Q(t,n){if(1&t&&(g.TgZ(0,"div",35),g.TgZ(1,"mat-tab-group",36),g.YNc(2,G,3,2,"mat-tab",37),g.qZA(),g.qZA()),2&t){const t=g.oxw();g.xp6(1),g.Q6J("@slideIn",void 0),g.xp6(1),g.Q6J("ngForOf",t.TabBan)}}function P(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"div",55),g.NdJ("click",function(){const n=g.CHM(t).$implicit;return g.oxw(4).addNewItem(n)}),g.TgZ(1,"div",56),g.TgZ(2,"h4",57),g._uU(3),g.qZA(),g.qZA(),g.qZA()}if(2&t){const t=n.$implicit;g.xp6(1),g.Udp("border-bottom-color",t.MauSac),g.xp6(2),g.hij("",t.TenHangHoa," ")}}function Y(t,n){if(1&t&&(g.TgZ(0,"mat-tab",38),g.TgZ(1,"div",53),g.YNc(2,P,4,3,"div",54),g.ALo(3,"filterByKV"),g.qZA(),g.qZA()),2&t){const t=n.$implicit,i=g.oxw(3);g.s9C("label",t.NoiDung),g.xp6(1),g.Q6J("@slideX",void 0),g.xp6(1),g.Q6J("ngForOf",g.Dn7(3,3,i.items,"NhomHang",t.NoiDung))}}function V(t,n){if(1&t&&(g.TgZ(0,"div",52),g.TgZ(1,"mat-tab-group",36),g.YNc(2,Y,4,7,"mat-tab",37),g.qZA(),g.qZA()),2&t){const t=g.oxw(2);g.xp6(1),g.Q6J("@slideIn",void 0),g.xp6(1),g.Q6J("ngForOf",t.NhomHang)}}function E(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"span",73),g.NdJ("click",function(){g.CHM(t);const n=g.oxw().index;return g.oxw(3).delItem(n)}),g._UZ(1,"i",74),g.qZA()}}function K(t,n){if(1&t&&(g.TgZ(0,"i",75),g._uU(1),g.qZA()),2&t){const t=g.oxw().$implicit;g.xp6(1),g.Oqu(t.GhiChu.length>30?t.GhiChu.slice(0,25)+"...":t.GhiChu)}}function j(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"i",76),g.NdJ("click",function(){g.CHM(t);const n=g.oxw().index;return g.oxw(3).openModal(n)}),g.qZA()}}function S(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"mat-icon",77),g.NdJ("click",function(){g.CHM(t);const n=g.oxw().index;return g.oxw(3).removeItem(n)}),g._uU(1,"arrow_left"),g.qZA()}}function $(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"mat-icon",78),g.NdJ("click",function(){g.CHM(t);const n=g.oxw(),i=n.$implicit,o=n.index;return g.oxw(3).addItem(i,o)}),g._uU(1,"arrow_right"),g.qZA()}}function W(t,n){if(1&t&&(g.TgZ(0,"tr",59),g.TgZ(1,"td",60),g._uU(2),g.YNc(3,E,2,0,"span",63),g.qZA(),g.TgZ(4,"td",64),g.TgZ(5,"b",65),g._uU(6),g.qZA(),g._UZ(7,"br"),g._uU(8),g.ALo(9,"commas"),g.YNc(10,K,2,1,"i",66),g.YNc(11,j,1,0,"i",67),g.qZA(),g.TgZ(12,"td",68),g.TgZ(13,"mat-form-field"),g.YNc(14,S,2,0,"mat-icon",69),g._UZ(15,"input",70),g.ALo(16,"number"),g.YNc(17,$,2,0,"mat-icon",71),g.qZA(),g.qZA(),g.TgZ(18,"td",72),g._uU(19),g.ALo(20,"commas"),g.qZA(),g.qZA()),2&t){const t=n.$implicit,i=n.index;g.xp6(2),g.hij("",i+1," "),g.xp6(1),g.Q6J("ngIf",0==t.DaLam),g.xp6(3),g.hij(" ",t.TenHangHoa,""),g.xp6(2),g.AsE(" ",g.lcZ(9,11,1e3*t.GiaBan)," ",t.KhuyenMai>0?"(Gi\u1ea3m "+t.KhuyenMai+"%)":""," "),g.xp6(2),g.Q6J("ngIf",0==t.DaLam),g.xp6(1),g.Q6J("ngIf",0==t.DaLam),g.xp6(3),g.Q6J("ngIf",0==t.DaLam),g.xp6(1),g.s9C("value",g.lcZ(16,13,t.TongCong)),g.xp6(2),g.Q6J("ngIf",0==t.DaLam),g.xp6(2),g.Oqu(g.lcZ(20,15,t.TongCong*(t.GiaBan-t.GiaBan*t.KhuyenMai/100)*1e3))}}function X(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"div",1),g.TgZ(1,"table",58),g.TgZ(2,"thead",18),g.TgZ(3,"tr",59),g.TgZ(4,"th"),g._uU(5,"TT "),g.qZA(),g.TgZ(6,"th"),g._uU(7,"H\u1ea1ng m\u1ee5c"),g.qZA(),g.TgZ(8,"th",60),g._uU(9,"S\u1ed1 l\u01b0\u1ee3ng"),g.qZA(),g._UZ(10,"th"),g.qZA(),g.qZA(),g.TgZ(11,"tbody"),g.YNc(12,W,21,17,"tr",61),g.TgZ(13,"tr",35),g.TgZ(14,"td",62),g.TgZ(15,"h5"),g._uU(16),g.ALo(17,"commas"),g.qZA(),g.TgZ(18,"h6"),g.TgZ(19,"i"),g._uU(20),g.ALo(21,"titlecase"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(22,"td"),g.TgZ(23,"button",34),g.NdJ("click",function(){return g.CHM(t),g.oxw(2).thanhToan()}),g._uU(24),g.ALo(25,"commas"),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.qZA()}if(2&t){const t=g.oxw(2);g.xp6(12),g.Q6J("ngForOf",t.BanDuocChon.DonMua),g.xp6(4),g.AsE("T\u1ed5ng c\u1ed9ng: ",g.lcZ(17,5,t.ThanhTien)," / ",t.total," m\xf3n"),g.xp6(4),g.Oqu(g.lcZ(21,7,t.bangchu)),g.xp6(4),g.hij("Thanh to\xe1n ",g.lcZ(25,9,t.ThanhTien),"")}}function R(t,n){if(1&t&&(g.TgZ(0,"div",49),g.YNc(1,V,3,2,"div",50),g.YNc(2,X,26,11,"div",51),g.qZA()),2&t){const t=g.oxw();g.xp6(1),g.Q6J("ngIf",t.xemMon),g.xp6(1),g.Q6J("ngIf",!t.xemMon)}}function z(t,n){if(1&t&&(g.TgZ(0,"tr"),g.TgZ(1,"td"),g._uU(2),g.qZA(),g.TgZ(3,"td"),g._uU(4),g._UZ(5,"br"),g._uU(6),g.ALo(7,"commas"),g.qZA(),g.TgZ(8,"td",35),g._uU(9),g.qZA(),g.TgZ(10,"td",81),g._uU(11),g.ALo(12,"commas"),g.qZA(),g.qZA()),2&t){const t=n.$implicit,i=n.index;g.xp6(2),g.hij("",i+1," "),g.xp6(2),g.hij(" ",t.TenHangHoa," "),g.xp6(2),g.AsE(" ",g.lcZ(7,6,1e3*t.GiaBan)," ",t.KhuyenMai>0?"(Gi\u1ea3m "+t.KhuyenMai+"%)":""," "),g.xp6(3),g.Oqu(t.TongCong),g.xp6(2),g.Oqu(g.lcZ(12,8,t.TongCong*(t.GiaBan-t.GiaBan*t.KhuyenMai/100)*1e3))}}function tt(t,n){if(1&t&&(g.TgZ(0,"tbody"),g.YNc(1,z,13,10,"tr",28),g.TgZ(2,"tr"),g.TgZ(3,"td",79),g.TgZ(4,"h5"),g._uU(5,"T\u1ed5ng c\u1ed9ng:"),g.qZA(),g.qZA(),g.TgZ(6,"td"),g.TgZ(7,"h5"),g._uU(8),g.qZA(),g.qZA(),g.TgZ(9,"td",35),g.TgZ(10,"h5"),g._uU(11),g.ALo(12,"commas"),g.qZA(),g.TgZ(13,"h6"),g.TgZ(14,"i"),g._uU(15),g.ALo(16,"titlecase"),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.TgZ(17,"td",80),g.TgZ(18,"h6"),g._uU(19,"Xin c\u1ea3m \u01a1n qu\xfd kh\xe1ch"),g.qZA(),g.TgZ(20,"h6"),g._uU(21,"S\u1ea3n ph\u1ea9m c\u1ee7a 4la.vn"),g.qZA(),g.qZA(),g.qZA()),2&t){const t=g.oxw();g.xp6(1),g.Q6J("ngForOf",t.BanDuocChon.DonMua),g.xp6(7),g.hij("",t.total," m\xf3n"),g.xp6(3),g.hij(" ",g.lcZ(12,4,t.ThanhTien),""),g.xp6(4),g.Oqu(g.lcZ(16,6,t.bangchu))}}function nt(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"div"),g.TgZ(1,"span",82),g.NdJ("click",function(){const n=g.CHM(t).$implicit;return g.oxw().note.push(n.NoiDung)}),g._uU(2),g.qZA(),g.qZA()}if(2&t){const t=n.$implicit;g.xp6(2),g.Oqu(t.NoiDung)}}function it(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"div"),g.TgZ(1,"span",83),g.NdJ("click",function(){const n=g.CHM(t).$implicit;return g.oxw().note.push(n.NoiDung)}),g._uU(2),g.qZA(),g.qZA()}if(2&t){const t=n.$implicit;g.xp6(2),g.Oqu(t.NoiDung)}}let ot=(()=>{class t{constructor(t,n,i){this.plus=t,this.route=n,this.fb=i,this.db=null,this.title="H\xe0ng h\xf3a",this.dbName="ban-hang",this.api="nhan-don",this.tabs=[],this.items=[],this.DonMua=[],this.total=0,this.ThanhTien=0,this.donHang=[],this.bangchu="",this.filter=[],this.note=[],this.user=this.plus.user.getValue(),this.printTime=Date.now(),this.NhomHang=this.plus.user.getValue().NhomHang,this.TabBan=this.plus.sortArr(this.plus.user.getValue().NhomBan,"ThuTu",1),this.ChiaBan=[],this.ban=0,this.now=Date.now(),this.xemBan=!0,this.xemMon=!1,this.donHangFB=this.fb.group({TenBan:[,[d.kI.required]],NhomBan:[,[d.kI.required]],ThanhTien:[,[d.kI.required]],LoiNhuan:[,[d.kI.required]],SoKH:[,[d.kI.required]],GioVao:[,[d.kI.required]],DaThanhToan:[,[d.kI.required]],DonMua:this.fb.array([this.fb.group({idHangHoa:[,[d.kI.required]],DVT:[,[d.kI.required]],GiaBan:[,[d.kI.required]],GiaVon:[,[d.kI.required]],KhuyenMai:[,[d.kI.required]],TenHangHoa:[,[d.kI.required]],TongCong:[,[d.kI.required]],DaLam:[,[]],GioVao:[,[d.kI.required]],GhiChu:[]})])})}ngOnDestroy(){if(console.log("Destroy nhan-don"),console.log(this.BanDuocChon),this.note.length>0&&confirm("Ban c\xf3 mu\u1ed1n l\u01b0u ghi ch\xfa?"))return this.LuuCho();this.plus.subs.unsubscribe()}ngOnInit(){this.chiaBan(),this.plus.setTiTle(this.title),this.plus.IDB_InitDB(this.dbName).subscribe(t=>{this.db=t,this.getHangHoa(),this.plus.updateUserLocal(t,this.api),this.getDonHangLocal(),this.plus.updateAPi.subscribe(t=>{console.log("updateAPi",t),this.chiaBan(),this.getDonHangLocal()})}),this.DonMua=[]}thanhToan(){const t=confirm("B\u1ea1n c\xf3 mu\u1ed1n in h\xf3a \u0111\u01a1n ko?"),n=this.BanDuocChon;if(delete n.__v,n.DaThanhToan=!0,0==n.ThanhTien&&(this.BanDuocChon=Object.assign(this.BanDuocChon,{DonMua:this.DonMua.map(t=>({idHangHoa:t._id,TenHangHoa:t.TenHangHoa,GiaBan:t.GiaBan,GiaVon:t.GiaVon,KhuyenMai:t.KhuyenMai,DVT:t.DVT,TongCong:t.TongCong,DaLam:t.DaLam})),LoiNhuan:this.DonMua.map(t=>t.GiaBan-t.GiaVon-t.GiaBan*t.KhuyenMai/100).reduce((t,n)=>t+n),ThanhTien:this.ThanhTien,GioVao:Date.now(),SoKH:this.total,DaThanhToan:!0}),this.donHangFB.patchValue(this.BanDuocChon),this.donHangFB.invalid)){const t=this.plus.getErrValidateForm(this.donHangFB);console.log(t)}void 0!==n._id?(delete n.__v,this.plus.httpPut("nhan-don",n).subscribe(t=>{this.back(),this.plus.IDB_DB_Add(this.db,this.api,n)})):this.plus.httpPost("nhan-don",n).subscribe(t=>{this.back()}),t?(this.PrintDiv("HoaDon"),console.log(0,n)):console.log(1,n)}getDonHangLocal(){this.plus.subs.add(this.plus.IDB_DB_GetAll(this.db,this.api,"TenBan",1).pipe((0,N.map)(t=>t?t.filter(t=>0==t.DaThanhToan):[])).subscribe(t=>{null==t&&(t=[]),this.donHang=t,this.ChiaBan=t.concat(this.ChiaBan.filter(({TenBan:n})=>!t.find(t=>t.TenBan==n))),this.ChiaBan=this.plus.sortArr(this.ChiaBan,"TenBan",1)}))}LuuTam(){this.xemMon=!this.xemMon,this.ChiaBan[this.ban]=Object.assign(this.ChiaBan[this.ban],{DonMua:this.DonMua.map(t=>({idHangHoa:t._id,TenHangHoa:t.TenHangHoa,GiaBan:t.GiaBan,GiaVon:t.GiaVon,KhuyenMai:t.KhuyenMai,DVT:t.DVT,TongCong:t.TongCong,DaLam:t.DaLam,GioVao:t.GioVao,GhiChu:t.GhiChu})),LoiNhuan:this.DonMua.map(t=>t.GiaBan-t.GiaVon-t.GiaBan*t.KhuyenMai/100).reduce((t,n)=>t+n),ThanhTien:this.ThanhTien,GioVao:Date.now(),SoKH:this.total,DaThanhToan:!1})}LuuCho(){this.LuuTam(),this.xemMon=!1,this.xemBan=!0,this.total=0,this.DonMua=[];const t=this.ChiaBan[this.ban];if(this.donHangFB.patchValue(t),this.donHangFB.valid)console.log(t._id),void 0!==t._id?(delete t.__v,this.plus.httpPut("nhan-don",t).subscribe(t=>{console.log(t)})):this.plus.httpPost("nhan-don",t).subscribe(t=>{console.log(t)});else{const t=this.plus.getErrValidateForm(this.donHangFB);console.log(t)}}chiaBan(){this.plus.load(),this.ChiaBan=[],this.TabBan.forEach(t=>{this.ChiaBan.push({TenBan:t.NoiDung+"- Mang v\u1ec1",NhomBan:t.NoiDung,DonMua:[],ThanhTien:0,GioVao:0,SoKH:0,DaThanhToan:!1});for(let n=1;n<t.SoLuong+1;n++)this.ChiaBan.push({TenBan:t.NoiDung+"-"+n,NhomBan:t.NoiDung,DonMua:[],ThanhTien:0,GioVao:0,SoKH:0,DaThanhToan:!1})}),this.plus.loaded()}chonBan(t){this.BanDuocChon=this.ChiaBan[t],console.log(this.BanDuocChon),this.bangchu=this.plus.numToVi(this.BanDuocChon.ThanhTien),this.xemBan=!1,this.ban=t;const n=this.ChiaBan[t];console.log(n),n.ThanhTien>0?(this.DonMua=n.DonMua,this.xemMon=!1):this.xemMon=!0,this.getTongCong()}getHangHoa(){this.plus.subs.add(this.plus.IDB_DB_GetAll(this.db,"hang-hoa").subscribe(t=>{try{this.items=t}catch(n){this.items=[],this.plus.alertWarning("B\u1ea1n ch\u01b0a c\xf3 h\xe0ng h\xf3a trong kho!!!")}0==t.length&&this.plus.alertWarning("B\u1ea1n ch\u01b0a c\xf3 h\xe0ng h\xf3a trong kho!"),console.log("getHangHoa: "+t.length)}))}addNewItem(t){const n=this.DonMua.find(n=>n._id==t._id);if(window.navigator.vibrate(200),!n)return t.TongCong=1,t.GioVao=Date.now(),t.DaLam=!1,t.GhiChu=this.note.join(" "),this.DonMua.push(t),this.getTongCong();{const t=this.DonMua.findIndex(t=>t._id==n._id);this.DonMua[t].TongCong+=1}this.getTongCong()}removeItem(t){this.BanDuocChon.DonMua[t].TongCong>0&&(this.BanDuocChon.DonMua[t].TongCong-=1),this.getTongCong()}addItem(t,n){this.BanDuocChon.DonMua[n].TongCong+=1,this.getTongCong()}delItem(t){this.BanDuocChon.DonMua.splice(t,1),this.getTongCong()}getTongCong(){this.total=this.plus.sumByKey(this.DonMua,"TongCong"),this.getThanhTien()}getThanhTien(){let t=0;return this.DonMua.forEach(n=>{t+=(n.GiaBan-n.GiaBan*n.KhuyenMai/100)*n.TongCong*1e3}),this.ThanhTien=t}openModal(t){this.plus.clickBtn("ghichubtn"),this.indexDonMua=t}addNote(){this.BanDuocChon.DonMua[this.indexDonMua].GhiChu=this.note.join(", "),this.note=[]}updateList(t,n,i){const o=+i.target.textContent;if(console.log(o),"Enter"===i.key&&i.preventDefault(),"number"!=typeof o)return this.plus.alertError("Sai \u0111\u1ecbnh d\u1ea1ng"),this.DonMua[t][n]=0;this.DonMua[t][n]=+o,this.getTongCong()}PrintDiv(t){let n=window.document.getElementById(t);var i=window.open("","PRINT");i.document.write(document.documentElement.innerHTML),setTimeout(()=>{i.document.body.innerHTML=n.outerHTML,i.document.close(),i.focus(),i.print(),i.close()},1e3)}back(){this.plus.reload("ban-hang/nhan-don")}}return t.\u0275fac=function(n){return new(n||t)(g.Y36(l.T),g.Y36(p.gz),g.Y36(d.qu))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-nhan-don"]],decls:65,vars:18,consts:[[1,"row","text-center","inline"],[1,"col"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","warn","class","float-rigth",4,"ngIf"],[4,"ngIf"],["class","text-center",4,"ngIf"],["class","row",4,"ngIf"],["id","modelId","tabindex","-1","role","dialog","aria-labelledby","modelTitleId","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-body","hoadon"],["id","HoaDon",1,"div"],[1,"text-left"],[1,"table","table-hover"],[1,"thead-inverse"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary"],["id","ghichubtn","mat-raised-button","","color","accent","data-toggle","modal","data-target","#notes",1,"d-none"],["id","notes","tabindex","-1","role","dialog","aria-labelledby","modelTitleId","aria-hidden","true",1,"modal","fade"],["notes",""],["role","document",1,"modal-dialog","modal-sm"],[1,"modal-body"],[1,"card-group"],[4,"ngFor","ngForOf"],["type","text","placeholder","Ghi ch\xfa kh\xe1c",1,"form-control",3,"blur"],["ghichuKhac",""],["type","button","data-dismiss","modal",1,"btn","btn-primary",3,"click"],["mat-raised-button","","color","warn",1,"float-rigth"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","warn",3,"click"],[1,"text-center"],["dynamicHeight",""],[3,"label",4,"ngFor","ngForOf"],[3,"label"],["class","div",4,"ngFor","ngForOf"],[1,"div"],["class","card hangHoa",3,"ngClass","click",4,"ngIf"],[1,"card","hangHoa",3,"ngClass","click"],[1,"text-center","pt-3"],["class","badge badge-warning",4,"ngIf"],["class","badge badge-light",4,"ngIf"],[1,"card-body","py-3","px-2"],[1,"badge","badge-warning"],[1,"badge","badge-light"],[1,"row"],["class","list",4,"ngIf"],["class","col",4,"ngIf"],[1,"list"],["id","item",1,"card-group"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[1,"card","hangHoa"],[1,"text-center","py-3"],["id","myDiv",1,"table","table-hover"],[1,"d-flex"],[1,"col-1"],["class","d-flex",4,"ngFor","ngForOf"],["colspan","3"],["class","badge badge-danger mx-2 ",3,"click",4,"ngIf"],[1,"col-6"],[1,"font-blue"],["class"," font-note",4,"ngIf"],["class","fa fa-pencil text-success",3,"click",4,"ngIf"],[1,"col-2"],["matPrefix","",3,"click",4,"ngIf"],["readonly","","required","","type","text","autocomplete","off","matInput","",2,"text-align","center",3,"value"],["matSuffix","",3,"click",4,"ngIf"],[1,"col-3"],[1,"badge","badge-danger","mx-2",3,"click"],["aria-hidden","true",1,"fa","fa-trash"],[1,"font-note"],[1,"fa","fa-pencil","text-success",3,"click"],["matPrefix","",3,"click"],["matSuffix","",3,"click"],["colspan","2",1,"text-center"],["colspan","4",1,"text-center"],[1,"text-rigth"],[1,"badge","badge-primary","py-2","mx-2","my-2",3,"click"],[1,"badge","badge-warning","py-2","mx-2","my-2",3,"click"]],template:function(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"div",0),g.TgZ(1,"div",1),g.TgZ(2,"button",2),g.NdJ("click",function(){return n.back()}),g._uU(3,"Ch\u1ecdn b\xe0n"),g.qZA(),g.YNc(4,w,2,1,"button",3),g.qZA(),g.TgZ(5,"div",1),g.YNc(6,I,8,5,"div",4),g.qZA(),g.qZA(),g.YNc(7,Q,3,2,"div",5),g.YNc(8,R,3,2,"div",6),g.TgZ(9,"div",7),g.TgZ(10,"div",8),g.TgZ(11,"div",9),g.TgZ(12,"div",10),g.TgZ(13,"h5",11),g._uU(14,"Modal title"),g.qZA(),g.TgZ(15,"button",12),g.TgZ(16,"span",13),g._uU(17,"\xd7"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(18,"div",14),g.TgZ(19,"div",15),g.TgZ(20,"div",16),g.TgZ(21,"h6"),g._uU(22),g.qZA(),g.TgZ(23,"h6"),g._uU(24),g.qZA(),g.TgZ(25,"h6"),g._uU(26),g.ALo(27,"date"),g.qZA(),g.qZA(),g.TgZ(28,"table",17),g.TgZ(29,"thead",18),g.TgZ(30,"tr"),g.TgZ(31,"th"),g._uU(32,"TT"),g.qZA(),g.TgZ(33,"th"),g._uU(34,"H\u1ea1ng m\u1ee5c"),g.qZA(),g.TgZ(35,"th"),g._uU(36,"S\u1ed1 l\u01b0\u1ee3ng"),g.qZA(),g.TgZ(37,"th"),g._uU(38,"Th\xe0nh ti\u1ec1n"),g.qZA(),g.qZA(),g.qZA(),g.YNc(39,tt,22,8,"tbody",4),g.qZA(),g.qZA(),g.qZA(),g.TgZ(40,"div",19),g.TgZ(41,"button",20),g._uU(42,"Close"),g.qZA(),g.TgZ(43,"button",21),g._uU(44,"Save"),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g._UZ(45,"button",22),g.TgZ(46,"div",23,24),g.TgZ(48,"div",25),g.TgZ(49,"div",9),g.TgZ(50,"div",10),g.TgZ(51,"h6",11),g._uU(52,"Ghi ch\xfa"),g.qZA(),g.qZA(),g.TgZ(53,"div",26),g._uU(54),g.TgZ(55,"div",27),g.YNc(56,nt,3,1,"div",28),g.ALo(57,"catalog"),g.YNc(58,it,3,1,"div",28),g.ALo(59,"catalog"),g.qZA(),g.qZA(),g.TgZ(60,"input",29,30),g.NdJ("blur",function(){g.CHM(t);const i=g.MAs(61);return n.note.push(i.value)}),g.qZA(),g.TgZ(62,"div",19),g.TgZ(63,"button",31),g.NdJ("click",function(){return n.addNote()}),g._uU(64," Ok "),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.qZA()}2&t&&(g.xp6(4),g.Q6J("ngIf",n.BanDuocChon),g.xp6(2),g.Q6J("ngIf",n.total>0),g.xp6(1),g.Q6J("ngIf",n.xemBan),g.xp6(1),g.Q6J("ngIf",!n.xemBan),g.xp6(14),g.Oqu(n.user.title),g.xp6(2),g.Oqu(n.user.phoneNumber),g.xp6(2),g.hij("Gi\u1edd in: ",g.xi3(27,11,n.printTime,"HH:MM dd/MM/yyyy"),""),g.xp6(13),g.Q6J("ngIf",n.BanDuocChon),g.xp6(15),g.hij(" ",n.note.join(", ")," "),g.xp6(2),g.Q6J("ngForOf",g.lcZ(57,14,"SoLy")),g.xp6(2),g.Q6J("ngForOf",g.lcZ(59,16,"GhiChuMon")))},directives:[f.lW,c.O5,c.sg,k.SP,k.uX,c.mk,M.KE,U.Nt,D.Hw,M.qo,M.R9],pipes:[c.uU,q.pW,q.W,q.dw,q.H$,c.rS,c.JJ],styles:[".hangHoa[_ngcontent-%COMP%]{height:10rem;width:10rem;border-radius:1rem;margin:.2rem;border-bottom-width:3rem;border-color:#90ee90;color:blue;float:left;display:flex;align-items:center;justify-content:center}@media print,screen{.container[_ngcontent-%COMP%]{background-color:#999;position:relative;border:1px solid #000;width:500px;height:500px}}@media screen{.hideForPrint[_ngcontent-%COMP%]{position:absolute;width:100px;height:200px;top:100px;left:50px;border:5px dashed #ccc;z-index:98;background-color:#fff}}@media print{.hideForPrint[_ngcontent-%COMP%], .hideForPrint2[_ngcontent-%COMP%], .noPrint[_ngcontent-%COMP%]{display:none}}.hangHoa[_ngcontent-%COMP%]:active{transform:scale(1.1);opacity:50%;background-color:tomato}.hoadon[_ngcontent-%COMP%]{width:200px}mat-icon[_ngcontent-%COMP%]{transform:scale(2);color:tomato}mat-icon[_ngcontent-%COMP%]:active{transform:scale(2.2);color:red}"],data:{animation:[r.Y,r.M]}}),t})();var et=i(47701),at=i(89274),st=i(69121),ht=i(39012),ct=i(78477);function rt(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"div",16),g.TgZ(1,"div",3),g.TgZ(2,"button",17),g.NdJ("click",function(){g.CHM(t);const n=g.oxw();return n.showInput=!n.showInput}),g._UZ(3,"i",18),g.qZA(),g.qZA(),g.qZA()}}function ut(t,n){if(1&t&&(g.TgZ(0,"option",38),g._uU(1),g.qZA()),2&t){const t=n.$implicit;g.s9C("value",t.NoiDung),g.xp6(1),g.Oqu(t.NoiDung)}}function lt(t,n){if(1&t&&(g.TgZ(0,"option",38),g._uU(1),g.qZA()),2&t){const t=n.$implicit;g.s9C("value",t.NoiDung),g.xp6(1),g.hij("",t.NoiDung," ")}}function gt(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"button",39),g.NdJ("click",function(){return g.CHM(t),g.oxw(2).save()}),g._uU(1,"L\u01b0u"),g.qZA()}}function dt(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"div",2),g.TgZ(1,"form",6),g.TgZ(2,"div",2),g.TgZ(3,"div",3),g.TgZ(4,"div",19),g.TgZ(5,"div",20),g.TgZ(6,"span",21),g._uU(7,"Nh\xf3m"),g.qZA(),g.qZA(),g.TgZ(8,"select",22),g.YNc(9,ut,2,2,"option",23),g.qZA(),g.qZA(),g.TgZ(10,"div",19),g.TgZ(11,"div",20),g.TgZ(12,"span",21),g._uU(13,"T\xean"),g.qZA(),g.qZA(),g._UZ(14,"input",24),g.qZA(),g.TgZ(15,"div",19),g.TgZ(16,"div",20),g.TgZ(17,"span",21),g._uU(18,"Gi\xe1 v\u1ed1n"),g.qZA(),g.qZA(),g._UZ(19,"input",25),g.TgZ(20,"div",26),g.TgZ(21,"span",21),g._uU(22,"000"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(23,"div",19),g.TgZ(24,"div",20),g.TgZ(25,"span",21),g._uU(26,"Gi\xe1n B\xe1n"),g.qZA(),g.qZA(),g._UZ(27,"input",27),g.TgZ(28,"div",26),g.TgZ(29,"span",21),g._uU(30,"000"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(31,"div",19),g.TgZ(32,"div",20),g.TgZ(33,"span",21),g._uU(34,"\u0110\u01a1n v\u1ecb t\xednh"),g.qZA(),g.qZA(),g.TgZ(35,"select",28),g.YNc(36,lt,2,2,"option",23),g.ALo(37,"catalog"),g.qZA(),g.qZA(),g.TgZ(38,"app-barcode-scanner",29),g.NdJ("barcodeResult",function(n){return g.CHM(t),g.oxw().getBarcode(n)}),g.qZA(),g.qZA(),g.TgZ(39,"div",3),g.TgZ(40,"div",19),g.TgZ(41,"div",20),g.TgZ(42,"span",21),g._uU(43,"T\u1ed3n kho"),g.qZA(),g.qZA(),g._UZ(44,"input",30),g.qZA(),g.TgZ(45,"div",19),g.TgZ(46,"div",20),g.TgZ(47,"span",21),g._uU(48,"Khuy\u1ebfn m\xe3i"),g.qZA(),g.qZA(),g._UZ(49,"input",31),g.TgZ(50,"div",26),g.TgZ(51,"span",21),g._uU(52,"%"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(53,"div",19),g.TgZ(54,"div",20),g.TgZ(55,"span",21),g._uU(56,"Quy \u0111\u1ed5i \u0111\u01a1n v\u1ecb"),g.qZA(),g.qZA(),g._UZ(57,"input",32),g.qZA(),g.TgZ(58,"div",19),g.TgZ(59,"div",20),g.TgZ(60,"span",21),g._uU(61,"M\xe0u s\u1eafc"),g.qZA(),g.qZA(),g._UZ(62,"input",33),g.qZA(),g.TgZ(63,"div",19),g.TgZ(64,"div",20),g.TgZ(65,"span",21),g._uU(66,"M\xe3 v\u1ea1ch"),g.qZA(),g.qZA(),g._UZ(67,"input",34),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.TgZ(68,"div",35),g.YNc(69,gt,2,0,"button",36),g.TgZ(70,"button",37),g.NdJ("click",function(){return g.CHM(t),g.oxw().reload()}),g._uU(71,"H\u1ee7y"),g.qZA(),g.qZA(),g.qZA()}if(2&t){const t=g.oxw();g.xp6(1),g.Q6J("formGroup",t.main),g.xp6(8),g.Q6J("ngForOf",t.NhomHang),g.xp6(5),g.Q6J("readOnly",t.readonly),g.xp6(5),g.Q6J("readOnly",t.readonly),g.xp6(8),g.Q6J("readOnly",t.readonly),g.xp6(9),g.Q6J("ngForOf",g.lcZ(37,12,"DVT")),g.xp6(2),g.Q6J("patchCode",t.main.get("Barcode").value),g.xp6(6),g.Q6J("readOnly",t.readonly),g.xp6(5),g.Q6J("readOnly",t.readonly),g.xp6(8),g.Q6J("readOnly",t.readonly),g.xp6(5),g.Q6J("readOnly",t.readonly),g.xp6(7),g.Q6J("ngIf",t.checkPer(2)&&t.main.valid)}}function pt(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"i",44),g.NdJ("click",function(){g.CHM(t);const n=g.oxw().$implicit;return g.oxw().onEdit(n)}),g.qZA()}}function Zt(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"i",45),g.NdJ("click",function(){g.CHM(t);const n=g.oxw().$implicit;return g.oxw().onDelete(n)}),g.qZA()}}function mt(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"tr"),g.TgZ(1,"td"),g.TgZ(2,"a",40),g.NdJ("click",function(){const n=g.CHM(t).$implicit;return g.oxw().onEdit(n)}),g._uU(3),g.qZA(),g.qZA(),g.TgZ(4,"td"),g._uU(5),g.qZA(),g.TgZ(6,"td"),g._uU(7),g.ALo(8,"commas"),g.qZA(),g.TgZ(9,"td"),g._uU(10),g.qZA(),g.TgZ(11,"td",41),g.YNc(12,pt,1,0,"i",42),g.YNc(13,Zt,1,0,"i",43),g.qZA(),g.qZA()}if(2&t){const t=n.$implicit,i=g.oxw();g.Q6J("@slideIn",void 0),g.xp6(3),g.hij(" ",t.TenHangHoa,""),g.xp6(1),g.Udp("background-color",t.MauSac),g.xp6(1),g.Oqu(t.TonKho),g.xp6(2),g.Oqu(g.lcZ(8,9,1e3*t.GiaBan)),g.xp6(3),g.Oqu(t.KhuyenMai),g.xp6(2),g.Q6J("ngIf",i.checkPer(2)),g.xp6(1),g.Q6J("ngIf",i.checkPer(4))}}function Tt(t,n){if(1&t&&g._UZ(0,"app-import-database",46),2&t){const t=g.oxw();g.Q6J("dbName",t.dbName)("api",t.api)("form",t.main)}}const ft=function(t){return{"fa-spin":t}};let bt=(()=>{class t{constructor(t,n){this.plus=t,this.fb=n,this.searchForm=this.fb.group({input:[,[d.kI.minLength(3),d.kI.maxLength(50)]]}),this.main=this.fb.group({_id:[,[]],Barcode:[,[]],TenHangHoa:[,[d.kI.required]],NhomHang:[,[d.kI.required]],catalogId:[,],TonKho:[1e3,[d.kI.required]],DVT:[,[,]],GiaVon:[,[d.kI.required]],GiaBan:[,[d.kI.required]],KhuyenMai:[0,[]],QuyDoi:[1,[]],MauSac:[,[]]}),this.title="H\xe0ng h\xf3a",this.dbName="ban-hang",this.api="hang-hoa",this.db=null,this.items=[],this.readonly=!1,this.filter=[],this.importData=[],this.errorData=[],this.show=!1,this.showInput=!1,this.NhomHang=this.plus.user.getValue().NhomHang}ngOnDestroy(){console.log("destroy app-hang-hoa"),this.plus.subs.unsubscribe()}ngOnInit(){this.plus.setTiTle(this.title),this.plus.IDB_InitDB(this.dbName).subscribe(t=>{this.db=t,this.plus.updateUserLocal(t,this.api),this.plus.updateAPi.subscribe(t=>{this.getIDB()}),this.search()})}getIDB(){this.plus.subs.add(this.plus.IDB_DB_GetAll(this.db,this.api).subscribe(t=>{console.log(t.length),this.items=t}))}save(){let t=this.main.value;null!==t._id?this.plus.httpPut(this.api,t).subscribe(t=>{console.log(t)}):(delete t._id,this.plus.httpPost(this.api,t).subscribe(t=>{}))}onEdit(t){this.showInput=!0,this.items=[],this.plus.scrollTop(),this.main.patchValue(t),this.filter[0]=t}onDelete(t){confirm("B\u1ea1n mu\u1ed1n x\xf3a?")&&this.plus.httpDisable(this.api,t).then(t=>{})}search(){this.searchForm.valueChanges.pipe((0,et.b)(300)).subscribe(t=>{const n=this.plus.removeAccents(t.input);n.trim().length<2||this.plus.IDB_DB_Search(this.db,"hang-hoa",n).subscribe(t=>{this.filter=t})})}find(t){this.items=t}checkPer(t){return this.plus.checkPer(this.api,t)}getLink(t){console.log(t)}getBarcode(t){this.main.controls.Barcode.setValue(t)}reset(){this.plus.loaded(),this.filter=[],this.importData=[],this.errorData=[]}reload(){return this.plus.reload(this.dbName+"/"+this.api)}getById(){this.plus.httpGet(this.api+"/6071af9f7daf7e1218f8daf0").subscribe(t=>{const n=this.plus.Crypt_DecryptRest(t);console.log(n)})}}return t.\u0275fac=function(n){return new(n||t)(g.Y36(l.T),g.Y36(d.qu))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-hang-hoa"]],decls:30,vars:13,consts:[[1,"container"],[1,"text-center","text-white","py-2","my-3","bg-primary","rounded-pill","justify-content-center"],[1,"row"],[1,"col"],[3,"api","data"],[1,"col-5"],[1,"form-group",3,"formGroup"],["type","text","id","search-api","autocomplete","off","formControlName","input","placeholder","T\xecm ki\u1ebfm nhanh (F2)",1,"form-control"],["class","row float-right",4,"ngIf"],["class","row",4,"ngIf"],[1,"table","table-hover"],[1,"thead-inverse"],[1,"fa","fa-refresh","mx-2","text-info",3,"ngClass","click"],[4,"ngFor","ngForOf"],[3,"dbName","api","form",4,"ngIf"],[3,"dataJson"],[1,"row","float-right"],["mat-raised-button","","color","primary",1,"float-right",3,"click"],["aria-hidden","true",1,"fa","fa-plus"],[1,"input-group","mb-3"],[1,"input-group-prepend"],[1,"input-group-text"],["name","nhom","id","nhom","formControlName","NhomHang",1,"custom-select"],[3,"value",4,"ngFor","ngForOf"],["type","text","formControlName","TenHangHoa",1,"form-control",3,"readOnly"],["type","number","formControlName","GiaVon",1,"form-control",3,"readOnly"],[1,"input-group-append"],["type","number","formControlName","GiaBan",1,"form-control",3,"readOnly"],["formControlName","DVT",1,"custom-select"],[3,"patchCode","barcodeResult"],["type","number","formControlName","TonKho",1,"form-control",3,"readOnly"],["type","number","formControlName","KhuyenMai",1,"form-control",3,"readOnly"],["type","number","formControlName","QuyDoi",1,"form-control",3,"readOnly"],["type","color","formControlName","MauSac",1,"form-control",3,"readOnly"],["type","text","formControlName","Barcode",1,"form-control"],[1,"text-center","example-button-row"],["style","margin: 8px 8px 8px 0;","mat-raised-button","","color","warn",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",2,"margin","8px 8px 8px 0",3,"click"],[3,"value"],["mat-raised-button","","color","warn",2,"margin","8px 8px 8px 0",3,"click"],[3,"click"],[1,"text-center"],["class","fa fa-pencil text-success mx-3 fa-lg","aria-hidden","true",3,"click",4,"ngIf"],["class","fa fa-trash text-danger mx-3 fa-lg","aria-hidden","true",3,"click",4,"ngIf"],["aria-hidden","true",1,"fa","fa-pencil","text-success","mx-3","fa-lg",3,"click"],["aria-hidden","true",1,"fa","fa-trash","text-danger","mx-3","fa-lg",3,"click"],[3,"dbName","api","form"]],template:function(t,n){1&t&&(g.TgZ(0,"div",0),g.TgZ(1,"h5",1),g._uU(2),g.ALo(3,"uppercase"),g.qZA(),g.TgZ(4,"div",2),g.TgZ(5,"div",3),g.TgZ(6,"app-search-api",4),g.NdJ("data",function(t){return n.find(t)}),g.qZA(),g.qZA(),g.TgZ(7,"div",5),g.TgZ(8,"div",6),g._UZ(9,"input",7),g.qZA(),g.qZA(),g.YNc(10,rt,4,0,"div",8),g.qZA(),g.YNc(11,dt,72,14,"div",9),g.TgZ(12,"div",2),g.TgZ(13,"table",10),g.TgZ(14,"thead",11),g.TgZ(15,"tr"),g.TgZ(16,"th"),g._uU(17,"T\xean"),g.qZA(),g.TgZ(18,"th"),g._uU(19,"T\u1ed3n kho"),g.qZA(),g.TgZ(20,"th"),g._uU(21,"Gi\xe1n B\xe1n"),g.qZA(),g.TgZ(22,"th"),g._uU(23,"Khuy\u1ebfn m\xe3i"),g.qZA(),g.TgZ(24,"th"),g.TgZ(25,"i",12),g.NdJ("click",function(){return n.reload()}),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.TgZ(26,"tbody"),g.YNc(27,mt,14,11,"tr",13),g.qZA(),g.qZA(),g.qZA(),g.YNc(28,Tt,1,3,"app-import-database",14),g._UZ(29,"app-export-ecxel",15),g.qZA()),2&t&&(g.xp6(2),g.Oqu(g.lcZ(3,9,n.title)),g.xp6(4),g.Q6J("api",n.api),g.xp6(2),g.Q6J("formGroup",n.searchForm),g.xp6(2),g.Q6J("ngIf",!n.showInput),g.xp6(1),g.Q6J("ngIf",n.showInput),g.xp6(14),g.Q6J("ngClass",g.VKq(11,ft,n.show)),g.xp6(2),g.Q6J("ngForOf",n.filter.length>0?n.filter:n.items.slice(0,20)),g.xp6(1),g.Q6J("ngIf",n.checkPer(4)),g.xp6(1),g.Q6J("dataJson",n.items))},directives:[at.W,d.JL,d.sg,d.Fj,d.JJ,d.u,c.O5,c.mk,c.sg,st.t,f.lW,d._Y,d.EJ,d.wV,ht.O,d.YN,d.Kr,ct.y],pipes:[c.gd,q.pW,q.W],styles:[""],data:{animation:[r.Y,r.M]}}),t})();function At(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"div",2),g.TgZ(1,"button",3),g.NdJ("click",function(){return g.CHM(t),g.oxw().resetNhanDon()}),g._uU(2,"nhan-don"),g.qZA(),g.TgZ(3,"button",3),g.NdJ("click",function(){return g.CHM(t),g.oxw().resetHangHoa()}),g._uU(4,"hang-hoa"),g.qZA(),g.qZA()}}let qt=(()=>{class t{constructor(t){this.plus=t,this.db=null,this.dbName="ban-hang",this.isAdmin=this.plus.isAdmin()}ngOnInit(){this.plus.IDB_InitDB(this.dbName).subscribe(t=>{this.db=t})}resetNhanDon(){const t="nhan-don";confirm("Reset DB"+t)&&this.plus.httpDelete(t,"del").subscribe(n=>{console.log("Clear DB"),this.plus.FBS_PostByUser(t,0).then(n=>{console.log("Clear FBS"),console.log(n),this.plus.IDB_DB_ClearCollection(this.db,t).subscribe(t=>{console.log("Clear IDB")})})})}resetHangHoa(){const t="hang-hoa";confirm("Reset DB"+t)&&this.plus.httpDelete(t,"del").subscribe(n=>{console.log("Clear DB"),this.plus.FBS_PostByUser(t,0).then(n=>{console.log("Clear FBS"),console.log(n),this.plus.IDB_DB_ClearCollection(this.db,t).subscribe(t=>{console.log("Clear IDB")})})})}checkPer(t,n){return this.plus.checkPer(t,n)}onDetect(t){console.log(t)}}return t.\u0275fac=function(n){return new(n||t)(g.Y36(l.T))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-ban-hang"]],decls:2,vars:1,consts:[[1,"container"],["class","row",4,"ngIf"],[1,"row"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(t,n){1&t&&(g.TgZ(0,"div",0),g.YNc(1,At,5,0,"div",1),g.qZA()),2&t&&(g.xp6(1),g.Q6J("ngIf",n.checkPer("hang-hoa",7)))},directives:[c.O5],styles:[""]}),t})();var xt=i(40084),Dt=i(10033),_t=i(71522);function yt(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"mat-option",38),g.NdJ("click",function(){const n=g.CHM(t).$implicit;return g.oxw().addNewItem(n)})("keyup.enter",function(){const n=g.CHM(t).$implicit;return g.oxw().addNewItem(n)}),g.TgZ(1,"b"),g._uU(2),g.qZA(),g._uU(3),g.qZA()}if(2&t){const t=n.$implicit;g.xp6(2),g.hij(" ",t.TenHangHoa,""),g.xp6(1),g.AsE(" | ",t.GiaBan,"k/",t.DVT," ")}}function Ct(t,n){1&t&&(g.TgZ(0,"mat-option"),g._uU(1," Kh\xf4ng c\xf2n k\u1ebft qu\u1ea3 ph\xf9 h\u1ee3p! "),g.qZA())}function Bt(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"tr"),g.TgZ(1,"td"),g._uU(2),g.TgZ(3,"span",39),g.NdJ("click",function(){const n=g.CHM(t).index;return g.oxw().delItem(n)}),g._UZ(4,"i",40),g.qZA(),g.qZA(),g.TgZ(5,"td"),g.TgZ(6,"b"),g._uU(7),g.qZA(),g._UZ(8,"br"),g.TgZ(9,"span",41),g.NdJ("blur",function(n){const i=g.CHM(t).index;return g.oxw().updateGiaBan(i,"GiaBan",n)})("keydown.enter",function(n){const i=g.CHM(t).index;return g.oxw().updateGiaBan(i,"GiaBan",n)})("keydown.enter",function(n){const i=g.CHM(t).index;return g.oxw().updateList(i,"GiaBan",n)})("blur",function(n){const i=g.CHM(t).index;return g.oxw().updateList(i,"GiaBan",n)}),g._uU(10),g.ALo(11,"number"),g.qZA(),g._uU(12),g.qZA(),g.TgZ(13,"td",42),g.TgZ(14,"mat-icon",43),g.NdJ("click",function(){const n=g.CHM(t).index;return g.oxw().removeItem(n)}),g._uU(15,"chevron_left"),g.qZA(),g.TgZ(16,"b",44),g.NdJ("keydown.enter",function(n){const i=g.CHM(t).index;return g.oxw().updateList(i,"TongCong",n)})("blur",function(n){const i=g.CHM(t).index;return g.oxw().updateList(i,"TongCong",n)}),g._uU(17),g.ALo(18,"number"),g.qZA(),g.TgZ(19,"mat-icon",43),g.NdJ("click",function(){const n=g.CHM(t),i=n.$implicit,o=n.index;return g.oxw().addItem(i,o)}),g._uU(20,"navigate_next"),g.qZA(),g.qZA(),g.TgZ(21,"td",45),g.TgZ(22,"b"),g._uU(23),g.ALo(24,"commas"),g.qZA(),g.qZA(),g.qZA()}if(2&t){const t=n.$implicit,i=n.index;g.xp6(2),g.hij("",i+1," "),g.xp6(5),g.Oqu(t.TenHangHoa),g.xp6(3),g.Oqu(g.lcZ(11,6,t.GiaBan)),g.xp6(2),g.hij("k/",t.DVT," "),g.xp6(5),g.hij(" ",g.lcZ(18,8,t.TongCong)," "),g.xp6(6),g.Oqu(g.lcZ(24,10,t.TongCong*t.GiaBan*1e3))}}function vt(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"mat-chip",46),g.NdJ("click",function(){const n=g.CHM(t).$implicit,i=g.oxw();return i.khachDua=+i.khachDua+1e3*n}),g._uU(1),g.qZA()}if(2&t){const t=n.$implicit;g.xp6(1),g.hij("",t,"k")}}function Nt(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"mat-chip",47),g.NdJ("click",function(){const n=g.CHM(t).$implicit,i=g.oxw();return i.khachDua=+i.khachDua+1e3*n}),g._uU(1),g.qZA()}if(2&t){const t=n.$implicit;g.xp6(1),g.hij("",t,"k")}}function kt(t,n){if(1&t){const t=g.EpF();g.TgZ(0,"mat-chip",48),g.NdJ("click",function(){const n=g.CHM(t).$implicit,i=g.oxw();return i.khachDua=+i.khachDua+1e3*n}),g._uU(1),g.qZA()}if(2&t){const t=n.$implicit;g.xp6(1),g.hij("",t,"k")}}function Mt(t,n){if(1&t&&(g.TgZ(0,"mat-hint"),g._uU(1),g.ALo(2,"commas"),g.ALo(3,"titlecase"),g.ALo(4,"bangChu"),g.qZA()),2&t){const t=g.oxw();g.xp6(1),g.AsE(" ",g.lcZ(2,2,t.khachDua),": ",g.lcZ(3,4,g.lcZ(4,6,t.khachDua)),"")}}function Ut(t,n){if(1&t&&(g.TgZ(0,"mat-hint",49),g._uU(1),g.ALo(2,"commas"),g.qZA()),2&t){const t=g.oxw();g.xp6(1),g.hij(" Ti\u1ec1n th\u1eeba: ",g.lcZ(2,1,+t.khachDua-t.ThanhTien),"")}}function wt(t,n){if(1&t&&(g.TgZ(0,"tr"),g.TgZ(1,"td"),g._uU(2),g.qZA(),g.TgZ(3,"td"),g._uU(4),g._UZ(5,"br"),g._uU(6),g.ALo(7,"commas"),g.qZA(),g.TgZ(8,"td",51),g._uU(9),g.qZA(),g.TgZ(10,"td",53),g._uU(11),g.ALo(12,"commas"),g.qZA(),g.qZA()),2&t){const t=n.$implicit,i=n.index;g.xp6(2),g.hij("",i+1," "),g.xp6(2),g.hij("",t.TenHangHoa," "),g.xp6(2),g.hij(" ",g.lcZ(7,5,1e3*t.GiaBan)," "),g.xp6(3),g.Oqu(t.TongCong),g.xp6(2),g.Oqu(g.lcZ(12,7,t.TongCong*t.GiaBan*1e3))}}function It(t,n){if(1&t&&(g.TgZ(0,"tbody"),g.YNc(1,wt,13,9,"tr",13),g.TgZ(2,"tr"),g.TgZ(3,"td",50),g.TgZ(4,"h5"),g._uU(5,"T\u1ed5ng c\u1ed9ng:"),g.qZA(),g.qZA(),g.TgZ(6,"td"),g.TgZ(7,"h5"),g._uU(8),g.qZA(),g.qZA(),g.TgZ(9,"td",51),g.TgZ(10,"h5"),g._uU(11),g.ALo(12,"commas"),g.qZA(),g.TgZ(13,"h6"),g.TgZ(14,"i"),g._uU(15),g.ALo(16,"titlecase"),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.TgZ(17,"td",52),g.TgZ(18,"h6"),g._uU(19,"Xin c\u1ea3m \u01a1n qu\xfd kh\xe1ch"),g.qZA(),g.TgZ(20,"h6"),g._uU(21,"S\u1ea3n ph\u1ea9m c\u1ee7a 4la.vn"),g.qZA(),g.qZA(),g.qZA()),2&t){const t=g.oxw();g.xp6(1),g.Q6J("ngForOf",t.DonMua),g.xp6(7),g.hij("",t.total," m\xf3n"),g.xp6(3),g.hij(" ",g.lcZ(12,4,t.ThanhTien),""),g.xp6(4),g.Oqu(g.lcZ(16,6,t.bangchu))}}const Ht=function(t){return{loading:t}},Jt=function(){return[1,2,5]},Ot=function(){return[10,20,50]},Ft=function(){return[100,200,500]},Lt=[{path:"",component:qt},{path:"hang-hoa",component:bt},{path:"nhan-don/:ten-ban",component:ot},{path:"nhan-don",component:ot},{path:"pha-che",component:v},{path:"tap-hoa",component:(()=>{class t{constructor(t,n,i){this.plus=t,this.route=n,this.fb=i,this.db=null,this.title="B\xe1n h\xe0ng t\u1ea1p h\xf3a",this.dbName="ban-hang",this.api="tap-hoa",this.tabs=[],this.items=[],this.DonMua=[],this.total=0,this.ThanhTien=0,this.donHang=[],this.bangchu="",this.filter=[],this.audio=new Audio,this.nhapThuCong=!1,this.xemHoaDon=!0,this.khachDua=0,this.user=this.plus.user.getValue(),this.printTime=Date.now(),this.NhomHang=this.plus.user.getValue().NhomHang,this.TabBan=this.plus.sortArr(this.plus.user.getValue().NhomBan,"ThuTu",1),this.ChiaBan=[],this.ban=0,this.width=window.innerWidth,this.count=0,this.now=Date.now(),this.xemBan=!0,this.xemMon=!1,this.donHangFB=this.fb.group({ThanhTien:[,[d.kI.required]],LoiNhuan:[,[d.kI.required]],SoKH:[,[d.kI.required]],GioVao:[,[d.kI.required]],DaThanhToan:[,[d.kI.required]],DonMua:this.fb.array([this.fb.group({idHangHoa:[,[d.kI.required]],DVT:[,[d.kI.required]],GiaBan:[,[d.kI.required]],GiaVon:[,[d.kI.required]],KhuyenMai:[,[d.kI.required]],TenHangHoa:[,[d.kI.required]],TongCong:[,[d.kI.required]]})])}),this.searchForm=this.fb.group({input:[,[d.kI.minLength(3),d.kI.maxLength(50)]]})}ngOnDestroy(){console.log("Destroy nhan-don"),this.plus.subs.unsubscribe()}test(t){console.log(+t.replace(/\D/g,"")),this.khachDua=+t}ngOnInit(){this.plus.setTiTle(this.title),this.plus.IDB_InitDB(this.dbName).subscribe(t=>{this.db=t,document.getElementById("search-api").focus(),this.plus.updateUserLocal(t,"hang-hoa")}),this.search()}search(){this.searchForm.valueChanges.subscribe(t=>{const n=this.plus.removeAccents(t.input);n.trim().length<2||this.plus.IDB_DB_GetByBarCode(this.db,"hang-hoa",n).subscribe(t=>{t?(this.searchForm.reset(),this.addNewItem(t)):(this.filter=[],this.plus.IDB_DB_Search(this.db,"hang-hoa",n,5).subscribe(t=>{this.filter=t}))})})}thanhToan(){const t=confirm("In h\xf3a \u0111\u01a1n?");let n=Object.assign({DonMua:this.DonMua.map(t=>({idHangHoa:t._id,TenHangHoa:t.TenHangHoa,GiaBan:t.GiaBan,GiaVon:t.GiaVon,KhuyenMai:t.KhuyenMai,DVT:t.DVT,TongCong:t.TongCong})),LoiNhuan:this.DonMua.map(t=>t.GiaBan-t.GiaVon-t.GiaBan*t.KhuyenMai/100).reduce((t,n)=>t+n),ThanhTien:this.ThanhTien,GioVao:Date.now(),SoKH:this.total,DaThanhToan:!0});if(this.donHangFB.patchValue(n),this.donHangFB.invalid){const t=this.plus.getErrValidateForm(this.donHangFB);console.log(t,this.donHangFB.status)}else this.plus.httpPost("tap-hoa",n).subscribe(t=>{console.log(t),this.DonMua=[],this.reload()});t?(this.PrintDiv("HoaDon"),console.log(0,n)):console.log(1,n)}addNewItem(t){this.filter=[],this.playAudio(),this.xemHoaDon=!0,window.navigator.vibrate(100);const n=this.DonMua.find(n=>n._id==t._id);if(!n)return t.TongCong=1,this.DonMua.push(t),this.getTongCong();{const t=this.DonMua.findIndex(t=>t._id==n._id);this.DonMua[t].TongCong+=1}this.getTongCong(),this.filter=[],this.searchForm.controls.input.setValue("")}removeItem(t){this.DonMua[t].TongCong>0&&(this.DonMua[t].TongCong-=1),this.getTongCong()}addItem(t,n){this.playAudio(),this.DonMua[n].TongCong+=1,this.getTongCong()}delItem(t){this.DonMua.splice(t,1),this.getTongCong()}getTongCong(){this.total=this.plus.sumByKey(this.DonMua,"TongCong"),this.getThanhTien()}getThanhTien(){let t=0;return this.DonMua.forEach(n=>{t+=n.GiaBan*n.TongCong*1e3}),this.bangchu=this.plus.numToVi(t),this.ThanhTien=t}PrintDiv(t){this.plus.load();let n=window.document.getElementById(t);var i=window.open("","PRINT");i.document.write(document.documentElement.innerHTML),setTimeout(()=>{i.document.body.innerHTML=n.outerHTML,i.document.close(),i.focus(),i.print(),i.close()},1e3),this.plus.loaded()}getBarcode(t){this.searchForm.controls.input.setValue(t)}find(t){this.filter=t}getByBarcode(t){}reload(){this.plus.reload("ban-hang/tap-hoa")}updateList(t,n,i){const o=+i.target.textContent;if(console.log(o),"Enter"===i.key&&i.preventDefault(),"number"!=typeof o)return this.plus.alertError("Sai \u0111\u1ecbnh d\u1ea1ng"),this.DonMua[t][n]=0;this.DonMua[t][n]=+o,this.getTongCong()}updateGiaBan(t,n,i){if(this.DonMua[t][n]==+i.target.textContent)return;const o=this.DonMua[t].TongCong,e=this.DonMua[t];delete e.__v,delete e.TongCong,e.GiaBan=+i.target.textContent,this.plus.httpPut("hang-hoa",e).subscribe(n=>{document.getElementById("search-api").focus(),console.log(this.DonMua[t])}),this.DonMua[t][n]=+i.target.textContent,this.DonMua[t].TongCong=+o,this.getTongCong()}playAudio(){this.audio.src="assets/audio/beep.mp3",this.audio.load(),this.audio.play()}}return t.\u0275fac=function(n){return new(n||t)(g.Y36(l.T),g.Y36(p.gz),g.Y36(d.qu))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-tap-hoa"]],decls:94,vars:37,consts:[[1,"row"],[1,"col-lg-8"],[1,"form-group",3,"formGroup"],["type","text","id","search-api","autocomplete","off","formControlName","input","placeholder","T\xecm ki\u1ebfm (F2)",1,"form-control",3,"readonly","matAutocomplete","ngClass"],["autoActiveFirstOption",""],["auto","matAutocomplete"],[3,"click","keyup.enter",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"col-lg-4"],[3,"barcodeResult"],["mat-raised-button","","color","warn",1,"float-rigth"],[1,"col"],[1,"table","table-hover"],[4,"ngFor","ngForOf"],["colspan","2"],["mat-raised-button","","id","thanh-toan","color","warn",3,"disabled","click"],["colspan","2",1,"float-rigth"],["color","primary","selected","",3,"click",4,"ngFor","ngForOf"],["color","accent","selected","",3,"click",4,"ngFor","ngForOf"],["color","warn","selected","",3,"click",4,"ngFor","ngForOf"],["colspan","2",1,"text-left"],["matInput","","autocomplete","off",3,"ngModel","ngModelChange"],["mat-button","","matSuffix","","mat-icon-button","",3,"click"],["align","end",4,"ngIf"],["id","modelId","tabindex","-1","role","dialog","aria-labelledby","modelTitleId","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-body","hoadon"],["id","HoaDon",1,"div"],[1,"text-left"],[1,"thead-inverse"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary"],[3,"click","keyup.enter"],[1,"badge","badge-danger",3,"click"],["aria-hidden","true",1,"fa","fa-trash"],["contenteditable","true",1,"px-2","font-blue",3,"blur","keydown.enter"],[1,""],[3,"click"],["contenteditable","true",1,"font-blue",3,"keydown.enter","blur"],[1,"text-right"],["color","primary","selected","",3,"click"],["color","accent","selected","",3,"click"],["color","warn","selected","",3,"click"],["align","end"],["colspan","2",1,"text-center"],[1,"text-center"],["colspan","4",1,"text-center"],[1,"text-rigth"]],template:function(t,n){if(1&t&&(g.TgZ(0,"div",0),g.TgZ(1,"div",1),g.TgZ(2,"div",2),g._UZ(3,"input",3),g.TgZ(4,"mat-autocomplete",4,5),g.YNc(6,yt,4,3,"mat-option",6),g.YNc(7,Ct,2,0,"mat-option",7),g.qZA(),g.qZA(),g.qZA(),g.TgZ(8,"div",8),g.TgZ(9,"app-barcode-scanner",9),g.NdJ("barcodeResult",function(t){return n.getBarcode(t)}),g.qZA(),g.TgZ(10,"button",10),g._uU(11),g.ALo(12,"commas"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(13,"div",0),g.TgZ(14,"div",11),g.TgZ(15,"table",12),g.TgZ(16,"thead"),g.TgZ(17,"tr"),g.TgZ(18,"th"),g._uU(19,"TT "),g.qZA(),g.TgZ(20,"th"),g._uU(21,"H\u1ea1ng m\u1ee5c"),g.qZA(),g.TgZ(22,"th"),g._uU(23,"S\u1ed1 l\u01b0\u1ee3ng"),g.qZA(),g.TgZ(24,"th"),g._uU(25,"Th\xe0nh ti\u1ec1n"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(26,"tbody"),g.YNc(27,Bt,25,12,"tr",13),g.TgZ(28,"tr"),g.TgZ(29,"td",14),g.TgZ(30,"h5"),g._uU(31),g.ALo(32,"commas"),g.qZA(),g.TgZ(33,"h6"),g.TgZ(34,"i"),g._uU(35),g.ALo(36,"titlecase"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(37,"td"),g.TgZ(38,"button",15),g.NdJ("click",function(){return n.thanhToan()}),g._uU(39,"Thanh to\xe1n (F9)"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(40,"tr"),g.TgZ(41,"td",16),g.TgZ(42,"mat-chip-list"),g.YNc(43,vt,2,1,"mat-chip",17),g.qZA(),g.TgZ(44,"mat-chip-list"),g.YNc(45,Nt,2,1,"mat-chip",18),g.qZA(),g.TgZ(46,"mat-chip-list"),g.YNc(47,kt,2,1,"mat-chip",19),g.qZA(),g.qZA(),g.TgZ(48,"td",20),g.TgZ(49,"mat-form-field"),g.TgZ(50,"mat-label"),g._uU(51,"Kh\xe1ch \u0111\u01b0a"),g.qZA(),g.TgZ(52,"input",21),g.NdJ("ngModelChange",function(t){return n.khachDua=t}),g.qZA(),g.TgZ(53,"button",22),g.NdJ("click",function(){return n.khachDua=0}),g.TgZ(54,"mat-icon"),g._uU(55,"backspace"),g.qZA(),g.qZA(),g.YNc(56,Mt,5,8,"mat-hint",7),g.qZA(),g.YNc(57,Ut,3,3,"mat-hint",23),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.TgZ(58,"div",24),g.TgZ(59,"div",25),g.TgZ(60,"div",26),g.TgZ(61,"div",27),g.TgZ(62,"h5",28),g._uU(63,"Modal title"),g.qZA(),g.TgZ(64,"button",29),g.TgZ(65,"span",30),g._uU(66,"\xd7"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(67,"div",31),g.TgZ(68,"div",32),g.TgZ(69,"div",33),g.TgZ(70,"h6"),g._uU(71),g.qZA(),g.TgZ(72,"h6"),g._uU(73),g.qZA(),g.TgZ(74,"h6"),g._uU(75),g.ALo(76,"date"),g.qZA(),g.qZA(),g.TgZ(77,"table",12),g.TgZ(78,"thead",34),g.TgZ(79,"tr"),g.TgZ(80,"th"),g._uU(81,"TT"),g.qZA(),g.TgZ(82,"th"),g._uU(83,"H\u1ea1ng m\u1ee5c"),g.qZA(),g.TgZ(84,"th"),g._uU(85,"S\u1ed1 l\u01b0\u1ee3ng"),g.qZA(),g.TgZ(86,"th"),g._uU(87,"Th\xe0nh ti\u1ec1n"),g.qZA(),g.qZA(),g.qZA(),g.YNc(88,It,22,8,"tbody",7),g.qZA(),g.qZA(),g.qZA(),g.TgZ(89,"div",35),g.TgZ(90,"button",36),g._uU(91,"Close"),g.qZA(),g.TgZ(92,"button",37),g._uU(93,"Save"),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.qZA()),2&t){const t=g.MAs(5);g.xp6(2),g.Q6J("formGroup",n.searchForm),g.xp6(1),g.Q6J("readonly",!1)("matAutocomplete",t)("ngClass",g.VKq(32,Ht,n.filter.length>1&&n.filter.length<5)),g.xp6(3),g.Q6J("ngForOf",n.filter),g.xp6(1),g.Q6J("ngIf",0==n.filter.length&&n.searchForm.value.input),g.xp6(4),g.AsE(" ",n.DonMua.length," | ",g.lcZ(12,23,n.ThanhTien)," "),g.xp6(16),g.Q6J("ngForOf",n.DonMua),g.xp6(4),g.AsE("T\u1ed5ng c\u1ed9ng: ",g.lcZ(32,25,n.ThanhTien)," / ",n.total," m\xf3n"),g.xp6(4),g.Oqu(g.lcZ(36,27,n.bangchu)),g.xp6(3),g.Q6J("disabled",n.ThanhTien<=0),g.xp6(5),g.Q6J("ngForOf",g.DdM(34,Jt)),g.xp6(2),g.Q6J("ngForOf",g.DdM(35,Ot)),g.xp6(2),g.Q6J("ngForOf",g.DdM(36,Ft)),g.xp6(5),g.Q6J("ngModel",n.khachDua),g.xp6(4),g.Q6J("ngIf",n.khachDua>0),g.xp6(1),g.Q6J("ngIf",n.khachDua>0&&n.khachDua>n.ThanhTien),g.xp6(14),g.Oqu(n.user.title),g.xp6(2),g.Oqu(n.user.phoneNumber),g.xp6(2),g.hij("Gi\u1edd in:",g.xi3(76,29,n.printTime,"hh:mm dd/MM/yyyy"),""),g.xp6(13),g.Q6J("ngIf",n.DonMua)}},directives:[d.JL,d.sg,d.Fj,xt.ZL,d.JJ,d.u,c.mk,xt.XC,c.sg,c.O5,ht.O,f.lW,Dt.qn,M.KE,M.hX,U.Nt,d.On,M.R9,D.Hw,_t.ey,Dt.HS,M.bx],pipes:[q.W,c.rS,c.uU,c.JJ,q.ID],styles:[".hangHoa[_ngcontent-%COMP%]{height:8rem;width:8rem;border-radius:1rem;margin:.2rem;border-bottom-width:1rem;border-color:#90ee90;color:blue;float:left;display:flex;align-items:center;justify-content:center}.hangHoa[_ngcontent-%COMP%]:active{transform:scale(1.1);opacity:50%}.hoadon[_ngcontent-%COMP%]{width:200px}.font-mat[_ngcontent-%COMP%]{color:#fff;font-size:medium}.le[_ngcontent-%COMP%]{background-color:#ff0}.chuc[_ngcontent-%COMP%], .le[_ngcontent-%COMP%]{border:#0000cd;border-radius:.2rem;color:brown;margin:.8rem;padding-left:.5rem;padding-right:.5rem}.chuc[_ngcontent-%COMP%]{background-color:#deb887}.tram[_ngcontent-%COMP%]{border:#0000cd;border-radius:.2rem;color:brown;background-color:#7fff00;margin:.8rem;padding-left:.5rem;padding-right:.5rem}.arrow-bt[_ngcontent-%COMP%]{font-size:larger;color:blue;font-weight:700;padding:.5rem}.arrow-bt[_ngcontent-%COMP%]:hover{border:brown;border-radius:.5rem;background-color:aqua}.example-form-field[_ngcontent-%COMP%]{max-width:8rem}"],data:{animation:[r.Y]}}),t})()},{path:"bao-cao",component:x},{path:"khach-hang",component:Z}];let Gt=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=g.oAB({type:t}),t.\u0275inj=g.cJS({imports:[[p.Bz.forChild(Lt)],p.Bz]}),t})();var Qt=i(41007);let Pt=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=g.oAB({type:t}),t.\u0275inj=g.cJS({imports:[[c.ez]]}),t})();var Yt=i(97534);let Vt=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=g.oAB({type:t}),t.\u0275inj=g.cJS({providers:[Yt.F],imports:[[c.ez,e.ShareModule,s.q,Gt,h.D,Qt.m,Yt.F,Pt,a.k,o.N]]}),t})()},64762:function(t,n,i){"use strict";function o(t,n,i,o){return new(i||(i=Promise))(function(e,a){function s(t){try{c(o.next(t))}catch(n){a(n)}}function h(t){try{c(o.throw(t))}catch(n){a(n)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i(function(t){t(n)})).then(s,h)}c((o=o.apply(t,n||[])).next())})}i.d(n,{mG:function(){return o}})}}]);