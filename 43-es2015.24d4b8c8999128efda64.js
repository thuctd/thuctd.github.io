"use strict";(self.webpackChunk_4la=self.webpackChunk_4la||[]).push([[43],{74043:function(t,e,i){i.r(e),i.d(e,{EmailModule:function(){return Zt}});var n=i(24561),s=i(39609),a=i(87841),o=i(24751),r=i(12057),l=i(58497);class h{constructor(t,e,i,n){this.loader=t,this.url=e,this.http=i,this.plus=n}uploadFile(t,e,i){let n=new FormData;const s=new l.WM({"ngsw-bypass":""});return n.append("file",t),console.log("formData",n),new l.LE,this.http.post("https://up-log.herokuapp.com/upload",n,{headers:s})}upload(){return new Promise((t,e)=>{this.loader.file.then(i=>{this.uploadFile(i,this.url,"test").subscribe(e=>{console.log(e),t({default:e.url})},t=>{e("Ch\u1ee9c n\u0103ng b\u1ecb l\u1ed7i.\nVui l\xf2ng th\u1eed l\u1ea1i sau \xedt ph\xfat!"),console.log(i)})})})}abort(){console.log("abort")}}var c=i(29726),u=i(84487),d=i(28831),g=i(74788),p=i(88638),m=i(33982),f=i(50077),b=i(2895),Z=function(t,e,i,n){return new(i||(i=Promise))(function(s,a){function o(t){try{l(n.next(t))}catch(e){a(e)}}function r(t){try{l(n.throw(t))}catch(e){a(e)}}function l(t){t.done?s(t.value):function(t){return t instanceof i?t:new i(function(e){e(t)})}(t.value).then(o,r)}l((n=n.apply(t,e||[])).next())})};const T=["myEditor"];function y(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"button",18),g.NdJ("click",function(){return g.CHM(t),g.oxw().checkImportData()}),g._uU(1,"Xem tr\u01b0\u1edbc"),g.qZA()}}function x(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"button",19),g.NdJ("click",function(){return g.CHM(t),g.oxw().reload()}),g._uU(1,"L\xe0m l\u1ea1i "),g.qZA()}}function v(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"div",20),g.TgZ(1,"div",21),g.TgZ(2,"button",22),g.NdJ("click",function(){return g.CHM(t),g.oxw().pre()}),g._UZ(3,"i",23),g.qZA(),g.TgZ(4,"button",24),g.NdJ("click",function(){return g.CHM(t),g.oxw().next()}),g._UZ(5,"i",25),g.qZA(),g.qZA(),g.TgZ(6,"div",26),g.TgZ(7,"h5",27),g._uU(8),g.qZA(),g._UZ(9,"div",28),g.qZA(),g._UZ(10,"hr"),g.qZA()}if(2&t){const t=g.oxw();g.Q6J("@slideIn",void 0),g.xp6(8),g.AsE("N\u1ed8I DUNG EMAIL S\u1ed0 ",t.i+1,": ",t.dataJson[t.i].email,""),g.xp6(1),g.Q6J("innerHTML",t.dataJson[t.i].message,g.oJD)}}function I(t,e){if(1&t&&(g.TgZ(0,"tr"),g.TgZ(1,"td"),g._uU(2),g.qZA(),g.TgZ(3,"td"),g._uU(4),g.qZA(),g.qZA()),2&t){const t=e.$implicit;g.xp6(2),g.hij(" ",t.email," "),g.xp6(2),g.hij(" ",t.err," ")}}function q(t,e){if(1&t&&(g.TgZ(0,"div",29),g.TgZ(1,"h6"),g._uU(2,"DANH S\xc1CH D\u1eee LI\u1ec6U KH\xd4NG H\u1ee2P L\u1ec6"),g.qZA(),g.TgZ(3,"table",30),g.YNc(4,I,5,2,"tr",31),g.qZA(),g.qZA()),2&t){const t=g.oxw();g.Q6J("@slideIn",void 0),g.xp6(4),g.Q6J("ngForOf",t.errData)}}const A=function(t,e){return{"bg-success":t,"bg-danger":e}};function J(t,e){if(1&t&&(g.TgZ(0,"tr"),g.TgZ(1,"td"),g._uU(2),g.qZA(),g.TgZ(3,"td",35),g._uU(4),g.qZA(),g.TgZ(5,"td",35),g._uU(6),g.qZA(),g.TgZ(7,"td",36),g._uU(8),g.qZA(),g.qZA()),2&t){const t=e.$implicit,i=e.index;g.xp6(2),g.Oqu(i+1),g.xp6(2),g.Oqu(t.fullName),g.xp6(2),g.Oqu(t.email),g.xp6(1),g.Q6J("ngClass",g.WLB(5,A,t.status,3===t.status)),g.xp6(1),g.hij(" ",1===t.status?"\u0110\xe3 g\u1eedi":"Ch\u01b0a g\u1eedi"," ")}}function k(t,e){if(1&t&&(g.TgZ(0,"div",32),g.TgZ(1,"h5"),g._uU(2,"DANH S\xc1CH EMAIL \u0110\u01af\u1ee2C TH\xd4NG B\xc1O"),g.qZA(),g.TgZ(3,"table",33),g.TgZ(4,"thead"),g.TgZ(5,"tr"),g.TgZ(6,"th"),g._uU(7,"STT"),g.qZA(),g.TgZ(8,"th"),g._uU(9,"H\u1ecd v\xe0 t\xean"),g.qZA(),g.TgZ(10,"th"),g._uU(11,"Email"),g.qZA(),g.TgZ(12,"th",34),g._uU(13,"Tr\u1ea1ng th\xe1i"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(14,"tbody"),g.YNc(15,J,9,8,"tr",31),g.qZA(),g.qZA(),g.qZA()),2&t){const t=g.oxw();g.Q6J("@slideIn",void 0),g.xp6(15),g.Q6J("ngForOf",t.dataJson)}}function N(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"button",37),g.NdJ("click",function(){return g.CHM(t),g.oxw().sendMail()}),g._uU(1,"G\u1eedi mail"),g.qZA()}}let _=(()=>{class t{constructor(t,e,i,n){this.plus=t,this.fb=e,this.router=i,this.httpClient=n,this.Editor=c,this.user=this.plus.user.getValue(),this.from=this.plus.user.getValue().unit,this.localName="moneyMail",this.dataImport=[],this.dataJson=[],this.errData=[],this.resent=[],this.tienLuong=[],this.send="",this.i=0,this.doc="",this.htmlContent=sessionStorage.getItem("htmlContentMain")||"",this.main=this.fb.group({email:[,o.kI.email],title:[`Th\xf4ng b\xe1o ti\u1ec1n l\u01b0\u01a1ng chuy\u1ec3n kho\u1ea3n ng\xe0y ${this.plus.dateFormat(Date.now())}`,[o.kI.required,o.kI.minLength(3)]]}),this.checkBody=this.fb.group({email:["",[o.kI.required,o.kI.email]],from:["\u0110i\u1ec7n l\u1ef1c Xu\xe2n L\u1ed9c",[o.kI.required,o.kI.minLength(10)]],title:["",[o.kI.required,o.kI.minLength(3)]],message:["",[o.kI.required,o.kI.minLength(200)]],reciver:["",[o.kI.required,o.kI.minLength(3)]],index:[,o.kI.max(1e3)]}),this.tienluong=this.fb.group({keyWord:[,[]],_id:[,[]],HoTen:[,[o.kI.required]],ThucLanh:[,[o.kI.required]],NgayNhanLuong:[,[o.kI.required]],MucHtnv:[,],SoNguoiGiamTru:[,],ThueTamDong:[,]})}ngOnInit(){this.init()}init(){if((JSON.parse(localStorage.getItem(this.localName))||[]).filter(t=>{0===t.status&&this.resent.push(t)}),0==this.from.length){const t=this.plus.user.getValue().unit;t?this.from=t:this.plus.alertToasrt({err:"B\u1ea1n ch\u01b0a khai b\xe1o \u0111\u01a1n v\u1ecb t\u1ea1i m\u1ee5c T\xe0i Kho\u1ea3n"}),console.log(t)}this.resent.length>0?(console.log(this.resent),confirm("B\u1ea5m OK \u0111\u1ec3 g\u1eedi mail tr\u01b0\u1edbc ch\u01b0a ho\xe0n th\xe0nh.\nB\u1ea5m Cancel \u0111\u1ec3 x\xf3a phi\xean l\xe0m vi\u1ec7c tr\u01b0\u1edbc?")?this.dataJson=this.resent:(localStorage.removeItem(this.localName),this.reset())):(this.reset(),localStorage.removeItem(this.localName))}onReady(t){t.ui.getEditableElement().parentElement.insertBefore(t.ui.view.toolbar.element,t.ui.getEditableElement()),t.plugins.get("FileRepository").createUploadAdapter=t=>(console.log(btoa(t.file)),new h(t,"/upload",this.httpClient,this.plus))}saveArticle(){this.dataJson.length>0&&(this.plus.alertToasrt({war:"B\u1ea1n c\u1ea7n ch\u1ecdn l\u1ea1i danh s\xe1ch nh\u1eadn email sau khi hi\u1ec7u ch\u1ec9nh n\u1ed9i dung!"}),this.reset()),this.htmlContent=this.getArticleContent(),sessionStorage.setItem("htmlContentMain",this.htmlContent)}getArticleContent(){return this.myEditor&&this.myEditor.editorInstance?this.myEditor.editorInstance.getData():""}readXlsx(t){this.dataJson=[],this.dataImport=[];let e=t.target;const i=new FileReader;i.onload=t=>{const e=u.read(t.target.result,{type:"binary"});this.dataImport=u.utils.sheet_to_json(e.Sheets[e.SheetNames[0]],{header:1})},i.readAsBinaryString(e.files[0]),e=null}checkImportData(){this.dataImport.length>400&&this.plus.alertError("Vui l\xf2ng ch\u1ecdn danh s\xe1ch d\u01b0\u1edbi 400 email!");const t=this.dataImport[0],e=t.length;this.dataImport.splice(0,1);const i=this.plus.dateHtmlToXls(Date.now()),n=t.indexOf("M\u1ee9c HTNV"),s=t.indexOf("Thu\u1ebf TNCN"),a=t.indexOf("Th\u1ef1c l\xe3nh");console.log(n,s),this.dataImport.forEach((o,r)=>{if("x"==o[1]){let l="<ul>";for(let i=6;i<e;i++)l+=o[i]?`<li>${t[i]}: ${this.plus.numberWithCommas(o[i])}.</li>`:"";let h={_id:+o[0],HoTen:o[3],ThucLanh:o[a],NgayNhanLuong:i,MucHtnv:o[n],SoNguoiGiamTru:0,ThueTamDong:o[s],dateModify:Date.now()+r};this.tienLuong.push(h);let c={from:this.from,status:0,reciver:o[3],err:"",index:r,email:o[4],fullName:o[2]+": "+o[3],title:`${this.main.get("title").value}`,message:`<p>K\xednh g\u1eedi ${o[2]}: ${o[3]}.</p>\n          <p>\u0110i\u1ec7n l\u1ef1c Xu\xe2n L\u1ed9c th\xf4ng b\xe1o ti\u1ec1n l\u01b0\u01a1ng chuy\u1ec3n kho\u1ea3n chi ti\u1ebft nh\u01b0 sau:</p>\n          ${l}\n          </ul><p>S\u1ed1 ti\u1ec1n th\u1ef1c l\xe3nh tr\xean \u0111\u01b0\u1ee3c chuy\u1ec3n kho\u1ea3n qua t\xe0i kho\u1ea3n s\u1ed1 ${o[5]} c\u1ee7a ${o[2]} ${o[3]}.\n\n          M\u1ecdi \xfd ki\u1ebfn th\u1eafc m\u1eafc, vui l\xf2ng li\xean h\u1ec7 ph\xf2ng Ph\xf2ng T\u1ed5ng H\u1ee3p \u0111\u1ec3 \u0111\u01b0\u1ee3c gi\u1ea3i \u0111\xe1p.</p>\n          ${this.htmlContent}\n        Tr\xe2n tr\u1ecdng.\n           `};if(console.log(c),this.checkBody.patchValue(c),this.checkBody.valid)this.dataJson.push(c),this.plus.pushLocalStorage(this.localName,c);else{const t=this.plus.getErrValidateForm(this.checkBody);c.err=t,console.log(t),this.errData.push(c)}}})}sendDefault(){this.plus.sendMail({from:this.from,status:0,err:"",email:"thucspc@gmail.com",title:`B\xe1o c\xe1o th\u1ef1c hi\u1ec7n g\u1eedi ${this.checkBody.value.title}`,index:0,message:`\n      <p> B\xe1o c\xe1o th\u1ef1c hi\u1ec7n g\u1eedi email: ${this.dataJson.length}</p>\n      <p>Tr\xe2n tr\u1ecdng.</p>\n      `},"mail/bao-cao").subscribe(t=>{console.log("bodydefault")})}sendMail(){return Z(this,void 0,void 0,function*(){this.plus.httpPost("tien-luong/importmail",this.tienLuong,!0).subscribe(t=>{console.log(t)});const t=this.dataJson.length,e=confirm("Th\u1ef1c hi\u1ec7n th\xf4ng b\xe1o cho "+t+" CBCNV?");if(t>400)this.plus.alertToasrt({war:"Vui l\xf2ng l\u1eadp danh s\xe1ch d\u01b0\u1edbi 400 email"});else if(0===this.errData.length&&t>0&&e){this.sendDefault();let t=0;const e=this.dataJson.length;for(;t<e;){yield this.plus.sleep(5e3),this.i=t;const e=this.dataJson[t];this.plus.sendMail(e,"mail/money").subscribe(i=>{i.email&&(this.dataJson.filter((t,e)=>{t.index===i.index&&(this.dataJson[e].status=1)}),console.log(t,i.email,e.reciver),localStorage.setItem(this.localName,JSON.stringify(this.dataJson)))},i=>{this.dataJson[t].status=0,localStorage.setItem(this.localName,JSON.stringify(this.dataJson)),this.plus.alertToasrt({err:` Ch\u01b0a g\u1eedi email \u0111\u1ebfn ${e.reciver}`})}),t++}}else this.plus.alertToasrt({war:"\u0110\xe3 h\u1ee7y thao t\xe1c!"}),window.location.reload()})}pre(){this.i>0?this.i--:this.i=0}next(){this.i<this.dataJson.length-1?this.i++:this.i=1}view(t){console.log(t),this.mailModal=t,document.getElementById("email").click()}reset(){this.dataJson=[],this.errData=[],sessionStorage.removeItem("htmlContentMain")}reload(){return Z(this,void 0,void 0,function*(){return yield this.router.navigate([""]),this.router.navigate(["email/tienluong"])})}}return t.\u0275fac=function(e){return new(e||t)(g.Y36(p.T),g.Y36(o.qu),g.Y36(m.F0),g.Y36(l.eN))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-money"]],viewQuery:function(t,e){if(1&t&&g.Gf(T,5),2&t){let t;g.iGM(t=g.CRH())&&(e.myEditor=t.first)}},decls:26,vars:10,consts:[[1,"container"],[1,"text-center","my-3","text-primary"],[1,"modal-body"],[1,"form-group",3,"formGroup"],["for",""],["type","text","required","","placeholder","Nh\u1eadp n\u1ed9i dung ti\xeau \u0111\u1ec1","formControlName","title",1,"form-control"],[3,"editor","data","ready","change"],["myEditor",""],["target","_blank","href","https://github.com/thuctd/FileStore/raw/master/templates/MauTienLuong.xlsx",1,"badge","badge-warning"],["for","file-upload",1,"custom-file-upload","mx-5"],[1,"fa","fa-cloud-upload"],["hidden","","id","file-upload","type","file","multiple","false",3,"change"],["type","button","class","btn btn-outline-primary mx-3",3,"click",4,"ngIf"],["type","button","class","btn btn-outline-danger mx-3",3,"click",4,"ngIf"],["class","card border-primary my-3",4,"ngIf"],["class","alert-danger my-4 justify-content-center",4,"ngIf"],["class","dataOk",4,"ngIf"],["mat-raised-button","","color","accent",3,"click",4,"ngIf"],["type","button",1,"btn","btn-outline-primary","mx-3",3,"click"],["type","button",1,"btn","btn-outline-danger","mx-3",3,"click"],[1,"card","border-primary","my-3"],[1,"button"],["type","button",1,"btn","btn-danger","float-left",3,"click"],["aria-hidden","true",1,"fa","fa-arrow-left"],["type","button",1,"btn","btn-danger","float-right",3,"click"],["aria-hidden","true",1,"fa","fa-arrow-right"],[1,"card-body"],[1,"text-center","rounded","font-weigth-bold","bg-warning","py-2"],[3,"innerHTML"],[1,"alert-danger","my-4","justify-content-center"],[1,"table","table-hover","table-invert","table-bordered"],[4,"ngFor","ngForOf"],[1,"dataOk"],[1,"table","table-hover"],[1,"text-center"],["scope","row"],[1,"text-center",3,"ngClass"],["mat-raised-button","","color","accent",3,"click"]],template:function(t,e){1&t&&(g.TgZ(0,"div",0),g.TgZ(1,"h5",1),g._uU(2,"TH\xd4NG B\xc1O TI\u1ec0N L\u01af\u01a0NG B\u1eb0NG EMAIL"),g.qZA(),g.TgZ(3,"div"),g.TgZ(4,"div",2),g.TgZ(5,"form",3),g.TgZ(6,"label",4),g._uU(7,"Ti\xeau \u0111\u1ec1"),g.qZA(),g._UZ(8,"input",5),g.qZA(),g.qZA(),g.TgZ(9,"h5",4),g._uU(10,"N\u1ed9i dung th\xf4ng b\xe1o kh\xe1c"),g.qZA(),g.TgZ(11,"ckeditor",6,7),g.NdJ("ready",function(t){return e.onReady(t)})("change",function(){return e.saveArticle()}),g.qZA(),g.TgZ(13,"a",8),g._uU(14,"File m\u1eabu"),g.qZA(),g.TgZ(15,"label",9),g._UZ(16,"i",10),g._uU(17," Ch\u1ecdn file "),g.qZA(),g.TgZ(18,"input",11),g.NdJ("change",function(t){return e.readXlsx(t)}),g.qZA(),g.YNc(19,y,2,0,"button",12),g.YNc(20,x,2,0,"button",13),g.YNc(21,v,11,4,"div",14),g.YNc(22,q,5,2,"div",15),g.YNc(23,k,16,2,"div",16),g.YNc(24,N,2,0,"button",17),g._UZ(25,"hr"),g.qZA(),g.qZA()),2&t&&(g.Q6J("@slideIn",void 0),g.xp6(5),g.Q6J("formGroup",e.main),g.xp6(6),g.s9C("data",e.htmlContent),g.Q6J("editor",e.Editor),g.xp6(8),g.Q6J("ngIf",e.dataImport.length>0&&0===e.dataJson.length),g.xp6(1),g.Q6J("ngIf",e.dataJson.length>0),g.xp6(1),g.Q6J("ngIf",e.dataJson.length>0&&0==e.errData.length),g.xp6(1),g.Q6J("ngIf",e.errData.length>0),g.xp6(1),g.Q6J("ngIf",e.dataJson.length>0&&0===e.errData.length),g.xp6(1),g.Q6J("ngIf",0===e.errData.length&&e.dataJson.length>0))},directives:[o._Y,o.JL,o.sg,o.Fj,o.Q7,o.JJ,o.u,f.u,r.O5,r.sg,r.mk,b.lW],styles:[""],data:{animation:[d.Ym]}}),t})();var U=i(46833),w=i(46113),C=i(49356);function D(t,e){1&t&&(g.TgZ(0,"label",4),g._uU(1," Ch\u1ecdn file "),g._UZ(2,"i",5),g.qZA())}let M=(()=>{class t{constructor(t){this.plus=t,this.xlsMail=new g.vpe,this.dataImport=[]}ngOnInit(){}readXlsx(t){this.plus.load(),this.dataImport=[];let e=t.target;const i=new FileReader;i.onload=t=>{const e=u.read(t.target.result,{type:"binary"});this.dataImport=u.utils.sheet_to_json(e.Sheets[e.SheetNames[0]],{header:1}),this.xlsMail.emit(this.dataImport)},i.readAsBinaryString(e.files[0]),e=null,this.plus.loaded()}reload(){this.plus.reload(this.dbName+"/"+this.api)}}return t.\u0275fac=function(e){return new(e||t)(g.Y36(p.T))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-read-to-mail"]],inputs:{api:"api",dbName:"dbName"},outputs:{xlsMail:"xlsMail"},decls:9,vars:2,consts:[[1,"row"],["for","file-import","class","custom-file-upload text-primary mx-5",4,"ngIf"],["hidden","","id","file-import","type","file","multiple","false",3,"change"],["target","_blank",1,"badge","badge-warning",3,"href"],["for","file-import",1,"custom-file-upload","text-primary","mx-5"],["aria-hidden","true",1,"fa","fa-file-excel-o","fa-2x","text-success"]],template:function(t,e){1&t&&(g.TgZ(0,"div",0),g._UZ(1,"hr"),g.YNc(2,D,3,0,"label",1),g.TgZ(3,"input",2),g.NdJ("change",function(t){return e.readXlsx(t)}),g.qZA(),g._UZ(4,"hr"),g.TgZ(5,"a",3),g.TgZ(6,"mat-icon"),g._uU(7,"description"),g.qZA(),g._uU(8," File import m\u1eabu"),g.qZA(),g.qZA()),2&t&&(g.xp6(2),g.Q6J("ngIf",0==e.dataImport.length),g.xp6(3),g.MGl("href","https://github.com/thuctd/FileStore/raw/master/templates/",e.api,".xlsx",g.LSH))},directives:[r.O5,C.Hw],styles:[""],data:{animation:[d.Ym]}}),t})();var L=function(t,e,i,n){return new(i||(i=Promise))(function(s,a){function o(t){try{l(n.next(t))}catch(e){a(e)}}function r(t){try{l(n.throw(t))}catch(e){a(e)}}function l(t){t.done?s(t.value):function(t){return t instanceof i?t:new i(function(e){e(t)})}(t.value).then(o,r)}l((n=n.apply(t,e||[])).next())})};function B(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"button",11),g.NdJ("click",function(){return g.CHM(t),g.oxw().reload()}),g._uU(1,"L\xe0m l\u1ea1i "),g.qZA()}}function S(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"div",12),g.TgZ(1,"div",13),g.TgZ(2,"button",14),g.NdJ("click",function(){return g.CHM(t),g.oxw().pre()}),g._UZ(3,"i",15),g.qZA(),g.TgZ(4,"button",16),g.NdJ("click",function(){return g.CHM(t),g.oxw().next()}),g._UZ(5,"i",17),g.qZA(),g.qZA(),g.TgZ(6,"div",18),g.TgZ(7,"h5",19),g._uU(8),g.qZA(),g._UZ(9,"div",20),g.qZA(),g._UZ(10,"hr"),g.qZA()}if(2&t){const t=g.oxw();g.xp6(6),g.Q6J("@slideIn",void 0),g.xp6(2),g.AsE("N\u1ed8I DUNG EMAIL S\u1ed0 ",t.i+1,": ",t.dataJson[t.i].email,""),g.xp6(1),g.Q6J("innerHTML",t.dataJson[t.i].message,g.oJD)}}function F(t,e){if(1&t&&(g.TgZ(0,"tr"),g.TgZ(1,"td"),g._uU(2),g.qZA(),g.TgZ(3,"td"),g._uU(4),g.qZA(),g.qZA()),2&t){const t=e.$implicit;g.xp6(2),g.hij(" ",t.email," "),g.xp6(2),g.hij(" ",t.err," ")}}function E(t,e){if(1&t&&(g.TgZ(0,"div",21),g.TgZ(1,"h6"),g._uU(2,"DANH S\xc1CH D\u1eee LI\u1ec6U KH\xd4NG H\u1ee2P L\u1ec6"),g.qZA(),g.TgZ(3,"table",22),g.YNc(4,F,5,2,"tr",23),g.qZA(),g.qZA()),2&t){const t=g.oxw();g.Q6J("@slideIn",void 0),g.xp6(4),g.Q6J("ngForOf",t.errData)}}const H=function(t,e){return{"bg-success":t,"bg-danger":e}};function O(t,e){if(1&t&&(g.TgZ(0,"tr"),g.TgZ(1,"td"),g._uU(2),g.qZA(),g.TgZ(3,"td",27),g._uU(4),g.qZA(),g.TgZ(5,"td",27),g._uU(6),g.qZA(),g.TgZ(7,"td",28),g._uU(8),g.qZA(),g.qZA()),2&t){const t=e.$implicit,i=e.index;g.xp6(2),g.Oqu(i+1),g.xp6(2),g.Oqu(t.company),g.xp6(2),g.Oqu(t.email),g.xp6(1),g.Q6J("ngClass",g.WLB(5,H,t.status,3===t.status)),g.xp6(1),g.hij(" ",1===t.status?"\u0110\xe3 g\u1eedi":"Ch\u01b0a g\u1eedi"," ")}}function Q(t,e){if(1&t&&(g.TgZ(0,"div",24),g.TgZ(1,"h5"),g._uU(2,"DANH S\xc1CH EMAIL \u0110\u01af\u1ee2C TH\xd4NG B\xc1O"),g.qZA(),g.TgZ(3,"table",25),g.TgZ(4,"thead"),g.TgZ(5,"tr"),g.TgZ(6,"th"),g._uU(7,"STT"),g.qZA(),g.TgZ(8,"th"),g._uU(9,"H\u1ecd v\xe0 t\xean"),g.qZA(),g.TgZ(10,"th"),g._uU(11,"Email"),g.qZA(),g.TgZ(12,"th",26),g._uU(13,"Tr\u1ea1ng th\xe1i"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(14,"tbody"),g.YNc(15,O,9,8,"tr",23),g.qZA(),g.qZA(),g.qZA()),2&t){const t=g.oxw();g.Q6J("@slideIn",void 0),g.xp6(15),g.Q6J("ngForOf",t.dataJson)}}function Y(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"button",29),g.NdJ("click",function(){return g.CHM(t),g.oxw().sendMail()}),g._uU(1,"G\u1eedi mail"),g.qZA()}}let $=(()=>{class t{constructor(t,e,i,n){this.plus=t,this.fb=e,this.router=i,this.httpClient=n,this.user=this.plus.user.getValue(),this.from=this.plus.user.getValue().unit,this.api="dien-mat-troi",this.title="\u0110i\u1ec7n m\u1eb7t tr\u1eddi",this.errData=[],this.dataJson=[],this.resent=[],this.i=0,this.checkBody=this.fb.group({email:["",[o.kI.required,o.kI.email]],from:["\u0110i\u1ec7n l\u1ef1c Xu\xe2n L\u1ed9c",[o.kI.required,o.kI.minLength(10)]],title:["Th\xf4ng b\xe1o chi ti\u1ebft ti\u1ec1n \u0111i\u1ec7n m\u1eb7t tr\u1eddi tr\xean m\xe1i nh\xe0 th\xe1ng ",[o.kI.required,o.kI.minLength(3)]],message:["",[o.kI.required,o.kI.minLength(1010)]],company:["",[o.kI.required,o.kI.minLength(10)]],index:[,o.kI.max(1e3)]})}ngOnInit(){this.init(),this.plus.setTiTle(this.title)}init(){if((JSON.parse(localStorage.getItem(this.api))||[]).filter(t=>{0===t.status&&this.resent.push(t)}),0==this.from.length){const t=this.plus.user.getValue().unit;t?this.from=t:this.plus.alertToasrt({err:"B\u1ea1n ch\u01b0a khai b\xe1o \u0111\u01a1n v\u1ecb t\u1ea1i m\u1ee5c T\xe0i Kho\u1ea3n"}),console.log(t)}if(this.resent.length>0){console.log(this.resent);const t=confirm("G\u1eedi l\u1ea1i c\xe1c email ch\u01b0a ho\xe0n th\xe0nh?");t?this.dataJson=this.resent:localStorage.removeItem(this.api),t?this.dataJson=this.resent:(localStorage.removeItem(this.api),this.reset())}else this.reset(),localStorage.removeItem(this.api)}selectedFile(t){console.log(t);const e=t[0];t.forEach((t,i)=>{if("x"==t[1]||"X"==t[1]){let n="<ul>";for(let i=3;i<=16;i++)n+=i<12?`<li>${e[i]}: ${t[i]}.</li>`:i>11?`<li>${e[i]}: ${this.plus.numberWithCommas(t[i])}.</li>`:"";let s={from:this.from,status:0,err:"",email:t[2],title:`${this.checkBody.get("title").value}`,company:t[4],index:i,message:`<p>K\xednh g\u1eedi kh\xe1ch h\xe0ng: ${t[4]}.</p>\n          <p>\u0110i\u1ec7n l\u1ef1c Xu\xe2n L\u1ed9c k\xednh g\u1eedi \u0111\u1ebfn qu\xfd kh\xe1ch h\xe0ng n\u1ed9i dung thanh to\xe1n ti\u1ec1n \u0111i\u1ec7n m\u1eb7t tr\u1eddi tr\xean m\xe1i nh\xe0 v\u1edbi n\u1ed9i dung nh\u01b0 sau:</p>\n          ${n}</ul>\n          <p>M\u1ecdi \xfd ki\u1ebfn th\u1eafc m\u1eafc, vui l\xf2ng li\xean h\u1ec7 \u0110i\u1ec7n l\u1ef1c Xu\xe2n L\u1ed9c qua s\u1ed1 \u0111i\u1ec7n tho\u1ea1i Mr. \u0110\u1ea1t - <a href="tel:0937232239">0937232239 </a> ho\u1eb7c Mrs. Ph\u01b0\u1edbc Anh - <a href="tel:0583223344" >0583223344 </a> \u0111\u1ec3 \u0111\u01b0\u1ee3c gi\u1ea3i \u0111\xe1p.</p>\n          <p>Ph\u1ea3n h\u1ed3i h\xf3a \u0111\u01a1n qu\xfd kh\xe1ch vui l\xf2ng g\u1eedi email v\u1ec1 c\u1ea3 02 \u0111\u1ecba ch\u1ec9: <a href="mailto:dienlucxuanloc.nlmt@gmail.com;tckt.dlxl.pcdn@gmail.com">dienlucxuanloc.nlmt@gmail.com</a> v\xe0 <a href="mailto:dienlucxuanloc.nlmt@gmail.com;tckt.dlxl.pcdn@gmail.com">tckt.dlxl.pcdn@gmail.com</a> </p>\n          Tr\xe2n tr\u1ecdng.`};if(this.checkBody.patchValue(s),this.checkBody.valid)console.log(s),this.dataJson.push(s),this.plus.pushLocalStorage(this.api,s);else{const t=this.plus.getErrValidateForm(this.checkBody);s.err=t,console.log(t),this.errData.push(s)}}this.errData.length>0&&localStorage.setItem(this.api,JSON.stringify([]))}),0==this.dataJson.length&&this.plus.alertWarning("B\u1ea1n ch\u01b0a ch\u1ecdn g\u1eedi trong file excel")}sendDefault(){const t=this.dataJson.map(t=>t.company),e={from:this.from,status:0,err:"",email:"thucspc@gmail.com",title:`B\xe1o c\xe1o th\u1ef1c hi\u1ec7n g\u1eedi ${this.checkBody.value.title}`,index:0,message:` <p> K\xednh g\u1eedi \xf4ng: Tr\u1ea7n \u0110\u1ea1i Th\u1ee9c.</p>\n      <p>  ${this.plus.user.getValue().fullName} (${this.plus.user.getValue()._id}) th\u1ef1c hi\u1ec7n g\u1eedi th\xf4ng b\xe1o ti\u1ec1n \u0111i\u1ec7n m\u1eb7t tr\u1eddi cho ${this.dataJson.length} kh\xe1ch h\xe0ng:</p>\n      <ul>\n      <li> ${t.join(".</li><li>")}.</li>\n      </ul>\n      <p>Tr\xe2n tr\u1ecdng.</p>`};this.plus.sendMail(e,"mail/bao-cao").subscribe(t=>{console.log("bodydefault")})}sendMail(){return L(this,void 0,void 0,function*(){const t=this.dataJson.length,e=confirm("Th\u1ef1c hi\u1ec7n g\u1eedi "+t+" email?");if(t>200)this.plus.alertToasrt({war:"Vui l\xf2ng l\u1eadp danh s\xe1ch d\u01b0\u1edbi 200 email"});else if(0===this.errData.length&&t>0&&e){this.sendDefault(),this.plus.logger(this.api,this.plus.user.getValue()._id+" send mail"+t,"POTS",!0);let e=0;const i=this.dataJson.length;for(;e<i;){yield this.plus.sleep(5e3),this.i=e;const t=this.dataJson[e];this.plus.httpPost("mail/dien-mat-troi",t).subscribe(t=>{this.plus.logger(this.api,this.plus.user.getValue()._id+JSON.stringify(t),"Send Mail",!0);const i=t.index;console.log("Mail sent: ",i,t.email),i>=0&&t.email?(this.dataJson.filter((e,i)=>{e.index===t.index&&(this.dataJson[i].status=1)}),console.log(e,t.email),localStorage.setItem(this.api,JSON.stringify(this.dataJson))):this.plus.alertToasrt(t)},i=>{this.dataJson[e].status=0,localStorage.setItem(this.api,JSON.stringify(this.dataJson)),this.plus.alertToasrt({err:` Ch\u01b0a g\u1eedi email \u0111\u1ebfn ${t.reciver}`}),this.plus.logger(this.api,this.plus.user.getValue()._id+` Ch\u01b0a g\u1eedi email \u0111\u1ebfn ${t.reciver}`,"Post",!1)}),e++}}else this.plus.alertToasrt({war:"\u0110\xe3 h\u1ee7y thao t\xe1c!"}),this.reload()})}pre(){this.i>0?this.i--:this.i=0}next(){this.i<this.dataJson.length-1?this.i++:this.i=1}reset(){this.dataJson=[],this.errData=[],sessionStorage.removeItem("htmlContentMain")}reload(){return L(this,void 0,void 0,function*(){return yield this.router.navigate([""]),this.router.navigate(["email/dien-mat-troi"])})}test(t){console.log(t)}}return t.\u0275fac=function(e){return new(e||t)(g.Y36(p.T),g.Y36(o.qu),g.Y36(m.F0),g.Y36(l.eN))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-dienmattroi"]],decls:16,vars:9,consts:[[1,"container"],[1,"text-center","my-3","text-primary"],[1,"modal-body"],[1,"form-group",3,"formGroup"],["matInput","","required","","placeholder","Nh\u1eadp n\u1ed9i dung ti\xeau \u0111\u1ec1","formControlName","title"],[3,"dbName","api","xlsMail"],["type","button","class","btn btn-outline-danger mx-3",3,"click",4,"ngIf"],["class","card border-primary my-3",4,"ngIf"],["class","alert-danger my-4 justify-content-center",4,"ngIf"],["class","dataOk",4,"ngIf"],["type","button","class","btn btn-primary mx-3","data-toggle","modal","data-target","#modelId",3,"click",4,"ngIf"],["type","button",1,"btn","btn-outline-danger","mx-3",3,"click"],[1,"card","border-primary","my-3"],[1,"button"],["type","button",1,"btn","btn-danger","float-left",3,"click"],["aria-hidden","true",1,"fa","fa-arrow-left"],["type","button",1,"btn","btn-danger","float-right",3,"click"],["aria-hidden","true",1,"fa","fa-arrow-right"],[1,"card-body"],[1,"text-center","rounded","font-weigth-bold","bg-warning","py-2"],[3,"innerHTML"],[1,"alert-danger","my-4","justify-content-center"],[1,"table","table-hover","table-invert","table-bordered"],[4,"ngFor","ngForOf"],[1,"dataOk"],[1,"table","table-hover"],[1,"text-center"],["scope","row"],[1,"text-center",3,"ngClass"],["type","button","data-toggle","modal","data-target","#modelId",1,"btn","btn-primary","mx-3",3,"click"]],template:function(t,e){1&t&&(g.TgZ(0,"div",0),g.TgZ(1,"h5",1),g._uU(2,"TH\xd4NG B\xc1O TI\u1ec0N \u0110I\u1ec6N M\u1eb6T TR\u1edcI"),g.qZA(),g.TgZ(3,"div",2),g.TgZ(4,"form",3),g.TgZ(5,"mat-form-field"),g.TgZ(6,"mat-label"),g._uU(7,"Ti\xeau \u0111\u1ec1"),g.qZA(),g._UZ(8,"textarea",4),g.qZA(),g.qZA(),g.qZA(),g.TgZ(9,"app-read-to-mail",5),g.NdJ("xlsMail",function(t){return e.selectedFile(t)}),g.qZA(),g.YNc(10,B,2,0,"button",6),g.YNc(11,S,11,4,"div",7),g.YNc(12,E,5,2,"div",8),g.YNc(13,Q,16,2,"div",9),g.YNc(14,Y,2,0,"button",10),g._UZ(15,"hr"),g.qZA()),2&t&&(g.Q6J("@slideIn",void 0),g.xp6(4),g.Q6J("formGroup",e.checkBody),g.xp6(5),g.Q6J("dbName","email")("api",e.api),g.xp6(1),g.Q6J("ngIf",e.dataJson.length>0),g.xp6(1),g.Q6J("ngIf",e.dataJson.length>0&&0==e.errData.length),g.xp6(1),g.Q6J("ngIf",e.errData.length>0),g.xp6(1),g.Q6J("ngIf",e.dataJson.length>0&&0===e.errData.length),g.xp6(1),g.Q6J("ngIf",0===e.errData.length&&e.dataJson.length>0))},directives:[o._Y,o.JL,o.sg,U.KE,U.hX,w.Nt,o.Fj,o.Q7,o.JJ,o.u,M,r.O5,r.sg,r.mk],styles:[""],data:{animation:[d.Ym]}}),t})();class G{constructor(t,e,i,n){this.loader=t,this.url=e,this.http=i,this.plus=n}uploadFile(t,e,i){let n=new FormData;const s=new l.WM({"ngsw-bypass":""});return n.append("file",t),console.log("formData",n),new l.LE,this.http.post("https://up-log.herokuapp.com/upload",n,{headers:s})}upload(){return new Promise((t,e)=>{this.loader.file.then(i=>{this.uploadFile(i,this.url,"test").subscribe(e=>{console.log(e),t({default:e.url})},t=>{e("L\u1ed7i k\u1ebft n\u1ed1i kho l\u01b0u tr\u1eef.\nVui l\xf2ng th\u1eed l\u1ea1i sau \xedt ph\xfat!"),console.log(i)})})})}abort(){console.log("abort")}}function V(t,e){if(1&t&&(g.TgZ(0,"div",8),g.TgZ(1,"div",9),g._uU(2),g.qZA(),g.qZA()),2&t){const t=g.oxw();g.xp6(1),g.Udp("width",t.uploadProgress+"%"),g.xp6(1),g.hij("",t.uploadProgress,"%")}}function P(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"div",0),g.TgZ(1,"div",1),g.TgZ(2,"span",2),g._uU(3,"\u0110\u01b0\u1eddng d\u1eabn file t\u1ea3i l\xean:"),g.qZA(),g.qZA(),g._UZ(4,"input",10),g.TgZ(5,"div",11),g.TgZ(6,"button",12),g.NdJ("click",function(){return g.CHM(t),g.oxw().copyInputMessage("linkcopy")}),g._UZ(7,"i",13),g.qZA(),g.qZA(),g.qZA()}if(2&t){const t=g.oxw();g.xp6(4),g.s9C("value",t.linkUpload)}}let j=(()=>{class t{constructor(t,e){this.plus=t,this.httpClient=e,this.apiUpload="https://api.cloudinary.com/v1_1/dienluc/image/upload",this.uploadProgress=0,this.place="Ch\u1ecdn file",this.linkUpload=""}ngOnInit(){}uploadDrive(t){const e=t.target.files[0].size||0;if(console.log(e),e>0?this.plus.load():this.plus.loaded(),e>10485760)return this.plus.alertToasrt({war:"Dung l\u01b0\u1ee3ng file qu\xe1 10Mb"}),void this.plus.loaded();const i=new FormData;i.append("file",t.target.files[0]);for(let n=0;n<t.target.files.length;n++)i.append("file",t.target.files[n]),i.append("api_key","942981119615178"),i.append("cloud_name","dienluc"),i.append("upload_preset","lgnigzh2"),new l.WM({"ngsw-bypass":""}),this.httpClient.post(this.apiUpload,i,{reportProgress:!0,observe:"events"}).subscribe(t=>{console.log(t),t.type===l.dt.UploadProgress?this.uploadProgress=Math.round(t.loaded/t.total*100):t.type===l.dt.Response&&(this.place="\u0110\xe3 upload xong!",this.linkUpload=t.body.url,this.plus.copyToClipboard(t.body.url),this.plus.loaded())},t=>{this.plus.loaded(),this.plus.alertToasrt({err:"L\u1ed7i upload file! \nVui l\xf2ng th\u1eed l\u1ea1i!"})})}get(){this.httpClient.get("https://942981119615178:fvO34914PdLgXjdv1Az5jg2mVno@api.cloudinary.com/v1_1/dienluc/resources/image").subscribe(t=>{})}copyInputMessage(t){this.plus.copyInputMessage(t)}}return t.\u0275fac=function(e){return new(e||t)(g.Y36(p.T),g.Y36(l.eN))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-cloudinary"]],decls:10,vars:2,consts:[[1,"input-group","mb-3"],[1,"input-group-prepend"],[1,"input-group-text"],[1,"custom-file"],["type","file","id","inputGroupFile01",1,"custom-file-input",3,"change"],["for","inputGroupFile01",1,"custom-file-label"],["class","progress",4,"ngIf"],["class","input-group mb-3",4,"ngIf"],[1,"progress"],["role","progressbar","aria-valuenow","0","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","bg-primary"],["type","text","id","linkcopy",1,"form-control",3,"value"],[1,"input-group-append"],["type","button",1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"fa","fa-copy"]],template:function(t,e){1&t&&(g.TgZ(0,"div",0),g.TgZ(1,"div",1),g.TgZ(2,"span",2),g._uU(3,"PDF/IMG"),g.qZA(),g.qZA(),g.TgZ(4,"div",3),g.TgZ(5,"input",4),g.NdJ("change",function(t){return e.uploadDrive(t)}),g.qZA(),g.TgZ(6,"label",5),g._uU(7,"Ch\u1ecdn file upload"),g.qZA(),g.qZA(),g.qZA(),g.YNc(8,V,3,3,"div",6),g.YNc(9,P,8,1,"div",7)),2&t&&(g.xp6(8),g.Q6J("ngIf",e.uploadProgress>0&&e.uploadProgress<100),g.xp6(1),g.Q6J("ngIf",e.linkUpload))},directives:[r.O5],styles:[""]}),t})();var X=function(t,e,i,n){return new(i||(i=Promise))(function(s,a){function o(t){try{l(n.next(t))}catch(e){a(e)}}function r(t){try{l(n.throw(t))}catch(e){a(e)}}function l(t){t.done?s(t.value):function(t){return t instanceof i?t:new i(function(e){e(t)})}(t.value).then(o,r)}l((n=n.apply(t,e||[])).next())})};const R=["myEditor"];function K(t,e){if(1&t&&(g.TgZ(0,"tr"),g.TgZ(1,"td"),g._uU(2),g.qZA(),g.TgZ(3,"td"),g._uU(4),g.qZA(),g.TgZ(5,"td"),g._uU(6),g.qZA(),g.qZA()),2&t){const t=e.$implicit;g.xp6(2),g.hij(" ",t.receiver," "),g.xp6(2),g.hij(" ",t.email," "),g.xp6(2),g.hij(" ",t.err," ")}}function W(t,e){if(1&t&&(g.TgZ(0,"div"),g.TgZ(1,"h4",17),g._uU(2,"DANH S\xc1CH D\u1eee LI\u1ec6U KH\xd4NG H\u1ee2P L\u1ec6"),g.qZA(),g.TgZ(3,"table",18),g.TgZ(4,"tr",19),g.TgZ(5,"th"),g._uU(6,"Kh\xe1ch h\xe0ng "),g.qZA(),g.TgZ(7,"th"),g._uU(8," Email "),g.qZA(),g.TgZ(9,"th"),g._uU(10," N\u1ed9i dung l\u1ed7i "),g.qZA(),g.qZA(),g.YNc(11,K,7,3,"tr",20),g.qZA(),g.qZA()),2&t){const t=g.oxw();g.xp6(11),g.Q6J("ngForOf",t.errData)}}function z(t,e){1&t&&(g.TgZ(0,"label",21),g._UZ(1,"i",22),g._uU(2,"Danh s\xe1ch g\u1eedi email "),g.qZA())}function tt(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"button",23),g.NdJ("click",function(){return g.CHM(t),g.oxw().checkImportData()}),g._uU(1,"Ki\u1ec3m tra "),g.qZA()}}function et(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"button",23),g.NdJ("click",function(){return g.CHM(t),g.oxw().reload()}),g._uU(1,"L\xe0m l\u1ea1i "),g.qZA()}}const it=function(t,e){return{"bg-success":t,"bg-danger":e}};function nt(t,e){if(1&t&&(g.TgZ(0,"tr"),g.TgZ(1,"td"),g._uU(2),g.qZA(),g.TgZ(3,"td",28),g._uU(4),g.qZA(),g.TgZ(5,"td",28),g._uU(6),g.qZA(),g.TgZ(7,"td",29),g._uU(8),g.qZA(),g.qZA()),2&t){const t=e.$implicit,i=e.index;g.Q6J("@slideIn",void 0),g.xp6(2),g.Oqu(i+1),g.xp6(2),g.Oqu(t.receiver),g.xp6(2),g.Oqu(t.email),g.xp6(1),g.Q6J("ngClass",g.WLB(6,it,t.status,3===t.status)),g.xp6(1),g.hij(" ",1===t.status?"\u0110\xe3 g\u1eedi":"Ch\u01b0a g\u1eedi","")}}function st(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"button",30),g.NdJ("click",function(){return g.CHM(t),g.oxw(2).sendMail()}),g._uU(1,"G\u1eedi mail"),g.qZA()}}function at(t,e){if(1&t&&(g.TgZ(0,"div",24),g.TgZ(1,"h5"),g._uU(2,"DANH S\xc1CH EMAIL \u0110\u01af\u1ee2C TH\xd4NG B\xc1O"),g.qZA(),g.TgZ(3,"table",25),g.TgZ(4,"thead"),g.TgZ(5,"tr"),g.TgZ(6,"th"),g._uU(7,"STT"),g.qZA(),g.TgZ(8,"th"),g._uU(9,"Ng\u01b0\u1eddi nh\u1eadn"),g.qZA(),g.TgZ(10,"th"),g._uU(11,"Email"),g.qZA(),g.TgZ(12,"th",26),g._uU(13,"Tr\u1ea1ng th\xe1i"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(14,"tbody"),g.YNc(15,nt,9,9,"tr",20),g.qZA(),g.qZA(),g.YNc(16,st,2,0,"button",27),g.qZA()),2&t){const t=g.oxw();g.xp6(15),g.Q6J("ngForOf",t.dataJson),g.xp6(1),g.Q6J("ngIf",0===t.errData.length&&t.dataJson.length>0)}}function ot(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"button",38),g.NdJ("click",function(){return g.CHM(t),g.oxw(2).pre()}),g._UZ(1,"i",39),g.qZA()}}function rt(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"button",40),g.NdJ("click",function(){return g.CHM(t),g.oxw(2).next()}),g._UZ(1,"i",41),g.qZA()}}function lt(t,e){if(1&t&&g._UZ(0,"div",42),2&t){const t=g.oxw(2);g.Q6J("innerHTML",t.dataJson[t.i].message,g.oJD)}}function ht(t,e){if(1&t&&(g.TgZ(0,"div",31),g.TgZ(1,"div",32),g.YNc(2,ot,2,0,"button",33),g.YNc(3,rt,2,0,"button",34),g.qZA(),g.TgZ(4,"div",35),g.TgZ(5,"h5",36),g._uU(6),g.qZA(),g.YNc(7,lt,1,1,"div",37),g.qZA(),g._UZ(8,"hr"),g.qZA()),2&t){const t=g.oxw();g.xp6(2),g.Q6J("ngIf",t.i>0&&t.dataJson.length>t.i),g.xp6(1),g.Q6J("ngIf",t.dataJson.length-1>t.i),g.xp6(3),g.hij("N\u1ed9i dung \u0111\u01b0\u1ee3c g\u1eedi \u0111\u1ebfn email ",t.dataJson[t.i].email," "),g.xp6(1),g.Q6J("ngIf",t.dataJson[t.i].message)}}let ct=(()=>{class t{constructor(t,e,i,n){this.plus=t,this.fb=e,this.httpClient=i,this.router=n,this.Editor=c,this.apiUpload="https://up-log.herokuapp.com/upload",this.collection="thong-bao",this.db=null,this.dbName="email",this.dbVer=1,this.selectedFile=null,this.dataImport=[],this.dataJson=[],this.errData=[],this.sent=[],this.resent=[],this.send="",this.htmlContent=sessionStorage.getItem("htmlContent")||"",this.uploadProgress=0,this.i=0,this.main=this.fb.group({email:[,o.kI.email],title:["Th\xf4ng b\xe1o ",[o.kI.minLength(3)]],message:["\u0110i\u1ec7n l\u1ef1c xin th\xf4ng b\xe1o nh\u01b0 sau:",o.kI.minLength(10)]}),this.account=this.fb.group({user:["",o.kI.minLength(3)],pass:["",o.kI.minLength(6)]}),this.checkBody=this.fb.group({from:["",[o.kI.required,o.kI.minLength(10)]],status:0,err:"",email:[,o.kI.email],receiver:["",[o.kI.required,o.kI.minLength(3)]],title:["",[o.kI.required,o.kI.minLength(3)]],message:["",[o.kI.required,o.kI.minLength(1020)]]}),this.uploadForm=this.fb.group({profile:[""]})}ngOnInit(){this.reset(),this.plus.IDB_InitDB(this.dbName).subscribe(t=>{this.db=t,this.init()}),this.plus.httpGetFull(this.apiUpload).subscribe(t=>{console.log(t)})}onReady(t){t.ui.getEditableElement().parentElement.insertBefore(t.ui.view.toolbar.element,t.ui.getEditableElement()),t.plugins.get("FileRepository").createUploadAdapter=t=>(console.log(btoa(t.file)),new G(t,"/upload",this.httpClient,this.plus))}saveArticle(){this.dataJson.length>0&&(this.plus.alertToasrt({war:"B\u1ea1n c\u1ea7n ch\u1ecdn l\u1ea1i danh s\xe1ch nh\u1eadn email sau khi hi\u1ec7u ch\u1ec9nh n\u1ed9i dung!"}),this.reset()),this.htmlContent=this.getArticleContent(),sessionStorage.setItem("htmlContent",this.htmlContent)}getArticleContent(){return this.myEditor&&this.myEditor.editorInstance?this.myEditor.editorInstance.getData():""}init(){this.from=this.plus.user.getValue().unit,this.plus.IDB_DB_GetAll(this.db,this.collection).subscribe(t=>{console.log(t),t.filter(t=>{0==t.status&&(console.log(t),this.resent.push(t))}),this.resent.length>0?(console.log(this.resent),confirm("B\u1ea5m OK \u0111\u1ec3 g\u1eedi mail tr\u01b0\u1edbc ch\u01b0a ho\xe0n th\xe0nh.\nB\u1ea5m Cancel \u0111\u1ec3 x\xf3a phi\xean l\xe0m vi\u1ec7c tr\u01b0\u1edbc?")?this.dataJson=this.resent:this.plus.IDB_DB_ClearCollection(this.db,this.collection).subscribe(t=>{t&&console.log("clear")})):this.plus.IDB_DB_ClearCollection(this.db,this.collection).subscribe(t=>{t&&(console.log("clear"),this.htmlContent="",this.reset())})}),0===this.from.length&&(this.plus.alertToasrt({err:"B\u1ea1n ch\u01b0a khai b\xe1o \u0111\u01a1n v\u1ecb t\u1ea1i m\u1ee5c T\xe0i Kho\u1ea3n"}),this.router.navigateByUrl("/taikhoan"))}getFails(){}readXlsx(t){console.log(t),this.dataJson=[],this.dataImport=[];let e=t.target;const i=new FileReader;i.onload=t=>{const e=u.read(t.target.result,{type:"binary"});this.dataImport=u.utils.sheet_to_json(e.Sheets[e.SheetNames[0]],{header:1}),0==this.dataImport.length&&this.plus.alertWarning("Danh s\xe1ch g\u1eedi tr\u1ed1ng")},i.readAsBinaryString(e.files[0]),e=null}reload(){return X(this,void 0,void 0,function*(){return yield this.router.navigate([""]),this.router.navigate(["email/thongbao"])})}checkImportData(){this.dataImport.length>200&&(this.reset(),this.plus.alertToasrt({err:"S\u1ed1 l\u01b0\u1ee3ng email v\u01b0\u1ee3t qu\xe1 gi\u1edbi h\u1ea1n\nVui l\xf2ng ch\u1ecdn d\u01b0\u1edbi 200 email cho m\u1ed7i l\u1ea7n g\u1eedi!"})),this.dataJson=[],this.dataImport.splice(0,1),this.dataImport.forEach(t=>{let e="";if("x"==t[1]||"X"==t[1]){void 0!==t[5]&&(e="\n"+t[5]+"\n");let i={from:this.from,status:0,err:"",receiver:t[3],email:t[4],title:`${this.main.get("title").value}`,message:`<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; K\xednh g\u1eedi ${t[2]}: ${t[3]}.</p>\n                       ${e} <br>\n                       ${this.htmlContent} <br>\n                      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Tr\xe2n tr\u1ecdng.\n                      </hr>\n                      <table class="table">\n                      <td><img src="https://github.com/thuctd/FileStore/raw/master/NhanHieuDLuc-Doc-150x150.jpg"> </td>\n                      <td>\n                        <b>\u0110i\u1ec7n l\u1ef1c Xu\xe2n L\u1ed9c - C\xf4ng ty TNHH m\u1ed9t th\xe0nh vi\xean \u0110i\u1ec7n l\u1ef1c \u0110\u1ed3ng Nai.</b><br>\n                        <b>\u0110\u1ecba ch\u1ec9: S\u1ed1 94 H\xf9ng V\u01b0\u01a1ng - Th\u1ecb tr\u1ea5n Gia Ray - Huy\u1ec7n Xu\xe2n L\u1ed9c - T\u1ec9nh \u0110\u1ed3ng Nai.</b><br>\n                        <b>MST: 3600432744 - 004</b><br>\n                        <b>Li\xean h\u1ec7: <a href="tel:02512218242" title="02512218242">0251.2218.242 </a></b><br>\n                        <b>T\u1ed5ng \u0111\xe0i ch\u0103m s\xf3c kh\xe1ch h\xe0ng: <a href="tel:19001006">19001006</a> - <a href="tel:19009000">19009000</a></b><br>\n                      </td>\n                      </table>\n                      `};if(console.log(i.message.length),this.checkBody.patchValue(i),this.checkBody.valid)this.dataJson.push(i),i._id=i.email,console.log(i),this.plus.IDB_DB_Add(this.db,this.collection,i);else{if(this.checkBody.valid)return;{console.log("else if");const t=this.plus.getErrValidateForm(this.checkBody);console.log(t),i.err=t,this.errData.push(i)}}if(this.errData.length>0)return console.log(this.errData),this.plus.IDB_DB_ClearCollection(this.db,this.collection).subscribe(t=>{t&&this.plus.alertWarning("D\u1eef li\u1ec7u c\xf3 l\u1ed7i!")});this.plus.loaded()}})}sendDefault(){const t=this.dataJson.map(t=>t.receiver),e={from:this.from,status:0,err:"",email:"thucspc@gmail.com",title:`B\xe1o c\xe1o th\u1ef1c hi\u1ec7n g\u1eedi ${this.checkBody.value.title}`,index:0,message:` <p> K\xednh g\u1eedi \xf4ng: Tr\u1ea7n \u0110\u1ea1i Th\u1ee9c.</p>\n      <p>  ${this.plus.user.getValue().fullName} (${this.plus.user.getValue()._id}) th\u1ef1c hi\u1ec7n g\u1eedi th\xf4ng b\xe1o ti\u1ec1n \u0111i\u1ec7n m\u1eb7t tr\u1eddi cho ${this.dataJson.length} kh\xe1ch h\xe0ng:</p>\n      <ul>\n      <li> ${t.join(".</li><li>")}.</li>\n      </ul>\n      <p>Tr\xe2n tr\u1ecdng.</p>`};this.plus.sendMail(e,"mail/bao-cao").subscribe(t=>{console.log("bodydefault")})}sendMail(){return X(this,void 0,void 0,function*(){const t=confirm("Th\u1ef1c hi\u1ec7n th\xf4ng b\xe1o cho "+this.dataJson.length+" CBCNV?");if(0===this.errData.length&&this.dataJson.length>0&&t){this.sendDefault();let t=0;const e=this.dataJson.length;for(;t<e;){yield this.plus.sleep(5e3),this.i=t;const e=this.dataJson[t];this.plus.sendMail(e,"mail/thong-bao").subscribe(i=>{console.log(),i.email&&(this.dataJson.filter((t,e)=>{t.email===i.email&&(this.dataJson[e].status=1,this.plus.IDB_DB_DeleteOne(this.db,this.collection,t.email))}),console.log(t,i.email,e.reciver),localStorage.setItem("notify",JSON.stringify(this.dataJson)))},i=>{this.dataJson[t].status=0,localStorage.setItem("notify",JSON.stringify(this.dataJson)),this.plus.alertToasrt({err:` Ch\u01b0a g\u1eedi email \u0111\u1ebfn ${e.reciver}`})}),t++}}else this.plus.alertToasrt({war:"\u0110\xe3 h\u1ee7y thao t\xe1c!"}),window.location.reload()})}uploadDrive(t){this.plus.load(),console.log(t.target.files[0]);const e=t.target.files[0].size;if(console.log(e),e>52428800)return this.plus.alertToasrt({war:"Dung l\u01b0\u1ee3ng file qu\xe1 50Mb"}),void this.plus.loaded();const i=new FormData;i.append("file",t.target.files[0]);const n=new l.WM({"ngsw-bypass":""});this.httpClient.post(this.apiUpload,i,{reportProgress:!0,observe:"events",headers:n}).subscribe(t=>{t.type===l.dt.UploadProgress?this.uploadProgress=Math.round(t.loaded/t.total*100):t.type===l.dt.Response&&(this.linkUpload=t.body.url,this.plus.pushLocalStorage("link",t.body.url),this.plus.loaded())},t=>{this.plus.loaded(),this.plus.alertToasrt({err:"L\u1ed7i upload file! \nVui l\xf2ng th\u1eed l\u1ea1i!"})})}copyInputMessage(t){this.plus.copyInputMessage(t)}getBase64(t){const e=new FileReader;return e.readAsDataURL(t),e.onload=()=>{},e.onerror=t=>{console.log("Error: ",t)},e.result}pre(){this.i>0?this.i--:this.i=0}next(){this.i<this.dataJson.length-1?this.i++:this.i=0}reset(){this.dataJson=[],this.errData=[],this.linkUpload="",this.uploadProgress=0}logList(t){this.dataJson.splice(0,1),localStorage.setItem("sendmail",this.dataJson.toString())}sliceList(t){}export(t){this.plus.exportHTML(t)}}return t.\u0275fac=function(e){return new(e||t)(g.Y36(p.T),g.Y36(o.qu),g.Y36(l.eN),g.Y36(m.F0))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-notify"]],viewQuery:function(t,e){if(1&t&&g.Gf(R,5),2&t){let t;g.iGM(t=g.CRH())&&(e.myEditor=t.first)}},decls:26,vars:10,consts:[[1,"container","my-3"],[1,"text-center","text-primary"],[1,"import"],[1,"modal-body"],[1,"form-group",3,"formGroup"],["for",""],["type","text","required","","placeholder","Nh\u1eadp n\u1ed9i dung ti\xeau \u0111\u1ec1","formControlName","title",1,"form-control"],[3,"editor","data","ready","change"],["myEditor",""],[4,"ngIf"],[1,"list"],["target","_blank","href","https://github.com/thuctd/FileStore/raw/master/templates/MauThongBao.xlsx",1,"badge","badge-warning"],["for","file-import","class","custom-file-upload mx-5",4,"ngIf"],["hidden","","id","file-import","type","file","multiple","false",3,"change"],["type","button","class","btn btn-outline-primary mx-3",3,"click",4,"ngIf"],["class","dataOk",4,"ngIf"],["class","card border-primary rounded",4,"ngIf"],[1,"text-center","bg-warning","rounded-pill"],[1,"table","table-hover","table-invert","table-bordered","rounded-pill"],[1,"text-center","bg-danger"],[4,"ngFor","ngForOf"],["for","file-import",1,"custom-file-upload","mx-5"],[1,"fa","fa-address-book"],["type","button",1,"btn","btn-outline-primary","mx-3",3,"click"],[1,"dataOk"],[1,"table","table-hover"],[1,"text-center"],["type","button","class","btn btn-primary mx-3 text-center","data-toggle","modal","data-target","#modelId",3,"click",4,"ngIf"],["scope","row"],[1,"text-center",3,"ngClass"],["type","button","data-toggle","modal","data-target","#modelId",1,"btn","btn-primary","mx-3","text-center",3,"click"],[1,"card","border-primary","rounded"],[1,"button"],["type","button","class","btn btn-danger float-left",3,"click",4,"ngIf"],["type","button","class","btn btn-danger float-right",3,"click",4,"ngIf"],[1,"card-body"],[1,"text-center","rounded","font-weigth-bold","bg-warning","my-4"],[3,"innerHTML",4,"ngIf"],["type","button",1,"btn","btn-danger","float-left",3,"click"],["aria-hidden","true",1,"fa","fa-arrow-left"],["type","button",1,"btn","btn-danger","float-right",3,"click"],["aria-hidden","true",1,"fa","fa-arrow-right"],[3,"innerHTML"]],template:function(t,e){1&t&&(g.TgZ(0,"div",0),g.TgZ(1,"h5",1),g._uU(2,"G\u1eecI TH\xd4NG B\xc1O B\u1eb0NG EMAIL"),g.qZA(),g.TgZ(3,"div",2),g.TgZ(4,"div",3),g.TgZ(5,"form",4),g.TgZ(6,"label",5),g._uU(7,"Ti\xeau \u0111\u1ec1"),g.qZA(),g._UZ(8,"input",6),g.qZA(),g.qZA(),g._UZ(9,"app-cloudinary"),g.TgZ(10,"h4",1),g._uU(11,"So\u1ea1n th\u1ea3o"),g.qZA(),g.TgZ(12,"ckeditor",7,8),g.NdJ("ready",function(t){return e.onReady(t)})("change",function(){return e.saveArticle()}),g.qZA(),g.YNc(14,W,12,1,"div",9),g.TgZ(15,"div",10),g._UZ(16,"hr"),g.TgZ(17,"a",11),g._uU(18,"File m\u1eabu"),g.qZA(),g.YNc(19,z,3,0,"label",12),g.TgZ(20,"input",13),g.NdJ("change",function(t){return e.readXlsx(t)}),g.qZA(),g.YNc(21,tt,2,0,"button",14),g.YNc(22,et,2,0,"button",14),g.qZA(),g.YNc(23,at,17,2,"div",15),g._UZ(24,"hr"),g.qZA(),g.YNc(25,ht,9,4,"div",16),g.qZA()),2&t&&(g.Q6J("@slideIn",void 0),g.xp6(5),g.Q6J("formGroup",e.main),g.xp6(7),g.s9C("data",e.htmlContent),g.Q6J("editor",e.Editor),g.xp6(2),g.Q6J("ngIf",e.errData.length>0),g.xp6(5),g.Q6J("ngIf",0===e.dataJson.length),g.xp6(2),g.Q6J("ngIf",e.dataImport.length>0&&0===e.dataJson.length&&0===e.errData.length),g.xp6(1),g.Q6J("ngIf",e.errData.length>0),g.xp6(1),g.Q6J("ngIf",e.dataJson.length>0&&0==e.errData.length),g.xp6(2),g.Q6J("ngIf",e.dataJson.length>0&&0===e.errData.length))},directives:[o._Y,o.JL,o.sg,o.Fj,o.Q7,o.JJ,o.u,j,f.u,r.O5,r.sg,r.mk],styles:[""],data:{animation:[d.Ym,d.Mq]}}),t})(),ut=(()=>{class t{constructor(t){this.plus=t,this.db=null,this.verDB=1,this.dbName="email",this.api="email"}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(g.Y36(p.T))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-email"]],decls:0,vars:0,template:function(t,e){},styles:[""]}),t})(),dt=(()=>{class t{constructor(t){this.plus=t}canActivate(){return this.plus.checkPer("thong-bao")}}return t.\u0275fac=function(e){return new(e||t)(g.LFG(p.T))},t.\u0275prov=g.Yz7({token:t,factory:t.\u0275fac}),t})(),gt=(()=>{class t{constructor(t){this.plus=t}canActivate(){return this.plus.checkPer("tien-luong")}}return t.\u0275fac=function(e){return new(e||t)(g.LFG(p.T))},t.\u0275prov=g.Yz7({token:t,factory:t.\u0275fac}),t})(),pt=(()=>{class t{constructor(t){this.plus=t}canActivate(){return this.plus.checkPer("dien-mat-troi")}}return t.\u0275fac=function(e){return new(e||t)(g.LFG(p.T))},t.\u0275prov=g.Yz7({token:t,factory:t.\u0275fac}),t})();const mt=[{path:"",component:ut},{path:"thong-bao",component:ct,canActivate:[dt]},{path:"tien-luong",component:_,canActivate:[gt]},{path:"dien-mat-troi",component:$,canActivate:[pt]}];let ft=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=g.oAB({type:t}),t.\u0275inj=g.cJS({providers:[dt,gt,pt],imports:[[m.Bz.forChild(mt)],m.Bz]}),t})();var bt=i(48387);let Zt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=g.oAB({type:t}),t.\u0275inj=g.cJS({imports:[[r.ez,ft,o.u5,o.UX,f.d,bt.D,a.ShareModule,s.qX,n.k]]}),t})()}}]);