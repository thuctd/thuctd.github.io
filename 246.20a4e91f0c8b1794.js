"use strict";(self.webpackChunkdlxl=self.webpackChunkdlxl||[]).push([[246],{55321:(W,O,r)=>{r.d(O,{e:()=>C});var h=r(15861),M=r(29260),x=r(61135),v=r(78372),F=r(95698),V=r(50727),I=r(69751),L=r(92340),D=r(28986),S=r(23970),b=r(84322),g=r(94650),U=r(20948),P=r(47977),w=r(97185),y=r(94559),f=r(54654),A=r(9116),R=r(80529),N=r(52075),T=r(88689);let C=(()=>{class B{constructor(e,t,s,o,l,n,i,a,d){this.auth=e,this.afs=t,this.toastr=s,this.loadSV=o,this.idbSV=l,this.router=n,this.http=i,this.fileSV=a,this.remoteConfig=d,this.basedbName="",this.user=new x.X(void 0),this.setup=JSON.parse(sessionStorage.getItem("setup")),this.nav=new x.X([]),this.subs=new V.w0,this.chunkSize=200}unsubcribe(){this.subs.unsubscribe()}getValueByKey(e){var t=this;return(0,h.Z)(function*(){return t.remoteConfig.getString(e).then(s=>(console.log(s),s)).catch(s=>s)})()}updateLocalDB(e,t,s,o=""){var l=this;return new I.y(n=>{if(this.loadSV.load("updateLocalDB"+e),!navigator.onLine)return n.next(!0),void this.loadSV.loaded("updateLocalDB"+e);this.idbSV.IDB_InitDB(s,o).subscribe(function(){var i=(0,h.Z)(function*(a){let d=yield l.idbSV.IDB_GetMax(a,t);yield l.getLastModify(e),0==d?yield l.fileSV.getFileBackup(e).then(function(){var u=(0,h.Z)(function*(p){console.log(p),p.length>0?(l.idbSV.IDB_DB_Add(a,t,p),n.next(!0)):0==p.length&&(l.subs=l.afs.collection(l.basedbName+e,m=>m.where("dateModify",">",0)).valueChanges((0,v.b)(500)).subscribe({next:m=>{console.log("updateLocalDB",l.basedbName+e,t,m,d),l.loadSV.loaded("updateLocalDB"+e),l.idbSV.IDB_DB_Add(a,t,m).then(K=>{n.next(!0),l.backupFileDB(e,a,t)})},error:m=>{console.error("updateLocalDB",m,l.basedbName+e,t,d),n.next(!0),l._toastWarn("Kh\xf4ng c\xf3 d\u1eef li\u1ec7u! \n D\u1eef li\u1ec7u offline s\u1ebd \u0111\u01b0\u1ee3c hi\u1ec3n th\u1ecb n\u1ebfu c\xf3"),l.logger(e,m,"updateLocalDB ")},complete:()=>{l.loadSV.loaded("updateLocalDB"+e),console.log("updateLocalDB complete ",e)}}))});return function(p){return u.apply(this,arguments)}}()).catch(u=>{console.log(u)}):l.subs=l.afs.collection(l.basedbName+e,u=>u.where("dateModify",">",d)).valueChanges((0,v.b)(500)).subscribe({next:u=>{console.log("updateLocalDB",l.basedbName+e,t,u,d),l.loadSV.loaded("updateLocalDB"+e),l.idbSV.IDB_DB_Add(a,t,u),l.backupFileDB(e,a,t),n.next(!0)},error:u=>{l.loadSV.loaded("updateLocalDB"+e),console.error("updateLocalDB",l.basedbName+e,t,d),n.next(!0),l._toastWarn("Kh\xf4ng c\xf3 d\u1eef li\u1ec7u! \n D\u1eef li\u1ec7u offline s\u1ebd \u0111\u01b0\u1ee3c hi\u1ec3n th\u1ecb n\u1ebfu c\xf3"),l.logger(e,u,"updateLocalDB ERR")}})});return function(a){return i.apply(this,arguments)}}())})}backupFileDB(e,t,s){var o=this;this.idbSV.IDB_DB_GetAll(t,s).subscribe(function(){var l=(0,h.Z)(function*(n){let i=n.length,a=yield o.idbSV.IDB_GetMax(t,s);o.getLastModify(e).then(d=>{let c=d;if(!c)return o.fileSV.uploadBackupDB(n,e).then(_=>{o.setLastModify(e,i,a)});(Date.now()>c?.time&&a>c.time+18e5&&i>=c.count||null==c)&&o.fileSV.uploadBackupDB(n,e).then(_=>{o.logger("backupFileDB ",i,e),o.setLastModify(e,i,a)})})});return function(n){return l.apply(this,arguments)}}())}getBackupFile(e,t,s){var o=this;this.fileSV.getFileBackup(e).then(function(){var l=(0,h.Z)(function*(n){o.loadSV.loaded("getBackupFile() loaded"),yield o.idbSV.IDB_DB_ClearCollection(t,s),yield o.idbSV.IDB_DB_Add(t,s,n)});return function(n){return l.apply(this,arguments)}}()).catch(l=>{this.loadSV.loaded("getBackupFile() err loaded")})}setLastModify(e,t,s){var o=this;return(0,h.Z)(function*(){let l=e.replace(/\//g,"-"),n={_id:l,path:e,time:Date.now()+864e5,user:o.userDir.displayName,count:t,lastModify:s};o.FBS_set("backup-file",l,n)})()}getLastModify(e){return new Promise((t,s)=>{let o=e.replace(/\//g,"-");this.afs.collection(this.basedbName+"backup-file").doc(o).get().pipe((0,F.q)(1)).subscribe(l=>{let n=l.data();t(n)})})}getUser(){this.loadSV.load("getUser"),this.auth.user.subscribe(e=>{if(!e)return this.getNavFree();this.afs.collection("user").doc(e.uid).valueChanges().subscribe({next:t=>{this._setOpt(t,"max"),console.log("getUser()",t),this.user.next(t),this.userDir=t,t?.lock&&this.logout(),t&&this.getNav(t),this.loadSV.loaded("getUser")},error:t=>{console.log("getUser()",t),this.loadSV.loaded("getUser")},complete:()=>{console.info("complete getUser")}})})}getNav(e){let t=[];S.w.forEach(s=>{s.sub.forEach(o=>{(e.opt[o.api]>=1&&o.link.length>0||o.guest)&&t.push(o)})}),t.filter(function(s,o,l){return l.indexOf(s)==o}),this.nav.next(t)}getNavFree(){let e=[];S.w.forEach(t=>{t.sub.forEach(s=>{s.guest&&e.push(s)})}),e.filter(function(t,s,o){return o.indexOf(t)==s}),this.nav.next(e)}FBS_set(e,t,s){let o=this.addBaseProperty(s);return this.loadSV.load("FBS_set"),console.log("FBS_set()",this.basedbName+e,t,o),t?this.afs.collection(this.basedbName+e).doc(t).set(o).then(l=>{this.loadSV.loaded("FBS_set"),this.logger(this.basedbName+e,o,"FBS_set ",!0),this._toastSuccess()}).catch(l=>{console.log("FBS_set",e,l),this.loadSV.loaded("FBS_set "),this.logger(this.basedbName+e,o,"FBS_set: ",l),this._toastErr(l)}):alert("_id kh\xf4ng h\u01a1p l\u1ec7")}FBS_setMany(e,t){var s=this;return(0,h.Z)(function*(){if(t.length>1e3)return alert("Vui l\xf2ng thao t\xe1c nh\u1ecf h\u01a1n 1000 d\u1eef li\u1ec7u!");s.loadSV.load("FBS_setMany");let o=s.chunkSize,l=[];for(let n=0;n<t.length;n+=o){const i=t.slice(n,n+o);console.log("chunk",i);const a=s.afs.firestore.batch();for(let d=0;d<i.length;d++){const c=i[d],_=s.afs.firestore.collection(s.basedbName+e).doc(c._id);a.set(_,s.addBaseProperty(c))}l.push(a.commit()),console.log("FBS_setMany",s.basedbName+e,i)}return Promise.all(l).then(n=>{s.logger(s.basedbName+e,t,"FBS_setMany ",!0),s.loadSV.loaded("FBS_setMany"),console.log("FBS_setMany()",s.basedbName+e,t)}).catch(n=>{console.log("FBS_setMany",e,n),s.logger(s.basedbName+e,t,"FBS_setMany ERR ",n)})})()}FBS_add(e,t){return new Promise((s,o)=>{let l=this.addBaseProperty(t);l._id=(0,D.h)(25),console.log(" FBS_add",this.basedbName+e,l),this.afs.collection(this.basedbName+e).doc(l._id).set(l).then(n=>{s(l),this.logger(this.basedbName+e,l,"FBS_add ",!0),this._toastSuccess()}).catch(n=>{console.log("FBS_add",e,n),this._toastErr(n),this.logger(this.basedbName+e,l,"FBS_add: ERR ",n)})})}FBS_addMany(e,t){if(t.length>1e3)return alert("Vui l\xf2ng thao t\xe1c nh\u1ecf h\u01a1n 1000 d\u1eef li\u1ec7u!");this.logger(this.basedbName+e,t,"FBS_addMany ",!0),this.loadSV.load("FBS_addMany");let s=this.chunkSize,o=[];for(let l=0;l<t.length;l+=s){const n=t.slice(l,l+s);console.log("chunk",n);const i=this.afs.firestore.batch();for(let a=0;a<n.length;a++){const d=n[a];d._id=d._id?d._id:(0,D.h)(25);let c=this.addBaseProperty(d);if(c.dateModify=Date.now()+l,!c._id)return alert("_id kh\xf4ng h\u01a1p l\u1ec7");let _=this.Obj_clean(c);const u=this.afs.firestore.collection(this.basedbName+e).doc(_._id);i.set(u,_)}o.push(i.commit()),console.log("FBS_addMany",this.basedbName+e,n)}return Promise.all(o).then(l=>{this._toastSuccess(),this.loadSV.loaded("FBS_addMany"),console.log("FBS_addMany()",this.basedbName+e,t),window.location.reload()}).catch(l=>{console.log("FBS_addMany",e,l),this.logger(this.basedbName+e,t,"FBS_addMany ERR ",l)})}FBS_update(e,t,s){var o=this;return(0,h.Z)(function*(){let l=s;if(l.dateModify=Date.now(),o.loadSV.load("FBS_update"),!t)return alert("_id kh\xf4ng h\u01a1p l\u1ec7");console.log("FBS_update",o.basedbName+e,t,l),yield o.afs.collection(o.basedbName+e).doc(t).update(l).then(n=>{o._toastSuccess(),o.loadSV.loaded("FBS_update"),o.logger(o.basedbName+e,l,"FBS_update: ",!0)}).catch(n=>{o.loadSV.loaded("FBS_update"),console.error("FBS_update",e,n),o.logger(o.basedbName+e,l,"FBS_update: ERR ",n),o._toastErr(n)})})()}FBS_updateMany(e,t){if(t.length>1e3)return alert("Vui l\xf2ng thao t\xe1c nh\u1ecf h\u01a1n 1000 d\u1eef li\u1ec7u!");this.logger(this.basedbName+e,t,"FBS_updateMany ",!0),this.loadSV.load("FBS_updateMany");const s=Date.now();let o=this.chunkSize,l=[];for(let n=0;n<t.length;n+=o){const i=t.slice(n,n+o);console.log("chunk",i);const a=this.afs.firestore.batch();for(let d=0;d<i.length;d++){let _=i[d];if(!_._id)return alert("_id kh\xf4ng h\u01a1p l\u1ec7");_.dateModify=s+d;const u=this.afs.firestore.collection(this.basedbName+e).doc(_._id);a.update(u,_)}l.push(a.commit()),console.log("FBS_updateMany",this.basedbName+e,t)}return Promise.all(l).then(n=>{this._toastSuccess(),this.loadSV.loaded("FBS_updateMany"),console.log("FBS_updateMany()",this.basedbName+e,t)}).catch(n=>{console.error("FBS_updateMany",e,n),this.loadSV.loaded("FBS_updateMany"),this.logger(this.basedbName+e,t,"FBS_updateMany ERR"+n,!1)})}FBS_getById(e,t){return console.log("FBS_getById",this.basedbName+e,t),this.logger(e,t,"FBS_getById",null),this.afs.collection(this.basedbName+e).doc(t).valueChanges()}FBS_GetByQuery(e,t,s,o){return console.log("FBS_GetByQuery",this.basedbName+e,t+s+o),this.logger(e,t+o,"FBS_GetByQuery ",null),this.afs.collection(e,l=>l.where(t,s,o).orderBy(t,"desc")).valueChanges()}FBS_GetAll(e){return this.afs.collection(e).valueChanges()}FBS_Delete_ID(e,t){this.loadSV.load("FBS_Delete_ID",t),this.afs.collection(this.basedbName+e).doc(t).delete().then(s=>{this.logger(this.basedbName+e,t,"FBS_Delete_ID ",!0),this.loadSV.loaded("FBS_Delete_ID",t),this._toastSuccess()}).catch(s=>{console.error("FBS_Delete_ID",e,s),this.logger(this.basedbName+e,t,"FBS_Delete_ID ERR ",s)})}FBS_deleteMany(e,t){if(t.length>1e3)return alert("Vui l\xf2ng thao t\xe1c nh\u1ecf h\u01a1n 1000 d\u1eef li\u1ec7u!");this.logger(this.basedbName+e,t,"FBS_updateMany ",!0),this.loadSV.load("FBS_Delete_ID",e);let s=this.chunkSize,o=[];for(let l=0;l<t.length;l+=s){const n=t.slice(l,l+s);console.log("chunk",n);const i=this.afs.firestore.batch();for(let a=0;a<n.length;a++){const d=n[a],c=this.afs.firestore.collection(this.basedbName+e).doc(d._id);i.delete(c)}o.push(i.commit()),console.log("FBS_updateMany",this.basedbName+e,t)}Promise.all(o).then(l=>{this._toastSuccess(),this.loadSV.loaded("FBS_Delete_ID",e),console.log("FBS_updateMany()",this.basedbName+e,t)}).catch(l=>{console.error("FBS_deleteMany",e,l),this.loadSV.loaded("FBS_Delete_ID",e),this.logger(this.basedbName+e,t,"FBS_updateMany ERR"+l,!1)})}FBS_Disable_ID(e,t){var s=this;return(0,h.Z)(function*(){console.log("FBS_Disable_ID()",s.basedbName+e,t),confirm("B\u1ea1n mu\u1ed1n x\xf3a?")&&(s.loadSV.loaded("FBS_Disable_ID",e),s.afs.collection(s.basedbName+e).doc(t).update({status:0,dateModify:Date.now()}).then(l=>{console.log(l),s.logger(s.basedbName+e,t,"FBS_Delete_ID ",!0),s.loadSV.loaded("FBS_Disable_ID",e)}).catch(l=>{console.error("FBS_Disable_ID",e,l),s.loadSV.loaded("FBS_Disable_ID",e),s.logger(s.basedbName+e,t,"FBS_Delete_ID ERR",l)}))})()}FBS_DisableMany(e,t){this.logger(this.basedbName+e,t,"FBS_DisableMany ",!0),this.loadSV.load("FBS_DisableMany",e);let s=this.chunkSize,o=[];for(let l=0;l<t.length;l+=s){const n=t.slice(l,l+s);console.log("chunk",n);const i=this.afs.firestore.batch();for(let a=0;a<n.length;a++){const d=n[a],c=this.afs.firestore.collection(this.basedbName+e).doc(d._id);i.update(c,{status:0})}o.push(i.commit()),console.log("FBS_DisableMany",this.basedbName+e,t)}Promise.all(o).then(l=>{this._toastSuccess(),this.logger(this.basedbName+e,t,"FBS_DisableMany ",!0),this.loadSV.loaded("FBS_DisableMany",e),console.log("FBS_updateMany()",this.basedbName+e,t)}).catch(l=>{this.loadSV.loaded("FBS_DisableMany",e),console.error("FBS_DisableMany",e,l),this.logger(this.basedbName+e,t,"FBS_DisableMany ERR"+l,!1)})}logger(e,t,s,o=!0){}loginAuthGoogle(){let e=new M.Z.auth.GoogleAuthProvider;e.addScope("email"),this.auth.signInWithPopup(e).then(t=>{console.log(t),this.addNewUser(t)},t=>{this.toastr.error("Vui l\xf2ng th\u1eed l\u1ea1i")})}loginPhone(e){var t=new M.Z.auth.RecaptchaVerifier("recaptcha-container");console.log(e,t),M.Z.auth().signInWithPhoneNumber(e,t).then(s=>{console.log(s),window.step=2;let o=window.prompt("Vui l\xf2ng nh\u1eadp m\xe3 x\xe1c minh");return t.clear(),s.confirm(o).then(l=>{this.logger("Login",l,"Login"),console.log(l),this.addNewUser(l)}).catch(l=>{console.log(l),this._toastErr("L\u1ed7i x\xe1c th\u1ef1c"),this.reload()})}).catch(s=>{alert("Kh\xf4ng h\u1ee3p l\u1ec7!"),t.clear(),console.log(s)})}loginAuthFacebook(){var e=this;return(0,h.Z)(function*(){let t=new M.Z.auth.FacebookAuthProvider;yield e.auth.signInWithPopup(t).then(s=>{e.addNewUser(s)},s=>{e.toastr.error("Vui l\xf2ng th\u1eed l\u1ea1i")})})()}customToken(){const e=(0,b.v0)();(0,b._p)(e,"").then(t=>{}).catch(t=>{})}logout(){alert("\u0110a\u0306ng xu\u1ea5t V1"),localStorage.clear(),this.idbSV.IDB_DB_DeleteAllDB([`ban-hang${this.userDir.store}`]),this.auth.signOut()}checkPer(e,t=1){let s=this.userDir;return null!=s&&null!=s&&s.opt[e]>=t}addNewUser(e){let t={_id:e.user.uid,phoneNumber:e.user.phoneNumber,opt:{"trac-nghiem":4},unit:e.user.phoneNumber,avatar:e.user.photoURL,provider:e.user.providerId,store:e.user.phoneNumber,storeEpx:Date.now()+6048e5,lock:!1,dateModify:Date.now(),status:1};console.log("addNewUser ",t),localStorage.setItem("avatar",e.user.photoURL),this.afs.collection("user").doc(e.user.uid).get().subscribe(s=>{if(!s.exists){window.step=3;let o=window.prompt("Vui l\xf2ng nh\u1eadp h\u1ecd v\xe0 t\xean");for(;o.length<3;)alert("Kh\xf4ng h\u1ee3p l\u1ec7"),o=window.prompt("Vui l\xf2ng nh\u1eadp h\u1ecd v\xe0 t\xean");t.fullName=o,this.afs.collection("user").doc(e.user.uid).set(t).then(l=>{this.logger("addNewUser ",t,"addNewUser",null)}).catch(l=>{this.logger("addNewUser",t,"add new",l)})}this.logger("login ",e," login")})}exportJson(e,t=`${Date.now()}`){let s=JSON.stringify(e),o="data:application/json;charset=utf-8,"+encodeURIComponent(s),l=t+".json",n=document.createElement("a");n.setAttribute("href",o),n.setAttribute("download",l),n.click()}_toastErr(e=""){this.toastr.error(e),"Missing or insufficient permissions"==e&&this.toastr.error("B\u1ea1n ch\u01b0a \u0111\u01b0\u1ee3c c\u1ea5p quy\u1ec1n truy c\u1eadp!")}_toastSuccess(e=""){this.toastr.success(e,"Th\xe0nh c\xf4ng")}_toastWarn(e=""){this.toastr.warning(e,"C\u1ea3nh b\xe1o")}_setOpt(e,t){this.idbSV.IDB_InitDB("firebase-local").subscribe(s=>{let o=Buffer.from(JSON.stringify(e)).toString("base64");this.idbSV.IDB_DB_Add(s,"any",{_id:e._id+t,module:t,key:o,status:1})})}_getOpt(e=""){return new Promise(t=>{this.idbSV.IDB_InitDB("firebase-local").subscribe(s=>{let o=[],l=null;this.idbSV.IDB_DB_GetAll(s,"any").subscribe(n=>{for(let i=0;i<n.length;i++){let d=JSON.parse(Buffer.from(n[i].key,"base64").toString());n[i].module==e&&(l=d),o.push(d)}e.length>0&&l?t(l):0==e.length&&o.length>0&&t(o)})})})}addBaseProperty(e){return delete e.keyword,e.sync=navigator.onLine?1:0,e.dateModify=Date.now(),e.status=1,e}Obj_clean(e){for(const[t,s]of Object.entries(e))(null===s||""===s||Number.isNaN(s)||null==s)&&delete e[t];return e}reload(e=""){var t=this;return(0,h.Z)(function*(){t.loadSV.clear();let s=t.router.url;return yield t.router.navigate(["/"]),console.log("reload ",e,s),t.router.navigate(e.length>0?[`${e}`]:[`${s}`])})()}createKeyWord(e){delete e.canEdit,delete e.keyWord,delete e.sync,delete e.status,delete e.dateModify,delete e.__v;const t=Object.values(e);return this.removeAccents(t.join(" ")).replace(/object/g,"")}removeAccents(e){return e?(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.trim()).replace(/\xe0|\xe1|\u1ea1|\u1ea3|\xe3|\xe2|\u1ea7|\u1ea5|\u1ead|\u1ea9|\u1eab|\u0103|\u1eb1|\u1eaf|\u1eb7|\u1eb3|\u1eb5/g,"a")).replace(/\xe8|\xe9|\u1eb9|\u1ebb|\u1ebd|\xea|\u1ec1|\u1ebf|\u1ec7|\u1ec3|\u1ec5/g,"e")).replace(/\xec|\xed|\u1ecb|\u1ec9|\u0129/g,"i")).replace(/\xf2|\xf3|\u1ecd|\u1ecf|\xf5|\xf4|\u1ed3|\u1ed1|\u1ed9|\u1ed5|\u1ed7|\u01a1|\u1edd|\u1edb|\u1ee3|\u1edf|\u1ee1/g,"o")).replace(/\xf9|\xfa|\u1ee5|\u1ee7|\u0169|\u01b0|\u1eeb|\u1ee9|\u1ef1|\u1eed|\u1eef/g,"u")).replace(/\u1ef3|\xfd|\u1ef5|\u1ef7|\u1ef9/g,"y")).replace(/\u0111/g,"d")).replace(/\xc0|\xc1|\u1ea0|\u1ea2|\xc3|\xc2|\u1ea6|\u1ea4|\u1eac|\u1ea8|\u1eaa|\u0102|\u1eb0|\u1eae|\u1eb6|\u1eb2|\u1eb4/g,"A")).replace(/\xc8|\xc9|\u1eb8|\u1eba|\u1ebc|\xca|\u1ec0|\u1ebe|\u1ec6|\u1ec2|\u1ec4/g,"E")).replace(/\xcc|\xcd|\u1eca|\u1ec8|\u0128/g,"I")).replace(/\xd2|\xd3|\u1ecc|\u1ece|\xd5|\xd4|\u1ed2|\u1ed0|\u1ed8|\u1ed4|\u1ed6|\u01a0|\u1edc|\u1eda|\u1ee2|\u1ede|\u1ee0/g,"O")).replace(/\xd9|\xda|\u1ee4|\u1ee6|\u0168|\u01af|\u1eea|\u1ee8|\u1ef0|\u1eec|\u1eee/g,"U")).replace(/\u1ef2|\xdd|\u1ef4|\u1ef6|\u1ef8/g,"Y")).replace(/\u0110/g,"D")).replace(/[^0-9a-z:\xe0\xe1\u1ea1\u1ea3\xe3\xe2\u1ea7\u1ea5\u1ead\u1ea9\u1eab\u0103\u1eb1\u1eaf\u1eb7\u1eb3\u1eb5\xe8\xe9\u1eb9\u1ebb\u1ebd\xea\u1ec1\u1ebf\u1ec7\u1ec3\u1ec5\xec\xed\u1ecb\u1ec9\u0129\xf2\xf3\u1ecd\u1ecf\xf5\xf4\u1ed3\u1ed1\u1ed9\u1ed5\u1ed7\u01a1\u1edd\u1edb\u1ee3\u1edf\u1ee1\xf9\xfa\u1ee5\u1ee7\u0169\u01b0\u1eeb\u1ee9\u1ef1\u1eed\u1eef\u1ef3\xfd\u1ef5\u1ef7\u1ef9\u0111\s]/gi,"")).normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLocaleLowerCase():""}removeDupArr(e){return e.filter(function(t,s,o){return o.indexOf(t)==s})}Arr_MaxValue(e,t="dateModify"){const s=e.map(l=>l[t]),o=Math.max(...s);return console.log("max",o),isFinite(o)?o:0}backupToMongoDB(e,t){this.http.post(L.N.apiUrl+e,t).subscribe(s=>{})}}return B.\u0275fac=function(e){return new(e||B)(g.LFG(U.zQ),g.LFG(P.ST),g.LFG(w._W),g.LFG(y.b),g.LFG(f.Y),g.LFG(A.F0),g.LFG(R.eN),g.LFG(N.O),g.LFG(T.uR))},B.\u0275prov=g.Yz7({token:B,factory:B.\u0275fac,providedIn:"root"}),B})()},70511:(W,O,r)=>{r.d(O,{O:()=>B});var h=r(15861),M=r(80529),x=r(50727),v=r(69751),F=r(54968),V=r(78372),I=r(71884),L=r(49808),D=r(54004),S=r(75625),b=r(70262),P=(r(15439),r(12157)),w=r(10875),y=r(92340),f=r(94650),A=r(94559),R=r(23887),N=r(25555),T=r(47977),C=r(54654);let B=(()=>{class E{constructor(t,s,o,l,n,i){this.http=t,this.loadSV=s,this.cryptSV=o,this.plus=l,this.afs=n,this.idbSV=i,this.api=y.N.apiUrl,this.subs=new x.w0,this.user=this.getUser()}unsubcribe(){var t=this;return(0,h.Z)(function*(){t.subs.unsubscribe(),t.subs=new x.w0})()}logSheet(t,s){var o=this;return(0,h.Z)(function*(){o.http.post(o.getApiUrl("logger"),{api:t,data:s},o.getHeader()).subscribe()})()}getUser(){var t=this;return(0,h.Z)(function*(){return yield t._getOpt(w.HB.USER)})()}getHeader(){return{headers:new M.WM({"Content-Type":"application/json","Access-Control-Max-Age":"86400"})}}getApiUrl(t,s=!1){return`${y.N.apiUrl}${t}/`}getOutServer(t){return P.Z.get(t)}postOutServer(t,s){return P.Z.post(t,s)}updateLocalDB(t,s,o){var l=this;return new v.y(n=>{(0,F.R)(window,"offline").subscribe(i=>{this.plus.alertWarning("M\u1ea5t k\u1ebft n\u1ed1i\nB\u1ea1n \u0111ang xem d\u1eef li\u1ec7u offline!"),n.next(!0)}),(0,F.R)(window,"online").subscribe(i=>{this.plus.alertSuccess("\u0110\xe3 k\u1ebft n\u1ed1i!"),window.location.reload()}),window[o]||(window[o]=Date.now(),console.log("%cGET updateLocalDB -> "+o,"font-style: italic; color:Blue"),window[s+"max"]=0,this.loadSV.load("updateLocalDB"+o),this.subs.add(this.afs.collection("updateDB").doc(o).valueChanges().pipe((0,V.b)(300),(0,I.x)()).subscribe(function(){var i=(0,h.Z)(function*(a){console.log("xxxxxxxxxxxxxxxxxxxxxxxxxxx",t,s,o);let d=yield l.idbSV.IDB_GetMax(t,s);if(!a&&0==d)return l.afs.collection("updateDB").doc(o).set({lastUpdate:0},{merge:!0}),n.next(!0);if(window[s+"max"]=d,a.lastUpdate==window[s+"max"]||a.lastUpdate==window[s+"lastget"])return n.next(!0);if(console.log("updateLocalDB",s,o,a),a.lastUpdate>window[s+"max"])for(;a.lastUpdate>window[s+"max"];){let c=yield l.idbSV.IDB_GetMax(t,s),_=s+"/token/"+c;window[s+"max"]=c;let u=yield(0,L.n)(l.get(_));if(window[s+"lastget"]=c,0==u.data.length){console.log("next in data.length == 0 && break");break}console.log("%cGET updateLocalDB -> "+new Date(c),"font-style: italic; color:green"),console.log(new Date(l.plus.Arr_MaxValue(u.data))),yield l.idbSV.IDB_DB_Add(t,s,u.data),console.log("next in While")}n.next(!0),l.loadSV.loaded("updateLocalDB"+o)});return function(a){return i.apply(this,arguments)}}())),this.loadSV.loaded("updateLocalDB"+o))})}get(t,s=!1){return console.log("%cGET -> "+t,"font-style: italic; color:green"),this.http.get(this.getApiUrl(t,s),this.getHeader()).pipe((0,D.U)(o=>(this.loadSV.loaded("get"+t),o)),(0,S.X)(1),(0,b.K)(o=>{throw this.logger(t,"Get","Get",o),this.loadSV.loaded("get"+t),o}))}post(t,s,o,l=!0,n=!0){return console.log("%cPOST -> "+t,"font-style: italic; color:green",s),this.loadSV.load("httpPost"+o),Array.isArray(s)&&this.plus.Arr_MaxValue(s),this.http.post(this.getApiUrl(t),s,this.getHeader()).pipe((0,D.U)(a=>(window[t+"max"]=0,n&&this.loadSV.loaded("httpPost"+o),this._handleSuccess(l),a)),(0,S.X)(1),(0,b.K)(a=>{throw console.log(a),this.logger(t,s,"post "+o,a),this.plus.alertError(a.err),this.loadSV.loaded("httpPost"+o),a}))}put(t,s,o,l=!0){return this.loadSV.load("httpPut",o),console.log("%cPUT -> "+t,"font-style: italic; color:green",s),this.http.put(this.getApiUrl(t),s,this.getHeader()).pipe((0,D.U)(n=>(window[t+"max"]=0,this._handleSuccess(l),this.logger(t,s,"put "+o,!1),this.loadSV.loaded("httpPut",o),n)),(0,S.X)(1),(0,b.K)(n=>{throw this.logger(t,s,"put "+o,n),this.loadSV.loaded("httpPut",o),429==n.status&&(alert("Thi\u1ebft b\u1ecb c\u1ee7a b\u1ea1n c\xf3 truy c\u1eadp b\u1ea5t th\u01b0\u1eddng!"),window.location.reload()),400==n.status&&this.plus.alertError(n.error.err),403==n.status&&(alert(n.err),window.location.reload()),n}))}delete(t,s,o,l=!0){return console.log("%cDELETE -> "+t+"/"+s,"font-style: italic; color:red"),Date.now(),this.loadSV.load("delete",o),this.http.delete(this.getApiUrl(t+"/"+s),this.getHeader()).pipe((0,D.U)(i=>(window[t+"max"]=0,this.loadSV.loaded("delete",o),this._handleSuccess(l),this.logger(t,s,"delete "+o,!1),i)),(0,S.X)(1),(0,b.K)(i=>{throw this._handleError(i),this.loadSV.loaded("delete",o),this.logger(t,s,"delete "+o,i),"error in source. Details: "+i}))}disable(t,s,o,l=!0){console.log("%Disable -> "+t+"/"+s,"font-style: italic; color:red");const n=Date.now();return this.loadSV.load("disable",o),new Promise((i,a)=>{this.http.delete(this.getApiUrl(t)+s._id+"/token/"+n,this.getHeader()).pipe((0,D.U)(d=>(window[t+"max"]=0,this._handleSuccess(l),this.loadSV.loaded("disable",o),this.logger(t,s,"disable "+o,!1),d)),(0,S.X)(1),(0,b.K)(d=>{throw this.logger(t,s,"disable "+o,d),this.loadSV.loaded("disable",o),this._handleError(d),"Error httpDisable. Details: "+d})).subscribe(d=>{void 0!==d&&(console.log("Delete",d),i(n))})})}_handleError(t){429==t.status&&(alert("Thi\u1ebft b\u1ecb c\u1ee7a b\u1ea1n c\xf3 truy c\u1eadp b\u1ea5t th\u01b0\u1eddng!"),window.location.reload()),400==t.status&&this.plus.alertError(t.error.err),(401==t.status||500==t.status)&&(alert("L\u1ed7i x\xe1c th\u1ef1c t\xe0i kho\u1ea3n!"),this.plus.alertError(t.error.err)),403==t.status&&(alert(t.err),window.location.reload())}_handleSuccess(t=!0){t&&this.plus.alertSuccess("Th\xe0nh c\xf4ng")}convertUpdatebyKey(t){for(let s=0;s<t.length;s++);}logger(t,s,o,l){return(0,h.Z)(function*(){})()}guid(){let t=(new Date).getTime();return typeof performance<"u"&&"function"==typeof performance.now&&(t+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const o=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===s?o:3&o|8).toString(16)})}geneKeyWord(...t){return t.join(" ").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLocaleLowerCase()}_getOpt(t=""){return new Promise(s=>{this.idbSV.IDB_InitDB("firebase-local").subscribe(o=>{let l=[],n=null;this.idbSV.IDB_DB_GetAll(o,"any").subscribe(i=>{for(let a=0;a<i.length;a++){let c=JSON.parse(Buffer.from(i[a].key,"base64").toString());i[a].module==t&&(n=c),l.push(c)}t.length>0&&n?s(n):0==t.length&&l.length>0&&s(l)})})})}}return E.\u0275fac=function(t){return new(t||E)(f.LFG(M.eN),f.LFG(A.b),f.LFG(R.j),f.LFG(N.T),f.LFG(T.ST),f.LFG(C.Y))},E.\u0275prov=f.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"}),E})()}}]);