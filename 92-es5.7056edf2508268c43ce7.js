!function(){"use strict";function t(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function n(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function e(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}(self.webpackChunk_4la=self.webpackChunk_4la||[]).push([[92],{11092:function(n,i,o){o.r(i),o.d(i,{BanHangModule:function(){return dn}});var a,u=o(83886),r=o(88817),c=o(11596),l=o(13397),s=o(48387),h=o(12057),d=o(15228),g=o(24751),p=o(74788),f=o(57922),m=o(84875),Z=((a=function(){function n(e,i){t(this,n),this.plus=e,this.fb=i,this.dbName="ban-hang",this.db=null,this.user=this.plus.user.getValue(),this.main=this.fb.group({}),this.initDB()}return e(n,[{key:"initDB",value:function(){var t=this;this.plus.IDB_InitDB(this.dbName).subscribe(function(n){t.db=n})}},{key:"creatTable",value:function(t){var n=this;"guest"!=t._id&&this.plus.IDB_InitDB(this.dbName).subscribe(function(e){for(var i=n.plus.sortArr(t.NhomBan,"ThuTu",1),o=0;o<i.length;o++){var a=i[o];n.plus.IDB_DB_Add(n.db,"an-uong",{_id:a.NoiDung+"- MV",status:1,dateModify:t.dateModify,TenBan:a.NoiDung+"- MV",NhomBan:a.NoiDung,DonMua:[],ThanhTien:0,GioVao:0,SoKH:0,DaThanhToan:m.gp.unpaid});for(var u=1;u<a.SoLuong;u++)n.plus.IDB_DB_Add(e,"an-uong",{_id:a.NoiDung+"-"+u,status:1,dateModify:t.dateModify,TenBan:a.NoiDung+"-"+u,NhomBan:a.NoiDung,DonMua:[],ThanhTien:0,GioVao:0,SoKH:0,DaThanhToan:m.gp.unpaid})}n.plus.reload("/ban-hang/an-uong")})}},{key:"clearAnUong",value:function(){var t=this;this.plus.IDB_InitDB(this.dbName).subscribe(function(n){t.plus.IDB_DB_ClearCollection(n,"an-uong").subscribe(function(t){return console.log("clearAnUong",t)})})}},{key:"thanhToan",value:function(t){var n=this;if(delete t.__v,t.DaThanhToan=m.hg.DaThanhToan,t.NguonThu=m.rP.AnUong,0==t.ThanhTien&&(this.main.patchValue(t),this.main.invalid)){var e=this.plus.getErrValidateForm(this.main);console.log(e)}void 0!==t._id?(delete t.__v,this.plus.httpPut("thanh-toan",t).subscribe(function(t){var e=n.plus.Crypt_DecryptRest(t);n.plus.IDB_DB_Add(n.db,"thanh-toan",e),n.plus.FBS_PostByUser("hang-hoa",e.dateModify).then(function(){n.reload()})})):this.plus.httpPost("thanh-toan",t).subscribe(function(t){n.plus.IDB_DB_Add(n.db,"thanh-toan",n.plus.Crypt_DecryptRest(t))})}},{key:"printBill",value:function(){if(confirm("B\u1ea1n c\xf3 mu\u1ed1n in h\xf3a \u0111\u01a1n ko?")){var t=window.document.getElementById("bill"),n=window.open("","PRINT");n.document.write(document.documentElement.innerHTML),setTimeout(function(){n.document.body.innerHTML=t.outerHTML,n.document.close(),n.focus(),n.print(),n.close()},1e3)}}},{key:"reload",value:function(){this.plus.reload("/ban-hang/an-uong")}}]),n}()).\u0275fac=function(t){return new(t||a)(p.LFG(f.T),p.LFG(g.qu))},a.\u0275prov=p.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a),T=o(23202),v=o(2895),b=o(49356),A=o(46833),q=o(46113),y=o(61260),x=o(17935),_=o(73888);function k(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"mat-chip",27),p.NdJ("click",function(){var t=p.CHM(e).$implicit;return p.oxw().onEditArea(t)}),p._uU(1),p.qZA()}if(2&t){var i=n.$implicit;p.xp6(1),p.hij("Khu ",i.KhuVuc,"")}}function D(t,n){if(1&t&&(p.TgZ(0,"button",28),p._uU(1),p.qZA()),2&t){var e=n.index;p.xp6(1),p.hij(" ",e+1,"")}}function N(t,n){if(1&t&&(p.TgZ(0,"mat-option",29),p._uU(1),p.qZA()),2&t){var e=n.$implicit;p.Q6J("value",e.GiaTri),p.xp6(1),p.Oqu(e.NoiDung)}}function B(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"button",30),p.NdJ("click",function(){return p.CHM(e),p.oxw().saveArea()}),p.TgZ(1,"mat-icon"),p._uU(2,"save"),p.qZA(),p.qZA()}2&t&&p.Q6J("@slideIn",void 0)}function I(t,n){if(1&t&&(p.TgZ(0,"mat-option",29),p._uU(1),p.qZA()),2&t){var e=n.$implicit;p.Q6J("value",e.KhuVuc),p.xp6(1),p.hij("",e.KhuVuc," ")}}function C(t,n){if(1&t&&(p.TgZ(0,"mat-option",29),p._uU(1),p.qZA()),2&t){var e=n.$implicit;p.Q6J("value",e.GiaTri),p.xp6(1),p.Oqu(e.NoiDung)}}function w(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"button",30),p.NdJ("click",function(){return p.CHM(e),p.oxw().saveTable()}),p.TgZ(1,"mat-icon"),p._uU(2,"save"),p.qZA(),p.qZA()}2&t&&p.Q6J("@slideIn",void 0)}var U=function(){var n=function(){function n(e,i,o){t(this,n),this.plus=e,this.fb=i,this.bhSV=o,this.chart=[],this.areaForm=this.fb.group({_id:[,[]],KhuVuc:[,[g.kI.required]],TrangThai:[1,[g.kI.required]]}),this.tableForm=this.fb.group({_id:[,[]],KhuVuc:[,[g.kI.required]],TenBan:[,[g.kI.required]],TrangThai:[1,[g.kI.required]]}),this.title="Qu\u1ea3n l\xfd",this.dbName="ban-hang",this.api="quan-ly",this.apiArea="khu-vuc",this.apiTable="quan-ly/ban",this.db=null,this.areas=[],this.selectedItem=null,this.filter=[]}return e(n,[{key:"ngOnInit",value:function(){this.plus.setTiTle(this.title),this.getAllArea()}},{key:"ngOnDestroy",value:function(){console.log("Destroy",this.api),this.plus.subs.unsubscribe()}},{key:"getAllArea",value:function(){var t=this;this.plus.httpGet(this.apiArea).subscribe(function(n){t.areas=t.plus.Crypt_DecryptRest(n),console.log(t.areas)})}},{key:"saveArea",value:function(){var t=this;if(!this.areaForm.invalid){var n=this.areaForm.value;if(null==n._id)delete n._id,this.plus.httpPost(this.apiArea,n).subscribe(function(n){n.status&&t.plus.clickBtn("openModalA")});else{if(!confirm("C\u1eadp nh\u1eadt t\u1ea5t c\u1ea3 b\xe0n c\xf3 c\xf9ng khu v\u1ef1c?"))return this.plus.clickBtn("openModalA");this.plus.httpPut(this.apiArea,n).subscribe(function(n){n.status&&t.plus.clickBtn("openModalA")})}this.getAllArea()}}},{key:"onEditArea",value:function(t){this.selectedItem=t,this.areaForm.patchValue(t),this.plus.clickBtn("openModalA")}},{key:"onDeleteArea",value:function(t){var n=this;this.plus.httpDelete(this.apiArea,t._id).subscribe(function(t){console.log(t),n.getAllArea()})}},{key:"saveTable",value:function(){}},{key:"closeModal",value:function(){this.areaForm.reset(),this.tableForm.reset()}},{key:"search",value:function(t){this.filter=t}},{key:"find",value:function(t){this.areas=t}},{key:"checkPer",value:function(t){return this.plus.checkPer(this.api,t)}},{key:"patchForm",value:function(){}},{key:"reload",value:function(){return this.plus.reload(this.dbName+"/"+this.api)}},{key:"reset",value:function(){this.plus.loaded(),this.filter=[]}},{key:"changePage",value:function(t){this.filter=this.areas.slice(t.pageIndex*t.pageSize,(t.pageIndex+1)*t.pageSize)}},{key:"trackByFn",value:function(t,n){return n}}]),n}();return n.\u0275fac=function(t){return new(t||n)(p.Y36(f.T),p.Y36(g.qu),p.Y36(Z))},n.\u0275cmp=p.Xpm({type:n,selectors:[["app-quan-ly"]],decls:68,vars:16,consts:[[1,"container"],[1,"row"],["color","accent",3,"click",4,"ngFor","ngForOf"],["color","warn","mat-icon-button","","data-toggle","modal","data-target","#modelIdA"],[1,"list","text-center"],["color","warn","mat-icon-button","","data-toggle","modal","data-target","#modelIdT"],["data-dismiss","modal","mat-mini-fab","",4,"ngFor","ngForOf","ngForTrackBy"],["id","openModalA","type","button","data-toggle","modal","data-target","#modelIdA",1,"d-none"],["id","modelIdA","data-backdrop","static","tabindex","-1","role","dialog","aria-labelledby","modelTitleId","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-body"],[1,"container-fluid"],[3,"formGroup"],["hidden","","formControlName","_id"],["type","text","autocomplete","off","matInput","","formControlName","KhuVuc"],["matSuffix",""],["required","","formControlName","TrangThai"],[3,"value",4,"ngFor","ngForOf"],[1,"modal-footer"],["id","closeModal","mat-raised-button","","color","primary","data-dismiss","modal",3,"click"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["id","openModalT","type","button","data-toggle","modal","data-target","#modelIdT",1,"d-none"],["id","modelIdT","data-backdrop","static","tabindex","-1","role","dialog","aria-labelledby","modelTitleId","aria-hidden","true",1,"modal","fade"],[1,"tit"],["formControlName","KhuVuc"],["placeholder","VD: A-1, Vip-6","type","text","autocomplete","off","matInput","","formControlName","TenBan"],["color","accent",3,"click"],["data-dismiss","modal","mat-mini-fab",""],[3,"value"],["mat-raised-button","","color","warn",3,"click"]],template:function(t,n){1&t&&(p.TgZ(0,"div",0),p.TgZ(1,"div",1),p.TgZ(2,"mat-chip-list"),p.YNc(3,k,2,1,"mat-chip",2),p.TgZ(4,"button",3),p.TgZ(5,"mat-icon"),p._uU(6,"control_point"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(7,"div",1),p.TgZ(8,"div",4),p.TgZ(9,"button",5),p.TgZ(10,"mat-icon"),p._uU(11,"control_point"),p.qZA(),p.qZA(),p.YNc(12,D,2,1,"button",6),p.qZA(),p.qZA(),p.qZA(),p._UZ(13,"button",7),p.TgZ(14,"div",8),p.TgZ(15,"div",9),p.TgZ(16,"div",10),p.TgZ(17,"div",11),p.TgZ(18,"div",12),p.TgZ(19,"form",13),p._UZ(20,"input",14),p.TgZ(21,"mat-form-field"),p.TgZ(22,"mat-label"),p._uU(23,"Khu v\u1ef1c"),p.qZA(),p._UZ(24,"input",15),p._UZ(25,"span",16),p.qZA(),p.TgZ(26,"mat-form-field"),p.TgZ(27,"mat-label"),p._uU(28,"Tr\u1ea1ng th\xe1i"),p.qZA(),p.TgZ(29,"mat-select",17),p.YNc(30,N,2,2,"mat-option",18),p.ALo(31,"catalog"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(32,"div",19),p.TgZ(33,"button",20),p.NdJ("click",function(){return n.closeModal()}),p.TgZ(34,"mat-icon"),p._uU(35,"close"),p.qZA(),p.qZA(),p.YNc(36,B,3,1,"button",21),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p._UZ(37,"button",22),p.TgZ(38,"div",23),p.TgZ(39,"div",9),p.TgZ(40,"div",10),p.TgZ(41,"div",11),p.TgZ(42,"div",12),p.TgZ(43,"h5",24),p._uU(44,"Qu\u1ea3n l\xfd b\xe0n"),p.qZA(),p.TgZ(45,"form",13),p._UZ(46,"input",14),p.TgZ(47,"mat-form-field"),p.TgZ(48,"mat-label"),p._uU(49,"Khu v\u1ef1c"),p.qZA(),p.TgZ(50,"mat-select",25),p.YNc(51,I,2,2,"mat-option",18),p.qZA(),p.qZA(),p.TgZ(52,"mat-form-field"),p.TgZ(53,"mat-label"),p._uU(54,"T\xean b\xe0n"),p.qZA(),p._UZ(55,"input",26),p._UZ(56,"span",16),p.qZA(),p.TgZ(57,"mat-form-field"),p.TgZ(58,"mat-label"),p._uU(59,"Tr\u1ea1ng th\xe1i"),p.qZA(),p.TgZ(60,"mat-select",17),p.YNc(61,C,2,2,"mat-option",18),p.ALo(62,"catalog"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(63,"div",19),p.TgZ(64,"button",20),p.NdJ("click",function(){return n.closeModal()}),p.TgZ(65,"mat-icon"),p._uU(66,"close"),p.qZA(),p.qZA(),p.YNc(67,w,3,1,"button",21),p.qZA(),p.qZA(),p.qZA(),p.qZA()),2&t&&(p.xp6(3),p.Q6J("ngForOf",n.areas),p.xp6(9),p.Q6J("ngForOf",n.filter.length>0?n.filter:n.areas)("ngForTrackBy",n.trackByFn),p.xp6(7),p.Q6J("formGroup",n.areaForm),p.xp6(11),p.Q6J("ngForOf",p.lcZ(31,12,"TrangThaiHoatDong")),p.xp6(3),p.Q6J("@slideIn",void 0),p.xp6(3),p.Q6J("ngIf",n.checkPer(2)&&n.areaForm.valid),p.xp6(9),p.Q6J("formGroup",n.tableForm),p.xp6(6),p.Q6J("ngForOf",n.areas),p.xp6(10),p.Q6J("ngForOf",p.lcZ(62,14,"TrangThaiHoatDong")),p.xp6(3),p.Q6J("@slideIn",void 0),p.xp6(3),p.Q6J("ngIf",n.checkPer(2)&&n.tableForm.valid))},directives:[T.qn,h.sg,v.lW,b.Hw,g._Y,g.JL,g.sg,g.Fj,g.JJ,g.u,A.KE,A.hX,q.Nt,A.R9,y.gD,g.Q7,h.O5,T.HS,x.ey],pipes:[_.pW],styles:[""],data:{animation:[d.Ym,d.Mq]}}),n}(),M=o(16738),J=o.n(M),H=o(18849),O=o(46926),F=function(){var n=function(){function n(e){t(this,n),this.plus=e,this.db=null,this.title="B\xe1o c\xe1o b\xe1n h\xe0ng",this.dbName="ban-hang",this.items=[],this.DoanhThu=0,this.LoiNhuan=0,this.DoanhThuThang=[],this.LoiNhuanThang=[],this.BanChay=[],this.BanNgoiNhieu=[]}return e(n,[{key:"ngOnDestroy",value:function(){console.log("Destroy bao-cao"),this.plus.subs.unsubscribe()}},{key:"ngOnInit",value:function(){var t=this;this.plus.setTiTle(this.title),this.plus.IDB_InitDB(this.dbName).subscribe(function(n){t.plus.updateUserLocal(n,"thanh-toan"),t.db=n,t.plus.updateAPi.subscribe(function(n){t.getNhanDon()})})}},{key:"getNhanDon",value:function(){var t=this;this.plus.subs.add(this.plus.IDB_DB_GetAll(this.db,"thanh-toan").subscribe(function(n){null==n&&(n=[]),t.items=n,t.doanhThuNgay(1)}))}},{key:"doanhThuNgay",value:function(t){for(var n=this.items,e=Date.now()-24*t*60*60*1e3,i=[],o=[],a=[],u=0;u<n.length;u++)if(n[u].dateModify>e&&n[u].LoiNhuan>0&&1==n[u].DaThanhToan){var r={LoiNhuan:1e3*n[u].LoiNhuan,ThanhTien:n[u].ThanhTien,Ngay:J()(n[u].dateModify).format("DD/MM")};i.push(r),n[u].DonMua.forEach(function(t){o.push({TenHangHoa:t.TenHangHoa,TongCong:t.TongCong})}),a.push({TenBan:n[u].TenBan,SoKH:n[u].SoKH})}this.DoanhThuThang=this.plus.generateChart(i,"Ngay","ThanhTien"),this.LoiNhuanThang=this.plus.generateChart(i,"Ngay","LoiNhuan");var c=this.plus.sumByKey(i,["ThanhTien","LoiNhuan"]);this.DoanhThu=c.ThanhTien,this.LoiNhuan=c.LoiNhuan;var l=this.plus.sortArr(o,"TongCong"),s=this.plus.generateChart(l,"TenHangHoa","TongCong");this.BanChay=this.plus.generateChart(s.slice(0,5),"x","y"),this.BanNgoiNhieu=this.plus.generateChart(a,"TenBan","SoKH")}}]),n}();return n.\u0275fac=function(t){return new(t||n)(p.Y36(f.T))},n.\u0275cmp=p.Xpm({type:n,selectors:[["app-bao-cao"]],decls:30,vars:30,consts:[[1,"container"],[1,"tit"],[1,"row","text-center"],["mat-raised-button","","color","warn"],[1,"row"],[3,"day"],[1,"row","my-3"],[1,"col-md-6"],[3,"id","arr","label","type"],[3,"id","label","arr","type"],[1,"col-md-4"],[1,"col-md-8"],[3,"id","arr","type","label"]],template:function(t,n){1&t&&(p.TgZ(0,"div",0),p.TgZ(1,"h5",1),p._uU(2,"B\xc1O C\xc1O B\xc1N H\xc0NG"),p.qZA(),p.TgZ(3,"div",2),p.TgZ(4,"button",3),p._uU(5),p.ALo(6,"commas"),p.qZA(),p.TgZ(7,"button",3),p._uU(8),p.ALo(9,"commas"),p.qZA(),p.qZA(),p.TgZ(10,"div",4),p.TgZ(11,"app-chip",5),p.NdJ("day",function(t){return n.doanhThuNgay(t)}),p.qZA(),p.qZA(),p.TgZ(12,"div",6),p.TgZ(13,"div",7),p._UZ(14,"app-chart",8),p.qZA(),p.TgZ(15,"div",7),p._UZ(16,"app-chart",9),p.qZA(),p.qZA(),p._UZ(17,"hr"),p._UZ(18,"h6",1),p.TgZ(19,"div",6),p.TgZ(20,"div",10),p._UZ(21,"app-chart",8),p.qZA(),p.TgZ(22,"div",11),p._UZ(23,"app-chart",8),p.qZA(),p.qZA(),p._UZ(24,"hr"),p.TgZ(25,"div",6),p.TgZ(26,"div",10),p._UZ(27,"app-chart",8),p.qZA(),p.TgZ(28,"div",11),p._UZ(29,"app-chart",12),p.qZA(),p.qZA(),p.qZA()),2&t&&(p.xp6(5),p.hij(" Doanh thu: ",p.lcZ(6,26,n.DoanhThu),""),p.xp6(3),p.hij(" L\u1ee3i nhu\u1eadn: ",p.lcZ(9,28,n.LoiNhuan),""),p.xp6(6),p.Q6J("id","doanhthuthang")("arr",n.DoanhThuThang)("label","B\u1ea3ng Doanh thu")("type","line"),p.xp6(2),p.Q6J("id","LoinhuanThan")("label","B\u1ea3ng L\u1ee3i nhu\u1eadn")("arr",n.LoiNhuanThang)("type","bar"),p.xp6(5),p.Q6J("id","BanChay")("arr",n.BanChay)("label","Top b\xe1n ch\u1ea1y")("type","doughnut"),p.xp6(2),p.Q6J("id","BanChayBar")("arr",n.BanChay)("label","Top b\xe1n ch\u1ea1y")("type","bar"),p.xp6(4),p.Q6J("id","BanNgoiNhieu")("arr",n.BanNgoiNhieu)("label","Top B\xe0n kh\xe1ch ch\u1ecdn")("type","doughnut"),p.xp6(2),p.Q6J("id","BanNgoiNhieuBar")("arr",n.BanNgoiNhieu)("type","bar")("label","Top B\xe0n kh\xe1ch ch\u1ecdn"))},directives:[v.lW,H.Y,O.x],pipes:[_.W],styles:["mat-chip[_ngcontent-%COMP%]{max-width:200px}"]}),n}();function Q(t,n){1&t&&(p.TgZ(0,"h4",4),p._uU(1,"\u0110\xe3 ho\xe0n th\xe0nh "),p.qZA())}function P(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"button",15),p.NdJ("click",function(){p.CHM(e);var t=p.oxw().index,n=p.oxw().$implicit;return p.oxw().onComplete(n,t)}),p.TgZ(1,"mat-icon"),p._uU(2,"done"),p.qZA(),p.qZA()}}function G(t,n){if(1&t&&(p.TgZ(0,"div",9),p.TgZ(1,"b",10),p._uU(2),p.TgZ(3,"b",11),p._uU(4),p.qZA(),p.qZA(),p.TgZ(5,"i",12),p._uU(6),p.qZA(),p._UZ(7,"br"),p.TgZ(8,"i",13),p._uU(9),p.ALo(10,"fromNow"),p.qZA(),p.YNc(11,P,3,0,"button",14),p.qZA()),2&t){var e=n.$implicit,i=p.oxw(2);p.Q6J("@slideIn",void 0),p.xp6(2),p.hij("",e.TenHangHoa,": "),p.xp6(2),p.AsE(" ",e.TongCong," ",e.DVT," "),p.xp6(2),p.Oqu(e.GhiChu),p.xp6(3),p.Oqu(p.lcZ(10,7,e.GioVao)),p.xp6(2),p.Q6J("ngIf",i.checkPer(2)&&0==e.DaLam)}}function L(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"div"),p.TgZ(1,"div",5),p.TgZ(2,"h4",6),p._uU(3),p.qZA(),p.YNc(4,G,12,9,"div",7),p.TgZ(5,"button",8),p.NdJ("click",function(){var t=p.CHM(e).$implicit;return p.oxw().onCompleteAll(t)}),p.TgZ(6,"mat-icon"),p._uU(7,"done_all"),p.qZA(),p.qZA(),p.qZA(),p.qZA()}if(2&t){var i=n.$implicit;p.xp6(3),p.Oqu(i.TenBan),p.xp6(1),p.Q6J("ngForOf",i.DonMua)}}var Y=function(){var n=function(){function n(e,i){t(this,n),this.plus=e,this.fb=i,this.dbName="ban-hang",this.db=null,this.api="an-uong",this.items=[],this.tittle="Pha ch\u1ebf",this.DonMua=[],this.groups=[],this.main=this.fb.group({_id:[,[]],idHangHoa:[,[g.kI.required]],TrangThai:[0,[g.kI.required]]})}return e(n,[{key:"ngOnDestroy",value:function(){this.plus.subs.unsubscribe(),console.log("Destroy pha-che")}},{key:"ngOnInit",value:function(){var t=this;this.plus.setTiTle(this.tittle),this.plus.IDB_InitDB(this.dbName).subscribe(function(n){t.db=n,t.plus.updateUserLocal(n,t.api),t.plus.updateAPi.subscribe(function(e){t.getIDB(n)})})}},{key:"getIDB",value:function(t){var n=this;this.groups=[],this.plus.IDB_DB_GetAll(t,this.api).subscribe(function(t){for(var e=[],i=0;i<t.length;i++)if(0==t[i].DaThanhToan){var o=t[i].DonMua.filter(function(t){return 0==t.DaLam&&(n.addNewItem(t),n.groups.push(t),n.plus.notify_send("C\xf3 kh\xe1ch v\xe0o!"),n.plus.playUpdate()),0==t.DaLam});o.length>0&&(t[i].DonMua=o,e.push(t[i]))}n.items=e,console.log(n.groups),n.groupItems()})}},{key:"groupItems",value:function(){var t=this.plus.obj_GroupByKey(this.groups,"TenHangHoa");console.log(t)}},{key:"addNewItem",value:function(t){var n=this.DonMua.find(function(n){return n._id==t._id});if(window.navigator.vibrate(200),n){var e=this.DonMua.findIndex(function(t){return t._id==n._id});this.DonMua[e].TongCong+=t.TongCong}else t.TongCong=1,t.GioVao=Date.now(),t.DaLam=!1,this.DonMua.push(t)}},{key:"onComplete",value:function(t,n){var e=this;console.log(t,n);var i=t;delete i.__v,i.DonMua[n].DaLam=!0,console.log(i),this.plus.httpPut(this.api,i).subscribe(function(t){console.log(t),e.getIDB(e.db)})}},{key:"onCompleteAll",value:function(t){var n=this,e=t;delete e.__v;for(var i=0;i<e.DonMua.length;i++)e.DonMua[i].DaLam=!0;console.log(e),this.plus.httpPut(this.api,e).subscribe(function(t){console.log(t),n.plus.IDB_DB_Add(n.db,n.api,e),n.getIDB(n.db)})}},{key:"reload",value:function(){this.plus.reload("ban-hang/pha-che")}},{key:"checkPer",value:function(t){return this.plus.checkPer(this.api,t)}}]),n}();return n.\u0275fac=function(t){return new(t||n)(p.Y36(f.T),p.Y36(g.qu))},n.\u0275cmp=p.Xpm({type:n,selectors:[["app-pha-che"]],decls:4,vars:2,consts:[[1,"container"],["class","text-center text-primary",4,"ngIf"],[1,"card-group"],[4,"ngFor","ngForOf"],[1,"text-center","text-primary"],[1,"card","text-center","mx-3","mb-3"],[1,"card-title","bg-success"],["class","card-body text-left",4,"ngFor","ngForOf"],["mat-raised-button","","color","accent",3,"click"],[1,"card-body","text-left"],[1,"font-blue"],[1,"text-danger","mx-3"],[1,"font-red","font-note"],[1,"mx-3"],["hidden","","mat-raised-button","","color","accent",3,"click",4,"ngIf"],["hidden","","mat-raised-button","","color","accent",3,"click"]],template:function(t,n){1&t&&(p.TgZ(0,"div",0),p.YNc(1,Q,2,0,"h4",1),p.TgZ(2,"div",2),p.YNc(3,L,8,2,"div",3),p.qZA(),p.qZA()),2&t&&(p.xp6(1),p.Q6J("ngIf",0==n.items.length),p.xp6(2),p.Q6J("ngForOf",n.items))},directives:[h.O5,h.sg,v.lW,b.Hw],pipes:[_.dw],styles:[".card[_ngcontent-%COMP%]{border-radius:1rem}.card-title[_ngcontent-%COMP%]{border-radius:1rem}"],data:{animation:[d.Ym]}}),n}(),S=o(33982),V=o(48842),E=o(13269);function $(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"mat-chip",24),p.NdJ("click",function(){var t=p.CHM(e).$implicit;return p.oxw(2).showArea(t.NoiDung)}),p._uU(1),p.qZA()}if(2&t){var i=n.$implicit,o=p.oxw(2);p.Q6J("selected",o.area==i.NoiDung),p.xp6(1),p.hij("Khu ",i.NoiDung,"")}}function K(t,n){if(1&t&&(p.TgZ(0,"button",30),p._uU(1),p.ALo(2,"commas"),p.qZA()),2&t){var e=p.oxw().$implicit;p.xp6(1),p.Oqu(p.lcZ(2,1,e.ThanhTien))}}function j(t,n){if(1&t&&(p.TgZ(0,"span",31),p._uU(1),p.ALo(2,"fromNow"),p.qZA()),2&t){var e=p.oxw().$implicit;p.xp6(1),p.hij(" ",p.lcZ(2,1,e.GioVao),"")}}var z=function(t){return{"border-danger":t}};function R(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"div",25),p.TgZ(1,"div",26),p.NdJ("click",function(){var t=p.CHM(e).$implicit;return p.oxw(2).chooseTable(t)}),p.TgZ(2,"h4",27),p._uU(3),p.qZA(),p.YNc(4,K,3,3,"button",28),p.YNc(5,j,3,3,"span",29),p.qZA(),p.qZA()}if(2&t){var i=n.$implicit;p.xp6(1),p.Q6J("ngClass",p.VKq(4,z,i.ThanhTien>0)),p.xp6(2),p.Oqu(i.TenBan),p.xp6(1),p.Q6J("ngIf",i.ThanhTien>0),p.xp6(1),p.Q6J("ngIf",i.GioVao>0)}}function W(t,n){if(1&t&&(p.TgZ(0,"div",20),p.TgZ(1,"div",2),p.TgZ(2,"mat-chip-list"),p.YNc(3,$,2,2,"mat-chip",21),p.qZA(),p.TgZ(4,"button",22),p._uU(5,"Th\xeam b\xe0n"),p.qZA(),p.qZA(),p.TgZ(6,"div",2),p.YNc(7,R,6,6,"div",23),p.qZA(),p.qZA()),2&t){var e=p.oxw();p.xp6(3),p.Q6J("ngForOf",e.TabBan),p.xp6(4),p.Q6J("ngForOf",e.ChiaBan)}}function X(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"mat-chip",24),p.NdJ("click",function(){var t=p.CHM(e).$implicit;return p.oxw(2).orderByGroup(t)}),p._uU(1),p.qZA()}if(2&t){var i=n.$implicit,o=n.index,a=p.oxw(2);p.Q6J("selected",a.indexNhomHang==o),p.xp6(1),p.Oqu(i.NoiDung)}}function tt(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"div",1),p.NdJ("click",function(){p.CHM(e);var t=p.oxw().$implicit;return p.oxw(2).chooseProduct(t)}),p.TgZ(1,"div",37),p.TgZ(2,"h4",38),p._uU(3),p.qZA(),p.qZA(),p.qZA()}if(2&t){var i=p.oxw().$implicit;p.xp6(1),p.Udp("border-bottom-color",i.HinhAnh),p.xp6(2),p.hij("",i.TenHangHoa," ")}}function nt(t,n){if(1&t&&(p.TgZ(0,"div",35),p.YNc(1,tt,4,3,"div",36),p.qZA()),2&t){var e=n.$implicit;p.xp6(1),p.Q6J("ngIf",e.TrangThai)}}function et(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"div"),p.TgZ(1,"button",32),p.NdJ("click",function(){return p.CHM(e),p.oxw().reload()}),p._uU(2,"Ch\u1ecdn b\xe0n"),p.qZA(),p.TgZ(3,"button",33),p.NdJ("click",function(){return p.CHM(e),p.oxw().saveBill()}),p._uU(4,"L\u01b0u"),p.qZA(),p.TgZ(5,"mat-chip-list"),p.YNc(6,X,2,2,"mat-chip",21),p.qZA(),p._UZ(7,"hr"),p.TgZ(8,"div",2),p.YNc(9,nt,2,1,"div",34),p.qZA(),p.qZA()}if(2&t){var i=p.oxw();p.xp6(6),p.Q6J("ngForOf",i.NhomHang),p.xp6(3),p.Q6J("ngForOf",i.products)}}function it(t,n){if(1&t&&(p.TgZ(0,"h6",42),p.TgZ(1,"i"),p._uU(2),p.ALo(3,"commas"),p.qZA(),p.qZA()),2&t){var e=p.oxw(2);p.xp6(2),p.hij(" T\u1ea1m t\xednh ",p.lcZ(3,1,e.table.ThanhTien)," K ")}}function ot(t,n){if(1&t&&(p.TgZ(0,"span"),p._uU(1),p.qZA()),2&t){var e=p.oxw().$implicit;p.xp6(1),p.hij(" (+ ",e.GhiChu.length-1,") ")}}function at(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"mat-option",49),p.NdJ("click",function(){var t=p.CHM(e).$implicit,n=p.oxw().$implicit;return p.oxw(2).addNote(n._id,t)}),p._uU(1),p.qZA()}if(2&t){var i=n.$implicit;p.Q6J("value",i.NoiDung),p.xp6(1),p.hij(" ",i.NoiDung," ")}}function ut(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"mat-list-option"),p.TgZ(1,"table"),p.TgZ(2,"tr"),p.TgZ(3,"td"),p._uU(4),p.qZA(),p.TgZ(5,"td"),p._uU(6),p.ALo(7,"number"),p.qZA(),p.TgZ(8,"td"),p._uU(9),p.qZA(),p.TgZ(10,"td"),p.TgZ(11,"mat-icon",43),p._uU(12,"delete"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(13,"tr"),p.TgZ(14,"td"),p.TgZ(15,"mat-select",44),p.TgZ(16,"mat-select-trigger"),p._uU(17),p.YNc(18,ot,2,1,"span",5),p.qZA(),p.YNc(19,at,2,2,"mat-option",45),p.ALo(20,"catalog"),p.TgZ(21,"mat-form-field"),p._UZ(22,"input",46,47),p.TgZ(24,"mat-icon",48),p.NdJ("click",function(){var t=p.CHM(e).$implicit,n=p.MAs(23);return t.GhiChu[0]=n.value}),p._uU(25,"save"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA()}if(2&t){var i=n.$implicit;p.xp6(4),p.hij("",i.TenHangHoa,":"),p.xp6(2),p.Oqu(p.lcZ(7,8,i.SoLuong)),p.xp6(3),p.hij(" ",i.DVT,""),p.xp6(6),p.Q6J("placeholder","\u270e"),p.xp6(2),p.hij("",i.GhiChu[1]," "),p.xp6(1),p.Q6J("ngIf",i.GhiChu.length>1),p.xp6(1),p.Q6J("ngForOf",p.lcZ(20,10,"GhiChuMon")),p.xp6(3),p.s9C("value",i.GhiChu[0])}}function rt(t,n){if(1&t&&(p.TgZ(0,"div"),p.YNc(1,it,4,3,"h6",39),p._UZ(2,"hr"),p.TgZ(3,"mat-selection-list",40),p.YNc(4,ut,26,12,"mat-list-option",41),p.qZA(),p.qZA()),2&t){var e=p.oxw();p.xp6(1),p.Q6J("ngIf",e.table.ThanhTien>0),p.xp6(2),p.Q6J("multiple",!1),p.xp6(1),p.Q6J("ngForOf",null==e.table?null:e.table.DonMua)}}var ct=function(){var n=function(){function n(e,i,o,a,u){t(this,n),this.plus=e,this.route=i,this.fb=o,this.bhsv=a,this.rtSv=u,this.global=!1,this.DonMua=[],this.ThanhTien=0,this.donHang=[],this.filter=[],this.ChiaBan=[],this.ban=0,this.xemBan=!0,this.xemMon=!1,this.db=null,this.title="D\u1ecbch v\u1ee5 \u0103n u\u1ed1ng",this.dbName="ban-hang",this.api="thanh-toan",this.room=this.global?this.api:this.plus.userId+this.api,this.user=this.plus.user.getValue(),this.items=[],this.TabBan=this.plus.sortArr(this.plus.user.getValue().NhomBan,"ThuTu",1),this.NhomHang=this.plus.user.getValue().NhomHang,this.step=0,this.area=this.TabBan[0].NoiDung,this.group=this.NhomHang[0],this.products=[],this.printTime=Date.now(),this.total=0}return e(n,[{key:"ngOnDestroy",value:function(){console.log("Destroy an-uong"),this.plus.subs.unsubscribe(),this.rtSv.leaveRoom(this.room)}},{key:"ngOnInit",value:function(){var t=this;this.plus.setTiTle(this.title),this.plus.IDB_InitDB(this.dbName).subscribe(function(n){t.db=n,t.showArea(t.area),t.plus.updateUserLocal(n,t.api),t.plus.updateAPi.subscribe(function(n){t.showArea(t.area)})})}},{key:"get",value:function(){this.rtSv.get("thanh-toan",this.plus.user.value._id,!1)}},{key:"set",value:function(){this.rtSv.set("thanh-toan",this.plus.user.value._id,Date.now(),!1)}},{key:"print",value:function(){this.bhsv.printBill()}},{key:"showArea",value:function(t){var n=this;this.step=0,this.plus.IDB_DB_GetAllByIndexKey(this.bhsv.db,"an-uong","NhomBan",t).subscribe(function(e){n.ChiaBan=e,n.area=t})}},{key:"chooseTable",value:function(t){this.step=1,this.table=t,this.table.GioVao=Date.now(),this.orderByGroup(this.group)}},{key:"orderByGroup",value:function(t){var n=this;this.plus.IDB_DB_GetAllByIndexKey(this.db,"hang-hoa","NhomHang",t.NoiDung).subscribe(function(t){n.products=t})}},{key:"chooseProduct",value:function(t){var n=0,e=0,i={_id:t._id,TenHangHoa:t.TenHangHoa,GiaBan:t.GiaBan,GiaVon:t.GiaVon,KhuyenMai:t.KhuyenMai,DaLam:0,DVT:t.DVT,SoLuong:0,GhiChu:[" "]},o=this.table.DonMua.findIndex(function(n){return n._id==t._id});-1==o?(i.SoLuong=1,this.table.DonMua.push(i)):this.table.DonMua[o].SoLuong+=1;for(var a=this.table.DonMua,u=0;u<a.length;u++)n+=(a[u].GiaBan-a[u].GiaVon)*a[u].SoLuong,e+=a[u].GiaBan*a[u].SoLuong,this.table.SoKH+=a[u].SoLuong;this.table.ThanhTien=e,this.table.LoiNhuan=n}},{key:"addNote",value:function(t,n){var e=this.table.DonMua.findIndex(function(n){return n._id==t}),i=this.table.DonMua[e].GhiChu.findIndex(function(t){return t==n});this.table.DonMua[e].GhiChu.includes(n.NoiDung)?this.table.DonMua[e].GhiChu.splice(i,1):this.table.DonMua[e].GhiChu.push(n.NoiDung)}},{key:"saveBill",value:function(){console.log(this.table)}},{key:"addArea",value:function(){}},{key:"thanhToan",value:function(){}},{key:"removeItem",value:function(t){}},{key:"addItem",value:function(t,n){}},{key:"delItem",value:function(t){}},{key:"updateList",value:function(t,n,e){var i=+e.target.textContent;if(console.log(i),"Enter"===e.key&&e.preventDefault(),"number"!=typeof i)return this.plus.alertError("Sai \u0111\u1ecbnh d\u1ea1ng"),this.DonMua[t][n]=0;this.DonMua[t][n]=+i}},{key:"back",value:function(){this.step=this.step-1}},{key:"reload",value:function(){this.plus.reload("ban-hang/an-uong")}}]),n}();return n.\u0275fac=function(t){return new(t||n)(p.Y36(f.T),p.Y36(S.gz),p.Y36(g.qu),p.Y36(Z),p.Y36(V.i))},n.\u0275cmp=p.Xpm({type:n,selectors:[["app-an-uong"]],decls:31,vars:6,consts:[[1,"container-fluid"],[3,"click"],[1,"row"],[1,"col-md-9"],["class","step0",4,"ngIf"],[4,"ngIf"],[1,"col-md-3","border","rounded","py-2"],[1,"text-center"],["mat-raised-button","","color","warn",3,"click"],["id","addArea","tabindex","-1","role","dialog","aria-labelledby","modelTitleId","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-body"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary"],[1,"step0"],["color","accent",3,"selected","click",4,"ngFor","ngForOf"],["id","add-btn","mat-raised-button","","data-toggle","modal","data-target","#addArea"],["class","card-group",4,"ngFor","ngForOf"],["color","accent",3,"selected","click"],[1,"card-group"],[1,"card","hangHoa",3,"ngClass","click"],[1,"text-center","pt-3"],["class","badge badge-warning",4,"ngIf"],["class","badge badge-light",4,"ngIf"],[1,"badge","badge-warning"],[1,"badge","badge-light"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","accent",3,"click"],["class","card-group clearfix","id","item",4,"ngFor","ngForOf"],["id","item",1,"card-group","clearfix"],[3,"click",4,"ngIf"],[1,"card","hangHoa"],[1,"text-center","py-3"],["class","text-center text-primary",4,"ngIf"],[3,"multiple"],[4,"ngFor","ngForOf"],[1,"text-center","text-primary"],["color","warn"],["multiple","",1,"mat-select-red",3,"placeholder"],[3,"value","click",4,"ngFor","ngForOf"],["matInput","","placeholder","Ghi ch\xfa kh\xe1c",3,"value"],["note",""],["matSuffix","",3,"click"],[3,"value","click"]],template:function(t,n){1&t&&(p.TgZ(0,"div",0),p.TgZ(1,"button",1),p.NdJ("click",function(){return n.set()}),p._uU(2," set"),p.qZA(),p.TgZ(3,"button",1),p.NdJ("click",function(){return n.get()}),p._uU(4," get"),p.qZA(),p.TgZ(5,"div",2),p.TgZ(6,"div",3),p.YNc(7,W,8,2,"div",4),p.YNc(8,et,10,2,"div",5),p.qZA(),p.TgZ(9,"div",6),p.TgZ(10,"div",7),p.TgZ(11,"button",8),p.NdJ("click",function(){return n.thanhToan()}),p._uU(12),p.ALo(13,"uppercase"),p.qZA(),p.qZA(),p.YNc(14,rt,5,3,"div",5),p.qZA(),p.qZA(),p.qZA(),p.TgZ(15,"div",9),p.TgZ(16,"div",10),p.TgZ(17,"div",11),p.TgZ(18,"div",12),p.TgZ(19,"h5",13),p._uU(20,"Th\xeam b\xe0n"),p.qZA(),p.TgZ(21,"button",14),p.TgZ(22,"span",15),p._uU(23,"\xd7"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(24,"div",16),p._uU(25," Body "),p.qZA(),p.TgZ(26,"div",17),p.TgZ(27,"button",18),p._uU(28,"Close"),p.qZA(),p.TgZ(29,"button",19),p._uU(30,"Save"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA()),2&t&&(p.xp6(7),p.Q6J("ngIf",n.step<1),p.xp6(1),p.Q6J("ngIf",1==n.step),p.xp6(4),p.hij("Th\u1ef1c \u0111\u01a1n ",p.lcZ(13,4,null==n.table?null:n.table.TenBan),""),p.xp6(2),p.Q6J("ngIf",n.table))},directives:[h.O5,v.lW,T.qn,h.sg,T.HS,h.mk,E.Ub,E.vS,b.Hw,y.gD,y.$L,A.KE,q.Nt,A.R9,x.ey],pipes:[h.gd,_.W,_.dw,h.JJ,_.pW],styles:[".hangHoa[_ngcontent-%COMP%]{height:10rem;width:10rem;border-radius:1rem;border-bottom-width:3rem;border-color:#90ee90;color:#00f;float:none;align-items:center;justify-content:center}.hangHoa[_ngcontent-%COMP%]:active{transform:scale(1.1);opacity:50%;background-color:tomato}.new[_ngcontent-%COMP%]{height:10rem;width:10rem;border-radius:1rem;border-bottom-width:3rem;border-color:#90ee90;color:#00f;float:none;align-items:center;justify-content:center}.hoadon[_ngcontent-%COMP%]{width:200px}.mat-list-text[_ngcontent-%COMP%]{color:#00f!important;font-weight:bold;padding-bottom:3px;padding-top:3px}.mat-select-placeholder[_ngcontent-%COMP%]{color:#007bff}  .mat-pseudo-checkbox-checked, .mat-pseudo-checkbox-indeterminate[_ngcontent-%COMP%], .mat-accent[_ngcontent-%COMP%]   .mat-pseudo-checkbox-checked[_ngcontent-%COMP%], .mat-accent[_ngcontent-%COMP%]   .mat-pseudo-checkbox-indeterminate[_ngcontent-%COMP%]{background:tomato!important}.mat-select-red[_ngcontent-%COMP%]{color:tomato!important}  .mat-select-value{color:#00f!important;font-style:italic!important;font-size:small!important}  .mat-select-content{width:20px;background-color:red;font-size:10px}  .mat-select-placeholder{color:#00f!important;font-size:17px}"],data:{animation:[d.Ym,d.Mq]}}),n}(),lt=o(46936),st=o(23487),ht=o(97012),dt=o(15265),gt=o(73624),pt=o(25862),ft=o(55352);function mt(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"button",36),p.NdJ("click",function(){return p.CHM(e),p.oxw().reload()}),p.TgZ(1,"mat-icon"),p._uU(2,"undo"),p.qZA(),p.qZA()}2&t&&p.Q6J("@slideIn",void 0)}function Zt(t,n){1&t&&(p.TgZ(0,"th"),p._uU(1,"M\xe3 v\u1ea1ch"),p.qZA())}function Tt(t,n){1&t&&(p.TgZ(0,"th"),p._uU(1,"Nh\xf3m h\xe0ng"),p.qZA())}function vt(t,n){1&t&&(p.TgZ(0,"th"),p._uU(1,"Khuy\u1ebfn m\xe3i"),p.qZA())}function bt(t,n){1&t&&(p.TgZ(0,"th"),p._uU(1,"\u0110\u01a1n v\u1ecb t\xednh"),p.qZA())}function At(t,n){1&t&&(p.TgZ(0,"th"),p._uU(1,"Gi\xe1 v\u1ed1n"),p.qZA())}function qt(t,n){1&t&&(p.TgZ(0,"th"),p._uU(1,"Quy \u0111\u1ed5i \u0111\u01a1n v\u1ecb"),p.qZA())}function yt(t,n){1&t&&(p.TgZ(0,"th"),p._uU(1,"H\xecnh \u1ea3nh"),p.qZA())}function xt(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"td",44),p.NdJ("click",function(){p.CHM(e);var t=p.oxw().$implicit;return p.oxw(2).onEdit(t)}),p._uU(1),p.qZA()}if(2&t){var i=p.oxw().$implicit;p.xp6(1),p.Oqu(i.Barcode)}}function _t(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"td",44),p.NdJ("click",function(){p.CHM(e);var t=p.oxw().$implicit;return p.oxw(2).onEdit(t)}),p._uU(1),p.qZA()}if(2&t){var i=p.oxw().$implicit;p.xp6(1),p.Oqu(i.NhomHang)}}function kt(t,n){if(1&t&&(p.TgZ(0,"td"),p._uU(1),p.qZA()),2&t){var e=p.oxw().$implicit;p.xp6(1),p.Oqu(e.KhuyenMai)}}function Dt(t,n){if(1&t&&(p.TgZ(0,"td"),p._uU(1),p.qZA()),2&t){var e=p.oxw().$implicit;p.xp6(1),p.Oqu(e.DVT)}}function Nt(t,n){if(1&t&&(p.TgZ(0,"td"),p._uU(1),p.qZA()),2&t){var e=p.oxw().$implicit;p.xp6(1),p.Oqu(e.GiaVon)}}function Bt(t,n){if(1&t&&(p.TgZ(0,"td"),p._uU(1),p.qZA()),2&t){var e=p.oxw().$implicit;p.xp6(1),p.Oqu(e.QuyDoi)}}function It(t,n){if(1&t&&(p.TgZ(0,"td"),p._uU(1),p.qZA()),2&t){var e=p.oxw().$implicit;p.xp6(1),p.Oqu(e.HinhAnh)}}function Ct(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"mat-icon",47),p.NdJ("click",function(){p.CHM(e);var t=p.oxw().$implicit;return p.oxw(2).onDelete(t)}),p._uU(1,"delete"),p.qZA()}}function wt(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"tr"),p.YNc(1,xt,2,1,"td",42),p.YNc(2,_t,2,1,"td",43),p.TgZ(3,"td",44),p.NdJ("click",function(){var t=p.CHM(e).$implicit;return p.oxw(2).onEdit(t)}),p._uU(4),p.qZA(),p.TgZ(5,"td",44),p.NdJ("click",function(){var t=p.CHM(e).$implicit;return p.oxw(2).onEdit(t)}),p._uU(6),p.qZA(),p.TgZ(7,"td",44),p.NdJ("click",function(){var t=p.CHM(e).$implicit;return p.oxw(2).onEdit(t)}),p._uU(8),p.qZA(),p.YNc(9,kt,2,1,"td",38),p.YNc(10,Dt,2,1,"td",39),p.TgZ(11,"td"),p.TgZ(12,"mat-slide-toggle",45),p.NdJ("change",function(){var t=p.CHM(e).$implicit;return p.oxw(2).updateStatus(t)}),p.qZA(),p.qZA(),p.YNc(13,Nt,2,1,"td",38),p.YNc(14,Bt,2,1,"td",38),p.YNc(15,It,2,1,"td",38),p.TgZ(16,"td"),p.YNc(17,Ct,2,0,"mat-icon",46),p.qZA(),p.qZA()}if(2&t){var i=n.$implicit,o=p.oxw(2);p.xp6(1),p.Q6J("ngIf",o.device),p.xp6(1),p.Q6J("Device",2),p.xp6(2),p.Oqu(i.TenHangHoa),p.xp6(2),p.Oqu(i.TonKho),p.xp6(2),p.Oqu(i.GiaBan),p.xp6(1),p.Q6J("ngIf",o.device),p.xp6(1),p.Q6J("Device",2),p.xp6(2),p.Q6J("checked",i.TrangThai),p.xp6(1),p.Q6J("ngIf",o.device),p.xp6(1),p.Q6J("ngIf",o.device),p.xp6(1),p.Q6J("ngIf",o.device),p.xp6(2),p.Q6J("ngIf",o.checkPer(4))}}function Ut(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"table",37),p.TgZ(1,"thead"),p.YNc(2,Zt,2,0,"th",38),p.YNc(3,Tt,2,0,"th",39),p.TgZ(4,"th"),p._uU(5,"T\xean"),p.qZA(),p.TgZ(6,"th"),p._uU(7,"T\u1ed3n kho"),p.qZA(),p.TgZ(8,"th"),p._uU(9,"Gi\xe1n B\xe1n"),p.qZA(),p.YNc(10,vt,2,0,"th",38),p.YNc(11,bt,2,0,"th",39),p.TgZ(12,"th"),p._uU(13,"Cho b\xe1n"),p.qZA(),p.YNc(14,At,2,0,"th",38),p.YNc(15,qt,2,0,"th",38),p.YNc(16,yt,2,0,"th",38),p.TgZ(17,"th"),p.TgZ(18,"mat-icon",40),p.NdJ("click",function(){return p.CHM(e),p.oxw().reload()}),p._uU(19,"cached"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(20,"tbody"),p.YNc(21,wt,18,12,"tr",41),p.qZA(),p.qZA()}if(2&t){var i=p.oxw();p.Q6J("@slideIn",void 0),p.xp6(2),p.Q6J("ngIf",i.device),p.xp6(1),p.Q6J("Device",2),p.xp6(7),p.Q6J("ngIf",i.device),p.xp6(1),p.Q6J("Device",2),p.xp6(3),p.Q6J("ngIf",i.device),p.xp6(1),p.Q6J("ngIf",i.device),p.xp6(1),p.Q6J("ngIf",i.device),p.xp6(5),p.Q6J("ngForOf",i.filter.length>0?i.filter:i.items.slice(0,10))}}function Mt(t,n){if(1&t&&p._UZ(0,"app-import-database",48),2&t){var e=p.oxw();p.Q6J("api",e.api)("form",e.main)("global",!1)}}function Jt(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"button",49),p.NdJ("click",function(){return p.CHM(e),p.oxw().resetDB()}),p._uU(1,"X\xf3a to\xe0n b\u1ed9 d\u1eef li\u1ec7u"),p.qZA()}}function Ht(t,n){if(1&t&&(p.TgZ(0,"mat-option",50),p._uU(1),p.qZA()),2&t){var e=n.$implicit;p.s9C("value",e.NoiDung),p.xp6(1),p.hij("",e.NoiDung," ")}}function Ot(t,n){if(1&t&&(p.TgZ(0,"mat-option",50),p._uU(1),p.qZA()),2&t){var e=n.$implicit;p.s9C("value",e.NoiDung),p.xp6(1),p.hij("",e.NoiDung," ")}}function Ft(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"button",51),p.NdJ("click",function(){return p.CHM(e),p.oxw().save()}),p.TgZ(1,"mat-icon"),p._uU(2,"save"),p.qZA(),p.qZA()}2&t&&p.Q6J("@slideIn",void 0)}var Qt=function(){return[5,10,25,100]},Pt=function(){var n=function(){function n(e,i){t(this,n),this.plus=e,this.fb=i,this.chart=[],this.nhomHang=this.plus.sortArr(this.plus.user.getValue().NhomHang,"ThuTu",1),this.main=this.fb.group({_id:[],Barcode:[""],NhomHang:[,[g.kI.required]],TenHangHoa:[,[g.kI.required]],TonKho:[0],GiaBan:[0,[g.kI.required]],KhuyenMai:[0],DVT:[,[g.kI.required]],TrangThai:[!0],GiaVon:[0,[g.kI.required]],QuyDoi:[],HinhAnh:[]}),this.device=window.innerWidth>1200,this.title="H\xe0ng h\xf3a",this.dbName="ban-hang",this.api="hang-hoa",this.db=null,this.items=[],this.selectedItem=null,this.filter=[],this.itemsAuto=[]}return e(n,[{key:"ngOnInit",value:function(){var t=this;this.plus.setTiTle(this.title),this.plus.IDB_InitDB(this.dbName).subscribe(function(n){return function(t,n,e,i){return new(e||(e=Promise))(function(n,o){function a(t){try{r(i.next(t))}catch(n){o(n)}}function u(t){try{r(i.throw(t))}catch(n){o(n)}}function r(t){t.done?n(t.value):function(t){return t instanceof e?t:new e(function(n){n(t)})}(t.value).then(a,u)}r((i=i.apply(t,[])).next())})}(t,0,void 0,regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.db=n,this.plus.syncOffline(this.api),this.getIDB(),this.plus.updateUserLocal(n,this.api),this.plus.updateAPi.subscribe(function(t){t&&e.getIDB()});case 1:case"end":return t.stop()}},t,this)}))})}},{key:"getIDB",value:function(){var t=this;console.log("getIDB"),this.filter=[],this.plus.IDB_DB_GetAll(this.db,this.api).subscribe(function(n){t.items=n,t.plus.updateAPi.next(!1)})}},{key:"ngOnDestroy",value:function(){console.log("Destroy",this.api),this.plus.subs.unsubscribe()}},{key:"save",value:function(){var t=this;if(!this.main.invalid){var n=Object.assign({},this.main.value);if(0==this.plus.online.value){var e=[];return e.push(n),this.plus.IDB_DB_AddOff(this.db,this.api,e).subscribe(function(n){t.plus.clickBtn("closeModal")})}null==n._id?(delete n._id,this.plus.httpPost(this.api,n).subscribe(function(n){n.status&&t.plus.clickBtn("closeModal")})):this.plus.httpPut(this.api,n).subscribe(function(n){n.status&&t.plus.clickBtn("closeModal")})}}},{key:"onEdit",value:function(t){this.selectedItem=t;var n=this.plus.dateToHtmlObj(t,[""]);this.main.patchValue(n),this.plus.clickBtn("openModal")}},{key:"onDelete",value:function(t){!confirm("B\u1ea1n mu\u1ed1n x\xf3a?")||(this.plus.load(),this.plus.httpDisable(this.api,t).then(function(t){console.log(t)}))}},{key:"getAuto",value:function(t,n){var e=this;!this.db||n.length<2||(this.itemsAuto=[],this.plus.IDB_DB_Search(this.db,t,n,4).subscribe(function(t){e.itemsAuto=t}))}},{key:"getBarcode",value:function(t){this.main.patchValue({Barcode:t})}},{key:"chooseOpt",value:function(t,n,e){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.main.controls[n].setValue(t[e]),i&&this.main.controls[n+"ID"].setValue(t._id)}},{key:"updateStatus",value:function(t){t.TrangThai=!t.TrangThai,delete t.__v,this.plus.httpPost(this.api+"/updateStatus",t).subscribe(function(t){})}},{key:"closeModal",value:function(){this.main.reset()}},{key:"search",value:function(t){this.filter=t}},{key:"find",value:function(t){this.items=t}},{key:"checkPer",value:function(t){return this.plus.checkPer(this.api,t)}},{key:"patchForm",value:function(){}},{key:"reload",value:function(){return this.plus.reload(this.dbName+"/"+this.api)}},{key:"reset",value:function(){this.plus.loaded(),this.filter=[],this.getIDB(),this.main.reset({TonKho:0,TrangThai:!0,KhuyenMai:0,QuyDoi:1,HinhAnh:"#ffffff"})}},{key:"changePage",value:function(t){this.filter=this.items.slice(t.pageIndex*t.pageSize,(t.pageIndex+1)*t.pageSize)}},{key:"resetDB",value:function(){this.plus.resetDB(this.db,this.api)}}]),n}();return n.\u0275fac=function(t){return new(t||n)(p.Y36(f.T),p.Y36(g.qu))},n.\u0275cmp=p.Xpm({type:n,selectors:[["app-hang-hoa"]],decls:82,vars:19,consts:[[1,"container"],["id","add-btn","color","accent","mat-raised-button","","data-toggle","modal","data-target","#modelId",3,"click"],["id","back-btn","mat-raised-button","","color","primary",3,"click",4,"ngIf"],[3,"db","api","filter"],[1,"row"],["class","table table-hover ",4,"ngIf"],[3,"length","pageSize","pageSizeOptions","page"],[3,"api","form","global",4,"ngIf"],[3,"dataJson"],["mat-button","","color","warn",3,"click",4,"ngIf"],["id","openModal","type","button","data-toggle","modal","data-target","#modelId",1,"d-none"],["id","modelId","data-backdrop","static","tabindex","-1","role","dialog","aria-labelledby","modelTitleId","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-body"],[1,"container-fluid"],[3,"formGroup"],["hidden","","formControlName","_id"],["required","","matInput","","formControlName","TenHangHoa"],[1,"col-6"],["required","","formControlName","NhomHang"],[3,"value",4,"ngFor","ngForOf"],["required","","formControlName","DVT"],["type","number","autocomplete","off","matInput","","formControlName","GiaVon",2,"float","right"],["matSuffix",""],["type","number","autocomplete","off","matInput","","formControlName","TonKho",2,"float","right"],["required","","type","number","autocomplete","off","matInput","","formControlName","GiaBan",2,"float","right"],["type","number","autocomplete","off","matInput","","formControlName","KhuyenMai",2,"float","right"],["type","text","autocomplete","off","matInput","","formControlName","QuyDoi"],["type","color","matInput","","formControlName","HinhAnh"],["type","text","autocomplete","off","matInput","","formControlName","Barcode"],[3,"barcodeResult"],["matPrefix","","formControlName","TrangThai","color","primary",1,"mx-2"],[1,"modal-footer"],["id","closeModal","mat-raised-button","","color","primary","data-dismiss","modal",3,"click"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["id","back-btn","mat-raised-button","","color","primary",3,"click"],[1,"table","table-hover"],[4,"ngIf"],[4,"Device"],["color","primary",3,"click"],[4,"ngFor","ngForOf"],[3,"click",4,"ngIf"],[3,"click",4,"Device"],[3,"click"],["matPrefix","","color","primary",1,"mx-2",3,"checked","change"],["color","warn",3,"click",4,"ngIf"],["color","warn",3,"click"],[3,"api","form","global"],["mat-button","","color","warn",3,"click"],[3,"value"],["mat-raised-button","","color","warn",3,"click"]],template:function(t,n){1&t&&(p.TgZ(0,"div",0),p.TgZ(1,"button",1),p.NdJ("click",function(){return n.reset()}),p.TgZ(2,"mat-icon"),p._uU(3,"control_point"),p.qZA(),p.qZA(),p.YNc(4,mt,3,1,"button",2),p.TgZ(5,"app-search-table",3),p.NdJ("filter",function(t){return n.search(t)}),p.qZA(),p.TgZ(6,"div",4),p.YNc(7,Ut,22,9,"table",5),p.qZA(),p.TgZ(8,"mat-paginator",6),p.NdJ("page",function(t){return n.changePage(t)}),p.qZA(),p.YNc(9,Mt,1,3,"app-import-database",7),p._UZ(10,"app-export-ecxel",8),p.qZA(),p.YNc(11,Jt,2,0,"button",9),p._UZ(12,"button",10),p.TgZ(13,"div",11),p.TgZ(14,"div",12),p.TgZ(15,"div",13),p.TgZ(16,"div",14),p.TgZ(17,"div",15),p.TgZ(18,"form",16),p._UZ(19,"input",17),p.TgZ(20,"mat-form-field"),p.TgZ(21,"mat-label"),p._uU(22,"T\xean"),p.qZA(),p._UZ(23,"textarea",18),p.qZA(),p.TgZ(24,"div",4),p.TgZ(25,"div",19),p.TgZ(26,"mat-form-field"),p.TgZ(27,"mat-label"),p._uU(28,"Nh\xf3m h\xe0ng"),p.qZA(),p.TgZ(29,"mat-select",20),p.YNc(30,Ht,2,2,"mat-option",21),p.qZA(),p.qZA(),p.TgZ(31,"mat-form-field"),p.TgZ(32,"mat-label"),p._uU(33,"\u0110\u01a1n v\u1ecb t\xednh"),p.qZA(),p.TgZ(34,"mat-select",22),p.YNc(35,Ot,2,2,"mat-option",21),p.ALo(36,"catalog"),p.qZA(),p.qZA(),p.TgZ(37,"mat-form-field"),p.TgZ(38,"mat-label"),p._uU(39,"Gi\xe1 v\u1ed1n"),p.qZA(),p._UZ(40,"input",23),p.TgZ(41,"span",24),p._uU(42,".000"),p.qZA(),p.qZA(),p.TgZ(43,"mat-form-field"),p.TgZ(44,"mat-label"),p._uU(45,"T\u1ed3n kho"),p.qZA(),p._UZ(46,"input",25),p._UZ(47,"span",24),p.qZA(),p.TgZ(48,"mat-form-field"),p.TgZ(49,"mat-label"),p._uU(50,"Gi\xe1n B\xe1n"),p.qZA(),p._UZ(51,"input",26),p._UZ(52,"span",24),p.qZA(),p.qZA(),p.TgZ(53,"div",19),p.TgZ(54,"mat-form-field"),p.TgZ(55,"mat-label"),p._uU(56,"Khuy\u1ebfn m\xe3i"),p.qZA(),p._UZ(57,"input",27),p.TgZ(58,"span",24),p._uU(59,"%"),p.qZA(),p.qZA(),p.TgZ(60,"mat-form-field"),p.TgZ(61,"mat-label"),p._uU(62,"Quy \u0111\u1ed5i \u0111\u01a1n v\u1ecb"),p.qZA(),p._UZ(63,"input",28),p._UZ(64,"span",24),p.qZA(),p.TgZ(65,"mat-form-field"),p.TgZ(66,"mat-label"),p._uU(67,"M\xe0u \u0111\u1ea1i di\u1ec7n"),p.qZA(),p._UZ(68,"input",29),p.qZA(),p.TgZ(69,"mat-form-field"),p.TgZ(70,"mat-label"),p._uU(71,"M\xe3 v\u1ea1ch"),p.qZA(),p._UZ(72,"input",30),p.qZA(),p.TgZ(73,"app-barcode-scanner",31),p.NdJ("barcodeResult",function(t){return n.getBarcode(t)}),p.qZA(),p._UZ(74,"hr"),p.TgZ(75,"mat-slide-toggle",32),p._uU(76),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(77,"div",33),p.TgZ(78,"button",34),p.NdJ("click",function(){return n.closeModal()}),p.TgZ(79,"mat-icon"),p._uU(80,"close"),p.qZA(),p.qZA(),p.YNc(81,Ft,3,1,"button",35),p.qZA(),p.qZA(),p.qZA(),p.qZA()),2&t&&(p.xp6(4),p.Q6J("ngIf",n.filter.length>0),p.xp6(1),p.Q6J("db",n.db)("api",n.api),p.xp6(2),p.Q6J("ngIf",n.items.length+n.filter.length>0),p.xp6(1),p.Q6J("length",n.items.length)("pageSize",10)("pageSizeOptions",p.DdM(18,Qt)),p.xp6(1),p.Q6J("ngIf",n.checkPer(4)),p.xp6(1),p.Q6J("dataJson",n.items),p.xp6(1),p.Q6J("ngIf",n.checkPer(5)),p.xp6(7),p.Q6J("formGroup",n.main),p.xp6(12),p.Q6J("ngForOf",n.nhomHang),p.xp6(5),p.Q6J("ngForOf",p.lcZ(36,16,"DVT")),p.xp6(41),p.hij(" ",n.main.controls.TrangThai.value?"C\xf2n h\xe0ng":"H\u1ebft h\xe0ng",""),p.xp6(2),p.Q6J("@slideIn",void 0),p.xp6(3),p.Q6J("ngIf",n.checkPer(2)&&n.main.valid))},directives:[v.lW,b.Hw,h.O5,lt.D,st.NW,ht.t,g._Y,g.JL,g.sg,g.Fj,g.JJ,g.u,A.KE,A.hX,q.Nt,g.Q7,y.gD,h.sg,g.wV,A.R9,dt.O,gt.Rr,A.qo,pt.HP,ft.y,x.ey],pipes:[_.pW],styles:[""],data:{animation:[d.Ym,d.Mq]}}),n}();function Gt(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"div",2),p.TgZ(1,"button",3),p.NdJ("click",function(){return p.CHM(e),p.oxw().resetNhanDon()}),p._uU(2,"nhan-don"),p.qZA(),p.TgZ(3,"button",3),p.NdJ("click",function(){return p.CHM(e),p.oxw().resetHangHoa()}),p._uU(4,"hang-hoa"),p.qZA(),p.qZA()}}var Lt=function(){var n=function(){function n(e){t(this,n),this.plus=e,this.db=null,this.dbName="ban-hang",this.isAdmin=this.plus.isAdmin()}return e(n,[{key:"ngOnInit",value:function(){var t=this;this.plus.IDB_InitDB(this.dbName).subscribe(function(n){t.db=n})}},{key:"resetNhanDon",value:function(){var t=this,n="an-uong";!confirm("Reset DB"+n)||this.plus.httpDelete(n,"del").subscribe(function(e){console.log("Clear DB"),t.plus.FBS_PostByUser(n,0).then(function(e){console.log("Clear FBS"),console.log(e),t.plus.IDB_DB_ClearCollection(t.db,n).subscribe(function(t){console.log("Clear IDB")})})})}},{key:"resetHangHoa",value:function(){var t=this,n="hang-hoa";!confirm("Reset DB"+n)||this.plus.httpDelete(n,"del").subscribe(function(e){console.log("Clear DB"),t.plus.FBS_PostByUser(n,0).then(function(e){console.log("Clear FBS"),console.log(e),t.plus.IDB_DB_ClearCollection(t.db,n).subscribe(function(t){console.log("Clear IDB")})})})}},{key:"checkPer",value:function(t,n){return this.plus.checkPer(t,n)}},{key:"onDetect",value:function(t){console.log(t)}}]),n}();return n.\u0275fac=function(t){return new(t||n)(p.Y36(f.T))},n.\u0275cmp=p.Xpm({type:n,selectors:[["app-ban-hang"]],decls:2,vars:1,consts:[[1,"container"],["class","row",4,"ngIf"],[1,"row"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(t,n){1&t&&(p.TgZ(0,"div",0),p.YNc(1,Gt,5,0,"div",1),p.qZA()),2&t&&(p.xp6(1),p.Q6J("ngIf",n.checkPer("hang-hoa",7)))},directives:[h.O5],styles:[""]}),n}(),Yt=o(83550),St=o(50296);function Vt(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"b",36),p.NdJ("click",function(t){p.CHM(e);var n=p.oxw().$implicit;return p.oxw().addNewItem(n,t)}),p._uU(1),p.qZA()}if(2&t){var i=p.oxw().$implicit;p.xp6(1),p.lnq(" ",i.TenHangHoa," [",i.GiaBan,"k/",i.DVT,"]")}}function Et(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"mat-option",34),p.NdJ("keyup.enter",function(t){var n=p.CHM(e).$implicit;return p.oxw().addNewItem(n,t)})("onSelectionChange",function(t){var n=p.CHM(e).$implicit;return p.oxw().addNewItem(n,t)}),p.YNc(1,Vt,2,3,"b",35),p.qZA()}if(2&t){var i=n.$implicit;p.xp6(1),p.Q6J("ngIf",i.TrangThai)}}function $t(t,n){1&t&&(p.TgZ(0,"mat-option"),p._uU(1," Kh\xf4ng c\xf2n k\u1ebft qu\u1ea3 ph\xf9 h\u1ee3p! "),p.qZA())}function Kt(t,n){if(1&t&&(p.TgZ(0,"b",37),p._uU(1),p.ALo(2,"commas"),p.qZA()),2&t){var e=p.oxw();p.xp6(1),p.hij("Ti\u1ec1n th\u1eeba: ",p.lcZ(2,1,1e3*+e.khachDua-e.ThanhTien),"")}}function jt(t,n){if(1&t){var e=p.EpF();p.TgZ(0,"tr"),p.TgZ(1,"td",38),p._uU(2),p.qZA(),p.TgZ(3,"td",39),p._uU(4),p._UZ(5,"br"),p.TgZ(6,"b",40),p.NdJ("blur",function(t){var n=p.CHM(e).index;return p.oxw().updateGiaBan(n,"GiaBan",t)})("keydown.enter",function(t){var n=p.CHM(e).index;return p.oxw().updateGiaBan(n,"GiaBan",t)})("keydown.enter",function(t){var n=p.CHM(e).index;return p.oxw().updateList(n,"GiaBan",t)})("blur",function(t){var n=p.CHM(e).index;return p.oxw().updateList(n,"GiaBan",t)}),p._uU(7),p.ALo(8,"number"),p.qZA(),p._uU(9),p.qZA(),p.TgZ(10,"td",17),p.TgZ(11,"mat-icon",41),p.NdJ("click",function(){var t=p.CHM(e).index;return p.oxw().removeItem(t)}),p._uU(12,"arrow_left"),p.qZA(),p.TgZ(13,"b",42),p.NdJ("keydown.enter",function(t){var n=p.CHM(e).index;return p.oxw().updateList(n,"TongCong",t)})("blur",function(t){var n=p.CHM(e).index;return p.oxw().updateList(n,"TongCong",t)}),p._uU(14),p.ALo(15,"number"),p.qZA(),p.TgZ(16,"mat-icon",43),p.NdJ("click",function(){var t=p.CHM(e),n=t.$implicit,i=t.index;return p.oxw().addItem(n,i)}),p._uU(17,"arrow_right"),p.qZA(),p.qZA(),p.TgZ(18,"td",44),p.TgZ(19,"b"),p._uU(20),p.ALo(21,"commas"),p.qZA(),p.TgZ(22,"span",45),p.NdJ("click",function(){var t=p.CHM(e).index;return p.oxw().delItem(t)}),p.TgZ(23,"mat-icon",46),p._uU(24,"delete"),p.qZA(),p.qZA(),p.qZA(),p.qZA()}if(2&t){var i=n.$implicit,o=n.index;p.xp6(2),p.Oqu(o+1),p.xp6(2),p.Oqu(i.TenHangHoa),p.xp6(3),p.Oqu(p.lcZ(8,6,i.GiaBan)),p.xp6(2),p.hij("k/",i.DVT," "),p.xp6(5),p.hij(" ",p.lcZ(15,8,i.TongCong)," "),p.xp6(6),p.Oqu(p.lcZ(21,10,i.TongCong*i.GiaBan*1e3))}}function zt(t,n){if(1&t&&(p.TgZ(0,"tr"),p.TgZ(1,"td"),p._uU(2),p.qZA(),p.TgZ(3,"td"),p._uU(4),p._UZ(5,"br"),p._uU(6),p.ALo(7,"commas"),p.qZA(),p.TgZ(8,"td",48),p._uU(9),p.qZA(),p.TgZ(10,"td",50),p._uU(11),p.ALo(12,"commas"),p.qZA(),p.qZA()),2&t){var e=n.$implicit,i=n.index;p.xp6(2),p.hij("",i+1," "),p.xp6(2),p.hij("",e.TenHangHoa," "),p.xp6(2),p.hij(" ",p.lcZ(7,5,1e3*e.GiaBan)," "),p.xp6(3),p.Oqu(e.TongCong),p.xp6(2),p.Oqu(p.lcZ(12,7,e.TongCong*e.GiaBan*1e3))}}function Rt(t,n){if(1&t&&(p.TgZ(0,"tbody"),p.YNc(1,zt,13,9,"tr",19),p.TgZ(2,"tr"),p.TgZ(3,"td",47),p.TgZ(4,"h5"),p._uU(5,"T\u1ed5ng c\u1ed9ng:"),p.qZA(),p.qZA(),p.TgZ(6,"td"),p.TgZ(7,"h5"),p._uU(8),p.qZA(),p.qZA(),p.TgZ(9,"td",48),p.TgZ(10,"h5"),p._uU(11),p.ALo(12,"commas"),p.qZA(),p.TgZ(13,"h6"),p.TgZ(14,"i"),p._uU(15),p.ALo(16,"titlecase"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(17,"td",49),p.TgZ(18,"h6"),p._uU(19,"Xin c\u1ea3m \u01a1n qu\xfd kh\xe1ch"),p.qZA(),p.TgZ(20,"h6"),p._uU(21,"S\u1ea3n ph\u1ea9m c\u1ee7a 4la.vn"),p.qZA(),p.qZA(),p.qZA()),2&t){var e=p.oxw();p.xp6(1),p.Q6J("ngForOf",e.DonMua),p.xp6(7),p.hij("",e.total," m\xf3n"),p.xp6(3),p.hij(" ",p.lcZ(12,4,e.ThanhTien),""),p.xp6(4),p.Oqu(p.lcZ(16,6,e.bangchu))}}var Wt=function(t){return{loading:t}},Xt=function(){var n=function(){function n(e,i,o){t(this,n),this.plus=e,this.route=i,this.fb=o,this.subs=(new Yt.y).subscribe(),this.db=null,this.title="B\xe1n h\xe0ng t\u1ea1p h\xf3a",this.dbName="ban-hang",this.api="tap-hoa",this.tabs=[],this.items=[],this.DonMua=[],this.total=0,this.ThanhTien=0,this.donHang=[],this.bangchu="",this.filter=[],this.audio=new Audio,this.nhapThuCong=!1,this.xemHoaDon=!0,this.user=this.plus.user.getValue(),this.printTime=Date.now(),this.NhomHang=this.plus.user.getValue().NhomHang,this.TabBan=this.plus.sortArr(this.plus.user.getValue().NhomBan,"ThuTu",1),this.ChiaBan=[],this.ban=0,this.width=window.innerWidth,this.count=0,this.now=Date.now(),this.xemBan=!0,this.xemMon=!1,this.donHangFB=this.fb.group({ThanhTien:[,[g.kI.required]],LoiNhuan:[,[g.kI.required]],SoKH:[,[g.kI.required]],GioVao:[,[g.kI.required]],DaThanhToan:[,[g.kI.required]],DonMua:this.fb.array([this.fb.group({idHangHoa:[,[g.kI.required]],DVT:[,[g.kI.required]],GiaBan:[,[g.kI.required]],GiaVon:[,[g.kI.required]],KhuyenMai:[,[g.kI.required]],TenHangHoa:[,[g.kI.required]],TongCong:[,[g.kI.required]]})])}),this.searchForm=this.fb.group({input:[,[g.kI.minLength(3),g.kI.maxLength(50)]]})}return e(n,[{key:"ngOnDestroy",value:function(){console.log("Destroy an-uong"),this.plus.subs.unsubscribe()}},{key:"test",value:function(t){console.log(+t.replace(/\D/g,"")),this.khachDua=+t}},{key:"ngOnInit",value:function(){var t=this;this.plus.setTiTle(this.title),this.getBillLocal(),this.plus.IDB_InitDB(this.dbName).subscribe(function(n){t.db=n,document.getElementById("search-api").focus(),t.plus.updateUserLocal(n,"hang-hoa")}),this.search(),this.audio.src="assets/audio/beep.mp3",this.audio.load()}},{key:"getBillLocal",value:function(){var t=JSON.parse(localStorage.getItem("tapHoaBill"));console.log("getBillLocal",t),null==t?this.DonMua=[]:(this.DonMua=t,this.getTongCong())}},{key:"search",value:function(){var t=this;this.subs.add(this.searchForm.valueChanges.subscribe(function(n){var e=t.plus.removeAccents(n.input);e.trim().length<2||t.plus.IDB_DB_GetByBarCode(t.db,"hang-hoa",e).subscribe(function(n){n?(t.searchForm.reset(),n.TrangThai?t.addNewItem(n,{}):t.plus.alertMatSnackBar("T\u1ea1m h\u1ebft h\xe0ng")):(t.filter=[],t.plus.IDB_DB_Search(t.db,"hang-hoa",e,5).subscribe(function(n){t.filter=n}))})}))}},{key:"thanhToan",value:function(){var t=this,n=confirm("In h\xf3a \u0111\u01a1n?"),e=Object.assign({DonMua:this.DonMua.map(function(t){return{idHangHoa:t._id,TenHangHoa:t.TenHangHoa,GiaBan:t.GiaBan,GiaVon:t.GiaVon,KhuyenMai:t.KhuyenMai,DVT:t.DVT,TongCong:t.TongCong}}),LoiNhuan:this.DonMua.map(function(t){return t.GiaBan-t.GiaVon-t.GiaBan*t.KhuyenMai/100}).reduce(function(t,n){return t+n}),ThanhTien:this.ThanhTien,GioVao:Date.now(),SoKH:this.total,DaThanhToan:!0});if(this.donHangFB.patchValue(e),this.donHangFB.invalid){var i=this.plus.getErrValidateForm(this.donHangFB);console.log(i,this.donHangFB.status)}else this.plus.httpPost("thanh-toan/new",e).subscribe(function(n){var e=t.plus.Crypt_DecryptRest(n);t.plus.FBS_PostByUser("hang-hoa",e.dateModify),t.DonMua=[],t.reload()});localStorage.removeItem("tapHoaBill"),n?(this.PrintDiv("HoaDon"),console.log(0,e)):console.log(1,e)}},{key:"addNewItem",value:function(t,n){console.log(n),this.filter=[],this.playAudio(),this.xemHoaDon=!0,window.navigator.vibrate(100);var e=this.DonMua.find(function(n){return n._id==t._id});if(!e)return t.TongCong=1,this.DonMua.unshift(t),this.getTongCong();var i=this.DonMua.findIndex(function(t){return t._id==e._id});this.DonMua[i].TongCong+=1,this.getTongCong(),this.filter=[],this.searchForm.controls.input.setValue("")}},{key:"removeItem",value:function(t){this.playAudio(),this.DonMua[t].TongCong>0&&(this.DonMua[t].TongCong-=1),this.getTongCong()}},{key:"addItem",value:function(t,n){this.playAudio(),this.DonMua[n].TongCong+=1,this.getTongCong()}},{key:"delItem",value:function(t){this.DonMua.splice(t,1),this.getTongCong()}},{key:"getTongCong",value:function(){this.total=this.plus.sumByKey(this.DonMua,["TongCong"]).TongCong,this.getThanhTien()}},{key:"getThanhTien",value:function(){var t=0;return this.DonMua.forEach(function(n){t+=n.GiaBan*n.TongCong*1e3}),this.bangchu=this.plus.numToVi(t),localStorage.setItem("tapHoaBill",JSON.stringify(this.DonMua)),this.ThanhTien=t}},{key:"PrintDiv",value:function(t){this.plus.load();var n=window.document.getElementById(t),e=window.open("","PRINT");e.document.write(document.documentElement.innerHTML),setTimeout(function(){e.document.body.innerHTML=n.outerHTML,e.document.close(),e.focus(),e.print(),e.close()},1e3),this.plus.loaded()}},{key:"getBarcode",value:function(t){this.searchForm.controls.input.setValue(t)}},{key:"find",value:function(t){this.filter=t}},{key:"getByBarcode",value:function(t){}},{key:"reload",value:function(){this.plus.reload("ban-hang/tap-hoa")}},{key:"updateList",value:function(t,n,e){var i=+e.target.textContent;if(console.log(i),"Enter"===e.key&&e.preventDefault(),"number"!=typeof i)return this.plus.alertError("Sai \u0111\u1ecbnh d\u1ea1ng"),this.DonMua[t][n]=0;this.DonMua[t][n]=+i,this.getTongCong()}},{key:"updateGiaBan",value:function(t,n,e){var i=this;if(this.DonMua[t][n]!=+e.target.textContent){var o=this.DonMua[t].TongCong,a=this.DonMua[t];delete a.__v,delete a.TongCong,a.GiaBan=+e.target.textContent,this.plus.httpPut("hang-hoa",a).subscribe(function(n){document.getElementById("search-api").focus(),console.log(i.DonMua[t])}),this.DonMua[t][n]=+e.target.textContent,this.DonMua[t].TongCong=+o,this.getTongCong()}}},{key:"updateKhachDua",value:function(t){var n=+t.target.textContent;console.log(n,typeof n),"Enter"===t.key&&t.preventDefault(),("number"!=typeof n||Number.isNaN(n))&&this.plus.alertError("B\u1ea1n ph\u1ea3i nh\u1eadp s\u1ed1 ti\u1ec1n"),this.khachDua=+n}},{key:"playAudio",value:function(){this.audio.play()}}]),n}();return n.\u0275fac=function(t){return new(t||n)(p.Y36(f.T),p.Y36(S.gz),p.Y36(g.qu))},n.\u0275cmp=p.Xpm({type:n,selectors:[["app-tap-hoa"]],decls:69,vars:22,consts:[[1,"container-fluid"],[1,"row",2,"padding-top","10px"],[1,"col-lg-6"],[1,"form-group",3,"formGroup"],["type","text","id","search-api","autocomplete","off","formControlName","input","placeholder","T\xecm ki\u1ebfm (F2)",1,"form-control",3,"readonly","matAutocomplete","ngClass"],["autoActiveFirstOption",""],["auto","matAutocomplete"],[3,"keyup.enter","onSelectionChange",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"barcodeResult"],["id","thanh-toan","mat-raised-button","","color","warn",1,"float-rigth",3,"disabled","click"],["contentEditable","true",1,"font-blue","inputSpan",3,"keydown.enter","blur"],["style","padding-left: 15px; color: blue;",4,"ngIf"],[1,"row"],[1,"table","table-hover"],["width","10%"],["width","35%"],["width","30%"],["width","25%",2,"text-align","center"],[4,"ngFor","ngForOf"],["id","modelId","tabindex","-1","role","dialog","aria-labelledby","modelTitleId","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-body","hoadon"],["id","HoaDon",1,"div"],[1,"text-left"],[1,"thead-inverse"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary"],[3,"keyup.enter","onSelectionChange"],[3,"click",4,"ngIf"],[3,"click"],[2,"padding-left","15px","color","blue"],["width","10%",2,"padding-left","5px"],["width","35%",2,"font-size","16px"],["contenteditable","true",1,"px-2","font-blue",3,"blur","keydown.enter"],["matPrefix","",1,"ar",3,"click"],["contenteditable","true",1,"font-blue",3,"keydown.enter","blur"],["matSuffix","",1,"ar",3,"click"],["width","25%",1,"text-right"],[2,"margin-left","20px",3,"click"],["color","warn"],["colspan","2",1,"text-center"],[1,"text-center"],["colspan","4",1,"text-center"],[1,"text-rigth"]],template:function(t,n){if(1&t&&(p.TgZ(0,"div",0),p.TgZ(1,"div",1),p.TgZ(2,"div",2),p.TgZ(3,"div",3),p._UZ(4,"input",4),p.TgZ(5,"mat-autocomplete",5,6),p.YNc(7,Et,2,1,"mat-option",7),p.YNc(8,$t,2,0,"mat-option",8),p.qZA(),p.qZA(),p.qZA(),p.TgZ(9,"div",2),p.TgZ(10,"app-barcode-scanner",9),p.NdJ("barcodeResult",function(t){return n.getBarcode(t)}),p.qZA(),p.TgZ(11,"button",10),p.NdJ("click",function(){return n.thanhToan()}),p._uU(12),p.ALo(13,"commas"),p.qZA(),p.TgZ(14,"b"),p._uU(15,"Kh\xe1ch \u0111\u01b0a: "),p.TgZ(16,"span",11),p.NdJ("keydown.enter",function(t){return n.updateKhachDua(t)})("blur",function(t){return n.updateKhachDua(t)}),p.qZA(),p._uU(17,".000\u0111"),p.qZA(),p.YNc(18,Kt,3,3,"b",12),p.qZA(),p.qZA(),p.TgZ(19,"div",13),p.TgZ(20,"table",14),p.TgZ(21,"thead"),p.TgZ(22,"tr"),p.TgZ(23,"th",15),p._uU(24,"TT "),p.qZA(),p.TgZ(25,"th",16),p._uU(26,"H\u1ea1ng m\u1ee5c"),p.qZA(),p.TgZ(27,"th",17),p._uU(28,"S\u1ed1 l\u01b0\u1ee3ng"),p.qZA(),p.TgZ(29,"th",18),p._uU(30,"Th\xe0nh ti\u1ec1n"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(31,"tbody"),p.YNc(32,jt,25,12,"tr",19),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(33,"div",20),p.TgZ(34,"div",21),p.TgZ(35,"div",22),p.TgZ(36,"div",23),p.TgZ(37,"h5",24),p._uU(38,"Modal title"),p.qZA(),p.TgZ(39,"button",25),p.TgZ(40,"span",26),p._uU(41,"\xd7"),p.qZA(),p.qZA(),p.qZA(),p.TgZ(42,"div",27),p.TgZ(43,"div",28),p.TgZ(44,"div",29),p.TgZ(45,"h6"),p._uU(46),p.qZA(),p.TgZ(47,"h6"),p._uU(48),p.qZA(),p.TgZ(49,"h6"),p._uU(50),p.ALo(51,"date"),p.qZA(),p.qZA(),p.TgZ(52,"table",14),p.TgZ(53,"thead",30),p.TgZ(54,"tr"),p.TgZ(55,"th"),p._uU(56,"TT"),p.qZA(),p.TgZ(57,"th"),p._uU(58,"H\u1ea1ng m\u1ee5c"),p.qZA(),p.TgZ(59,"th"),p._uU(60,"S\u1ed1 l\u01b0\u1ee3ng"),p.qZA(),p.TgZ(61,"th"),p._uU(62,"Th\xe0nh ti\u1ec1n"),p.qZA(),p.qZA(),p.qZA(),p.YNc(63,Rt,22,8,"tbody",8),p.qZA(),p.qZA(),p.qZA(),p.TgZ(64,"div",31),p.TgZ(65,"button",32),p._uU(66,"Close"),p.qZA(),p.TgZ(67,"button",33),p._uU(68,"Save"),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA()),2&t){var e=p.MAs(6);p.xp6(3),p.Q6J("formGroup",n.searchForm),p.xp6(1),p.Q6J("readonly",!1)("matAutocomplete",e)("ngClass",p.VKq(20,Wt,n.filter.length>1&&n.filter.length<5)),p.xp6(3),p.Q6J("ngForOf",n.filter),p.xp6(1),p.Q6J("ngIf",0==n.filter.length&&n.searchForm.value.input),p.xp6(3),p.Q6J("disabled",0==n.ThanhTien),p.xp6(1),p.AsE(" ",n.DonMua.length," | ",p.lcZ(13,15,n.ThanhTien)," "),p.xp6(6),p.Q6J("ngIf",n.khachDua>0&&1e3*n.khachDua>n.ThanhTien),p.xp6(14),p.Q6J("ngForOf",n.DonMua),p.xp6(14),p.Oqu(n.user.title),p.xp6(2),p.Oqu(n.user.phoneNumber),p.xp6(2),p.hij("Gi\u1edd in:",p.xi3(51,17,n.printTime,"hh:mm dd/MM/yyyy"),""),p.xp6(13),p.Q6J("ngIf",n.DonMua)}},directives:[g.JL,g.sg,g.Fj,St.ZL,g.JJ,g.u,h.mk,St.XC,h.sg,h.O5,dt.O,v.lW,x.ey,b.Hw,A.qo,A.R9],pipes:[_.W,h.uU,h.JJ,h.rS],styles:[".hangHoa[_ngcontent-%COMP%]{height:8rem;width:8rem;border-radius:1rem;margin:.2rem;border-bottom-width:1rem;border-color:#90ee90;color:#00f;float:left;display:flex;align-items:center;justify-content:center}.hangHoa[_ngcontent-%COMP%]:active{transform:scale(1.1);opacity:50%}.hoadon[_ngcontent-%COMP%]{width:200px}.font-mat[_ngcontent-%COMP%]{color:#fff;font-size:medium}.font-blue[_ngcontent-%COMP%]{font-size:16px;padding-left:10px;padding-right:10px}.arrow-bt[_ngcontent-%COMP%]{font-size:larger;color:#00f;font-weight:700;padding:.5rem}.arrow-bt[_ngcontent-%COMP%]:hover{border:brown;border-radius:.5rem;background-color:#0ff}.example-form-field[_ngcontent-%COMP%]{max-width:8rem}.row[_ngcontent-%COMP%]{margin-left:5px!important;margin-right:5px!important}td[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{padding:0;vertical-align:middle}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding-bottom:0!important}.ar[_ngcontent-%COMP%]{transform:scale(1.5);color:tomato}.ar[_ngcontent-%COMP%]:active{transform:scale(2.2);color:#00f}.inputSpan[_ngcontent-%COMP%]{border-bottom:solid;border-color:#00f;padding-left:10px;text-align:right}.inputSpan[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:focus{border:rgb(255,0,0)}"],data:{animation:[d.Ym]}}),n}(),tn=function(){var n=function(){function n(e){t(this,n),this.plus=e}return e(n,[{key:"canActivate",value:function(){return this.plus.checkPer("hang-hoa")}}]),n}();return n.\u0275fac=function(t){return new(t||n)(p.LFG(f.T))},n.\u0275prov=p.Yz7({token:n,factory:n.\u0275fac}),n}(),nn=function(){var n=function(){function n(e){t(this,n),this.plus=e}return e(n,[{key:"canActivate",value:function(){return this.plus.checkPer("an-uong")}}]),n}();return n.\u0275fac=function(t){return new(t||n)(p.LFG(f.T))},n.\u0275prov=p.Yz7({token:n,factory:n.\u0275fac}),n}(),en=function(){var n=function(){function n(e){t(this,n),this.plus=e}return e(n,[{key:"canActivate",value:function(){return this.plus.checkPer("pha-che")}}]),n}();return n.\u0275fac=function(t){return new(t||n)(p.LFG(f.T))},n.\u0275prov=p.Yz7({token:n,factory:n.\u0275fac}),n}(),on=function(){var n=function(){function n(e){t(this,n),this.plus=e}return e(n,[{key:"canActivate",value:function(){return this.plus.checkPer("tap-hoa")}}]),n}();return n.\u0275fac=function(t){return new(t||n)(p.LFG(f.T))},n.\u0275prov=p.Yz7({token:n,factory:n.\u0275fac}),n}(),an=function(){var n=function(){function n(e){t(this,n),this.plus=e}return e(n,[{key:"canActivate",value:function(){return this.plus.checkPer("thanh-toan")}}]),n}();return n.\u0275fac=function(t){return new(t||n)(p.LFG(f.T))},n.\u0275prov=p.Yz7({token:n,factory:n.\u0275fac}),n}(),un=function(){var n=function(){function n(e){t(this,n),this.plus=e}return e(n,[{key:"canActivate",value:function(){return this.plus.checkPer("quan-ly")}}]),n}();return n.\u0275fac=function(t){return new(t||n)(p.LFG(f.T))},n.\u0275prov=p.Yz7({token:n,factory:n.\u0275fac}),n}(),rn=[{path:"",component:Lt},{path:"hang-hoa",component:Pt,canActivate:[tn]},{path:"an-uong/:ten-ban",component:ct,canActivate:[nn]},{path:"an-uong",component:ct,canActivate:[nn]},{path:"pha-che",component:Y,canActivate:[en]},{path:"tap-hoa",component:Xt,canActivate:[on]},{path:"bao-cao",component:F,canActivate:[an]},{path:"quan-ly",component:U,canActivate:[un]}],cn=function(){var n=function n(){t(this,n)};return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=p.oAB({type:n}),n.\u0275inj=p.cJS({providers:[tn,nn,en,on,an,un],imports:[[S.Bz.forChild(rn)],S.Bz]}),n}(),ln=o(85913),sn=o(24561),hn=o(60929),dn=function(){var n=function n(){t(this,n)};return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=p.oAB({type:n}),n.\u0275inj=p.cJS({providers:[hn.F],imports:[[h.ez,r.ShareModule,l.qX,cn,s.D,ln.m,hn.F,sn.k,c.k,u.N]]}),n}()}}])}();