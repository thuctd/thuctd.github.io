"use strict";(self.webpackChunkdlxl=self.webpackChunkdlxl||[]).push([[990],{51511:(A,M,h)=>{h.d(M,{k:()=>e});var s=h(5e3),b=h(15194);let e=(()=>{class T{constructor(){this.files=new s.vpe}ngOnInit(){}ngOnDestroy(){this.files.unsubscribe(),console.log("ngOnDestroy app-drop-files")}onDrop(u){this.files.emit(u),document.getElementById("dropZone").setAttribute("drop-active","false")}selectedFile(u){this.files.emit(u.target.files)}ondragover(){document.getElementById("dropZone").setAttribute("drop-active","true")}}return T.\u0275fac=function(u){return new(u||T)},T.\u0275cmp=s.Xpm({type:T,selectors:[["app-drop-files"]],inputs:{label:"label"},outputs:{files:"files"},decls:9,vars:1,consts:[[1,"row","justify-content-center","d-none-print"],["id","dropZone",3,"appDropZone","dragover"],["for","file-import"],["hidden","","id","file-import","type","file","multiple","false",3,"change"]],template:function(u,n){1&u&&(s.TgZ(0,"div",0)(1,"div",1),s.NdJ("appDropZone",function(p){return n.onDrop(p)})("dragover",function(){return n.ondragover()}),s.TgZ(2,"label",2),s._uU(3),s.TgZ(4,"span"),s._uU(5,"\u2794"),s.qZA(),s.TgZ(6,"a"),s._uU(7," Ch\u1ecdn file "),s.qZA()(),s.TgZ(8,"input",3),s.NdJ("change",function(p){return n.selectedFile(p)}),s.qZA()()()),2&u&&(s.xp6(3),s.hij(" K\xe9o th\u1ea3 file ",n.label," v\xe0o \u0111\xe2y ho\u1eb7c "))},directives:[b.i],styles:["label[_ngcontent-%COMP%]{width:100%;height:100%;text-align:center;line-height:170px;color:#00f;font-weight:bolder}#dropZone[_ngcontent-%COMP%]{top:20%;left:10%;width:80%;height:200px;border-radius:3%;border:2px dashed rgb(38,16,165)}#dropZone[drop-active=true][_ngcontent-%COMP%]{box-shadow:inset 0 0 0 2px #00c;border:2px dashed rgb(38,16,165);background-color:#c9eccb}"],changeDetection:0}),T})()},15194:(A,M,h)=>{h.d(M,{i:()=>b});var s=h(5e3);let b=(()=>{class e{constructor(){this.fileDrop=new s.vpe,this.preventBodyDrop=!0,this.active=!1}onDrop(c){c.preventDefault(),this.active=!1;const{dataTransfer:u}=c;if(u.items){const n=[];for(let r=0;r<u.items.length;r++)"file"===u.items[r].kind&&n.push(u.items[r].getAsFile());u.items.clear(),this.fileDrop.emit(n)}else{const n=u.files;u.clearData(),this.fileDrop.emit(Array.from(n))}}onDragOver(c){c.stopPropagation(),c.preventDefault(),this.active=!0}onDragLeave(c){this.active=!1}onBodyDragOver(c){this.preventBodyDrop&&(c.preventDefault(),c.stopPropagation())}onBodyDrop(c){this.preventBodyDrop&&c.preventDefault()}}return e.\u0275fac=function(c){return new(c||e)},e.\u0275dir=s.lG2({type:e,selectors:[["","appDropZone",""]],hostVars:2,hostBindings:function(c,u){1&c&&s.NdJ("drop",function(r){return u.onDrop(r)})("dragover",function(r){return u.onDragOver(r)})("dragleave",function(r){return u.onDragLeave(r)})("dragover",function(r){return u.onBodyDragOver(r)},!1,s.pYS)("drop",function(r){return u.onBodyDrop(r)},!1,s.pYS),2&c&&s.ekj("drop-zone-active",u.active)},inputs:{preventBodyDrop:"preventBodyDrop"},outputs:{fileDrop:"appDropZone"}}),e})()},31409:(A,M,h)=>{h.d(M,{x:()=>T});var s=h(80574),b=h(5e3),e=h(45230);let T=(()=>{class c{constructor(n){this.plus=n}toJsonArray(n,r=!0){return new Promise(p=>{let g={};if(this.plus.load(),null!=n&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"!=n.type&&"application/vnd.ms-excel"!=n.type)return this.plus.alertError("Kh\xf4ng ph\u1ea3i file excel");const d=new FileReader;d.readAsBinaryString(n),d.onloadend=D=>{const C=s.ij(D.target.result,{type:"binary",cellDates:!0,dateNF:"DD/MM/YYYY"}),P=C.SheetNames;for(let v=0;v<P.length;v++){const _=P[v],E=s.P6.sheet_to_json(C.Sheets[_],{header:1,raw:r});g[`${_}`]=this.convertJSon(E)}this.plus.loaded(),p(g)}})}read(n,r=2){return new Promise(p=>{let g=[];if(this.plus.load(),null!=n&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"!=n.type&&"application/vnd.ms-excel"!=n.type)return this.plus.alertError("Kh\xf4ng ph\u1ea3i file excel");const d=new FileReader;d.readAsBinaryString(n),d.onloadend=D=>{const C=s.ij(D.target.result,{type:"binary",cellDates:!0,dateNF:"DD/MM/YYYY"}),P=C.SheetNames;for(let v=0;v<r;v++){const E=s.P6.sheet_to_json(C.Sheets[P[v]],{header:1});g.push(E)}this.plus.loaded(),p(g)}})}convertJSon(n){const r=[];for(let p=1;p<n.length;p++){const g={};n[0].forEach((d,D)=>{g[`${d}`]=n[p][D]}),r.push(g)}return r}convertJSonByX(n){const r=[];for(let p=1;p<n.length;p++)if("x"==n[p][0]){const g={};n[0].forEach((d,D)=>{g[`${d}`]=n[p][D]}),r.push(g)}return r}readXlsxToMerge(n){return console.log(n),new Promise((r,p)=>{this.plus.load();let g={};if(null!=n&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"!=n.type&&"application/vnd.ms-excel"!=n.type)return this.plus.alertError("Kh\xf4ng ph\u1ea3i file excel");const d=new FileReader;d.readAsBinaryString(n),d.onloadend=D=>{const C=s.ij(D.target.result,{type:"binary",cellDates:!0,dateNF:"DD/MM/YYYY"}),P=C.SheetNames;for(let v=0;v<P.length;v++){const _=P[v];if("_Merge"==_)return this.plus.alertError("Vui l\xf2ng \u0111\u1ed5i t\xean sheet _Merge th\xe0nh t\xean kh\xe1c");const E=s.P6.sheet_to_json(C.Sheets[_],{header:1,raw:!0});g[`${0==v?"_Merge":_}`]=this.convertJSonByX(E)}r(g),this.plus.loaded()}})}export(n,r=""){const p=s.P6.json_to_sheet(n,{skipHeader:!0,dateNF:"mm/dd/yyyy;@",cellDates:!0}),g=s.P6.book_new();s.P6.book_append_sheet(g,p,"ChuaImport"),s.NC(g,"4la-"+r+"-ChuaImport.xlsx")}exportTar(n,r=""){for(let y=0;y<n.length;y++)delete n[y].dateModify,delete n[y].canEdit,delete n[y].keyWord,delete n[y].__v,delete n[y]._id;let p=JSON.stringify(n),g="data:application/json;charset=utf-8,"+encodeURIComponent(p);console.log(g);let d=`4la-${r||""}`+Date.now()+".tar",D=document.createElement("a");D.setAttribute("href",g),D.setAttribute("download",d),D.click()}}return c.\u0275fac=function(n){return new(n||c)(b.LFG(e.T))},c.\u0275prov=b.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()},57990:(A,M,h)=>{h.r(M),h.d(M,{XangDauModule:()=>H});var s=h(34291),b=h(69808),e=h(5e3),T=h(45230),c=h(31409),u=h(93075),n=h(9157),r=h(51511);let p=(()=>{class a{constructor(t,o,i,l){this.plus=t,this.excel=o,this.fb=i,this.docx=l}ngOnInit(){}onDrop(t){}ondragover(){document.getElementById("dropZone").setAttribute("drop-active","true")}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(T.T),e.Y36(c.x),e.Y36(u.qu),e.Y36(n.E))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-van-chuyen"]],decls:1,vars:0,consts:[[3,"files","ondragover"]],template:function(t,o){1&t&&(e.TgZ(0,"app-drop-files",0),e.NdJ("files",function(l){return o.onDrop(l)})("ondragover",function(){return o.ondragover()}),e.qZA())},directives:[r.k],styles:[""]}),a})();var g=h(15439),d=h.n(g),D=h(21019),y=h(67322),C=h(77531),P=h(47423),v=h(25245),_=function(a,f,t,o){return new(t||(t=Promise))(function(l,m){function x(Z){try{F(o.next(Z))}catch(N){m(N)}}function X(Z){try{F(o.throw(Z))}catch(N){m(N)}}function F(Z){Z.done?l(Z.value):function i(l){return l instanceof t?l:new t(function(m){m(l)})}(Z.value).then(x,X)}F((o=o.apply(a,f||[])).next())})};function B(a,f){if(1&a){const t=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(){return e.CHM(t),e.oxw().onGeneBill()}),e._uU(1,"Thanh to\xe1n"),e.qZA()}}function E(a,f){if(1&a){const t=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(){return e.CHM(t),e.oxw().geneSupply()}),e._uU(1,"C\u1ea5p h\xe0ng"),e.qZA()}}let O=(()=>{class a{constructor(t,o,i){this.plus=t,this.excel=o,this.docx=i,this.items=null,this.wordFileTT=null,this.wordFileCH=null,this.DieuPhoi=[],this.taixe=1,this.Cty="",this.vat=10,this.dataInXls=null,this.startMonth=d()(new Date).startOf("month").subtract(1,"months").toDate(),this.startDay=null,this.endDay=null}ngOnInit(){this.getMonth(this.startMonth),this.getWordFile()}getWordFile(){this.docx.loadFileUrl("https://thuctd.github.io/templates/ThanhToan.docx").then(t=>_(this,void 0,void 0,function*(){this.wordFileTT=t})),this.docx.loadFileUrl("https://thuctd.github.io/templates/CapHang.docx").then(t=>_(this,void 0,void 0,function*(){this.wordFileCH=t}))}getMonth(t){this.startDay=d()(t).startOf("month").subtract(1,"minutes").toDate(),this.endDay=d()(t).endOf("month").subtract(1,"minutes").toDate(),this.init()}onDropNew(t){for(let o=0;o<t.length;o++)if(console.log(t[o].type),"application/vnd.openxmlformats-officedocument.wordprocessingml.document"==t[o].type){const i=new FileReader;i.readAsArrayBuffer(t[o]),i.onloadend=()=>this.wordFileTT=i.result,i.onloadend=()=>this.wordFileCH=i.result}else"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"==t[o].type?this.excel.toJsonArray(t[o]).then(i=>{this.dataInXls=i}):this.plus.alertError("File kh\xf4ng h\u1ee3p l\u1ec7")}onGeneBill(){const t=this.dataInXls.Merge;for(let o=0;o<t.length;o++){const i=t[o];this.items=i,this.items.TongSL=0,this.items.TongTT=0,this.items.NgayBC=d()(this.endDay).add(1,"days").toDate(),this.items.TuNgay=this.startDay,this.items.VAT=this.vat,this.Cty=this.plus.removeAccents(i.NhaVC),"TX"==i.PhanLoai?this.getByDriver():"NCC"==i.PhanLoai&&this.getByCompany()}}getByDriver(){return _(this,void 0,void 0,function*(){const t=this.dataInXls,o=[];for(let i=0;i<t.Data.length;i++){const l=t.Data[i],m=l.NgayGiaoHang;d()(m).add(1,"days").toDate().getDate(),m>=this.startDay&&m<=this.endDay&&this.plus.removeAccents(l.NVGiaoHang)==this.Cty&&(o.push(l),this.items.TongSL+=l.SoLuong,this.items.TongTT+=l.ThanhTien)}this.items.Data=o,this.items.Thue=Math.round(this.items.TongTT*this.vat/100),this.items.TongVAT=Math.round(this.items.Thue+this.items.TongTT),yield this.geneBill()})}getByCompany(){const t=this.dataInXls,o=[];for(let i=0;i<t.Data.length;i++){const l=t.Data[i],m=l.NgayGiaoHang;d()(m).add(1,"days").toDate().getDate(),m>=this.startDay&&m<=this.endDay&&this.plus.removeAccents(l.NhaVC)==this.Cty&&(o.push(l),this.items.TongSL+=l.SoLuong,this.items.TongTT+=l.ThanhTien)}this.items.Data=o,this.items.Thue=Math.round(this.items.TongTT*this.vat/100),this.items.TongVAT=Math.round(this.items.Thue+this.items.TongTT),this.geneBill()}geneSupply(){this.onGeneSupply(),this.docx.loadFileUrl("https://thuctd.github.io/templates/CapHang.docx").then(t=>_(this,void 0,void 0,function*(){for(let o=1;o<this.DieuPhoi.length;o++)this.docx.generateOne(this.DieuPhoi[o],t,`Ngay ${this.DieuPhoi[o].NgayGiaoHang.slice(0,2)}`),yield this.plus.sleep(1e3).then(i=>{});this.reload()}))}geneBill(){this.docx.generateOne(this.items,this.wordFileTT,this.Cty+"-"+this.vat).then(t=>{console.log(t)})}onGeneSupply(){const t=this.dataInXls,o=[];for(let i=0;i<t.Data.length;i++){const l=t.Data[i],m=l.NgayGiaoHang,x=d()(m).add(1,"days").toDate().getDate();m>=this.startDay&&m<=this.endDay&&this.plus.removeAccents(l.NhaVC)==this.Cty&&o.push(l),this.checkByCustommer(l,m,x)}}checkByCustommer(t,o,i){const l=this.plus.removeAccents(t.TenKH);if(o>=this.startDay&&this.startDay<=this.endDay)switch(l){case"an binh":this.DieuPhoi[i].AnBinh.push(t);break;case"tan bien":this.DieuPhoi[i].TanBien.push(t);break;case"long phuoc":this.DieuPhoi[i].LongPhuoc.push(t);break;case"trang bom":this.DieuPhoi[i].TrangBom.push(t);break;case"trang dai":this.DieuPhoi[i].TrangDai.push(t);break;case"so 2":this.DieuPhoi[i].So2.push(t);break;case"phu binh":this.DieuPhoi[i].PhuBinh.push(t);break;case"nui le":this.DieuPhoi[i].NuiLe.push(t);break;case"hung nghia":this.DieuPhoi[i].HungNghia.push(t);break;case"dau giay":this.DieuPhoi[i].DauGiay.push(t)}}init(){for(let t=1;t<32;t++){const o=d()(this.startDay).add(t,"days").toDate();this.DieuPhoi[t]={NgayLap:d()(o).subtract(1,"days").format("DD/MM/YYYY"),NgayGiaoHang:d()(o).format("DD/MM/YYYY"),AnBinh:[],TanBien:[],LongPhuoc:[],TrangBom:[],TrangDai:[],So2:[],PhuBinh:[],NuiLe:[],HungNghia:[],DauGiay:[]}}}reload(){this.plus.reload("xang-dau/dieu-phoi")}ondragover(){document.getElementById("dropZone").setAttribute("drop-active","true")}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(T.T),e.Y36(c.x),e.Y36(n.E))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-dieu-phoi"]],decls:11,vars:5,consts:[[1,"container","py-3"],[3,"startDay","month"],["matInput","","placeholder","Thu\u1ebf GTGT (%)",3,"ngModel","ngModelChange"],[3,"label","files","ondragover"],[1,"row","justify-content-center"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["mat-raised-button","","color","warn",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"app-month-year",1),e.NdJ("month",function(l){return o.getMonth(l)}),e.qZA(),e.TgZ(2,"mat-form-field")(3,"input",2),e.NdJ("ngModelChange",function(l){return o.vat=l}),e.qZA()(),e.TgZ(4,"app-drop-files",3),e.NdJ("files",function(l){return o.onDropNew(l)})("ondragover",function(){return o.ondragover()}),e.qZA(),e.TgZ(5,"div",4)(6,"button",5),e.NdJ("click",function(){return o.reload()}),e.TgZ(7,"mat-icon"),e._uU(8,"refresh"),e.qZA()(),e.YNc(9,B,2,0,"button",6),e.YNc(10,E,2,0,"button",6),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("startDay",o.startMonth),e.xp6(2),e.Q6J("ngModel",o.vat),e.xp6(1),e.Q6J("label",""),e.xp6(5),e.Q6J("ngIf",o.dataInXls),e.xp6(1),e.Q6J("ngIf",o.dataInXls))},directives:[D.k,y.KE,C.Nt,u.Fj,u.JJ,u.On,r.k,P.lW,v.Hw,b.O5],styles:["#dropZone[_ngcontent-%COMP%]{position:absolute;top:20%;left:10%;width:80%;height:150px;border-radius:3%;border:solid}#dropZone[drop-active=true][_ngcontent-%COMP%]{box-shadow:inset 0 0 0 2px #00c;border:2px dashed rgb(38,16,165);background-color:#c9eccb}.x[_ngcontent-%COMP%]{border:solid;width:300px;height:200px}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{text-align:right}"]}),a})();var w=h(99826);const S=[{path:"",component:(()=>{class a{constructor(){}ngOnInit(){}}return a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-xang-dau"]],decls:2,vars:0,template:function(t,o){1&t&&(e.TgZ(0,"p"),e._uU(1,"xang-dau works!"),e.qZA())},styles:[""]}),a})()},{path:"dieu-phoi",component:O},{path:"van-chuyen",component:p}];let Y=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[[w.Bz.forChild(S)],w.Bz]}),a})();var I=h(5923);let H=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[[b.ez,Y,s.ShareModule,I.X]]}),a})()}}]);