"use strict";(self.webpackChunk_4la=self.webpackChunk_4la||[]).push([[441],{16314:function(t,e,r){r.d(e,{W:function(){return l},H$:function(){return u},cf:function(){return p},pW:function(){return h},ID:function(){return d},dw:function(){return f},yl:function(){return g}});var n=r(16738),o=r.n(n),s=r(24347),i=r(74788),a=r(88638),c=r(91211);let l=(()=>{class t{transform(t){return(+`${t}`.replace(/\D/g,"")).toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=i.Yjl({name:"commas",type:t,pure:!0}),t})(),u=(()=>{class t{transform(t,e,r){return t?t.filter(t=>t[e]==r):[]}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=i.Yjl({name:"filterByKV",type:t,pure:!0}),t})(),p=(()=>{class t{transform(t){return"number"!=typeof t?o()(t).format("DD/MM/YYYY"):o()(new Date(86400*(t-25569)*1e3)).format("DD/MM/YYYY")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=i.Yjl({name:"excelDay",type:t,pure:!0}),t})(),h=(()=>{class t{constructor(t){this.plus=t}transform(t){const e=JSON.parse(localStorage.getItem("catalog"));return e?e.filter(e=>e.Nhom==t).sort((t,e)=>t.GiaTri<e.GiaTri?-1:t.GiaTri>e.GiaTri?1:0):(this.plus.reload("/taikhoan"),this.plus.getCatalog(),[])}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(a.T,16))},t.\u0275pipe=i.Yjl({name:"catalog",type:t,pure:!0}),t})(),d=(()=>{class t{transform(t){const e=+`${t}`.replace(/\D/g,"");return console.log(e,t),(0,s.Z)(e)+" \u0111\u1ed3ng."}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=i.Yjl({name:"bangChu",type:t,pure:!0}),t})(),f=(()=>{class t{transform(t){return o()(t).locale("vi").fromNow()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=i.Yjl({name:"fromNow",type:t,pure:!0}),t})(),g=(()=>{class t{constructor(t){this.sanitizer=t}transform(t){return this.sanitizer.bypassSecurityTrustResourceUrl(t)}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(c.H7,16))},t.\u0275pipe=i.Yjl({name:"safe",type:t,pure:!0}),t})()},97012:function(t,e,r){r.d(e,{t:function(){return h}});var n=r(16738),o=r.n(n),s=r(84487),i=r(74788),a=r(88638),c=r(12057),l=r(2895);function u(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"button",1),i.NdJ("click",function(){return i.CHM(t),i.oxw().export()}),i._uU(1,"Export Excel"),i.qZA()}}function p(t,e){if(1&t){const t=i.EpF();i.TgZ(0,"button",1),i.NdJ("click",function(){return i.CHM(t),i.oxw().exportToJsonFile()}),i._uU(1,"Export BackupDB"),i.qZA()}}let h=(()=>{class t{constructor(t){this.plus=t}ngOnInit(){}export(){const t=[];this.dataJson.forEach(e=>{delete e.dateModify,delete e.status,delete e.sync,delete e.canEdit,delete e.keyWord,delete e.__v,t.push(e)});const e=s.utils.json_to_sheet(t),r=s.utils.book_new();s.utils.book_append_sheet(r,e,this.api),s.writeFile(r,o()(Date.now()).format("YYYYMMDDHHMM")+"-4la-"+this.api+".xlsx")}exportToJsonFile(){for(let o=0;o<this.dataJson.length;o++)delete this.dataJson[o].dateModify,delete this.dataJson[o].canEdit,delete this.dataJson[o].keyWord,delete this.dataJson[o].__v,delete this.dataJson[o]._id;let t=JSON.stringify(this.dataJson),e="data:application/json;charset=utf-8,"+encodeURIComponent(t),r=`4la-${this.api?this.api:""}`+Date.now()+".db",n=document.createElement("a");n.setAttribute("href",e),n.setAttribute("download",r),n.click()}check(){return this.plus.checkPer("admin",4)}}return t.\u0275fac=function(e){return new(e||t)(i.Y36(a.T))},t.\u0275cmp=i.Xpm({type:t,selectors:[["app-export-ecxel"]],inputs:{dataJson:"dataJson",api:"api"},decls:2,vars:2,consts:[["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",3,"click"]],template:function(t,e){1&t&&(i.YNc(0,u,2,0,"button",0),i.YNc(1,p,2,0,"button",0)),2&t&&(i.Q6J("ngIf",e.check()),i.xp6(1),i.Q6J("ngIf",e.check()))},directives:[c.O5,l.lW],styles:[""]}),t})()},55352:function(t,e,r){r.d(e,{y:function(){return k}});var n=r(28831),o=r(84487),s=r(74788),i=r(88638),a=r(2895),c=r(12057),l=r(49356),u=function(t,e,r,n){return new(r||(r=Promise))(function(o,s){function i(t){try{c(n.next(t))}catch(e){s(e)}}function a(t){try{c(n.throw(t))}catch(e){s(e)}}function c(t){t.done?o(t.value):function(t){return t instanceof r?t:new r(function(e){e(t)})}(t.value).then(i,a)}c((n=n.apply(t,e||[])).next())})};function p(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"div",10),s.TgZ(1,"input",11),s.NdJ("change",function(e){return s.CHM(t),s.oxw(2).readXlsx(e)}),s.qZA(),s.TgZ(2,"label",12),s._uU(3,"Ch\u1ecdn file "),s.TgZ(4,"mat-icon"),s._uU(5,"attachment"),s.qZA(),s.qZA(),s.TgZ(6,"a",13),s.TgZ(7,"mat-icon"),s._uU(8,"cloud_download"),s.qZA(),s._uU(9,"M\u1eabu import "),s.qZA(),s._UZ(10,"hr"),s.qZA()}if(2&t){const t=s.oxw(2);s.xp6(6),s.MGl("href","https://github.com/thuctd/FileStore/raw/master/templates/",t.api,".xlsx",s.LSH)}}function h(t,e){if(1&t&&(s.TgZ(0,"td",17),s._uU(1),s.qZA()),2&t){const t=s.oxw().$implicit;s.xp6(1),s.hij(" ",t.err||"","")}}function d(t,e){if(1&t&&(s.TgZ(0,"tr"),s.YNc(1,h,2,1,"td",16),s.qZA()),2&t){const t=e.$implicit;s.Q6J("@slideIn",void 0),s.xp6(1),s.Q6J("ngIf",t.err)}}function f(t,e){if(1&t&&(s.TgZ(0,"table",14),s.TgZ(1,"h4"),s._uU(2,"L\u1ed7i d\u1eef li\u1ec7u file import"),s.qZA(),s.TgZ(3,"tbody"),s.YNc(4,d,2,2,"tr",15),s.qZA(),s.qZA()),2&t){const t=s.oxw(2);s.xp6(4),s.Q6J("ngForOf",t.errorData.length>0?t.errorData:t.dataJson)}}function g(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"button",18),s.NdJ("click",function(){return s.CHM(t),s.oxw(2).import()}),s._uU(1,"Import Excel"),s.qZA()}}function m(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"button",18),s.NdJ("click",function(){return s.CHM(t),s.oxw(2).importDBFile()}),s._uU(1,"Import BackupDB"),s.qZA()}}function x(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"button",19),s.NdJ("click",function(){return s.CHM(t),s.oxw(2).reload()}),s._uU(1,"L\xe0m l\u1ea1i"),s.qZA()}}function b(t,e){if(1&t&&(s.TgZ(0,"div",3),s.TgZ(1,"h4",4),s._uU(2,"Import t\u1eeb file excel"),s.qZA(),s._UZ(3,"hr"),s.YNc(4,p,11,1,"div",5),s.YNc(5,f,5,1,"table",6),s.TgZ(6,"div",7),s.YNc(7,g,2,0,"button",8),s.YNc(8,m,2,0,"button",8),s.YNc(9,x,2,0,"button",9),s.qZA(),s.qZA()),2&t){const t=s.oxw();s.xp6(4),s.Q6J("ngIf",0===t.dataJson.length),s.xp6(1),s.Q6J("ngIf",t.errorData.length>0),s.xp6(2),s.Q6J("ngIf",t.checkPer(4)&&0==t.errorData.length&&t.dataJson.length>0),s.xp6(1),s.Q6J("ngIf",t.checkPer(4)&&0==t.errorData.length&&t.backup.length>0),s.xp6(1),s.Q6J("ngIf",t.errorData.length>0||t.dataJson.length>0||t.backup.length>0)}}function Z(t,e){if(1&t&&(s.TgZ(0,"tr"),s.TgZ(1,"td"),s._uU(2),s.qZA(),s.TgZ(3,"td"),s._uU(4),s.qZA(),s.qZA()),2&t){const t=e.$implicit;s.xp6(2),s.Oqu(t.index),s.xp6(2),s.Oqu(t.msg)}}function y(t,e){if(1&t&&(s.TgZ(0,"table"),s.TgZ(1,"thead"),s.TgZ(2,"tr"),s.TgZ(3,"th"),s._uU(4,"D\xf2ng"),s.qZA(),s.TgZ(5,"th"),s._uU(6,"L\u1ed7i"),s.qZA(),s.qZA(),s.qZA(),s.TgZ(7,"tbody"),s.YNc(8,Z,5,2,"tr",15),s.qZA(),s.qZA()),2&t){const t=s.oxw();s.xp6(8),s.Q6J("ngForOf",t.errServer)}}let k=(()=>{class t{constructor(t){this.plus=t,this.global=!1,this.dataImport=[],this.dataJson=[],this.errorData=[],this.errServer=[],this.show=!1,this.header=[],this.backup=[]}ngOnInit(){this.dataJson=[],this.dataImport=[]}readXlsx(t){this.plus.load();const e=t.target.files[0];if("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"==e.type||"application/vnd.ms-excel"==e.type){let e=t.target;const r=new FileReader;r.onload=t=>{const r=o.read(t.target.result,{type:"binary"});this.dataImport=o.utils.sheet_to_json(r.Sheets[r.SheetNames[0]],{header:1}),this.selectedFile(this.dataImport),this.plus.loaded(),e=null},r.onerror=()=>this.plus.alertError("L\u1ed7i file excel import"),r.readAsBinaryString(e.files[0])}else{const e=new FileReader;e.readAsText(t.target.files[0],"UTF-8"),e.onload=t=>{const e=JSON.parse(t.target.result);this.backup=this.cleanData(e),this.plus.loaded()},e.onerror=t=>{this.plus.alertError("L\u1ed7i file import"),this.plus.loaded()}}}selectedFile(t){this.header=t[0];for(let e=1;e<t.length;e++){const r={};t[0].forEach((n,o)=>{r[`${n}`]=t[e][o]}),delete r._id,delete r.__v,this.form.patchValue(r),this.form.valid?(r.keyWord=this.plus.generateKeyWord(r),r.dateModify=Date.now()+e,this.dataJson.push(r)):(r.err=`T\u1ea1i h\xe0ng ${e}: ${this.plus.getErrValidateForm(this.form)}`,this.errorData.push(r))}}import(){return u(this,void 0,void 0,function*(){this.plus.subs.unsubscribe();const t=this.dataJson.length;let e=0,r=!1;const n=this.dataJson;for(;e<t;){let o=n.slice(e,e+200);const s=this.plus.Arr_MaxValue(o);if(this.plus.httpPost(this.api+"/import",o).subscribe(t=>{if(1!=t.status)return r=!0;console.log(t.code),this.plus.FBS_PostByUser(this.api,s,this.global),e+=200},n=>{403==n.status&&(this.plus.alertError(n),localStorage.clear(),window.location.reload()),console.log(n),r=!0;const o=JSON.parse(n.error.code);this.errServer.push({index:"",msg:o.message}),this.plus.alertError("Import kh\xf4ng th\xe0nh c\xf4ng!"),e>0&&this.export(this.dataImport.slice(e+1)),e=t}),r)break;yield this.plus.sleep(3e3)}0==r&&(this.plus.alertSuccess("Import th\xe0nh c\xf4ng!"),this.plus.reload("/taikhoan"))})}importDBFile(){return u(this,void 0,void 0,function*(){this.plus.subs.unsubscribe();const t=this.backup.length;let e=0,r=!1;const n=this.backup;for(;e<t;){let o=n.slice(e,e+200);const s=this.plus.Arr_MaxValue(o);if(this.plus.httpPost(this.api+"/import",o).subscribe(t=>{if(console.log(t),1!=t.status)return r=!0;console.log(t.code),this.plus.FBS_PostByUser(this.api,s,this.global),e+=200},n=>{console.log(n),r=!0,this.errServer=JSON.parse(n.error.code),this.plus.alertError("Import kh\xf4ng th\xe0nh c\xf4ng!"),e>0&&this.export(this.dataImport.slice(e+1)),e=t}),r)break;yield this.plus.sleep(3e3)}0==r&&(this.plus.alertSuccess("Import th\xe0nh c\xf4ng!"),this.plus.reload("/taikhoan"))})}checkPer(t){return this.plus.checkPer(this.api,t)}reload(){return this.plus.reload("/")}export(t){t.unshift(this.header);const e=o.utils.json_to_sheet(t,{skipHeader:!0}),r=o.utils.book_new();o.utils.book_append_sheet(r,e,"ChuaImport"),o.writeFile(r,"4la-"+this.api+"-ChuaImport.xlsx")}cleanData(t){const e=[];for(let r=0;r<t.length;r++){const n=t[r];n.keyWord=this.plus.generateKeyWord(n),n.dateModify=Date.now()+r,delete n._id,delete n.__v,e.push(n)}return e}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(i.T))},t.\u0275cmp=s.Xpm({type:t,selectors:[["app-import-database"]],inputs:{form:"form",api:"api",global:"global"},decls:4,vars:2,consts:[["mat-raised-button","","color","accent",3,"click"],["class","card",4,"ngIf"],[4,"ngIf"],[1,"card"],[1,"text-center","text-white","py-2","my-3","bg-primary","rounded-pill","justify-content-center"],["class","ix",4,"ngIf"],["class","table table-inverse table-responsive",4,"ngIf"],[1,"text-center","mx-3"],["class","text-center mx-3","mat-raised-button","","color","accent",3,"click",4,"ngIf"],["class","text-center mx-3","mat-raised-button","","color","primary",3,"click",4,"ngIf"],[1,"ix"],["hidden","","id","file-import","type","file","multiple","false",3,"change"],["for","file-import",1,"custom-file-upload","text-primary","mx-5"],["mat-button","","target","_blank",3,"href"],[1,"table","table-inverse","table-responsive"],[4,"ngFor","ngForOf"],["class","text-danger",4,"ngIf"],[1,"text-danger"],["mat-raised-button","","color","accent",1,"text-center","mx-3",3,"click"],["mat-raised-button","","color","primary",1,"text-center","mx-3",3,"click"]],template:function(t,e){1&t&&(s.TgZ(0,"button",0),s.NdJ("click",function(){return e.show=!e.show}),s._uU(1,"Import Database"),s.qZA(),s.YNc(2,b,10,5,"div",1),s.YNc(3,y,9,1,"table",2)),2&t&&(s.xp6(2),s.Q6J("ngIf",e.show),s.xp6(1),s.Q6J("ngIf",e.errServer.length>0))},directives:[a.lW,c.O5,l.Hw,a.zs,c.sg],styles:[""],data:{animation:[n.Ym]}}),t})()},85913:function(t,e,r){r.d(e,{m:function(){return a}});var n=r(62136),o=r(24751),s=r(12057),i=r(74788);let a=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({imports:[[s.ez,o.UX,n.q]]}),t})()}}]);