"use strict";(self.webpackChunk_4la=self.webpackChunk_4la||[]).push([[855],{51511:function(t,e,n){n.d(e,{k:function(){return s}});var o=n(74788),i=n(15194);let s=(()=>{class t{constructor(){this.files=new o.vpe}ngOnInit(){}ngOnDestroy(){this.files.unsubscribe(),console.log("ngOnDestroy app-drop-files")}onDrop(t){this.files.emit(t),document.getElementById("dropZone").setAttribute("drop-active","false")}selectedFile(t){this.files.emit(t.target.files)}ondragover(){document.getElementById("dropZone").setAttribute("drop-active","true")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-drop-files"]],inputs:{label:"label"},outputs:{files:"files"},decls:10,vars:1,consts:[[1,"row","justify-content-center","d-none-print"],["id","dropZone",3,"appDropZone","dragover"],["for","file-import"],["for","file-import",1,"custom-file-upload","text-primary","mx-5"],["hidden","","id","file-import","type","file","multiple","false",3,"change"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0),o.TgZ(1,"div",1),o.NdJ("appDropZone",function(t){return e.onDrop(t)})("dragover",function(){return e.ondragover()}),o.TgZ(2,"label",2),o._uU(3),o.TgZ(4,"span"),o._uU(5,"\u2794"),o.qZA(),o.TgZ(6,"a"),o._uU(7," Ch\u1ecdn file "),o.qZA(),o.qZA(),o._UZ(8,"label",3),o.TgZ(9,"input",4),o.NdJ("change",function(t){return e.selectedFile(t)}),o.qZA(),o.qZA(),o.qZA()),2&t&&(o.xp6(3),o.hij(" K\xe9o th\u1ea3 file ",e.label," v\xe0o \u0111\xe2y ho\u1eb7c "))},directives:[i.i],styles:["label[_ngcontent-%COMP%]{width:100%;height:100%;text-align:center;line-height:170px;color:#00f;font-weight:bolder}#dropZone[_ngcontent-%COMP%]{top:20%;left:10%;width:80%;height:200px;border-radius:3%;border:2px dashed rgb(38,16,165)}#dropZone[drop-active=true][_ngcontent-%COMP%]{box-shadow:inset 0 0 0 2px #00c;border:2px dashed rgb(38,16,165);background-color:#c9eccb}"],changeDetection:0}),t})()},15194:function(t,e,n){n.d(e,{i:function(){return i}});var o=n(74788);let i=(()=>{class t{constructor(){this.fileDrop=new o.vpe,this.preventBodyDrop=!0,this.active=!1}onDrop(t){t.preventDefault(),this.active=!1;const{dataTransfer:e}=t;if(e.items){const t=[];for(let n=0;n<e.items.length;n++)"file"===e.items[n].kind&&t.push(e.items[n].getAsFile());e.items.clear(),this.fileDrop.emit(t)}else{const t=e.files;e.clearData(),this.fileDrop.emit(Array.from(t))}}onDragOver(t){t.stopPropagation(),t.preventDefault(),this.active=!0}onDragLeave(t){this.active=!1}onBodyDragOver(t){this.preventBodyDrop&&(t.preventDefault(),t.stopPropagation())}onBodyDrop(t){this.preventBodyDrop&&t.preventDefault()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=o.lG2({type:t,selectors:[["","appDropZone",""]],hostVars:2,hostBindings:function(t,e){1&t&&o.NdJ("drop",function(t){return e.onDrop(t)})("dragover",function(t){return e.onDragOver(t)})("dragleave",function(t){return e.onDragLeave(t)})("dragover",function(t){return e.onBodyDragOver(t)},!1,o.pYS)("drop",function(t){return e.onBodyDrop(t)},!1,o.pYS),2&t&&o.ekj("drop-zone-active",e.active)},inputs:{preventBodyDrop:"preventBodyDrop"},outputs:{fileDrop:"appDropZone"}}),t})()},31409:function(t,e,n){n.d(e,{x:function(){return r}});var o=n(84487),i=n(74788),s=n(57922);let r=(()=>{class t{constructor(t){this.plus=t}toJsonArray(t,e=!0){return new Promise(n=>{let i={};if(this.plus.load(),null!=t&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"!=t.type&&"application/vnd.ms-excel"!=t.type)return this.plus.alertError("Kh\xf4ng ph\u1ea3i file excel");const s=new FileReader;s.readAsBinaryString(t),s.onloadend=t=>{const s=o.read(t.target.result,{type:"binary",cellDates:!0,dateNF:"DD/MM/YYYY"}),r=s.SheetNames;for(let n=0;n<r.length;n++){const t=r[n],a=o.utils.sheet_to_json(s.Sheets[t],{header:1,raw:e});i[`${t}`]=this.convertJSon(a)}this.plus.loaded(),n(i)}})}read(t,e=2){return new Promise(n=>{let i=[];if(this.plus.load(),null!=t&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"!=t.type&&"application/vnd.ms-excel"!=t.type)return this.plus.alertError("Kh\xf4ng ph\u1ea3i file excel");const s=new FileReader;s.readAsBinaryString(t),s.onloadend=t=>{const s=o.read(t.target.result,{type:"binary",cellDates:!0,dateNF:"DD/MM/YYYY"}),r=s.SheetNames;for(let n=0;n<e;n++){const t=o.utils.sheet_to_json(s.Sheets[r[n]],{header:1});i.push(t)}this.plus.loaded(),n(i)}})}convertJSon(t){const e=[];for(let n=1;n<t.length;n++){const o={};t[0].forEach((e,i)=>{o[`${e}`]=t[n][i]}),e.push(o)}return e}convertJSonByX(t){const e=[];for(let n=1;n<t.length;n++)if("x"==t[n][0]){const o={};t[0].forEach((e,i)=>{o[`${e}`]=t[n][i]}),e.push(o)}return e}readXlsxToMerge(t){return console.log(t),new Promise((e,n)=>{this.plus.load();let i={};if(null!=t&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"!=t.type&&"application/vnd.ms-excel"!=t.type)return this.plus.alertError("Kh\xf4ng ph\u1ea3i file excel");const s=new FileReader;s.readAsBinaryString(t),s.onloadend=t=>{const n=o.read(t.target.result,{type:"binary",cellDates:!0,dateNF:"DD/MM/YYYY"}),s=n.SheetNames;for(let e=0;e<s.length;e++){const t=s[e];if("_Merge"==t)return this.plus.alertError("Vui l\xf2ng \u0111\u1ed5i t\xean sheet _Merge th\xe0nh t\xean kh\xe1c");const r=o.utils.sheet_to_json(n.Sheets[t],{header:1,raw:!0});i[`${0==e?"_Merge":t}`]=this.convertJSonByX(r)}e(i),this.plus.loaded()}})}export(t,e=""){const n=o.utils.json_to_sheet(t,{skipHeader:!0,dateNF:"mm/dd/yyyy;@",cellDates:!0}),i=o.utils.book_new();o.utils.book_append_sheet(i,n,"ChuaImport"),o.writeFile(i,"4la-"+e+"-ChuaImport.xlsx")}exportTar(t,e=""){for(let r=0;r<t.length;r++)delete t[r].dateModify,delete t[r].canEdit,delete t[r].keyWord,delete t[r].__v,delete t[r]._id;let n=JSON.stringify(t),o="data:application/json;charset=utf-8,"+encodeURIComponent(n);console.log(o);let i=`4la-${e||""}`+Date.now()+".tar",s=document.createElement("a");s.setAttribute("href",o),s.setAttribute("download",i),s.click()}}return t.\u0275fac=function(e){return new(e||t)(i.LFG(s.T))},t.\u0275prov=i.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},97855:function(t,e,n){n.r(e),n.d(e,{XangDauModule:function(){return M}});var o=n(88817),i=n(12057),s=n(74788),r=n(57922),a=n(31409),l=n(24751),h=n(9157),c=n(51511);let u=(()=>{class t{constructor(t,e,n,o){this.plus=t,this.excel=e,this.fb=n,this.docx=o}ngOnInit(){}onDrop(t){}ondragover(){document.getElementById("dropZone").setAttribute("drop-active","true")}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(r.T),s.Y36(a.x),s.Y36(l.qu),s.Y36(h.E))},t.\u0275cmp=s.Xpm({type:t,selectors:[["app-van-chuyen"]],decls:1,vars:0,consts:[[3,"files","ondragover"]],template:function(t,e){1&t&&(s.TgZ(0,"app-drop-files",0),s.NdJ("files",function(t){return e.onDrop(t)})("ondragover",function(){return e.ondragover()}),s.qZA())},directives:[c.k],styles:[""]}),t})();var d=n(16738),p=n.n(d),g=n(7365),f=n(46833),m=n(46113),y=n(2895),D=n(49356),v=function(t,e,n,o){return new(n||(n=Promise))(function(i,s){function r(t){try{l(o.next(t))}catch(e){s(e)}}function a(t){try{l(o.throw(t))}catch(e){s(e)}}function l(t){t.done?i(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(r,a)}l((o=o.apply(t,e||[])).next())})};function T(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"button",7),s.NdJ("click",function(){return s.CHM(t),s.oxw().onGeneBill()}),s._uU(1,"Thanh to\xe1n"),s.qZA()}}function b(t,e){if(1&t){const t=s.EpF();s.TgZ(0,"button",7),s.NdJ("click",function(){return s.CHM(t),s.oxw().geneSupply()}),s._uU(1,"C\u1ea5p h\xe0ng"),s.qZA()}}let x=(()=>{class t{constructor(t,e,n){this.plus=t,this.excel=e,this.docx=n,this.items=null,this.wordFileTT=null,this.wordFileCH=null,this.DieuPhoi=[],this.taixe=1,this.Cty="",this.vat=10,this.dataInXls=null,this.startMonth=p()(new Date).startOf("month").subtract(1,"months").toDate(),this.startDay=null,this.endDay=null}ngOnInit(){this.getMonth(this.startMonth),this.getWordFile()}getWordFile(){this.docx.loadFileUrl("https://thuctd.github.io/templates/ThanhToan.docx").then(t=>v(this,void 0,void 0,function*(){this.wordFileTT=t})),this.docx.loadFileUrl("https://thuctd.github.io/templates/CapHang.docx").then(t=>v(this,void 0,void 0,function*(){this.wordFileCH=t}))}getMonth(t){this.startDay=p()(t).startOf("month").subtract(1,"minutes").toDate(),this.endDay=p()(t).endOf("month").subtract(1,"minutes").toDate(),this.init()}onDropNew(t){for(let e=0;e<t.length;e++)if(console.log(t[e].type),"application/vnd.openxmlformats-officedocument.wordprocessingml.document"==t[e].type){const n=new FileReader;n.readAsArrayBuffer(t[e]),n.onloadend=()=>this.wordFileTT=n.result,n.onloadend=()=>this.wordFileCH=n.result}else"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"==t[e].type?this.excel.toJsonArray(t[e]).then(t=>{this.dataInXls=t}):this.plus.alertError("File kh\xf4ng h\u1ee3p l\u1ec7")}onGeneBill(){const t=this.dataInXls.Merge;for(let e=0;e<t.length;e++){const n=t[e];this.items=n,this.items.TongSL=0,this.items.TongTT=0,this.items.NgayBC=p()(this.endDay).add(1,"days").toDate(),this.items.TuNgay=this.startDay,this.items.VAT=this.vat,this.Cty=this.plus.removeAccents(n.NhaVC),console.log(n.PhanLoai),"TX"==n.PhanLoai?this.getByDriver():"NCC"==n.PhanLoai&&this.getByCompany()}}getByDriver(){return v(this,void 0,void 0,function*(){const t=this.dataInXls,e=[];for(let n=0;n<t.Data.length;n++){const o=t.Data[n],i=o.NgayGiaoHang;p()(i).add(1,"days").toDate().getDate(),i>=this.startDay&&i<=this.endDay&&this.plus.removeAccents(o.NVGiaoHang)==this.Cty&&(e.push(o),this.items.TongSL+=o.SoLuong,this.items.TongTT+=o.ThanhTien)}this.items.Data=e,this.items.Thue=Math.round(this.items.TongTT*this.vat/100),this.items.TongVAT=Math.round(this.items.Thue+this.items.TongTT),yield this.geneBill()})}getByCompany(){const t=this.dataInXls,e=[];for(let n=0;n<t.Data.length;n++){const o=t.Data[n],i=o.NgayGiaoHang;p()(i).add(1,"days").toDate().getDate(),i>=this.startDay&&i<=this.endDay&&this.plus.removeAccents(o.NhaVC)==this.Cty&&(e.push(o),this.items.TongSL+=o.SoLuong,this.items.TongTT+=o.ThanhTien)}this.items.Data=e,this.items.Thue=Math.round(this.items.TongTT*this.vat/100),this.items.TongVAT=Math.round(this.items.Thue+this.items.TongTT),this.geneBill()}geneSupply(){this.onGeneSupply(),this.docx.loadFileUrl("https://thuctd.github.io/templates/CapHang.docx").then(t=>v(this,void 0,void 0,function*(){for(let e=1;e<this.DieuPhoi.length;e++)this.docx.generateOne(this.DieuPhoi[e],t,`Ngay ${this.DieuPhoi[e].NgayGiaoHang.slice(0,2)}`),yield this.plus.sleep(1e3).then(t=>{});this.reload()}))}geneBill(){this.docx.generateOne(this.items,this.wordFileTT,this.Cty+"-"+this.vat).then(t=>{console.log(t)})}onGeneSupply(){const t=this.dataInXls,e=[];for(let n=0;n<t.Data.length;n++){const o=t.Data[n],i=o.NgayGiaoHang,s=p()(i).add(1,"days").toDate().getDate();i>=this.startDay&&i<=this.endDay&&this.plus.removeAccents(o.NhaVC)==this.Cty&&e.push(o),this.checkByCustommer(o,i,s)}}checkByCustommer(t,e,n){const o=this.plus.removeAccents(t.TenKH);if(e>=this.startDay&&this.startDay<=this.endDay)switch(o){case"an binh":this.DieuPhoi[n].AnBinh.push(t);break;case"tan bien":this.DieuPhoi[n].TanBien.push(t);break;case"long phuoc":this.DieuPhoi[n].LongPhuoc.push(t);break;case"trang bom":this.DieuPhoi[n].TrangBom.push(t);break;case"trang dai":this.DieuPhoi[n].TrangDai.push(t);break;case"so 2":this.DieuPhoi[n].So2.push(t);break;case"phu binh":this.DieuPhoi[n].PhuBinh.push(t);break;case"nui le":this.DieuPhoi[n].NuiLe.push(t);break;case"hung nghia":this.DieuPhoi[n].HungNghia.push(t);break;case"dau giay":this.DieuPhoi[n].DauGiay.push(t)}}init(){for(let t=1;t<32;t++){const e=p()(this.startDay).add(t,"days").toDate();this.DieuPhoi[t]={NgayLap:p()(e).subtract(1,"days").format("DD/MM/YYYY"),NgayGiaoHang:p()(e).format("DD/MM/YYYY"),AnBinh:[],TanBien:[],LongPhuoc:[],TrangBom:[],TrangDai:[],So2:[],PhuBinh:[],NuiLe:[],HungNghia:[],DauGiay:[]}}}reload(){this.plus.reload("xang-dau/dieu-phoi")}ondragover(){document.getElementById("dropZone").setAttribute("drop-active","true")}}return t.\u0275fac=function(e){return new(e||t)(s.Y36(r.T),s.Y36(a.x),s.Y36(h.E))},t.\u0275cmp=s.Xpm({type:t,selectors:[["app-dieu-phoi"]],decls:11,vars:5,consts:[[1,"container","py-3"],[3,"startDay","month"],["matInput","","placeholder","Thu\u1ebf GTGT (%)",3,"ngModel","ngModelChange"],[3,"label","files","ondragover"],[1,"row","justify-content-center"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["mat-raised-button","","color","warn",3,"click"]],template:function(t,e){1&t&&(s.TgZ(0,"div",0),s.TgZ(1,"app-month-year",1),s.NdJ("month",function(t){return e.getMonth(t)}),s.qZA(),s.TgZ(2,"mat-form-field"),s.TgZ(3,"input",2),s.NdJ("ngModelChange",function(t){return e.vat=t}),s.qZA(),s.qZA(),s.TgZ(4,"app-drop-files",3),s.NdJ("files",function(t){return e.onDropNew(t)})("ondragover",function(){return e.ondragover()}),s.qZA(),s.TgZ(5,"div",4),s.TgZ(6,"button",5),s.NdJ("click",function(){return e.reload()}),s.TgZ(7,"mat-icon"),s._uU(8,"refresh"),s.qZA(),s.qZA(),s.YNc(9,T,2,0,"button",6),s.YNc(10,b,2,0,"button",6),s.qZA(),s.qZA()),2&t&&(s.xp6(1),s.Q6J("startDay",e.startMonth),s.xp6(2),s.Q6J("ngModel",e.vat),s.xp6(1),s.Q6J("label",""),s.xp6(5),s.Q6J("ngIf",e.dataInXls),s.xp6(1),s.Q6J("ngIf",e.dataInXls))},directives:[g.k,f.KE,m.Nt,l.Fj,l.JJ,l.On,c.k,y.lW,D.Hw,i.O5],styles:["#dropZone[_ngcontent-%COMP%]{position:absolute;top:20%;left:10%;width:80%;height:150px;border-radius:3%;border:solid}#dropZone[drop-active=true][_ngcontent-%COMP%]{box-shadow:inset 0 0 0 2px #00c;border:2px dashed rgb(38,16,165);background-color:#c9eccb}.x[_ngcontent-%COMP%]{border:solid;width:300px;height:200px}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{text-align:right}"]}),t})();var w=n(33982);const Z=[{path:"",component:(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Xpm({type:t,selectors:[["app-xang-dau"]],decls:2,vars:0,template:function(t,e){1&t&&(s.TgZ(0,"p"),s._uU(1,"xang-dau works!"),s.qZA())},styles:[""]}),t})()},{path:"dieu-phoi",component:x},{path:"van-chuyen",component:u}];let A=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s.oAB({type:t}),t.\u0275inj=s.cJS({imports:[[w.Bz.forChild(Z)],w.Bz]}),t})();var B=n(5923);let M=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s.oAB({type:t}),t.\u0275inj=s.cJS({imports:[[i.ez,A,o.ShareModule,B.X]]}),t})()}}]);