(self.webpackChunkdlxl=self.webpackChunkdlxl||[]).push([[318],{48387:(He,me,$)=>{"use strict";$.d(me,{D:()=>ge});var I=$(17721),_e=$(36895),J=$(24006),G=$(5923),de=$(94650);let ge=(()=>{class Pe{}return Pe.\u0275fac=function(ye){return new(ye||Pe)},Pe.\u0275mod=de.oAB({type:Pe}),Pe.\u0275inj=de.cJS({imports:[_e.ez,J.u5,I.q,G.X]}),Pe})()},70511:(He,me,$)=>{"use strict";$.d(me,{O:()=>W});var I=$(15861),_e=$(80529),J=$(50727),G=$(69751),de=$(54968),ge=$(78372),Pe=$(71884),Ne=$(49808),ye=$(54004),De=$(75625),Ie=$(70262),Ee=($(15439),$(12157)),Y=$(10875),C=$(92340),D=$(94650),v=$(94559),o=$(23887),c=$(25555),f=$(47977),K=$(54654);let W=(()=>{class ie{constructor(R,j,Q,Te,Se,Me){this.http=R,this.loadSV=j,this.cryptSV=Q,this.plus=Te,this.afs=Se,this.idbSV=Me,this.api=C.N.apiUrl,this.subs=new J.w0,this.user=this.getUser()}unsubcribe(){var R=this;return(0,I.Z)(function*(){R.subs.unsubscribe(),R.subs=new J.w0})()}logSheet(R,j){var Q=this;return(0,I.Z)(function*(){Q.http.post(Q.getApiUrl("logger"),{api:R,data:j},Q.getHeader()).subscribe()})()}getUser(){var R=this;return(0,I.Z)(function*(){return yield R._getOpt(Y.HB.USER)})()}getHeader(){return{headers:new _e.WM({"Content-Type":"application/json","Access-Control-Max-Age":"86400"})}}getApiUrl(R,j=!1){return`${C.N.apiUrl}${R}/`}getOutServer(R){return Ee.Z.get(R)}postOutServer(R,j){return Ee.Z.post(R,j)}updateLocalDB(R,j,Q){var Te=this;return new G.y(Se=>{(0,de.R)(window,"offline").subscribe(Me=>{this.plus.alertWarning("M\u1ea5t k\u1ebft n\u1ed1i\nB\u1ea1n \u0111ang xem d\u1eef li\u1ec7u offline!"),Se.next(!0)}),(0,de.R)(window,"online").subscribe(Me=>{this.plus.alertSuccess("\u0110\xe3 k\u1ebft n\u1ed1i!"),window.location.reload()}),window[Q]||(window[Q]=Date.now(),console.log("%cGET updateLocalDB -> "+Q,"font-style: italic; color:Blue"),window[j+"max"]=0,this.loadSV.load("updateLocalDB"+Q),this.subs.add(this.afs.collection("updateDB").doc(Q).valueChanges().pipe((0,ge.b)(300),(0,Pe.x)()).subscribe(function(){var Me=(0,I.Z)(function*(Ke){console.log("xxxxxxxxxxxxxxxxxxxxxxxxxxx",R,j,Q);let Ve=yield Te.idbSV.IDB_GetMax(R,j);if(!Ke&&0==Ve)return Te.afs.collection("updateDB").doc(Q).set({lastUpdate:0},{merge:!0}),Se.next(!0);if(window[j+"max"]=Ve,Ke.lastUpdate==window[j+"max"]||Ke.lastUpdate==window[j+"lastget"])return Se.next(!0);if(console.log("updateLocalDB",j,Q,Ke),Ke.lastUpdate>window[j+"max"])for(;Ke.lastUpdate>window[j+"max"];){let Oe=yield Te.idbSV.IDB_GetMax(R,j),It=j+"/token/"+Oe;window[j+"max"]=Oe;let At=yield(0,Ne.n)(Te.get(It));if(window[j+"lastget"]=Oe,0==At.data.length){console.log("next in data.length == 0 && break");break}console.log("%cGET updateLocalDB -> "+new Date(Oe),"font-style: italic; color:green"),console.log(new Date(Te.plus.Arr_MaxValue(At.data))),yield Te.idbSV.IDB_DB_Add(R,j,At.data),console.log("next in While")}Se.next(!0),Te.loadSV.loaded("updateLocalDB"+Q)});return function(Ke){return Me.apply(this,arguments)}}())),this.loadSV.loaded("updateLocalDB"+Q))})}get(R,j=!1){return console.log("%cGET -> "+R,"font-style: italic; color:green"),this.http.get(this.getApiUrl(R,j),this.getHeader()).pipe((0,ye.U)(Q=>(this.loadSV.loaded("get"+R),Q)),(0,De.X)(1),(0,Ie.K)(Q=>{throw this.logger(R,"Get","Get",Q),this.loadSV.loaded("get"+R),Q}))}post(R,j,Q,Te=!0,Se=!0){return console.log("%cPOST -> "+R,"font-style: italic; color:green",j),this.loadSV.load("httpPost"+Q),Array.isArray(j)&&this.plus.Arr_MaxValue(j),this.http.post(this.getApiUrl(R),j,this.getHeader()).pipe((0,ye.U)(Ke=>(window[R+"max"]=0,Se&&this.loadSV.loaded("httpPost"+Q),this._handleSuccess(Te),Ke)),(0,De.X)(1),(0,Ie.K)(Ke=>{throw console.log(Ke),this.logger(R,j,"post "+Q,Ke),this.plus.alertError(Ke.err),this.loadSV.loaded("httpPost"+Q),Ke}))}put(R,j,Q,Te=!0){return this.loadSV.load("httpPut",Q),console.log("%cPUT -> "+R,"font-style: italic; color:green",j),this.http.put(this.getApiUrl(R),j,this.getHeader()).pipe((0,ye.U)(Se=>(window[R+"max"]=0,this._handleSuccess(Te),this.logger(R,j,"put "+Q,!1),this.loadSV.loaded("httpPut",Q),Se)),(0,De.X)(1),(0,Ie.K)(Se=>{throw this.logger(R,j,"put "+Q,Se),this.loadSV.loaded("httpPut",Q),429==Se.status&&(alert("Thi\u1ebft b\u1ecb c\u1ee7a b\u1ea1n c\xf3 truy c\u1eadp b\u1ea5t th\u01b0\u1eddng!"),window.location.reload()),400==Se.status&&this.plus.alertError(Se.error.err),403==Se.status&&(alert(Se.err),window.location.reload()),Se}))}delete(R,j,Q,Te=!0){return console.log("%cDELETE -> "+R+"/"+j,"font-style: italic; color:red"),Date.now(),this.loadSV.load("delete",Q),this.http.delete(this.getApiUrl(R+"/"+j),this.getHeader()).pipe((0,ye.U)(Me=>(window[R+"max"]=0,this.loadSV.loaded("delete",Q),this._handleSuccess(Te),this.logger(R,j,"delete "+Q,!1),Me)),(0,De.X)(1),(0,Ie.K)(Me=>{throw this._handleError(Me),this.loadSV.loaded("delete",Q),this.logger(R,j,"delete "+Q,Me),"error in source. Details: "+Me}))}disable(R,j,Q,Te=!0){console.log("%Disable -> "+R+"/"+j,"font-style: italic; color:red");const Se=Date.now();return this.loadSV.load("disable",Q),new Promise((Me,Ke)=>{this.http.delete(this.getApiUrl(R)+j._id+"/token/"+Se,this.getHeader()).pipe((0,ye.U)(Ve=>(window[R+"max"]=0,this._handleSuccess(Te),this.loadSV.loaded("disable",Q),this.logger(R,j,"disable "+Q,!1),Ve)),(0,De.X)(1),(0,Ie.K)(Ve=>{throw this.logger(R,j,"disable "+Q,Ve),this.loadSV.loaded("disable",Q),this._handleError(Ve),"Error httpDisable. Details: "+Ve})).subscribe(Ve=>{void 0!==Ve&&(console.log("Delete",Ve),Me(Se))})})}_handleError(R){429==R.status&&(alert("Thi\u1ebft b\u1ecb c\u1ee7a b\u1ea1n c\xf3 truy c\u1eadp b\u1ea5t th\u01b0\u1eddng!"),window.location.reload()),400==R.status&&this.plus.alertError(R.error.err),(401==R.status||500==R.status)&&(alert("L\u1ed7i x\xe1c th\u1ef1c t\xe0i kho\u1ea3n!"),this.plus.alertError(R.error.err)),403==R.status&&(alert(R.err),window.location.reload())}_handleSuccess(R=!0){R&&this.plus.alertSuccess("Th\xe0nh c\xf4ng")}convertUpdatebyKey(R){for(let j=0;j<R.length;j++);}logger(R,j,Q,Te){return(0,I.Z)(function*(){})()}guid(){let R=(new Date).getTime();return typeof performance<"u"&&"function"==typeof performance.now&&(R+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,j=>{const Q=(R+16*Math.random())%16|0;return R=Math.floor(R/16),("x"===j?Q:3&Q|8).toString(16)})}geneKeyWord(...R){return R.join(" ").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLocaleLowerCase()}_getOpt(R=""){return new Promise(j=>{this.idbSV.IDB_InitDB("firebase-local").subscribe(Q=>{let Te=[],Se=null;this.idbSV.IDB_DB_GetAll(Q,"any").subscribe(Me=>{for(let Ke=0;Ke<Me.length;Ke++){let Oe=JSON.parse(Buffer.from(Me[Ke].key,"base64").toString());Me[Ke].module==R&&(Se=Oe),Te.push(Oe)}R.length>0&&Se?j(Se):0==R.length&&Te.length>0&&j(Te)})})})}}return ie.\u0275fac=function(R){return new(R||ie)(D.LFG(_e.eN),D.LFG(v.b),D.LFG(o.j),D.LFG(c.T),D.LFG(f.ST),D.LFG(K.Y))},ie.\u0275prov=D.Yz7({token:ie,factory:ie.\u0275fac,providedIn:"root"}),ie})()},3909:(He,me,$)=>{"use strict";$.d(me,{M:()=>za});var ge,I=$(15861),_e=$(69386),J=$.n(_e),G=$(51452),de=$.n(G),Pe=new Uint8Array(16);function Ne(){if(!ge&&!(ge=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ge(Pe)}const ye=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Ie=function De(e){return"string"==typeof e&&ye.test(e)};for(var we=[],We=0;We<256;++We)we.push((We+256).toString(16).substr(1));const D=function C(e,t,n){var r=(e=e||{}).random||(e.rng||Ne)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return function Ee(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(we[e[t+0]]+we[e[t+1]]+we[e[t+2]]+we[e[t+3]]+"-"+we[e[t+4]]+we[e[t+5]]+"-"+we[e[t+6]]+we[e[t+7]]+"-"+we[e[t+8]]+we[e[t+9]]+"-"+we[e[t+10]]+we[e[t+11]]+we[e[t+12]]+we[e[t+13]]+we[e[t+14]]+we[e[t+15]]).toLowerCase();if(!Ie(n))throw TypeError("Stringified UUID is invalid");return n}(r)};var R,j,v=$(42899),o=$(59069),c=$.n(o);function f(e){return"$"+e}function K(e){return e.substring(1)}function W(){this._store={}}function ie(e){if(this._store=new W,e&&Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.add(e[t])}W.prototype.get=function(e){var t=f(e);return this._store[t]},W.prototype.set=function(e,t){var n=f(e);return this._store[n]=t,!0},W.prototype.has=function(e){return f(e)in this._store},W.prototype.keys=function(){return Object.keys(this._store).map(e=>K(e))},W.prototype.delete=function(e){var t=f(e),n=t in this._store;return delete this._store[t],n},W.prototype.forEach=function(e){for(var t=Object.keys(this._store),n=0,r=t.length;n<r;n++){var i=t[n];e(this._store[i],i=K(i))}},Object.defineProperty(W.prototype,"size",{get:function(){return Object.keys(this._store).length}}),ie.prototype.add=function(e){return this._store.set(e,!0)},ie.prototype.has=function(e){return this._store.has(e)},ie.prototype.forEach=function(e){this._store.forEach(function(t,n){e(n)})},Object.defineProperty(ie.prototype,"size",{get:function(){return this._store.size}}),function ue(){if(typeof Symbol>"u"||typeof Map>"u"||typeof Set>"u")return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}()?(R=Set,j=Map):(R=ie,j=W);var Vt,Me=Function.prototype.toString,Ke=Me.call(Object);function Oe(e){var t,n,r;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],n=0,r=e.length;n<r;n++)t[n]=Oe(e[n]);return t}if(e instanceof Date&&isFinite(e))return e.toISOString();if(function Q(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer||typeof Blob<"u"&&e instanceof Blob}(e))return function Se(e){if(e instanceof ArrayBuffer)return function Te(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),n=new Uint8Array(t),r=new Uint8Array(e);return n.set(r),t}(e);var t=e.size,n=e.type;return"function"==typeof e.slice?e.slice(0,t,n):e.webkitSlice(0,t,n)}(e);if(!function Ve(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=t.constructor;return"function"==typeof n&&n instanceof n&&Me.call(n)==Ke}(e))return e;for(n in t={},e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=Oe(e[n]);typeof i<"u"&&(t[n]=i)}return t}function It(e){var t=!1;return function(...n){if(t)throw new Error("once called more than once");t=!0,e.apply(this,n)}}function At(e){return function(...t){t=Oe(t);var n=this,r="function"==typeof t[t.length-1]&&t.pop(),i=new Promise(function(s,a){var u;try{var l=It(function(w,x){w?a(w):s(x)});t.push(l),(u=e.apply(n,t))&&"function"==typeof u.then&&s(u)}catch(w){a(w)}});return r&&i.then(function(s){r(null,s)},r),i}}function Fe(e,t){return At(function(...n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this;return function ni(e,t,n){if(e.constructor.listeners("debug").length){for(var r=["api",e.name,t],i=0;i<n.length-1;i++)r.push(n[i]);e.constructor.emit("debug",r);var s=n[n.length-1];n[n.length-1]=function(a,u){var l=["api",e.name,t];l=l.concat(a?["error",a]:["success",u]),e.constructor.emit("debug",l),s(a,u)}}}(r,e,n),this.taskqueue.isReady?t.apply(this,n):new Promise(function(i,s){r.taskqueue.addTask(function(a){a?s(a):i(r[e].apply(r,n))})})})}function Tt(e,t){for(var n={},r=0,i=t.length;r<i;r++){var s=t[r];s in e&&(n[s]=e[s])}return n}function Fn(e){return e}function ii(e){return[{ok:e}]}function Gn(e,t,n){var r=t.docs,i=new j;r.forEach(function(y){i.has(y.id)?i.get(y.id).push(y):i.set(y.id,[y])});var s=i.size,a=0,u=new Array(s);var O=[];i.forEach(function(y,d){O.push(d)});var B=0;!function g(){if(!(B>=O.length)){var y=Math.min(B+6,O.length),d=O.slice(B,y);(function m(y,d){y.forEach(function(_,b){var S=d+b,P=i.get(_),A=Tt(P[0],["atts_since","attachments"]);A.open_revs=P.map(function(q){return q.rev}),A.open_revs=A.open_revs.filter(Fn);var T=Fn;0===A.open_revs.length&&(delete A.open_revs,T=ii),["revs","attachments","binary","ajax","latest"].forEach(function(q){q in t&&(A[q]=t[q])}),e.get(_,A,function(q,M){var k;k=q?[{error:q}]:T(M),function x(y,d,_){u[y]={id:d,docs:_},function w(){++a===s&&function l(){var y=[];u.forEach(function(d){d.docs.forEach(function(_){y.push({id:d.id,docs:[_]})})}),n(null,{results:y})}()}()}(S,_,k),g()})})})(d,B),B+=d.length}}()}try{localStorage.setItem("_pouch_check_localstorage",1),Vt=!!localStorage.getItem("_pouch_check_localstorage")}catch{Vt=!1}function jt(){return Vt}class si extends(c()){constructor(){super(),this._listeners={},jt()&&addEventListener("storage",t=>{this.emit(t.key)})}addListener(t,n,r,i){if(!this._listeners[n]){var s=!1,a=this;this._listeners[n]=u,this.on(t,u)}function u(){if(a._listeners[n])if(s)s="waiting";else{s=!0;var l=Tt(i,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);r.changes(l).on("change",function(x){x.seq>i.since&&!i.cancelled&&(i.since=x.seq,i.onChange(x))}).on("complete",function(){"waiting"===s&&J()(u),s=!1}).on("error",function w(){s=!1})}}}removeListener(t,n){n in this._listeners&&(super.removeListener(t,this._listeners[n]),delete this._listeners[n])}notifyLocalWindows(t){jt()&&(localStorage[t]="a"===localStorage[t]?"b":"a")}notify(t){this.emit(t),this.notifyLocalWindows(t)}}function tt(e){if(typeof console<"u"&&"function"==typeof console[e]){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function oi(e){var t=0;return e||(t=2e3),function ai(e,t){var n=6e5;return e=parseInt(e,10)||0,(t=parseInt(t,10))!=t||t<=e?t=(e||1)<<1:t+=1,t>n&&(e=n>>1,t=n),~~((t-e)*Math.random()+e)}(e,t)}function Yt(e,t){tt("info","The above "+e+" is totally normal. "+t)}var ht="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t};class ke extends Error{constructor(t,n,r){super(),this.status=t,this.name=n,this.message=r,this.error=!0}toString(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})}}new ke(401,"unauthorized","Name or password is incorrect.");var ui=new ke(400,"bad_request","Missing JSON list of 'docs'"),nt=new ke(404,"not_found","missing"),Et=new ke(409,"conflict","Document update conflict"),Wn=new ke(400,"bad_request","_id field must contain a string"),ci=new ke(412,"missing_id","_id is required for puts"),fi=new ke(400,"bad_request","Only reserved document ids may start with underscore."),en=(new ke(412,"precondition_failed","Database not open"),new ke(500,"unknown_error","Database encountered an unknown error")),Zn=new ke(500,"badarg","Some query argument is invalid"),li=(new ke(400,"invalid_request","Request was invalid"),new ke(400,"query_parse_error","Some query parameter is invalid")),Jn=new ke(500,"doc_validation","Bad special document member"),$t=new ke(400,"bad_request","Something wrong with the request"),tn=new ke(400,"bad_request","Document must be a JSON object"),nn=(new ke(404,"not_found","Database not found"),new ke(500,"indexed_db_went_bad","unknown")),zn=(new ke(500,"web_sql_went_bad","unknown"),new ke(500,"levelDB_went_went_bad","unknown"),new ke(403,"forbidden","Forbidden by design doc validate_doc_update function"),new ke(400,"bad_request","Invalid rev format")),di=(new ke(412,"file_exists","The database could not be created, the file already exists."),new ke(412,"missing_stub","A pre-existing attachment stub wasn't found"));function ce(e,t){function n(r){for(var i=Object.getOwnPropertyNames(e),s=0,a=i.length;s<a;s++)"function"!=typeof e[i[s]]&&(this[i[s]]=e[i[s]]);void 0===this.stack&&(this.stack=(new Error).stack),void 0!==r&&(this.reason=r)}return n.prototype=ke.prototype,new n(t)}function Dt(e){if("object"!=typeof e){var t=e;(e=en).data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),"stack"in e||(e.stack=(new Error).stack),e}function rn(e){var t={},n=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(i){i.doc||(i.doc={});var s=n&&function hi(e,t,n){try{return!e(t,n)}catch(i){var r="Filter function threw: "+i.toString();return ce($t,r)}}(e.filter,i.doc,t);if("object"==typeof s)return s;if(s)return!1;if(e.include_docs){if(!e.attachments)for(var a in i.doc._attachments)Object.prototype.hasOwnProperty.call(i.doc._attachments,a)&&(i.doc._attachments[a].stub=!0)}else delete i.doc;return!0}}function Mt(e){for(var t=[],n=0,r=e.length;n<r;n++)t=t.concat(e[n]);return t}function Qn(e){var t;if(e?"string"!=typeof e?t=ce(Wn):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=ce(fi)):t=ce(ci),t)throw t}function at(e){return"boolean"==typeof e._remote?e._remote:"function"==typeof e.type&&(tt("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===e.type())}function sn(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}function Hn(e){var t=sn(e);return t?t.join("/"):null}new ke(413,"invalid_url","Provided URL is invalid");var Vn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Yn="queryKey",_i=/(?:^|&)([^&=]*)=?([^&]*)/g,gi=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function Xn(e){for(var t=gi.exec(e),n={},r=14;r--;){var i=Vn[r],s=t[r]||"",a=-1!==["user","password"].indexOf(i);n[i]=a?decodeURIComponent(s):s}return n[Yn]={},n[Vn[12]].replace(_i,function(u,l,w){l&&(n[Yn][l]=w)}),n}function an(e,t){var n=[],r=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n.push(i),r.push(t[i]));return n.push(e),Function.apply(null,n).apply(null,r)}function Ut(e,t,n){return e.get(t).catch(function(r){if(404!==r.status)throw r;return{}}).then(function(r){var i=r._rev,s=n(r);return s?(s._id=t,s._rev=i,function pi(e,t,n){return e.put(t).then(function(r){return{updated:!0,rev:r.rev}},function(r){if(409!==r.status)throw r;return Ut(e,t._id,n)})}(e,s,n)):{updated:!1,rev:i}})}var on=function(e){return atob(e)},Bt=function(e){return btoa(e)};function un(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(s){if("TypeError"!==s.name)throw s;for(var r=new(typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder),i=0;i<e.length;i+=1)r.append(e[i]);return r.getBlob(t.type)}}function yi(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function cn(e,t){return un([yi(e)],{type:t})}function fn(e,t){return cn(on(e),t)}function er(e,t){var n=new FileReader,r="function"==typeof n.readAsBinaryString;n.onloadend=function(i){var s=i.target.result||"";if(r)return t(s);t(function mi(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return t}(s))},r?n.readAsBinaryString(e):n.readAsArrayBuffer(e)}function tr(e,t){er(e,function(n){t(n)})}function ln(e,t){tr(e,function(n){t(Bt(n))})}var bi=self.setImmediate||self.setTimeout;function Ei(e,t,n,r,i){(n>0||r<t.size)&&(t=function Ai(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.slice(t,n)}(t,n,r)),function wi(e,t){var n=new FileReader;n.onloadend=function(r){var i=r.target.result||new ArrayBuffer(0);t(i)},n.readAsArrayBuffer(e)}(t,function(s){e.append(s),i()})}function Di(e,t,n,r,i){(n>0||r<t.length)&&(t=t.substring(n,r)),e.appendBinary(t),i()}function dn(e,t){var n="string"==typeof e,r=n?e.length:e.size,i=Math.min(32768,r),s=Math.ceil(r/i),a=0,u=n?new(de()):new(de().ArrayBuffer),l=n?Di:Ei;function w(){bi(O)}function x(){var g=function Si(e){return Bt(e)}(u.end(!0));t(g),u.destroy()}function O(){var B=a*i;a++,l(u,e,B,B+i,a<s?w:x)}O()}function nr(e){return de().hash(e)}function rr(e,t){if(!t)return D().replace(/-/g,"").toLowerCase();var n=ht({},e);return delete n._rev_tree,nr(JSON.stringify(n))}var Kt=D;function vt(e){for(var t,n,r,s,i=e.rev_tree.slice();s=i.pop();){var a=s.ids,u=a[2],l=s.pos;if(u.length)for(var w=0,x=u.length;w<x;w++)i.push({pos:l+1,ids:u[w]});else{var O=!!a[1].deleted,B=a[0];(!t||(r!==O?r:n!==l?n<l:t<B))&&(t=B,n=l,r=O)}}return n+"-"+t}function _t(e,t){for(var r,n=e.slice();r=n.pop();)for(var i=r.pos,s=r.ids,a=s[2],u=t(0===a.length,i,s[0],r.ctx,s[1]),l=0,w=a.length;l<w;l++)n.push({pos:i+1,ids:a[l],ctx:u})}function Oi(e,t){return e.pos-t.pos}function hn(e){var t=[];_t(e,function(i,s,a,u,l){i&&t.push({rev:s+"-"+a,pos:s,opts:l})}),t.sort(Oi).reverse();for(var n=0,r=t.length;n<r;n++)delete t[n].pos;return t}function vn(e){for(var t=vt(e),n=hn(e.rev_tree),r=[],i=0,s=n.length;i<s;i++){var a=n[i];a.rev!==t&&!a.opts.deleted&&r.push(a.rev)}return r}function ir(e){for(var r,t=[],n=e.slice();r=n.pop();){var i=r.pos,s=r.ids,a=s[0],u=s[1],l=s[2],w=0===l.length,x=r.history?r.history.slice():[];x.push({id:a,opts:u}),w&&t.push({pos:i+1-x.length,ids:x});for(var O=0,B=l.length;O<B;O++)n.push({pos:i+1,ids:l[O],history:x})}return t.reverse()}function Ti(e,t){return e.pos-t.pos}function Li(e,t,n){var r=function Bi(e,t,n){for(var s,r=0,i=e.length;r<i;)n(e[s=r+i>>>1],t)<0?r=s+1:i=s;return r}(e,t,n);e.splice(r,0,t)}function sr(e,t){for(var n,r,i=t,s=e.length;i<s;i++){var a=e[i],u=[a.id,a.opts,[]];r?(r[2].push(u),r=u):n=r=u}return n}function Ri(e,t){return e[0]<t[0]?-1:1}function ar(e,t){for(var n=[{tree1:e,tree2:t}],r=!1;n.length>0;){var i=n.pop(),s=i.tree1,a=i.tree2;(s[1].status||a[1].status)&&(s[1].status="available"===s[1].status||"available"===a[1].status?"available":"missing");for(var u=0;u<a[2].length;u++)if(s[2][0]){for(var l=!1,w=0;w<s[2].length;w++)s[2][w][0]===a[2][u][0]&&(n.push({tree1:s[2][w],tree2:a[2][u]}),l=!0);l||(r="new_branch",Li(s[2],a[2][u],Ri))}else r="new_leaf",s[2][0]=a[2][u]}return{conflicts:r,tree:e}}function or(e,t,n){var a,r=[],i=!1,s=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var u=0,l=e.length;u<l;u++){var w=e[u];if(w.pos===t.pos&&w.ids[0]===t.ids[0])a=ar(w.ids,t.ids),r.push({pos:w.pos,ids:a.tree}),i=i||a.conflicts,s=!0;else if(!0!==n){var x=w.pos<t.pos?w:t,O=w.pos<t.pos?t:w,g=[],m=[];for(m.push({ids:x.ids,diff:O.pos-x.pos,parent:null,parentIdx:null});m.length>0;){var y=m.pop();if(0!==y.diff)for(var d=y.ids[2],_=0,b=d.length;_<b;_++)m.push({ids:d[_],diff:y.diff-1,parent:y.ids,parentIdx:_});else y.ids[0]===O.ids[0]&&g.push(y)}var S=g[0];S?(a=ar(S.ids,O.ids),S.parent[2][S.parentIdx]=a.tree,r.push({pos:x.pos,ids:x.ids}),i=i||a.conflicts,s=!0):r.push(w)}else r.push(w)}return s||r.push(t),r.sort(Ti),{tree:r,conflicts:i||"internal_node"}}function ur(e,t,n){var r=or(e,t),i=function qi(e,t){for(var r,i,n=ir(e),s=0,a=n.length;s<a;s++){var w,u=n[s],l=u.ids;if(l.length>t){r||(r={});var x=l.length-t;w={pos:u.pos+x,ids:sr(l,x)};for(var O=0;O<x;O++)r[u.pos+O+"-"+l[O].id]=!0}else w={pos:u.pos,ids:sr(l,0)};i=i?or(i,w,!0).tree:[w]}return r&&_t(i,function(g,m,y){delete r[m+"-"+y]}),{tree:i,revs:r?Object.keys(r):[]}}(r.tree,n);return{tree:i.tree,stemmedRevs:i.revs,conflicts:r.conflicts}}function Ii(e){return e.ids}function ft(e,t){t||(t=vt(e));for(var i,n=t.substring(t.indexOf("-")+1),r=e.rev_tree.map(Ii);i=r.pop();){if(i[0]===n)return!!i[1].deleted;r=r.concat(i[2])}}function gt(e){return/^_local/.test(e)}function Mi(e,t,n){var r=[{rev:e._rev}];"all_docs"===n.style&&(r=hn(t.rev_tree).map(function(s){return{rev:s.rev}}));var i={id:t.id,changes:r,doc:e};return ft(t,e._rev)&&(i.deleted=!0),n.conflicts&&(i.doc._conflicts=vn(t),i.doc._conflicts.length||delete i.doc._conflicts),i}class Ui extends(c()){constructor(t,n,r){super(),this.db=t;var i=(n=n?Oe(n):{}).complete=It((u,l)=>{u?function vi(e,t){return"listenerCount"in e?e.listenerCount(t):c().listenerCount(e,t)}(this,"error")>0&&this.emit("error",u):this.emit("complete",l),this.removeAllListeners(),t.removeListener("destroyed",s)});r&&(this.on("complete",function(u){r(null,u)}),this.on("error",r));const s=()=>{this.cancel()};t.once("destroyed",s),n.onChange=(u,l,w)=>{this.isCancelled||function $i(e,t,n,r){try{e.emit("change",t,n,r)}catch(i){tt("error",'Error in .on("change", function):',i)}}(this,u,l,w)};var a=new Promise(function(u,l){n.complete=function(w,x){w?l(w):u(x)}});this.once("cancel",function(){t.removeListener("destroyed",s),n.complete(null,{status:"cancelled"})}),this.then=a.then.bind(a),this.catch=a.catch.bind(a),this.then(function(u){i(null,u)},i),t.taskqueue.isReady?this.validateChanges(n):t.taskqueue.addTask(u=>{u?n.complete(u):this.isCancelled?this.emit("cancel"):this.validateChanges(n)})}cancel(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")}validateChanges(t){var n=t.complete;fe._changesFilterPlugin?fe._changesFilterPlugin.validate(t,r=>{if(r)return n(r);this.doChanges(t)}):this.doChanges(t)}doChanges(t){var n=t.complete;if("live"in(t=Oe(t))&&!("continuous"in t)&&(t.continuous=t.live),t.processChange=Mi,"latest"===t.since&&(t.since="now"),t.since||(t.since=0),"now"!==t.since){if(fe._changesFilterPlugin){if(fe._changesFilterPlugin.normalize(t),fe._changesFilterPlugin.shouldFilter(this,t))return fe._changesFilterPlugin.filter(this,t)}else["doc_ids","filter","selector","view"].forEach(function(i){i in t&&tt("warn",'The "'+i+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in t||(t.descending=!1),t.limit=0===t.limit?1:t.limit,t.complete=n;var r=this.db._changes(t);if(r&&"function"==typeof r.cancel){const i=this.cancel;this.cancel=(...s)=>{r.cancel(),i.apply(this,s)}}}else this.db.info().then(i=>{this.isCancelled?n(null,{status:"cancelled"}):(t.since=i.update_seq,this.doChanges(t))},n)}}function cr(e,t){return e<t?-1:e>t?1:0}function _n(e,t){return function(n,r){n||r[0]&&r[0].error?((n=n||r[0]).docId=t,e(n)):e(null,r.length?r[0]:r)}}function Ni(e,t){var n=cr(e._id,t._id);return 0!==n?n:cr(e._revisions?e._revisions.start:0,t._revisions?t._revisions.start:0)}function fr(e){var t=e._compactionQueue[0],n=t.opts,r=t.callback;e.get("_local/compaction").catch(function(){return!1}).then(function(i){i&&i.last_seq&&(n.last_seq=i.last_seq),e._compact(n,function(s,a){s?r(s):r(null,a),J()(function(){e._compactionQueue.shift(),e._compactionQueue.length&&fr(e)})})})}class lr extends(c()){_setup(){this.post=Fe("post",function(t,n,r){if("function"==typeof n&&(r=n,n={}),"object"!=typeof t||Array.isArray(t))return r(ce(tn));this.bulkDocs({docs:[t]},n,_n(r,t._id))}).bind(this),this.put=Fe("put",function(t,n,r){if("function"==typeof n&&(r=n,n={}),"object"!=typeof t||Array.isArray(t))return r(ce(tn));if(Qn(t._id),gt(t._id)&&"function"==typeof this._putLocal)return t._deleted?this._removeLocal(t,r):this._putLocal(t,r);const i=a=>{"function"==typeof this._put&&!1!==n.new_edits?this._put(t,n,a):this.bulkDocs({docs:[t]},n,_n(a,t._id))};n.force&&t._rev?(function s(){var a=t._rev.split("-"),u=a[1],w=parseInt(a[0],10)+1,x=rr();t._revisions={start:w,ids:[x,u]},t._rev=w+"-"+x,n.new_edits=!1}(),i(function(a){r(a,a?null:{ok:!0,id:t._id,rev:t._rev})})):i(r)}).bind(this),this.putAttachment=Fe("putAttachment",function(t,n,r,i,s){var a=this;function u(l){var w="_rev"in l?parseInt(l._rev,10):0;return l._attachments=l._attachments||{},l._attachments[n]={content_type:s,data:i,revpos:++w},a.put(l)}return"function"==typeof s&&(s=i,i=r,r=null),typeof s>"u"&&(s=i,i=r,r=null),s||tt("warn","Attachment",n,"on document",t,"is missing content_type"),a.get(t).then(function(l){if(l._rev!==r)throw ce(Et);return u(l)},function(l){if(l.reason===nt.message)return u({_id:t});throw l})}).bind(this),this.removeAttachment=Fe("removeAttachment",function(t,n,r,i){this.get(t,(s,a)=>{if(s)i(s);else{if(a._rev===r)return a._attachments?(delete a._attachments[n],0===Object.keys(a._attachments).length&&delete a._attachments,void this.put(a,i)):i();i(ce(Et))}})}).bind(this),this.remove=Fe("remove",function(t,n,r,i){var s;"string"==typeof n?(s={_id:t,_rev:n},"function"==typeof r&&(i=r,r={})):(s=t,"function"==typeof n?(i=n,r={}):(i=r,r=n)),(r=r||{}).was_delete=!0;var a={_id:s._id,_rev:s._rev||r.rev,_deleted:!0};if(gt(a._id)&&"function"==typeof this._removeLocal)return this._removeLocal(s,i);this.bulkDocs({docs:[a]},r,_n(i,a._id))}).bind(this),this.revsDiff=Fe("revsDiff",function(t,n,r){"function"==typeof n&&(r=n,n={});var i=Object.keys(t);if(!i.length)return r(null,{});var s=0,a=new j;function u(w,x){a.has(w)||a.set(w,{missing:[]}),a.get(w).missing.push(x)}i.map(function(w){this._getRevisionTree(w,function(x,O){if(x&&404===x.status&&"missing"===x.message)a.set(w,{missing:t[w]});else{if(x)return r(x);!function l(w,x){var O=t[w].slice(0);_t(x,function(B,g,m,y,d){var _=g+"-"+m,b=O.indexOf(_);-1!==b&&(O.splice(b,1),"available"!==d.status&&u(w,_))}),O.forEach(function(B){u(w,B)})}(w,O)}if(++s===i.length){var B={};return a.forEach(function(g,m){B[m]=g}),r(null,B)}})},this)}).bind(this),this.bulkGet=Fe("bulkGet",function(t,n){Gn(this,t,n)}).bind(this),this.compactDocument=Fe("compactDocument",function(t,n,r){this._getRevisionTree(t,(i,s)=>{if(i)return r(i);var a=function Fi(e){var t={},n=[];return _t(e,function(r,i,s,a){var u=i+"-"+s;return r&&(t[u]=0),void 0!==a&&n.push({from:a,to:u}),u}),n.reverse(),n.forEach(function(r){t[r.from]=void 0===t[r.from]?1+t[r.to]:Math.min(t[r.from],1+t[r.to])}),t}(s),u=[],l=[];Object.keys(a).forEach(function(w){a[w]>n&&u.push(w)}),_t(s,function(w,x,O,B,g){var m=x+"-"+O;"available"===g.status&&-1!==u.indexOf(m)&&l.push(m)}),this._doCompaction(t,l,r)})}).bind(this),this.compact=Fe("compact",function(t,n){"function"==typeof t&&(n=t,t={}),t=t||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:t,callback:n}),1===this._compactionQueue.length&&fr(this)}).bind(this),this.get=Fe("get",function(t,n,r){if("function"==typeof n&&(r=n,n={}),"string"!=typeof t)return r(ce(Wn));if(gt(t)&&"function"==typeof this._getLocal)return this._getLocal(t,r);var i=[];const s=()=>{var l=[],w=i.length;if(!w)return r(null,l);i.forEach(x=>{this.get(t,{rev:x,revs:n.revs,latest:n.latest,attachments:n.attachments,binary:n.binary},function(O,B){if(O)l.push({missing:x});else{for(var g,m=0,y=l.length;m<y;m++)if(l[m].ok&&l[m].ok._rev===B._rev){g=!0;break}g||l.push({ok:B})}--w||r(null,l)})})};if(!n.open_revs)return this._get(t,n,(l,w)=>{if(l)return l.docId=t,r(l);var x=w.doc,O=w.metadata,B=w.ctx;if(n.conflicts){var g=vn(O);g.length&&(x._conflicts=g)}if(ft(O,x._rev)&&(x._deleted=!0),n.revs||n.revs_info){for(var m=x._rev.split("-"),y=parseInt(m[0],10),d=m[1],_=ir(O.rev_tree),b=null,S=0;S<_.length;S++){var P=_[S],A=P.ids.map(function(se){return se.id}).indexOf(d);(A===y-1||!b&&-1!==A)&&(b=P)}if(!b)return(l=new Error("invalid rev tree")).docId=t,r(l);var q=b.ids.map(function(se){return se.id}).indexOf(x._rev.split("-")[1])+1;if(b.ids.splice(q,b.ids.length-q),b.ids.reverse(),n.revs&&(x._revisions={start:b.pos+b.ids.length-1,ids:b.ids.map(function(se){return se.id})}),n.revs_info){var k=b.pos+b.ids.length;x._revs_info=b.ids.map(function(se){return{rev:--k+"-"+se.id,status:se.opts.status}})}}if(n.attachments&&x._attachments){var N=x._attachments,U=Object.keys(N).length;if(0===U)return r(null,x);Object.keys(N).forEach(se=>{this._getAttachment(x._id,se,N[se],{rev:x._rev,binary:n.binary,ctx:B},function(H,z){var X=x._attachments[se];X.data=z,delete X.stub,delete X.length,--U||r(null,x)})})}else{if(x._attachments)for(var oe in x._attachments)Object.prototype.hasOwnProperty.call(x._attachments,oe)&&(x._attachments[oe].stub=!0);r(null,x)}});if("all"===n.open_revs)this._getRevisionTree(t,function(l,w){if(l)return r(l);i=hn(w).map(function(x){return x.rev}),s()});else{if(!Array.isArray(n.open_revs))return r(ce(en,"function_clause"));i=n.open_revs;for(var a=0;a<i.length;a++){var u=i[a];if("string"!=typeof u||!/^\d+-/.test(u))return r(ce(zn))}s()}}).bind(this),this.getAttachment=Fe("getAttachment",function(t,n,r,i){r instanceof Function&&(i=r,r={}),this._get(t,r,(s,a)=>s?i(s):a.doc._attachments&&a.doc._attachments[n]?(r.ctx=a.ctx,r.binary=!0,void this._getAttachment(t,n,a.doc._attachments[n],r,i)):i(ce(nt)))}).bind(this),this.allDocs=Fe("allDocs",function(t,n){if("function"==typeof t&&(n=t,t={}),t.skip=typeof t.skip<"u"?t.skip:0,t.start_key&&(t.startkey=t.start_key),t.end_key&&(t.endkey=t.end_key),"keys"in t){if(!Array.isArray(t.keys))return n(new TypeError("options.keys must be an array"));var r=["startkey","endkey","key"].filter(function(i){return i in t})[0];if(r)return void n(ce(li,"Query parameter `"+r+"` is not compatible with multi-get"));if(!at(this)&&(function Gi(e){var t="limit"in e?e.keys.slice(e.skip,e.limit+e.skip):e.skip>0?e.keys.slice(e.skip):e.keys;e.keys=t,e.skip=0,delete e.limit,e.descending&&(t.reverse(),e.descending=!1)}(t),0===t.keys.length))return this._allDocs({limit:0},n)}return this._allDocs(t,n)}).bind(this),this.close=Fe("close",function(t){return this._closed=!0,this.emit("closed"),this._close(t)}).bind(this),this.info=Fe("info",function(t){this._info((n,r)=>{if(n)return t(n);r.db_name=r.db_name||this.name,r.auto_compaction=!(!this.auto_compaction||at(this)),r.adapter=this.adapter,t(null,r)})}).bind(this),this.id=Fe("id",function(t){return this._id(t)}).bind(this),this.bulkDocs=Fe("bulkDocs",function(t,n,r){if("function"==typeof n&&(r=n,n={}),n=n||{},Array.isArray(t)&&(t={docs:t}),!t||!t.docs||!Array.isArray(t.docs))return r(ce(ui));for(var i=0;i<t.docs.length;++i)if("object"!=typeof t.docs[i]||Array.isArray(t.docs[i]))return r(ce(tn));var s;if(t.docs.forEach(function(l){l._attachments&&Object.keys(l._attachments).forEach(function(w){s=s||function Zi(e){return"_"===e.charAt(0)&&e+" is not a valid attachment name, attachment names cannot start with '_'"}(w),l._attachments[w].content_type||tt("warn","Attachment",w,"on document",l._id,"is missing content_type")})}),s)return r(ce($t,s));"new_edits"in n||(n.new_edits=!("new_edits"in t)||t.new_edits);var a=this;!n.new_edits&&!at(a)&&t.docs.sort(Ni),function Ki(e){for(var t=0;t<e.length;t++){var n=e[t];if(n._deleted)delete n._attachments;else if(n._attachments)for(var r=Object.keys(n._attachments),i=0;i<r.length;i++){var s=r[i];n._attachments[s]=Tt(n._attachments[s],["data","digest","content_type","length","revpos","stub"])}}}(t.docs);var u=t.docs.map(function(l){return l._id});this._bulkDocs(t,n,function(l,w){if(l)return r(l);if(n.new_edits||(w=w.filter(function(B){return B.error})),!at(a))for(var x=0,O=w.length;x<O;x++)w[x].id=w[x].id||u[x];r(null,w)})}).bind(this),this.registerDependentDatabase=Fe("registerDependentDatabase",function(t,n){var r=Oe(this.__opts);this.__opts.view_adapter&&(r.adapter=this.__opts.view_adapter);var i=new this.constructor(t,r);Ut(this,"_local/_pouch_dependentDbs",function s(a){return a.dependentDbs=a.dependentDbs||{},!a.dependentDbs[t]&&(a.dependentDbs[t]=!0,a)}).then(function(){n(null,{db:i})}).catch(n)}).bind(this),this.destroy=Fe("destroy",function(t,n){"function"==typeof t&&(n=t,t={});var r=!("use_prefix"in this)||this.use_prefix;const i=()=>{this._destroy(t,(s,a)=>{if(s)return n(s);this._destroyed=!0,this.emit("destroyed"),n(null,a||{ok:!0})})};if(at(this))return i();this.get("_local/_pouch_dependentDbs",(s,a)=>{if(s)return 404!==s.status?n(s):i();var l=this.constructor,w=Object.keys(a.dependentDbs).map(x=>{var O=r?x.replace(new RegExp("^"+l.prefix),""):x;return new l(O,this.__opts).destroy()});Promise.all(w).then(i,n)})}).bind(this)}_compact(t,n){var s,r={return_docs:!1,last_seq:t.last_seq||0},i=[],a=0;const u=x=>{this.activeTasks.update(s,{completed_items:++a}),i.push(this.compactDocument(x.id,0))},l=x=>{this.activeTasks.remove(s,x),n(x)},w=x=>{var O=x.last_seq;Promise.all(i).then(()=>Ut(this,"_local/compaction",B=>(!B.last_seq||B.last_seq<O)&&(B.last_seq=O,B))).then(()=>{this.activeTasks.remove(s),n(null,{ok:!0})}).catch(l)};this.info().then(x=>{s=this.activeTasks.add({name:"database_compaction",total_items:x.update_seq-r.last_seq}),this.changes(r).on("change",u).on("complete",w).on("error",l)})}changes(t,n){return"function"==typeof t&&(n=t,t={}),(t=t||{}).return_docs="return_docs"in t?t.return_docs:!t.live,new Ui(this,t,n)}type(){return"function"==typeof this._type?this._type():this.adapter}}lr.prototype.purge=Fe("_purge",function(e,t,n){if(typeof this._purge>"u")return n(ce(en,"Purge is not implemented in the "+this.adapter+" adapter."));var r=this;r._getRevisionTree(e,(i,s)=>{if(i)return n(i);if(!s)return n(ce(nt));let a;try{a=function Pi(e,t){let n=[];const r=e.slice();let i;for(;i=r.pop();){const{pos:s,ids:a}=i,u=`${s}-${a[0]}`,l=a[2];if(n.push(u),u===t){if(0!==l.length)throw new Error("The requested revision is not a leaf");return n.reverse()}(0===l.length||l.length>1)&&(n=[]);for(let w=0,x=l.length;w<x;w++)r.push({pos:s+1,ids:l[w]})}if(0===n.length)throw new Error("The requested revision does not exist");return n.reverse()}(s,t)}catch(u){return n(u.message||u)}r._purge(e,a,(u,l)=>{if(u)return n(u);(function Wi(e,t,n){return e.get("_local/purges").then(function(r){const i=r.purgeSeq+1;return r.purges.push({docId:t,rev:n,purgeSeq:i}),r.purges.length>self.purged_infos_limit&&r.purges.splice(0,r.purges.length-self.purged_infos_limit),r.purgeSeq=i,r}).catch(function(r){if(404!==r.status)throw r;return{_id:"_local/purges",purges:[{docId:t,rev:n,purgeSeq:0}],purgeSeq:0}}).then(function(r){return e.put(r)})})(r,e,t).then(function(){return n(null,l)})})})});class Ji{constructor(){this.isReady=!1,this.failed=!1,this.queue=[]}execute(){var t;if(this.failed)for(;t=this.queue.shift();)t(this.failed);else for(;t=this.queue.shift();)t()}fail(t){this.failed=t,this.execute()}ready(t){this.isReady=!0,this.db=t,this.execute()}addTask(t){this.queue.push(t),this.failed&&this.execute()}}function dr(e,t){let n=function(...r){if(!(this instanceof n))return new n(...r);t.apply(this,r)};return function Qi(e,t){e.prototype=Object.create(t.prototype,{constructor:{value:e}})}(n,e),n}class hr extends lr{constructor(t,n){super(),this._setup(t,n)}_setup(t,n){if(super._setup(),n=n||{},t&&"object"==typeof t&&(t=(n=t).name,delete n.name),void 0===n.deterministic_revs&&(n.deterministic_revs=!0),this.__opts=n=Oe(n),this.auto_compaction=n.auto_compaction,this.purged_infos_limit=n.purged_infos_limit||1e3,this.prefix=fe.prefix,"string"!=typeof t)throw new Error("Missing/invalid DB name");var i=function zi(e,t){var n=e.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var r=fe.adapters,i=fe.preferredAdapters,s=fe.prefix,a=t.adapter;if(!a)for(var u=0;u<i.length&&"idb"===(a=i[u])&&"websql"in r&&jt()&&localStorage["_pouch__websqldb_"+s+e];++u)tt("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');var l=r[a];return{name:l&&"use_prefix"in l&&!l.use_prefix?e:s+e,adapter:a}}((n.prefix||"")+t,n);if(n.name=i.name,n.adapter=n.adapter||i.adapter,this.name=t,this._adapter=n.adapter,fe.emit("debug",["adapter","Picked adapter: ",n.adapter]),!fe.adapters[n.adapter]||!fe.adapters[n.adapter].valid())throw new Error("Invalid Adapter: "+n.adapter);if(n.view_adapter&&(!fe.adapters[n.view_adapter]||!fe.adapters[n.view_adapter].valid()))throw new Error("Invalid View Adapter: "+n.view_adapter);this.taskqueue=new Ji,this.adapter=n.adapter,fe.adapters[n.adapter].call(this,n,s=>{if(s)return this.taskqueue.fail(s);(function Hi(e){function t(r){e.removeListener("closed",n),r||e.constructor.emit("destroyed",e.name)}function n(){e.removeListener("destroyed",t),e.constructor.emit("unref",e)}e.once("destroyed",t),e.once("closed",n),e.constructor.emit("ref",e)})(this),this.emit("created",this),fe.emit("created",this.name),this.taskqueue.ready(this)})}}const fe=dr(hr,function(e,t){hr.prototype._setup.call(this,e,t)});var Vi=typeof AbortController<"u"?AbortController:function(){return{abort:function(){}}},vr=fetch,Ot=Headers;fe.adapters={},fe.preferredAdapters=[],fe.prefix="_pouch_";var _r=new(c());function gn(e,t){for(var n=e,r=0,i=t.length;r<i&&(n=n[t[r]]);r++);return n}function pn(e){for(var t=[],n="",r=0,i=e.length;r<i;r++){var s=e[r];r>0&&"\\"===e[r-1]&&("$"===s||"."===s)?n=n.substring(0,n.length-1)+s:"."===s?(t.push(n),n=""):n+=s}return t.push(n),t}(function Xi(e){Object.keys(c().prototype).forEach(function(n){"function"==typeof c().prototype[n]&&(e[n]=_r[n].bind(_r))});var t=e._destructionListeners=new j;e.on("ref",function(r){t.has(r.name)||t.set(r.name,[]),t.get(r.name).push(r)}),e.on("unref",function(r){if(t.has(r.name)){var i=t.get(r.name),s=i.indexOf(r);s<0||(i.splice(s,1),i.length>1?t.set(r.name,i):t.delete(r.name))}}),e.on("destroyed",function(r){if(t.has(r)){var i=t.get(r);t.delete(r),i.forEach(function(s){s.emit("destroyed",!0)})}})})(fe),fe.adapter=function(e,t,n){t.valid()&&(fe.adapters[e]=t,n&&fe.preferredAdapters.push(e))},fe.plugin=function(e){if("function"==typeof e)e(fe);else{if("object"!=typeof e||0===Object.keys(e).length)throw new Error('Invalid plugin: got "'+e+'", expected an object or a function');Object.keys(e).forEach(function(t){fe.prototype[t]=e[t]})}return this.__defaults&&(fe.__defaults=ht({},this.__defaults)),fe},fe.defaults=function(e){let t=dr(fe,function(n,r){r=r||{},n&&"object"==typeof n&&(n=(r=n).name,delete r.name),r=ht({},t.__defaults,r),fe.call(this,n,r)});return t.preferredAdapters=fe.preferredAdapters.slice(),Object.keys(fe).forEach(function(n){n in t||(t[n]=fe[n])}),t.__defaults=ht({},this.__defaults,e),t},fe.fetch=function(e,t){return vr(e,t)},fe.prototype.activeTasks=fe.activeTasks=new class Yi{constructor(){this.tasks={}}list(){return Object.values(this.tasks)}add(t){const n=D();return this.tasks[n]={id:n,name:t.name,total_items:t.total_items,created_at:(new Date).toJSON()},n}get(t){return this.tasks[t]}remove(t,n){return delete this.tasks[t],this.tasks}update(t,n){const r=this.tasks[t];if(typeof r<"u"){const i={id:r.id,name:r.name,created_at:r.created_at,total_items:n.total_items||r.total_items,completed_items:n.completed_items||r.completed_items,updated_at:(new Date).toJSON()};this.tasks[t]=i}return this.tasks}};var ns=["$or","$nor","$not"];function gr(e){return ns.indexOf(e)>-1}function pr(e){return Object.keys(e)[0]}function Lt(e){var t={},n={$or:!0,$nor:!0};return e.forEach(function(r){Object.keys(r).forEach(function(i){var s=r[i];if("object"!=typeof s&&(s={$eq:s}),gr(i))if(s instanceof Array){if(n[i])return n[i]=!1,void(t[i]=s);var a=[];t[i].forEach(function(l){Object.keys(s).forEach(function(w){var x=s[w],O=Math.max(Object.keys(l).length,Object.keys(x).length),B=Lt([l,x]);Object.keys(B).length<=O||a.push(B)})}),t[i]=a}else t[i]=Lt([s]);else{var u=t[i]=t[i]||{};Object.keys(s).forEach(function(l){var w=s[l];return"$gt"===l||"$gte"===l?function is(e,t,n){typeof n.$eq<"u"||(typeof n.$gte<"u"?"$gte"===e?t>n.$gte&&(n.$gte=t):t>=n.$gte&&(delete n.$gte,n.$gt=t):typeof n.$gt<"u"?"$gte"===e?t>n.$gt&&(delete n.$gt,n.$gte=t):t>n.$gt&&(n.$gt=t):n[e]=t)}(l,w,u):"$lt"===l||"$lte"===l?function ss(e,t,n){typeof n.$eq<"u"||(typeof n.$lte<"u"?"$lte"===e?t<n.$lte&&(n.$lte=t):t<=n.$lte&&(delete n.$lte,n.$lt=t):typeof n.$lt<"u"?"$lte"===e?t<n.$lt&&(delete n.$lt,n.$lte=t):t<n.$lt&&(n.$lt=t):n[e]=t)}(l,w,u):"$ne"===l?function as(e,t){"$ne"in t?t.$ne.push(e):t.$ne=[e]}(w,u):"$eq"===l?function os(e,t){delete t.$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,t.$eq=e}(w,u):"$regex"===l?function us(e,t){"$regex"in t?t.$regex.push(e):t.$regex=[e]}(w,u):void(u[l]=w)})}})}),t}function yr(e){for(var t in e){if(Array.isArray(e))for(var n in e)e[n].$and&&(e[n]=Lt(e[n].$and));var r=e[t];"object"==typeof r&&yr(r)}return e}function mr(e,t){for(var n in e){"$and"===n&&(t=!0);var r=e[n];"object"==typeof r&&(t=mr(r,t))}return t}function cs(e){var t=Oe(e);mr(t,!1)&&"$and"in(t=yr(t))&&(t=Lt(t.$and)),["$or","$nor"].forEach(function(a){a in t&&t[a].forEach(function(u){for(var l=Object.keys(u),w=0;w<l.length;w++){var x=l[w],O=u[x];("object"!=typeof O||null===O)&&(u[x]={$eq:O})}})}),"$not"in t&&(t.$not=Lt([t.$not]));for(var n=Object.keys(t),r=0;r<n.length;r++){var i=n[r],s=t[i];("object"!=typeof s||null===s)&&(s={$eq:s}),t[i]=s}return yn(t),t}function yn(e){Object.keys(e).forEach(function(t){var n=e[t];Array.isArray(n)?n.forEach(function(r){r&&"object"==typeof r&&yn(r)}):"$ne"===t?e.$ne=[n]:"$regex"===t?e.$regex=[n]:n&&"object"==typeof n&&yn(n)})}function Ge(e,t){if(e===t)return 0;e=pt(e),t=pt(t);var n=bn(e),r=bn(t);if(n-r!=0)return n-r;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return function ps(e,t){return e===t?0:e>t?1:-1}(e,t)}return Array.isArray(e)?function gs(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=Ge(e[r],t[r]);if(0!==i)return i}return e.length===t.length?0:e.length>t.length?1:-1}(e,t):function ys(e,t){for(var n=Object.keys(e),r=Object.keys(t),i=Math.min(n.length,r.length),s=0;s<i;s++){var a=Ge(n[s],r[s]);if(0!==a||0!==(a=Ge(e[n[s]],t[r[s]])))return a}return n.length===r.length?0:n.length>r.length?1:-1}(e,t)}function pt(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var n=e.length;e=new Array(n);for(var r=0;r<n;r++)e[r]=pt(t[r])}else{if(e instanceof Date)return e.toJSON();if(null!==e)for(var i in e={},t)if(Object.prototype.hasOwnProperty.call(t,i)){var s=t[i];typeof s<"u"&&(e[i]=pt(s))}}}return e}function it(e){return bn(e=pt(e))+""+function ds(e){if(null!==e)switch(typeof e){case"boolean":return e?1:0;case"number":return function ms(e){if(0===e)return"1";var t=e.toExponential().split(/e\+?/),n=parseInt(t[1],10),r=e<0,i=r?"0":"2",a=function ls(e,t,n){var r=function fs(e,t,n){for(var r="",i=n-e.length;r.length<i;)r+=t;return r}(e,t,n);return r+e}(((r?-n:n)- -324).toString(),"0",3);i+=""+a;var u=Math.abs(parseFloat(t[0]));r&&(u=10-u);var l=u.toFixed(20);return i+""+l.replace(/\.?0+$/,"")}(e);case"string":return e.replace(/\u0002/g,"\x02\x02").replace(/\u0001/g,"\x01\x02").replace(/\u0000/g,"\x01\x01");case"object":var t=Array.isArray(e),n=t?e:Object.keys(e),r=-1,i=n.length,s="";if(t)for(;++r<i;)s+=it(n[r]);else for(;++r<i;){var a=n[r];s+=it(a)+it(e[a])}return s}return""}(e)+"\0"}function hs(e,t){var r,n=t;if("1"===e[t])r=0,t++;else{var s="0"===e[t];t++;var a="",u=e.substring(t,t+3),l=parseInt(u,10)+-324;for(s&&(l=-l),t+=3;;){var w=e[t];if("\0"===w)break;a+=w,t++}r=1===(a=a.split(".")).length?parseInt(a,10):parseFloat(a[0]+"."+a[1]),s&&(r-=10),0!==l&&(r=parseFloat(r+"e"+l))}return{num:r,length:t-n}}function vs(e,t){var n=e.pop();if(t.length){var r=t[t.length-1];n===r.element&&(t.pop(),r=t[t.length-1]);var i=r.element,s=r.index;Array.isArray(i)?i.push(n):s===e.length-2?i[e.pop()]=n:e.push(n)}}function _s(e){for(var t=[],n=[],r=0;;){var i=e[r++];if("\0"!==i)switch(i){case"1":t.push(null);break;case"2":t.push("1"===e[r]),r++;break;case"3":var s=hs(e,r);t.push(s.num),r+=s.length;break;case"4":for(var a="";;){var u=e[r];if("\0"===u)break;a+=u,r++}a=a.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"\x01").replace(/\u0002\u0002/g,"\x02"),t.push(a);break;case"5":var l={element:[],index:t.length};t.push(l.element),n.push(l);break;case"6":var w={element:{},index:t.length};t.push(w.element),n.push(w);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}else{if(1===t.length)return t.pop();vs(t,n)}}}function bn(e){var n=["boolean","number","string","object"].indexOf(typeof e);return~n?null===e?1:Array.isArray(e)?5:n<3?n+2:n+3:Array.isArray(e)?5:void 0}function Ct(e,t,n){return n.every(function(r){var i=t[r],s=pn(r),a=gn(e,s);return gr(r)?function xs(e,t,n){return"$or"===e?t.some(function(r){return Ct(n,r,Object.keys(r))}):"$not"===e?!Ct(n,t,Object.keys(t)):!t.find(function(r){return Ct(n,r,Object.keys(r))})}(r,i,e):Nt(i,e,s,a)})}function Nt(e,t,n,r){return!e||("object"==typeof e?Object.keys(e).every(function(i){var s=e[i];if(0===i.indexOf("$"))return br(i,t,s,n,r);var a=pn(i);if(void 0===r&&"object"!=typeof s&&a.length>0)return!1;var u=gn(r,a);return"object"==typeof s?Nt(s,t,n,u):br("$eq",t,s,a,u)}):e===r)}function br(e,t,n,r,i){if(!Sr[e])throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return Sr[e](t,n,r,i)}function Rt(e){return typeof e<"u"&&null!==e}function yt(e){return typeof e<"u"}function xr(e,t){return t.some(function(n){return e instanceof Array?e.some(function(r){return 0===Ge(n,r)}):0===Ge(n,e)})}var Sr={$elemMatch:function(e,t,n,r){return!(!Array.isArray(r)||0===r.length)&&r.some("object"==typeof r[0]&&null!==r[0]?function(i){return Ct(i,t,Object.keys(t))}:function(i){return Nt(t,e,n,i)})},$allMatch:function(e,t,n,r){return!(!Array.isArray(r)||0===r.length)&&r.every("object"==typeof r[0]&&null!==r[0]?function(i){return Ct(i,t,Object.keys(t))}:function(i){return Nt(t,e,n,i)})},$eq:function(e,t,n,r){return yt(r)&&0===Ge(r,t)},$gte:function(e,t,n,r){return yt(r)&&Ge(r,t)>=0},$gt:function(e,t,n,r){return yt(r)&&Ge(r,t)>0},$lte:function(e,t,n,r){return yt(r)&&Ge(r,t)<=0},$lt:function(e,t,n,r){return yt(r)&&Ge(r,t)<0},$exists:function(e,t,n,r){return t?yt(r):!yt(r)},$mod:function(e,t,n,r){return Rt(r)&&function Ss(e,t){return"number"==typeof e&&parseInt(e,10)===e&&e%t[0]===t[1]}(r,t)},$ne:function(e,t,n,r){return t.every(function(i){return 0!==Ge(r,i)})},$in:function(e,t,n,r){return Rt(r)&&xr(r,t)},$nin:function(e,t,n,r){return Rt(r)&&!xr(r,t)},$size:function(e,t,n,r){return Rt(r)&&Array.isArray(r)&&function Es(e,t){return e.length===t}(r,t)},$all:function(e,t,n,r){return Array.isArray(r)&&function As(e,t){return t.every(function(n){return e.some(function(r){return 0===Ge(n,r)})})}(r,t)},$regex:function(e,t,n,r){return Rt(r)&&"string"==typeof r&&t.every(function(i){return function Ds(e,t){return new RegExp(t).test(e)}(r,i)})},$type:function(e,t,n,r){return function Os(e,t){switch(t){case"null":return null===e;case"boolean":return"boolean"==typeof e;case"number":return"number"==typeof e;case"string":return"string"==typeof e;case"array":return e instanceof Array;case"object":return"[object Object]"==={}.toString.call(e)}}(r,t)}};function Bs(e,t){if(e.selector&&e.filter&&"_selector"!==e.filter)return t(new Error('selector invalid for filter "'+("string"==typeof e.filter?e.filter:"function")+'"'));t()}function Ls(e){e.view&&!e.filter&&(e.filter="_view"),e.selector&&!e.filter&&(e.filter="_selector"),e.filter&&"string"==typeof e.filter&&("_view"===e.filter?e.view=Hn(e.view):e.filter=Hn(e.filter))}function Rs(e,t){return t.filter&&"string"==typeof t.filter&&!t.doc_ids&&!at(e.db)}function qs(e,t){var n=t.complete;if("_view"===t.filter){if(!t.view||"string"!=typeof t.view){var r=ce($t,"`view` filter parameter not found or invalid.");return n(r)}var i=sn(t.view);e.db.get("_design/"+i[0],function(a,u){if(e.isCancelled)return n(null,{status:"cancelled"});if(a)return n(Dt(a));var l=u&&u.views&&u.views[i[1]]&&u.views[i[1]].map;if(!l)return n(ce(nt,u.views?"missing json key: "+i[1]:"missing json key: views"));t.filter=function Ts(e){return an(["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+e+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n"),{})}(l),e.doChanges(t)})}else if(t.selector)t.filter=function(a){return function Cs(e,t){if("object"!=typeof t)throw new Error("Selector error: expected a JSON object");var r=function bs(e,t,n){if(e=e.filter(function(a){return Ct(a.doc,t.selector,n)}),t.sort){var r=function ws(e){function t(n){return e.map(function(r){var s=pn(pr(r));return gn(n,s)})}return function(n,r){var a=Ge(t(n.doc),t(r.doc));return 0!==a?a:function ts(e,t){return e<t?-1:e>t?1:0}(n.doc._id,r.doc._id)}}(t.sort);e=e.sort(r),"string"!=typeof t.sort[0]&&"desc"===function rs(e){return e[pr(e)]}(t.sort[0])&&(e=e.reverse())}if("limit"in t||"skip"in t){var i=t.skip||0;e=e.slice(i,("limit"in t?t.limit:e.length)+i)}return e}([{doc:e}],{selector:t=cs(t)},Object.keys(t));return r&&1===r.length}(a,t.selector)},e.doChanges(t);else{var s=sn(t.filter);e.db.get("_design/"+s[0],function(a,u){if(e.isCancelled)return n(null,{status:"cancelled"});if(a)return n(Dt(a));var l=u&&u.filters&&u.filters[s[1]];if(!l)return n(ce(nt,u&&u.filters?"missing json key: "+s[1]:"missing json key: filters"));t.filter=function Ps(e){return an('"use strict";\nreturn '+e+";",{})}(l),e.doChanges(t)})}}function Ar(e){return e.reduce(function(t,n){return t[n]=!0,t},{})}fe.plugin(function ks(e){e._changesFilterPlugin={validate:Bs,normalize:Ls,shouldFilter:Rs,filter:qs}}),fe.version="8.0.1";var Is=Ar(["_id","_rev","_access","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),js=Ar(["_access","_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function Er(e){if(!/^\d+-/.test(e))return ce(zn);var t=e.indexOf("-"),n=e.substring(0,t),r=e.substring(t+1);return{prefix:parseInt(n,10),id:r}}function Dr(e,t,n){n||(n={deterministic_revs:!0});var r,i,s,a={status:"available"};if(e._deleted&&(a.deleted=!0),t)if(e._id||(e._id=Kt()),i=rr(e,n.deterministic_revs),e._rev){if((s=Er(e._rev)).error)return s;e._rev_tree=[{pos:s.prefix,ids:[s.id,{status:"missing"},[[i,a,[]]]]}],r=s.prefix+1}else e._rev_tree=[{pos:1,ids:[i,a,[]]}],r=1;else if(e._revisions&&(e._rev_tree=function $s(e,t){for(var n=e.start-e.ids.length+1,r=e.ids,i=[r[0],t,[]],s=1,a=r.length;s<a;s++)i=[r[s],{status:"missing"},[i]];return[{pos:n,ids:i}]}(e._revisions,a),r=e._revisions.start,i=e._revisions.ids[0]),!e._rev_tree){if((s=Er(e._rev)).error)return s;e._rev_tree=[{pos:r=s.prefix,ids:[i=s.id,a,[]]}]}Qn(e._id),e._rev=r+"-"+i;var u={metadata:{},data:{}};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){var w="_"===l[0];if(w&&!Is[l]){var x=ce(Jn,l);throw x.message=Jn.message+": "+l,x}w&&!js[l]?u.metadata[l.slice(1)]=e[l]:u.data[l]=e[l]}return u}function Ns(e,t,n){if(e.stub)return n();"string"==typeof e.data?function Us(e,t,n){var r=function Ms(e){try{return on(e)}catch{return{error:ce(Zn,"Attachment is not a valid base64 string")}}}(e.data);if(r.error)return n(r.error);e.length=r.length,e.data="blob"===t?cn(r,e.content_type):"base64"===t?Bt(r):r,dn(r,function(i){e.digest="md5-"+i,n()})}(e,t,n):function Ks(e,t,n){dn(e.data,function(r){e.digest="md5-"+r,e.length=e.data.size||e.data.length||0,"binary"===t?tr(e.data,function(i){e.data=i,n()}):"base64"===t?ln(e.data,function(i){e.data=i,n()}):n()})}(e,t,n)}function Zs(e,t,n,r,i,s,a,u,l){e=e||1e3;var x=u.new_edits,O=new j,B=0,g=t.length;function m(){++B===g&&l&&l()}t.forEach(function(y,d){if(y._id&&gt(y._id))n[y._deleted?"_removeLocal":"_putLocal"](y,{ctx:i},function(S,P){s[d]=S||P,m()});else{var b=y.metadata.id;O.has(b)?(g--,O.get(b).push([y,d])):O.set(b,[[y,d]])}}),O.forEach(function(y,d){var _=0;function b(){++_<y.length?S():m()}function S(){var P=y[_],A=P[0],T=P[1];if(r.has(d))!function Gs(e,t,n,r,i,s,a,u){if(function ki(e,t){for(var a,n=e.slice(),r=t.split("-"),i=parseInt(r[0],10),s=r[1];a=n.pop();){if(a.pos===i&&a.ids[0]===s)return!0;for(var u=a.ids[2],l=0,w=u.length;l<w;l++)n.push({pos:a.pos+1,ids:u[l]})}return!1}(t.rev_tree,n.metadata.rev)&&!u)return r[i]=n,s();var l=t.winningRev||vt(t),w="deleted"in t?t.deleted:ft(t,l),x="deleted"in n.metadata?n.metadata.deleted:ft(n.metadata),O=/^1-/.test(n.metadata.rev);if(w&&!x&&u&&O){var B=n.data;B._rev=l,B._id=n.metadata.id,n=Dr(B,u)}var g=ur(t.rev_tree,n.metadata.rev_tree[0],e);if(u&&(w&&x&&"new_leaf"!==g.conflicts||!w&&"new_leaf"!==g.conflicts||w&&!x&&"new_branch"===g.conflicts)){var y=ce(Et);return r[i]=y,s()}var d=n.metadata.rev;n.metadata.rev_tree=g.tree,n.stemmedRevs=g.stemmedRevs||[],t.rev_map&&(n.metadata.rev_map=t.rev_map);var _=vt(n.metadata),b=ft(n.metadata,_),S=w===b?0:w<b?-1:1;a(n,_,b,d===_?b:ft(n.metadata,d),!0,S,i,s)}(e,r.get(d),A,s,T,b,a,x);else{var q=ur([],A.metadata.rev_tree[0],e);A.metadata.rev_tree=q.tree,A.stemmedRevs=q.stemmedRevs||[],function w(y,d,_){var b=vt(y.metadata),S=ft(y.metadata,b);if("was_delete"in u&&S)return s[d]=ce(nt,"deleted"),_();var P=x&&function Ws(e){return"missing"===e.metadata.rev_tree[0].ids[1].status}(y);if(P){var A=ce(Et);return s[d]=A,_()}a(y,b,S,S,!1,S?0:1,d,_)}(A,T,b)}}S()})}var Ze="document-store",Qe="by-sequence",rt="attach-store",mt="attach-seq-store",Ye="meta-store",ot="local-store",xn="detect-blob-support";function Qs(e){try{return JSON.stringify(e)}catch{return v.stringify(e)}}function ut(e){return function(t){var n="unknown_error";t.target&&t.target.error&&(n=t.target.error.name||t.target.error.message),e(ce(nn,n))}}function Sn(e,t,n){return{data:Qs(e),winningRev:t,deletedOrLocal:n?"1":"0",seq:e.seq,id:e.id}}function wt(e){if(!e)return null;var t=function zs(e){try{return JSON.parse(e)}catch{return v.parse(e)}}(e.data);return t.winningRev=e.winningRev,t.deleted="1"===e.deletedOrLocal,t.seq=e.seq,t}function Ft(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function Or(e,t,n,r){n?r(e?"string"!=typeof e?e:fn(e,t):un([""],{type:t})):e?"string"!=typeof e?er(e,function(i){r(Bt(i))}):r(e):r("")}function Cr(e,t,n,r){var i=Object.keys(e._attachments||{});if(!i.length)return r&&r();var s=0;function a(){++s===i.length&&r&&r()}i.forEach(function(l){t.attachments&&t.include_docs?function u(l,w){var x=l._attachments[w],O=x.digest;n.objectStore(rt).get(O).onsuccess=function(g){x.body=g.target.result.body,a()}}(e,l):(e._attachments[l].stub=!0,a())})}function An(e,t){return Promise.all(e.map(function(n){if(n.doc&&n.doc._attachments){var r=Object.keys(n.doc._attachments);return Promise.all(r.map(function(i){var s=n.doc._attachments[i];if("body"in s){var a=s.body,u=s.content_type;return new Promise(function(l){Or(a,u,t,function(w){n.doc._attachments[i]=ht(Tt(s,["digest","content_type"]),{data:w}),l()})})}}))}}))}function Pr(e,t,n){var r=[],i=n.objectStore(Qe),s=n.objectStore(rt),a=n.objectStore(mt),u=e.length;function l(){--u||function w(){r.length&&r.forEach(function(x){a.index("digestSeq").count(IDBKeyRange.bound(x+"::",x+"::\uffff",!1,!1)).onsuccess=function(B){B.target.result||s.delete(x)}})}()}e.forEach(function(x){i.index("_doc_id_rev").getKey(t+"::"+x).onsuccess=function(g){var m=g.target.result;if("number"!=typeof m)return l();i.delete(m),a.index("seq").openCursor(IDBKeyRange.only(m)).onsuccess=function(d){var _=d.target.result;if(_){var b=_.value.digestSeq.split("::")[0];r.push(b),a.delete(_.primaryKey),_.continue()}else l()}}})}function st(e,t,n){try{return{txn:e.transaction(t,n)}}catch(r){return{error:r}}}var qt=new si;function Hs(e,t,n,r,i,s){for(var u,l,w,x,O,B,g,m,a=t.docs,y=0,d=a.length;y<d;y++){var _=a[y];_._id&&gt(_._id)||(_=a[y]=Dr(_,n.new_edits,e)).error&&!g&&(g=_)}if(g)return s(g);var b=!1,S=0,P=new Array(a.length),A=new j,T=!1;function k(){b=!0,U()}function U(){!m||!b||(m.docCount+=S,B.put(m))}function se(){T||(qt.notify(r._meta.name),s(null,P))}function X(ee,he,be,je,Le,h,p,E){ee.metadata.winningRev=he,ee.metadata.deleted=be;var L=ee.data;if(L._id=ee.metadata.id,L._rev=ee.metadata.rev,je&&(L._deleted=!0),L._attachments&&Object.keys(L._attachments).length)return function le(ee,he,be,je,Le,h){var E=0,L=Object.keys(ee.data._attachments);function F(){E===L.length&&V(ee,he,be,je,Le,h)}function te(){E++,F()}L.forEach(function(ve){var ne=ee.data._attachments[ve];if(ne.stub)E++,F();else{var ae=ne.data;delete ne.data,ne.revpos=parseInt(he,10),function Xe(ee,he,be){x.count(ee).onsuccess=function(Le){if(Le.target.result)return be();x.put({digest:ee,body:he}).onsuccess=be}}(ne.digest,ae,te)}})}(ee,he,be,Le,p,E);S+=h,U(),V(ee,he,be,Le,p,E)}function V(ee,he,be,je,Le,h){var p=ee.data,E=ee.metadata;function L(ne){var ae=ee.stemmedRevs||[];je&&r.auto_compaction&&(ae=ae.concat(function Ci(e){var t=[];return _t(e.rev_tree,function(n,r,i,s,a){"available"===a.status&&!n&&(t.push(r+"-"+i),a.status="missing")}),t}(ee.metadata))),ae&&ae.length&&Pr(ae,ee.metadata.id,u),E.seq=ne.target.result;var Z=Sn(E,he,be);l.put(Z).onsuccess=te}function te(){P[Le]={ok:!0,id:E.id,rev:E.rev},A.set(ee.metadata.id,ee.metadata),function Be(ee,he,be){var je=0,Le=Object.keys(ee.data._attachments||{});if(!Le.length)return be();function h(){++je===Le.length&&be()}function p(L){var te=O.put({seq:he,digestSeq:ee.data._attachments[L].digest+"::"+he});te.onsuccess=h,te.onerror=function(ve){ve.preventDefault(),ve.stopPropagation(),h()}}for(var E=0;E<Le.length;E++)p(Le[E])}(ee,E.seq,h)}p._doc_id_rev=E.id+"::"+E.rev,delete p._id,delete p._rev;var ve=w.put(p);ve.onsuccess=L,ve.onerror=function F(ne){ne.preventDefault(),ne.stopPropagation(),w.index("_doc_id_rev").getKey(p._doc_id_rev).onsuccess=function(re){w.put(p,re.target.result).onsuccess=L}}}!function Fs(e,t,n){if(!e.length)return n();var i,r=0;function s(){r++,e.length===r&&(i?n(i):n())}e.forEach(function(a){var u=a.data&&a.data._attachments?Object.keys(a.data._attachments):[],l=0;if(!u.length)return s();function w(O){i=O,++l===u.length&&s()}for(var x in a.data._attachments)Object.prototype.hasOwnProperty.call(a.data._attachments,x)&&Ns(a.data._attachments[x],t,w)})}(a,r._meta.blobSupport?"blob":"base64",function(ee){if(ee)return s(ee);!function M(){var he=st(i,[Ze,Qe,rt,ot,mt,Ye],"readwrite");if(he.error)return s(he.error);(u=he.txn).onabort=ut(s),u.ontimeout=ut(s),u.oncomplete=se,l=u.objectStore(Ze),w=u.objectStore(Qe),x=u.objectStore(rt),O=u.objectStore(mt),(B=u.objectStore(Ye)).get(Ye).onsuccess=function(be){m=be.target.result,U()},function z(ee){var he=[];if(a.forEach(function(h){h.data&&h.data._attachments&&Object.keys(h.data._attachments).forEach(function(p){var E=h.data._attachments[p];E.stub&&he.push(E.digest)})}),!he.length)return ee();var je,be=0;he.forEach(function(h){!function H(ee,he){x.get(ee).onsuccess=function(je){if(je.target.result)he();else{var Le=ce(di,"unknown stub attachment with digest "+ee);Le.status=412,he(Le)}}}(h,function(p){p&&!je&&(je=p),function Le(){++be===he.length&&ee(je)}()})})}(function(be){if(be)return T=!0,s(be);!function oe(){if(a.length)for(var ee=0,je=0,Le=a.length;je<Le;je++){var h=a[je];h._id&&gt(h._id)?he():l.get(h.metadata.id).onsuccess=be}function he(){++ee===a.length&&function N(){Zs(e.revs_limit,a,r,A,u,P,X,n,k)}()}function be(E){var L=wt(E.target.result);L&&A.set(L.id,L),he()}}()})}()})}function Tr(e,t,n,r,i){var a,u,l;function w(g){u=g.target.result,a&&i(a,u,l)}function x(g){a=g.target.result,u&&i(a,u,l)}function B(g){var m=g.target.result;if(!m)return i();i([m.key],[m.value],m)}-1===r&&(r=1e3),"function"==typeof e.getAll&&"function"==typeof e.getAllKeys&&r>1&&!n?(l={continue:function O(){if(!a.length)return i();var m,g=a[a.length-1];if(t&&t.upper)try{m=IDBKeyRange.bound(g,t.upper,!0,t.upperOpen)}catch(y){if("DataError"===y.name&&0===y.code)return i()}else m=IDBKeyRange.lowerBound(g,!0);a=null,u=null,e.getAll(t=m,r).onsuccess=w,e.getAllKeys(t,r).onsuccess=x}},e.getAll(t,r).onsuccess=w,e.getAllKeys(t,r).onsuccess=x):n?e.openCursor(t,"prev").onsuccess=B:e.openCursor(t).onsuccess=B}var En=!1,Dn=[];function Br(){En||!Dn.length||(En=!0,Dn.shift()())}var On,Pt=new j,Cn=new j;function Lr(e,t){var n=this;!function ia(e,t,n){Dn.push(function(){e(function(s,a){(function ra(e,t,n,r){try{e(t,n)}catch(i){r.emit("error",i)}})(t,s,a,n),En=!1,J()(function(){Br()})})}),Br()}(function(r){!function aa(e,t,n){var r=t.name,i=null,s=null;function a(d){return function(_,b){_&&_ instanceof Error&&!_.reason&&s&&(_.reason=s),d(_,b)}}function l(d,_){var b=d.objectStore(Ze);b.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),b.openCursor().onsuccess=function(S){var P=S.target.result;if(P){var A=P.value,T=ft(A);A.deletedOrLocal=T?"1":"0",b.put(A),P.continue()}else _()}}function x(d,_){var b=d.objectStore(ot),S=d.objectStore(Ze),P=d.objectStore(Qe);S.openCursor().onsuccess=function(T){var q=T.target.result;if(q){var M=q.value,k=M.id,N=gt(k),U=vt(M);if(N){var oe=k+"::"+U,se=k+"::",H=k+"::~",z=P.index("_doc_id_rev"),X=IDBKeyRange.bound(se,H,!1,!1),V=z.openCursor(X);V.onsuccess=function(le){if(V=le.target.result){var Be=V.value;Be._doc_id_rev===oe&&b.put(Be),P.delete(V.primaryKey),V.continue()}else S.delete(q.primaryKey),q.continue()}}else q.continue()}else _&&_()}}function B(d,_){var b=d.objectStore(Qe),S=d.objectStore(rt),P=d.objectStore(mt);S.count().onsuccess=function(T){if(!T.target.result)return _();b.openCursor().onsuccess=function(M){var k=M.target.result;if(!k)return _();for(var N=k.value,U=k.primaryKey,oe=Object.keys(N._attachments||{}),se={},H=0;H<oe.length;H++)se[N._attachments[oe[H]].digest]=!0;var X=Object.keys(se);for(H=0;H<X.length;H++)P.put({seq:U,digestSeq:X[H]+"::"+U});k.continue()}}}function g(d){var b=d.objectStore(Qe),S=d.objectStore(Ze);S.openCursor().onsuccess=function(A){var T=A.target.result;if(T){var q=function _(A){return A.data?wt(A):(A.deleted="1"===A.deletedOrLocal,A)}(T.value);if(q.winningRev=q.winningRev||vt(q),q.seq)return k();!function M(){var N=q.id+"::",U=q.id+"::\uffff",oe=b.index("_doc_id_rev").openCursor(IDBKeyRange.bound(N,U)),se=0;oe.onsuccess=function(H){var z=H.target.result;if(!z)return q.seq=se,k();var X=z.primaryKey;X>se&&(se=X),z.continue()}}()}function k(){var N=Sn(q,q.winningRev,q.deleted);S.put(N).onsuccess=function(){T.continue()}}}}e._meta=null,e._remote=!1,e.type=function(){return"idb"},e._id=At(function(d){d(null,e._meta.instanceId)}),e._bulkDocs=function(_,b,S){Hs(t,_,b,e,i,a(S))},e._get=function(_,b,S){var P,A,T,q=b.ctx;if(!q){var M=st(i,[Ze,Qe,rt],"readonly");if(M.error)return S(M.error);q=M.txn}function k(){S(T,{doc:P,metadata:A,ctx:q})}q.objectStore(Ze).get(_).onsuccess=function(N){if(!(A=wt(N.target.result)))return T=ce(nt,"missing"),k();var U;if(b.rev)U=b.latest?function ji(e,t){for(var r,n=t.rev_tree.slice();r=n.pop();){var i=r.pos,s=r.ids,a=s[0],u=s[1],l=s[2],w=0===l.length,x=r.history?r.history.slice():[];if(x.push({id:a,pos:i,opts:u}),w)for(var O=0,B=x.length;O<B;O++){var g=x[O];if(g.pos+"-"+g.id===e)return i+"-"+a}for(var y=0,d=l.length;y<d;y++)n.push({pos:i+1,ids:l[y],history:x})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}(b.rev,A):b.rev;else if(U=A.winningRev,ft(A))return T=ce(nt,"deleted"),k();var se=q.objectStore(Qe),H=A.id+"::"+U;se.index("_doc_id_rev").get(H).onsuccess=function(z){if((P=z.target.result)&&(P=Ft(P)),!P)return T=ce(nt,"missing"),k();k()}}},e._getAttachment=function(d,_,b,S,P){var A;if(S.ctx)A=S.ctx;else{var T=st(i,[Ze,Qe,rt],"readonly");if(T.error)return P(T.error);A=T.txn}var q=b.digest,M=b.content_type;A.objectStore(rt).get(q).onsuccess=function(k){Or(k.target.result.body,M,S.binary,function(U){P(null,U)})}},e._info=function(_){var b,S,P=st(i,[Ye,Qe],"readonly");if(P.error)return _(P.error);var A=P.txn;A.objectStore(Ye).get(Ye).onsuccess=function(T){S=T.target.result.docCount},A.objectStore(Qe).openCursor(null,"prev").onsuccess=function(T){var q=T.target.result;b=q?q.key:0},A.oncomplete=function(){_(null,{doc_count:S,update_seq:b,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}},e._allDocs=function(_,b){!function ea(e,t,n){var x,O,a="keys"in e&&e.keys,u=e.skip||0,l="number"==typeof e.limit?e.limit:-1;if(!a&&(x=function Xs(e,t,n,r,i){try{if(e&&t)return i?IDBKeyRange.bound(t,e,!n,!1):IDBKeyRange.bound(e,t,!1,!n);if(e)return i?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return i?IDBKeyRange.lowerBound(t,!n):IDBKeyRange.upperBound(t,!n);if(r)return IDBKeyRange.only(r)}catch(s){return{error:s}}return null}("startkey"in e&&e.startkey,"endkey"in e&&e.endkey,!1!==e.inclusive_end,"key"in e&&e.key,e.descending),(O=x&&x.error)&&("DataError"!==O.name||0!==O.code)))return n(ce(nn,O.name));var B=[Ze,Qe,Ye];e.attachments&&B.push(rt);var g=st(t,B,"readonly");if(g.error)return n(g.error);var m=g.txn;m.oncomplete=function se(){e.attachments?An(S,e.binary).then(oe):oe()},m.onabort=ut(n);var P,A,y=m.objectStore(Ze),d=m.objectStore(Qe),_=m.objectStore(Ye),b=d.index("_doc_id_rev"),S=[];function M(H,z){var X={id:z.id,key:z.id,value:{rev:H}};z.deleted?a&&(S.push(X),X.value.deleted=!0,X.doc=null):u--<=0&&(S.push(X),e.include_docs&&function q(H,z,X){b.get(H.id+"::"+X).onsuccess=function(Be){if(z.doc=Ft(Be.target.result)||{},e.conflicts){var Xe=vn(H);Xe.length&&(z.doc._conflicts=Xe)}Cr(z.doc,e,m)}}(z,X,H))}function k(H){for(var z=0,X=H.length;z<X&&S.length!==l;z++){var V=H[z];if(V.error&&a)S.push(V);else{var le=wt(V);M(le.winningRev,le)}}}function N(H,z,X){X&&(k(z),S.length<l&&X.continue())}function oe(){var H={total_rows:P,offset:e.skip,rows:S};e.update_seq&&void 0!==A&&(H.update_seq=A),n(null,H)}if(_.get(Ye).onsuccess=function(H){P=H.target.result.docCount},e.update_seq&&function T(H,z){H.openCursor(null,"prev").onsuccess=function X(V){var le=V.target.result,Be=void 0;return le&&le.key&&(Be=le.key),z({target:{result:[Be]}})}}(d,function(H){H.target.result&&H.target.result.length>0&&(A=H.target.result[0])}),!O&&0!==l){if(a)return function Ys(e,t,n){var r=new Array(e.length),i=0;e.forEach(function(s,a){t.get(s).onsuccess=function(u){r[a]=u.target.result?u.target.result:{key:s,error:"not_found"},++i===e.length&&n(e,r,{})}})}(e.keys,y,N);if(-1===l)return function Vs(e,t,n){if("function"!=typeof e.getAll){var r=[];e.openCursor(t).onsuccess=function i(s){var a=s.target.result;a?(r.push(a.value),a.continue()):n({target:{result:r}})}}else e.getAll(t).onsuccess=n}(y,x,function U(H){var z=H.target.result;e.descending&&(z=z.reverse()),k(z)});Tr(y,x,e.descending,l+u,N)}}(_,i,a(b))},e._changes=function(_){return function sa(e,t,n,r){if((e=Oe(e)).continuous){var i=n+":"+Kt();return qt.addListener(n,i,t,e),qt.notify(n),{cancel:function(){qt.removeListener(n,i)}}}var s=e.doc_ids&&new R(e.doc_ids);e.since=e.since||0;var a=e.since,u="limit"in e?e.limit:-1;0===u&&(u=1);var B,g,m,y,l=[],w=0,x=rn(e),O=new j;function _(M,k,N,U){return N.seq!==k?U():N.winningRev===M._rev?U(N,M):void(y.get(M._id+"::"+N.winningRev).onsuccess=function(H){U(N,Ft(H.target.result))})}function S(){e.complete(null,{results:l,last_seq:a})}var A=[Ze,Qe];e.attachments&&A.push(rt);var T=st(r,A,"readonly");if(T.error)return e.complete(T.error);(B=T.txn).onabort=ut(e.complete),B.oncomplete=function P(){!e.continuous&&e.attachments?An(l).then(S):S()},g=B.objectStore(Qe),m=B.objectStore(Ze),y=g.index("_doc_id_rev"),Tr(g,e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,!0):null,e.descending,u,function d(M,k,N){if(N&&M.length){var U=new Array(M.length),oe=new Array(M.length),z=0;k.forEach(function(X,V){!function b(M,k,N){if(s&&!s.has(M._id))return N();var U=O.get(M._id);if(U)return _(M,k,U,N);m.get(M._id).onsuccess=function(oe){U=wt(oe.target.result),O.set(M._id,U),_(M,k,U,N)}}(Ft(X),M[V],function(Xe,ee){oe[V]=Xe,U[V]=ee,++z===M.length&&function H(){for(var X=[],V=0,le=U.length;V<le&&w!==u;V++){var Be=U[V];Be&&X.push(se(oe[V],Be))}Promise.all(X).then(function(ee){for(var he=0,be=ee.length;he<be;he++)ee[he]&&e.onChange(ee[he])}).catch(e.complete),w!==u&&N.continue()}()})})}function se(X,V){var le=e.processChange(V,X,e);a=le.seq=X.seq;var Be=x(le);return"object"==typeof Be?Promise.reject(Be):Be?(w++,e.return_docs&&l.push(le),e.attachments&&e.include_docs?new Promise(function(Xe){Cr(V,e,B,function(){An([le],e.binary).then(function(){Xe(le)})})}):Promise.resolve(le)):Promise.resolve()}})}(_,e,r,i)},e._close=function(d){i.close(),Pt.delete(r),d()},e._getRevisionTree=function(d,_){var b=st(i,[Ze],"readonly");if(b.error)return _(b.error);b.txn.objectStore(Ze).get(d).onsuccess=function(A){var T=wt(A.target.result);T?_(null,T.rev_tree):_(ce(nt))}},e._doCompaction=function(d,_,b){var P=st(i,[Ze,Qe,rt,mt],"readwrite");if(P.error)return b(P.error);var A=P.txn;A.objectStore(Ze).get(d).onsuccess=function(q){var M=wt(q.target.result);_t(M.rev_tree,function(U,oe,se,H,z){-1!==_.indexOf(oe+"-"+se)&&(z.status="missing")}),Pr(_,d,A);var k=M.winningRev,N=M.deleted;A.objectStore(Ze).put(Sn(M,k,N))},A.onabort=ut(b),A.oncomplete=function(){b()}},e._getLocal=function(d,_){var b=st(i,[ot],"readonly");if(b.error)return _(b.error);var P=b.txn.objectStore(ot).get(d);P.onerror=ut(_),P.onsuccess=function(A){var T=A.target.result;T?(delete T._doc_id_rev,_(null,T)):_(ce(nt))}},e._putLocal=function(d,_,b){"function"==typeof _&&(b=_,_={}),delete d._revisions;var S=d._rev,P=d._id;d._rev=S?"0-"+(parseInt(S.split("-")[1],10)+1):"0-1";var T,A=_.ctx;if(!A){var q=st(i,[ot],"readwrite");if(q.error)return b(q.error);(A=q.txn).onerror=ut(b),A.oncomplete=function(){T&&b(null,T)}}var k,M=A.objectStore(ot);S?(k=M.get(P)).onsuccess=function(N){var U=N.target.result;U&&U._rev===S?M.put(d).onsuccess=function(){T={ok:!0,id:d._id,rev:d._rev},_.ctx&&b(null,T)}:b(ce(Et))}:((k=M.add(d)).onerror=function(N){b(ce(Et)),N.preventDefault(),N.stopPropagation()},k.onsuccess=function(){T={ok:!0,id:d._id,rev:d._rev},_.ctx&&b(null,T)})},e._removeLocal=function(d,_,b){"function"==typeof _&&(b=_,_={});var S=_.ctx;if(!S){var P=st(i,[ot],"readwrite");if(P.error)return b(P.error);(S=P.txn).oncomplete=function(){A&&b(null,A)}}var A,T=d._id,q=S.objectStore(ot),M=q.get(T);M.onerror=ut(b),M.onsuccess=function(k){var N=k.target.result;N&&N._rev===d._rev?(q.delete(T),A={ok:!0,id:T,rev:"0-0"},_.ctx&&b(null,A)):b(ce(nt))}},e._destroy=function(d,_){qt.removeAllListeners(r);var b=Cn.get(r);b&&b.result&&(b.result.close(),Pt.delete(r));var S=indexedDB.deleteDatabase(r);S.onsuccess=function(){Cn.delete(r),jt()&&r in localStorage&&delete localStorage[r],_(null,{ok:!0})},S.onerror=ut(_)};var m=Pt.get(r);if(m)return i=m.idb,e._meta=m.global,J()(function(){n(null,e)});var y=indexedDB.open(r,5);Cn.set(r,y),y.onupgradeneeded=function(d){var _=d.target.result;if(d.oldVersion<1)return function u(d){var _=d.createObjectStore(Ze,{keyPath:"id"});d.createObjectStore(Qe,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),d.createObjectStore(rt,{keyPath:"digest"}),d.createObjectStore(Ye,{keyPath:"id",autoIncrement:!1}),d.createObjectStore(xn),_.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),d.createObjectStore(ot,{keyPath:"_id"});var b=d.createObjectStore(mt,{autoIncrement:!0});b.createIndex("seq","seq"),b.createIndex("digestSeq","digestSeq",{unique:!0})}(_);var b=d.currentTarget.transaction;d.oldVersion<3&&function w(d){d.createObjectStore(ot,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}(_),d.oldVersion<4&&function O(d){var _=d.createObjectStore(mt,{autoIncrement:!0});_.createIndex("seq","seq"),_.createIndex("digestSeq","digestSeq",{unique:!0})}(_);var S=[l,x,B,g],P=d.oldVersion;!function A(){var T=S[P-1];P++,T&&T(b,A)}()},y.onsuccess=function(d){(i=d.target.result).onversionchange=function(){i.close(),Pt.delete(r)},i.onabort=function(k){tt("error","Database has a global failure",k.target.error),s=k.target.error,i.close(),Pt.delete(r)};var S,P,A,T,_=i.transaction([Ye,xn,Ze],"readwrite"),b=!1;function q(){typeof A>"u"||!b||(e._meta={name:r,instanceId:T,blobSupport:A},Pt.set(r,{idb:i,global:e._meta}),n(null,e))}function M(){if(!(typeof P>"u"||typeof S>"u")){var k=r+"_id";k in S?T=S[k]:S[k]=T=Kt(),S.docCount=P,_.objectStore(Ye).put(S)}}_.objectStore(Ye).get(Ye).onsuccess=function(k){S=k.target.result||{id:Ye},M()},function na(e,t){e.objectStore(Ze).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(r){t(r.target.result)}}(_,function(k){P=k,M()}),On||(On=function ta(e){return new Promise(function(t){var n=un([""]),r=e.objectStore(xn).put(n,"key");r.onsuccess=function(){var i=navigator.userAgent.match(/Chrome\/(\d+)/),s=navigator.userAgent.match(/Edge\//);t(s||!i||parseInt(i[1],10)>=43)},r.onerror=e.onabort=function(i){i.preventDefault(),i.stopPropagation(),t(!1)}}).catch(function(){return!1})}(_)),On.then(function(k){A=k,q()}),_.oncomplete=function(){b=!0,q()},_.onabort=ut(n)},y.onerror=function(d){var _=d.target.error&&d.target.error.message;_?-1!==_.indexOf("stored database is a higher version")&&(_=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):_="Failed to open indexedDB, are you in private browsing mode?",tt("error",_),n(ce(nn,_))}}(n,e,r)},t,n.constructor)}Lr.valid=function(){try{return typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}};let Pn={};function Tn(e){let t=e.doc||e.ok,n=t&&t._attachments;n&&Object.keys(n).forEach(function(r){let i=n[r];i.data=fn(i.data,i.content_type)})}function bt(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):/^_local/.test(e)?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function Rr(e){return e._attachments&&Object.keys(e._attachments)?Promise.all(Object.keys(e._attachments).map(function(t){let n=e._attachments[t];if(n.data&&"string"!=typeof n.data)return new Promise(function(r){ln(n.data,r)}).then(function(r){n.data=r})})):Promise.resolve()}function Je(e,t){return Wt(e,e.db+"/"+t)}function Wt(e,t){return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+(e.path?"/":"")+t}function Zt(e){return"?"+Object.keys(e).map(function(t){return t+"="+encodeURIComponent(e[t])}).join("&")}function Bn(e,t){let n=this,r=function ha(e,t){if(function da(e){if(!e.prefix)return!1;let t=Xn(e.prefix).protocol;return"http"===t||"https"===t}(t)){let i=t.name.substr(t.prefix.length);e=t.prefix.replace(/\/?$/,"/")+encodeURIComponent(i)}let n=Xn(e);(n.user||n.password)&&(n.auth={username:n.user,password:n.password});let r=n.path.replace(/(^\/|\/$)/g,"").split("/");return n.db=r.pop(),-1===n.db.indexOf("%")&&(n.db=encodeURIComponent(n.db)),n.path=r.join("/"),n}(e.name,e),i=Je(r,"");e=Oe(e);const s=function(){var g=(0,I.Z)(function*(m,y){if((y=y||{}).headers=y.headers||new Ot,y.credentials="include",e.auth||r.auth){let b=e.auth||r.auth,P=Bt(unescape(encodeURIComponent(b.username+":"+b.password)));y.headers.set("Authorization","Basic "+P)}let d=e.headers||{};return Object.keys(d).forEach(function(b){y.headers.append(b,d[b])}),function va(e){let t=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=-1!==t.indexOf("msie"),r=-1!==t.indexOf("trident"),i=-1!==t.indexOf("edge");return(n||r||i)&&(!("method"in e)||"GET"===e.method)}(y)&&(m+=(-1===m.indexOf("?")?"?":"&")+"_nonce="+Date.now()),yield(e.fetch||vr)(m,y)});return function(y,d){return g.apply(this,arguments)}}();function a(g,m){return Fe(g,function(...y){x().then(function(){return m.apply(this,y)}).catch(function(d){y.pop()(d)})}).bind(n)}function u(g,m){return l.apply(this,arguments)}function l(){return(l=(0,I.Z)(function*(g,m){let y={};(m=m||{}).headers=m.headers||new Ot,m.headers.get("Content-Type")||m.headers.set("Content-Type","application/json"),m.headers.get("Accept")||m.headers.set("Accept","application/json");const d=yield s(g,m);y.ok=d.ok,y.status=d.status;const _=yield d.json();if(y.data=_,!y.ok)throw y.data.status=y.status,Dt(y.data);return Array.isArray(y.data)&&(y.data=y.data.map(function(b){return b.error||b.missing?Dt(b):b})),y})).apply(this,arguments)}let w;function x(){return O.apply(this,arguments)}function O(){return(O=(0,I.Z)(function*(){return e.skip_setup?Promise.resolve():w||(w=u(i).catch(function(g){return g&&g.status&&404===g.status?(Yt(404,"PouchDB is just detecting if the remote exists."),u(i,{method:"PUT"})):Promise.reject(g)}).catch(function(g){return!(!g||!g.status||412!==g.status)||Promise.reject(g)}),w.catch(function(){w=null}),w)})).apply(this,arguments)}function B(g){return g.split("/").map(encodeURIComponent).join("/")}J()(function(){t(null,n)}),n._remote=!0,n.type=function(){return"http"},n.id=a("id",function(){var g=(0,I.Z)(function*(m){let y;try{y=yield(yield s(Wt(r,""))).json()}catch{y={}}m(null,y&&y.uuid?y.uuid+r.db:Je(r,""))});return function(m){return g.apply(this,arguments)}}()),n.compact=a("compact",function(){var g=(0,I.Z)(function*(m,y){"function"==typeof m&&(y=m,m={}),m=Oe(m),yield u(Je(r,"_compact"),{method:"POST"}),function d(){n.info(function(_,b){b&&!b.compact_running?y(null,{ok:!0}):setTimeout(d,m.interval||200)})}()});return function(m,y){return g.apply(this,arguments)}}()),n.bulkGet=Fe("bulkGet",function(g,m){let y=this;function d(A){return _.apply(this,arguments)}function _(){return(_=(0,I.Z)(function*(A){let T={};g.revs&&(T.revs=!0),g.attachments&&(T.attachments=!0),g.latest&&(T.latest=!0);try{const q=yield u(Je(r,"_bulk_get"+Zt(T)),{method:"POST",body:JSON.stringify({docs:g.docs})});g.attachments&&g.binary&&q.data.results.forEach(function(M){M.docs.forEach(Tn)}),A(null,q.data)}catch(q){A(q)}})).apply(this,arguments)}function b(){let T=Math.ceil(g.docs.length/50),q=0,M=new Array(T);function k(N){return function(U,oe){M[N]=oe.results,++q===T&&m(null,{results:Mt(M)})}}for(let N=0;N<T;N++){let U=Tt(g,["revs","attachments","binary","latest"]);U.docs=g.docs.slice(50*N,Math.min(g.docs.length,50*(N+1))),Gn(y,U,k(N))}}let S=Wt(r,""),P=Pn[S];"boolean"!=typeof P?d(function(A,T){A?(Pn[S]=!1,Yt(A.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),b()):(Pn[S]=!0,m(null,T))}):P?d(m):b()}),n._info=function(){var g=(0,I.Z)(function*(m){try{yield x();const d=yield(yield s(Je(r,""))).json();d.host=Je(r,""),m(null,d)}catch(y){m(y)}});return function(m){return g.apply(this,arguments)}}(),n.fetch=function(){var g=(0,I.Z)(function*(m,y){yield x();const d="/"===m.substring(0,1)?Wt(r,m.substring(1)):Je(r,m);return s(d,y)});return function(m,y){return g.apply(this,arguments)}}(),n.get=a("get",function(){var g=(0,I.Z)(function*(m,y,d){"function"==typeof y&&(d=y,y={});let _={};function b(A){let T=A._attachments,q=T&&Object.keys(T);if(!T||!q.length)return;function k(){return(k=(0,I.Z)(function*(U){const oe=T[U],se=bt(A._id)+"/"+B(U)+"?rev="+A._rev,H=yield s(Je(r,se));let z,X;if(z="buffer"in H?yield H.buffer():yield H.blob(),y.binary){let V=Object.getOwnPropertyDescriptor(z.__proto__,"type");(!V||V.set)&&(z.type=oe.content_type),X=z}else X=yield new Promise(function(V){ln(z,V)});delete oe.stub,delete oe.length,oe.data=X})).apply(this,arguments)}let N=q.map(function(U){return function(){return function M(U){return k.apply(this,arguments)}(U)}});return function ua(e,t){return new Promise(function(n,r){var l,i=0,s=0,a=0,u=e.length;function x(){++a===u?l?r(l):n():g()}function O(){i--,x()}function B(m){i--,l=l||m,x()}function g(){for(;i<t&&s<u;)i++,e[s++]().then(O,B)}g()})}(N,5)}(y=Oe(y)).revs&&(_.revs=!0),y.revs_info&&(_.revs_info=!0),y.latest&&(_.latest=!0),y.open_revs&&("all"!==y.open_revs&&(y.open_revs=JSON.stringify(y.open_revs)),_.open_revs=y.open_revs),y.rev&&(_.rev=y.rev),y.conflicts&&(_.conflicts=y.conflicts),y.update_seq&&(_.update_seq=y.update_seq),m=bt(m);const P=Je(r,m+Zt(_));try{const A=yield u(P);y.attachments&&(yield function S(A){return Array.isArray(A)?Promise.all(A.map(function(T){if(T.ok)return b(T.ok)})):b(A)}(A.data)),d(null,A.data)}catch(A){A.docId=m,d(A)}});return function(m,y,d){return g.apply(this,arguments)}}()),n.remove=a("remove",function(){var g=(0,I.Z)(function*(m,y,d,_){let b;"string"==typeof y?(b={_id:m,_rev:y},"function"==typeof d&&(_=d,d={})):(b=m,"function"==typeof y?(_=y,d={}):(_=d,d=y));const S=b._rev||d.rev,P=Je(r,bt(b._id))+"?rev="+S;try{_(null,(yield u(P,{method:"DELETE"})).data)}catch(A){_(A)}});return function(m,y,d,_){return g.apply(this,arguments)}}()),n.getAttachment=a("getAttachment",function(){var g=(0,I.Z)(function*(m,y,d,_){"function"==typeof d&&(_=d,d={});const b=d.rev?"?rev="+d.rev:"",S=Je(r,bt(m))+"/"+B(y)+b;let P;try{const T=yield s(S,{method:"GET"});if(!T.ok)throw T;let q;if(P=T.headers.get("content-type"),q=typeof process<"u"&&!process.browser&&"function"==typeof T.buffer?yield T.buffer():yield T.blob(),typeof process<"u"&&!process.browser){var A=Object.getOwnPropertyDescriptor(q.__proto__,"type");(!A||A.set)&&(q.type=P)}_(null,q)}catch(T){_(T)}});return function(m,y,d,_){return g.apply(this,arguments)}}()),n.removeAttachment=a("removeAttachment",function(){var g=(0,I.Z)(function*(m,y,d,_){const b=Je(r,bt(m)+"/"+B(y))+"?rev="+d;try{_(null,(yield u(b,{method:"DELETE"})).data)}catch(S){_(S)}});return function(m,y,d,_){return g.apply(this,arguments)}}()),n.putAttachment=a("putAttachment",function(){var g=(0,I.Z)(function*(m,y,d,_,b,S){"function"==typeof b&&(S=b,b=_,_=d,d=null);const P=bt(m)+"/"+B(y);let A=Je(r,P);if(d&&(A+="?rev="+d),"string"==typeof _){let T;try{T=on(_)}catch{return S(ce(Zn,"Attachment is not a valid base64 string"))}_=T?cn(T,b):""}try{S(null,(yield u(A,{headers:new Ot({"Content-Type":b}),method:"PUT",body:_})).data)}catch(T){S(T)}});return function(m,y,d,_,b,S){return g.apply(this,arguments)}}()),n._bulkDocs=function(){var g=(0,I.Z)(function*(m,y,d){m.new_edits=y.new_edits;try{yield x(),yield Promise.all(m.docs.map(Rr)),d(null,(yield u(Je(r,"_bulk_docs"),{method:"POST",body:JSON.stringify(m)})).data)}catch(_){d(_)}});return function(m,y,d){return g.apply(this,arguments)}}(),n._put=function(){var g=(0,I.Z)(function*(m,y,d){try{yield x(),yield Rr(m),d(null,(yield u(Je(r,bt(m._id)),{method:"PUT",body:JSON.stringify(m)})).data)}catch(_){_.docId=m&&m._id,d(_)}});return function(m,y,d){return g.apply(this,arguments)}}(),n.allDocs=a("allDocs",function(){var g=(0,I.Z)(function*(m,y){"function"==typeof m&&(y=m,m={});let _,d={},b="GET";(m=Oe(m)).conflicts&&(d.conflicts=!0),m.update_seq&&(d.update_seq=!0),m.descending&&(d.descending=!0),m.include_docs&&(d.include_docs=!0),m.attachments&&(d.attachments=!0),m.key&&(d.key=JSON.stringify(m.key)),m.start_key&&(m.startkey=m.start_key),m.startkey&&(d.startkey=JSON.stringify(m.startkey)),m.end_key&&(m.endkey=m.end_key),m.endkey&&(d.endkey=JSON.stringify(m.endkey)),typeof m.inclusive_end<"u"&&(d.inclusive_end=!!m.inclusive_end),typeof m.limit<"u"&&(d.limit=m.limit),typeof m.skip<"u"&&(d.skip=m.skip);let S=Zt(d);typeof m.keys<"u"&&(b="POST",_={keys:m.keys});try{const P=yield u(Je(r,"_all_docs"+S),{method:b,body:JSON.stringify(_)});m.include_docs&&m.attachments&&m.binary&&P.data.rows.forEach(Tn),y(null,P.data)}catch(P){y(P)}});return function(m,y){return g.apply(this,arguments)}}()),n._changes=function(g){let m="batch_size"in g?g.batch_size:25;(g=Oe(g)).continuous&&!("heartbeat"in g)&&(g.heartbeat=1e4);let y="timeout"in g?g.timeout:3e4;"timeout"in g&&g.timeout&&y-g.timeout<5e3&&(y=g.timeout+5e3),"heartbeat"in g&&g.heartbeat&&y-g.heartbeat<5e3&&(y=g.heartbeat+5e3);let d={};"timeout"in g&&g.timeout&&(d.timeout=g.timeout);let _=typeof g.limit<"u"&&g.limit,b=_;if(g.style&&(d.style=g.style),(g.include_docs||g.filter&&"function"==typeof g.filter)&&(d.include_docs=!0),g.attachments&&(d.attachments=!0),g.continuous&&(d.feed="longpoll"),g.seq_interval&&(d.seq_interval=g.seq_interval),g.conflicts&&(d.conflicts=!0),g.descending&&(d.descending=!0),g.update_seq&&(d.update_seq=!0),"heartbeat"in g&&g.heartbeat&&(d.heartbeat=g.heartbeat),g.filter&&"string"==typeof g.filter&&(d.filter=g.filter),g.view&&"string"==typeof g.view&&(d.filter="_view",d.view=g.view),g.query_params&&"object"==typeof g.query_params)for(let N in g.query_params)Object.prototype.hasOwnProperty.call(g.query_params,N)&&(d[N]=g.query_params[N]);let P,S="GET";g.doc_ids?(d.filter="_doc_ids",S="POST",P={doc_ids:g.doc_ids}):g.selector&&(d.filter="_selector",S="POST",P={selector:g.selector});let T,A=new Vi;const q=function(){var N=(0,I.Z)(function*(U,oe){if(g.aborted)return;d.since=U,"object"==typeof d.since&&(d.since=JSON.stringify(d.since)),g.descending?_&&(d.limit=b):d.limit=!_||b>m?m:b;let se=Je(r,"_changes"+Zt(d)),H={signal:A.signal,method:S,body:JSON.stringify(P)};if(T=U,!g.aborted)try{yield x(),oe(null,(yield u(se,H)).data)}catch(z){oe(z)}});return function(oe,se){return N.apply(this,arguments)}}();let M={results:[]};const k=function(N,U){if(g.aborted)return;let oe=0;if(U&&U.results){oe=U.results.length,M.last_seq=U.last_seq;let H=null,z=null;"number"==typeof U.pending&&(H=U.pending),("string"==typeof M.last_seq||"number"==typeof M.last_seq)&&(z=M.last_seq),U.results=U.results.filter(function(V){b--;let le=rn(g)(V);return le&&(g.include_docs&&g.attachments&&g.binary&&Tn(V),g.return_docs&&M.results.push(V),g.onChange(V,H,z)),le})}else if(N)return g.aborted=!0,void g.complete(N);U&&U.last_seq&&(T=U.last_seq),(!g.continuous||_&&b<=0)&&(_&&b<=0||U&&oe<m||g.descending)?g.complete(null,M):J()(function(){q(T,k)})};return q(g.since||0,k),{cancel:function(){g.aborted=!0,A.abort()}}},n.revsDiff=a("revsDiff",function(){var g=(0,I.Z)(function*(m,y,d){"function"==typeof y&&(d=y,y={});try{d(null,(yield u(Je(r,"_revs_diff"),{method:"POST",body:JSON.stringify(m)})).data)}catch(_){d(_)}});return function(m,y,d){return g.apply(this,arguments)}}()),n._close=function(g){g()},n._destroy=function(){var g=(0,I.Z)(function*(m,y){try{y(null,yield u(Je(r,""),{method:"DELETE"}))}catch(d){404===d.status?y(null,{ok:!0}):y(d)}});return function(m,y){return g.apply(this,arguments)}}()}Bn.valid=function(){return!0};class xt extends Error{constructor(t){super(),this.status=400,this.name="query_parse_error",this.message=t,this.error=!0;try{Error.captureStackTrace(this,xt)}catch{}}}class Jt extends Error{constructor(t){super(),this.status=404,this.name="not_found",this.message=t,this.error=!0;try{Error.captureStackTrace(this,Jt)}catch{}}}class zt extends Error{constructor(t){super(),this.status=500,this.name="invalid_value",this.message=t,this.error=!0;try{Error.captureStackTrace(this,zt)}catch{}}}function qr(e,t){return t&&e.then(function(n){J()(function(){t(null,n)})},function(n){J()(function(){t(n)})}),e}function pa(e,t){return e.then(function(n){return t().then(function(){return n})},function(n){return t().then(function(){throw n})})}function Ln(e,t){return function(){var n=arguments,r=this;return e.add(function(){return t.apply(r,n)})}}function kr(e){var t=new R(e),n=new Array(t.size),r=-1;return t.forEach(function(i){n[++r]=i}),n}function Rn(e){var t=new Array(e.size),n=-1;return e.forEach(function(r,i){t[++n]=i}),t}function Ir(e){return new zt("builtin "+e+" function requires map values to be numbers or number arrays")}function qn(e){for(var t=0,n=0,r=e.length;n<r;n++){var i=e[n];if("number"!=typeof i){if(!Array.isArray(i))throw Ir("_sum");t="number"==typeof t?[t]:t;for(var s=0,a=i.length;s<a;s++){var u=i[s];if("number"!=typeof u)throw Ir("_sum");typeof t[s]>"u"?t.push(u):t[s]+=u}}else"number"==typeof t?t+=i:t[0]+=i}return t}var ya=tt.bind(null,"log"),ma=Array.isArray,wa=JSON.parse;function jr(e,t){return an("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:qn,log:ya,isArray:ma,toJSON:wa})}class kn{constructor(){this.promise=new Promise(function(t){t()})}add(t){return this.promise=this.promise.catch(function(){}).then(function(){return t()}),this.promise}finish(){return this.promise}}function $r(e){if(!e)return"undefined";switch(typeof e){case"function":case"string":return e.toString();default:return JSON.stringify(e)}}function ba(e,t){return $r(e)+$r(t)+"undefined"}function Mr(e,t,n,r,i,s){return In.apply(this,arguments)}function In(){return In=(0,I.Z)(function*(e,t,n,r,i,s){const a=ba(n,r);let u;if(!i&&(u=e._cachedViews=e._cachedViews||{},u[a]))return u[a];const l=e.info().then(function(){var w=(0,I.Z)(function*(x){const O=x.db_name+"-mrview-"+(i?"temp":nr(a));yield Ut(e,"_local/"+s,function B(_){_.views=_.views||{};let b=t;-1===b.indexOf("/")&&(b=t+"/"+t);const S=_.views[b]=_.views[b]||{};if(!S[O])return S[O]=!0,_});const m=(yield e.registerDependentDatabase(O)).db;m.auto_compaction=!0;const y={name:O,db:m,sourceDB:e,adapter:e.adapter,mapFun:n,reduceFun:r};let d;try{d=yield y.db.get("_local/lastSeq")}catch(_){if(404!==_.status)throw _}return y.seq=d?d.seq:0,u&&y.db.once("destroyed",function(){delete u[a]}),y});return function(x){return w.apply(this,arguments)}}());return u&&(u[a]=l),l}),In.apply(this,arguments)}var Ur={},Kr=new kn;function jn(e){return-1===e.indexOf("/")?[e,e]:e.split("/")}function Sa(e){return 1===e.length&&/^1-/.test(e[0].rev)}function Nr(e,t,n){try{e.emit("error",t)}catch{tt("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),tt("error",t,n)}}var $n__sum=function(e,t){return qn(t)},$n__count=function(e,t){return t.length},$n__stats=function(e,t){return{sum:qn(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:function n(r){for(var i=0,s=0,a=r.length;s<a;s++){var u=r[s];i+=u*u}return i}(t)}},Fr=function Aa(e,t,n,r){function i(h,p,E){try{p(E)}catch(L){Nr(h,L,{fun:p,doc:E})}}function s(h,p,E,L,F){try{return{output:p(E,L,F)}}catch(te){return Nr(h,te,{fun:p,keys:E,values:L,rereduce:F}),{error:te}}}function a(h,p){const E=Ge(h.key,p.key);return 0!==E?E:Ge(h.value,p.value)}function u(h,p,E){return E=E||0,"number"==typeof p?h.slice(E,p+E):E>0?h.slice(E):h}function l(h){const p=h.value;return p&&"object"==typeof p&&p._id||h.id}function x(h){return function(p){return h.include_docs&&h.attachments&&h.binary&&function w(h){h.rows.forEach(function(p){const E=p.doc&&p.doc._attachments;E&&Object.keys(E).forEach(function(L){const F=E[L];E[L].data=fn(F.data,F.content_type)})})}(p),p}}function O(h,p,E,L){let F=p[h];typeof F<"u"&&(L&&(F=encodeURIComponent(JSON.stringify(F))),E.push(h+"="+F))}function B(h){if(typeof h<"u"){const p=Number(h);return isNaN(p)||p!==parseInt(h,10)?h:p}}function y(h,p){const E=h.descending?"endkey":"startkey",L=h.descending?"startkey":"endkey";if(typeof h[E]<"u"&&typeof h[L]<"u"&&Ge(h[E],h[L])>0)throw new xt("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(p.reduce&&!1!==h.reduce){if(h.include_docs)throw new xt("{include_docs:true} is invalid for reduce");if(h.keys&&h.keys.length>1&&!h.group&&!h.group_level)throw new xt("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(F){const te=function m(h){if(h){if("number"!=typeof h)return new xt(`Invalid value for integer: "${h}"`);if(h<0)return new xt(`Invalid value for positive integer: "${h}"`)}}(h[F]);if(te)throw te})}function d(h,p,E){return _.apply(this,arguments)}function _(){return(_=(0,I.Z)(function*(h,p,E){let F,ve,L=[],te="GET";if(O("reduce",E,L),O("include_docs",E,L),O("attachments",E,L),O("limit",E,L),O("descending",E,L),O("group",E,L),O("group_level",E,L),O("skip",E,L),O("stale",E,L),O("conflicts",E,L),O("startkey",E,L,!0),O("start_key",E,L,!0),O("endkey",E,L,!0),O("end_key",E,L,!0),O("inclusive_end",E,L),O("key",E,L,!0),O("update_seq",E,L),L=L.join("&"),L=""===L?"":"?"+L,typeof E.keys<"u"){const re=`keys=${encodeURIComponent(JSON.stringify(E.keys))}`;re.length+L.length+1<=2e3?L+=("?"===L[0]?"&":"?")+re:(te="POST","string"==typeof p?F={keys:E.keys}:p.keys=E.keys)}if("string"==typeof p){const Z=jn(p),re=yield h.fetch("_design/"+Z[0]+"/_view/"+Z[1]+L,{headers:new Ot({"Content-Type":"application/json"}),method:te,body:JSON.stringify(F)});ve=re.ok;const pe=yield re.json();if(!ve)throw pe.status=re.status,Dt(pe);return pe.rows.forEach(function(Ce){if(Ce.value&&Ce.value.error&&"builtin_reduce_error"===Ce.value.error)throw new Error(Ce.reason)}),new Promise(function(Ce){Ce(pe)}).then(x(E))}F=F||{},Object.keys(p).forEach(function(Z){F[Z]=Array.isArray(p[Z])?p[Z]:p[Z].toString()});const ne=yield h.fetch("_temp_view"+L,{headers:new Ot({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(F)});ve=ne.ok;const ae=yield ne.json();if(!ve)throw ae.status=ne.status,Dt(ae);return new Promise(function(Z){Z(ae)}).then(x(E))})).apply(this,arguments)}function b(h,p,E){return new Promise(function(L,F){h._query(p,E,function(te,ve){if(te)return F(te);L(ve)})})}function P(h){return function(p){if(404===p.status)return h;throw p}}function T(){return(T=(0,I.Z)(function*(h,p,E){const L="_local/doc_"+h,F={_id:L,keys:[]},te=E.get(h),ve=te[0],ne=te[1],pe=yield function ae(){return Sa(ne)?Promise.resolve(F):p.db.get(L).catch(P(F))}();return function re(Re,$e){const dt=[],St=new R;for(let lt=0,xe=$e.rows.length;lt<xe;lt++){const Ae=$e.rows[lt].doc;if(Ae&&(dt.push(Ae),St.add(Ae._id),Ae._deleted=!ve.has(Ae._id),!Ae._deleted)){const et=ve.get(Ae._id);"value"in et&&(Ae.value=et.value)}}const Ht=Rn(ve);return Ht.forEach(function(lt){if(!St.has(lt)){const xe={_id:lt},qe=ve.get(lt);"value"in qe&&(xe.value=qe.value),dt.push(xe)}}),Re.keys=kr(Ht.concat(Re.keys)),dt.push(Re),dt}(pe,yield function Z(Re){return Re.keys.length?p.db.allDocs({keys:Re.keys,include_docs:!0}):Promise.resolve({rows:[]})}(pe))})).apply(this,arguments)}function M(h,p,E){var L="_local/lastSeq";return h.db.get(L).catch(P({_id:L,seq:0})).then(function(F){var te=Rn(p);return Promise.all(te.map(function(ve){return function A(h,p,E){return T.apply(this,arguments)}(ve,h,p)})).then(function(ve){var ne=Mt(ve);return F.seq=E,ne.push(F),h.db.bulkDocs({docs:ne})}).then(()=>function q(h){return h.sourceDB.get("_local/purges").then(function(p){const E=p.purgeSeq;return h.db.get("_local/purgeSeq").then(function(L){return L._rev}).catch(function(L){if(404!==L.status)throw L}).then(function(L){return h.db.put({_id:"_local/purgeSeq",_rev:L,purgeSeq:E})})}).catch(function(p){if(404!==p.status)throw p})}(h))})}function k(h){const p="string"==typeof h?h:h.name;let E=Ur[p];return E||(E=Ur[p]=new kn),E}function N(h,p){return U.apply(this,arguments)}function U(){return(U=(0,I.Z)(function*(h,p){return Ln(k(h),function(){return oe(h,p)})()})).apply(this,arguments)}function oe(h,p){return se.apply(this,arguments)}function se(){return se=(0,I.Z)(function*(h,p){let E,L,F;const ve=t(h.mapFun,function te(xe,qe){const Ae={id:L._id,key:pt(xe)};typeof qe<"u"&&null!==qe&&(Ae.value=pt(qe)),E.push(Ae)});let ne=h.seq||0,re=0;h.sourceDB.emit("indexing",{view:h.name,indexed_docs:re});const Ce=new kn;function Re(){return $e.apply(this,arguments)}function $e(){return($e=(0,I.Z)(function*(){return St(yield h.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:ne,limit:p.changes_batch_size}),yield dt())})).apply(this,arguments)}function dt(){return h.db.get("_local/purgeSeq").then(function(xe){return xe.purgeSeq}).catch(function(xe){if(xe&&404!==xe.status)throw xe;return-1}).then(function(xe){return h.sourceDB.get("_local/purges").then(function(qe){const Ae=qe.purges.filter(function(ze,Ue){return Ue>xe}).map(ze=>ze.docId),et=Ae.filter(function(ze,Ue){return Ae.indexOf(ze)===Ue});return Promise.all(et.map(function(ze){return h.sourceDB.get(ze).then(function(Ue){return{docId:ze,doc:Ue}}).catch(function(Ue){if(404!==Ue.status)throw Ue;return{docId:ze}})}))}).catch(function(qe){if(qe&&404!==qe.status)throw qe;return[]})})}function St(xe,qe){var Ae=xe.results;if(Ae.length||qe.length){for(let Ue of qe)if(Ae.findIndex(function(kt){return kt.id===Ue.docId})<0){const kt={_id:Ue.docId,doc:{_id:Ue.docId,_deleted:1},changes:[]};Ue.doc&&(kt.doc=Ue.doc,kt.changes.push({rev:Ue.doc._rev})),Ae.push(kt)}var et=function Ht(xe){const qe=new j;for(let Ae=0,et=xe.length;Ae<et;Ae++){const ze=xe[Ae];if("_"!==ze.doc._id[0]){E=[],L=ze.doc,L._deleted||i(h.sourceDB,ve,L),E.sort(a);const Ue=lt(E);qe.set(ze.doc._id,[Ue,ze.changes])}ne=ze.seq}return qe}(Ae);return Ce.add(function Z(xe,qe){return function(){return M(h,xe,qe)}}(et,ne)),re+=Ae.length,h.sourceDB.emit("indexing",{view:h.name,last_seq:xe.last_seq,results_count:Ae.length,indexed_docs:re}),h.sourceDB.activeTasks.update(F,{completed_items:re}),Ae.length<p.changes_batch_size?void 0:Re()}}function lt(xe){const qe=new j;let Ae;for(let et=0,ze=xe.length;et<ze;et++){const Ue=xe[et],Nn=[Ue.key,Ue.id];et>0&&0===Ge(Ue.key,Ae)&&Nn.push(et),qe.set(it(Nn),Ue),Ae=Ue.key}return qe}try{yield function ae(){return h.sourceDB.info().then(function(xe){F=h.sourceDB.activeTasks.add({name:"view_indexing",total_items:xe.update_seq-ne})})}(),yield Re(),yield Ce.finish(),h.seq=ne,h.sourceDB.activeTasks.remove(F)}catch(xe){h.sourceDB.activeTasks.remove(F,xe)}}),se.apply(this,arguments)}function H(h,p,E){0===E.group_level&&delete E.group_level;const L=E.group||E.group_level,F=n(h.reduceFun),te=[],ve=isNaN(E.group_level)?Number.POSITIVE_INFINITY:E.group_level;p.forEach(function(ne){const ae=te[te.length-1];let Z=L?ne.key:null;if(L&&Array.isArray(Z)&&(Z=Z.slice(0,ve)),ae&&0===Ge(ae.groupKey,Z))return ae.keys.push([ne.key,ne.id]),void ae.values.push(ne.value);te.push({keys:[[ne.key,ne.id]],values:[ne.value],groupKey:Z})}),p=[];for(let ne=0,ae=te.length;ne<ae;ne++){const Z=te[ne],re=s(h.sourceDB,F,Z.keys,Z.values,!1);if(re.error&&re.error instanceof zt)throw re.error;p.push({value:re.error?null:re.output,key:Z.groupKey})}return{rows:u(p,E.limit,E.skip)}}function z(h,p){return Ln(k(h),function(){return function X(h,p){return V.apply(this,arguments)}(h,p)})()}function V(){return V=(0,I.Z)(function*(h,p){let E;const L=h.reduceFun&&!1!==p.reduce,F=p.skip||0;function te(Z){return ve.apply(this,arguments)}function ve(){return(ve=(0,I.Z)(function*(Z){Z.include_docs=!0;const re=yield h.db.allDocs(Z);return E=re.total_rows,re.rows.map(function(pe){if("value"in pe.doc&&"object"==typeof pe.doc.value&&null!==pe.doc.value){const Re=Object.keys(pe.doc.value).sort(),$e=["id","key","value"];if(!(Re<$e||Re>$e))return pe.doc.value}const Ce=_s(pe.doc._id);return{key:Ce[0],id:Ce[1],value:"value"in pe.doc?pe.doc.value:null}})})).apply(this,arguments)}function ne(Z){return ae.apply(this,arguments)}function ae(){return(ae=(0,I.Z)(function*(Z){let re;if(re=L?H(h,Z,p):typeof p.keys>"u"?{total_rows:E,offset:F,rows:Z}:{total_rows:E,offset:F,rows:u(Z,p.limit,p.skip)},p.update_seq&&(re.update_seq=h.seq),p.include_docs){const Ce=kr(Z.map(l)),Re=yield h.sourceDB.allDocs({keys:Ce,include_docs:!0,conflicts:p.conflicts,attachments:p.attachments,binary:p.binary});var pe=new j;return Re.rows.forEach(function($e){pe.set($e.id,$e.doc)}),Z.forEach(function($e){var dt=l($e),St=pe.get(dt);St&&($e.doc=St)}),re}return re})).apply(this,arguments)}if(typeof p.keys<"u"&&!p.keys.length&&(p.limit=0,delete p.keys),typeof p.keys<"u"){const re=p.keys.map(function(Re){const $e={startkey:it([Re]),endkey:it([Re,{}])};return p.update_seq&&($e.update_seq=!0),te($e)});return ne(Mt(yield Promise.all(re)))}{const Z={descending:p.descending};let re,pe;if(p.update_seq&&(Z.update_seq=!0),"start_key"in p&&(re=p.start_key),"startkey"in p&&(re=p.startkey),"end_key"in p&&(pe=p.end_key),"endkey"in p&&(pe=p.endkey),typeof re<"u"&&(Z.startkey=it(p.descending?[re,{}]:[re])),typeof pe<"u"){let Re=!1!==p.inclusive_end;p.descending&&(Re=!Re),Z.endkey=it(Re?[pe,{}]:[pe])}if(typeof p.key<"u"){const Re=it([p.key]),$e=it([p.key,{}]);Z.descending?(Z.endkey=Re,Z.startkey=$e):(Z.startkey=Re,Z.endkey=$e)}return L||("number"==typeof p.limit&&(Z.limit=p.limit),Z.skip=F),ne(yield te(Z))}}),V.apply(this,arguments)}function Be(){return(Be=(0,I.Z)(function*(h){return(yield h.fetch("_view_cleanup",{headers:new Ot({"Content-Type":"application/json"}),method:"POST"})).json()})).apply(this,arguments)}function ee(){return(ee=(0,I.Z)(function*(h){try{const p=yield h.get("_local/"+e),E=new j;Object.keys(p.views).forEach(function(ae){const Z=jn(ae),re="_design/"+Z[0],pe=Z[1];let Ce=E.get(re);Ce||(Ce=new R,E.set(re,Ce)),Ce.add(pe)});const L={keys:Rn(E),include_docs:!0},F=yield h.allDocs(L),te={};F.rows.forEach(function(ae){const Z=ae.key.substring(8);E.get(ae.key).forEach(function(re){let pe=Z+"/"+re;p.views[pe]||(pe=re);const Ce=Object.keys(p.views[pe]),Re=ae.doc&&ae.doc.views&&ae.doc.views[re];Ce.forEach(function($e){te[$e]=te[$e]||Re})})});const ne=Object.keys(te).filter(function(ae){return!te[ae]}).map(function(ae){return Ln(k(ae),function(){return new h.constructor(ae,h.__opts).destroy()})()});return Promise.all(ne).then(function(){return{ok:!0}})}catch(p){if(404===p.status)return{ok:!0};throw p}})).apply(this,arguments)}function be(){return(be=(0,I.Z)(function*(h,p,E){if("function"==typeof h._query)return b(h,p,E);if(at(h))return d(h,p,E);const L={changes_batch_size:h.__opts.view_update_changes_batch_size||50};if("string"!=typeof p)return y(E,p),Kr.add((0,I.Z)(function*(){const F=yield Mr(h,"temp_view/temp_view",p.map,p.reduce,!0,e);return pa(N(F,L).then(function(){return z(F,E)}),function(){return F.db.destroy()})})),Kr.finish();{const F=p,te=jn(F),ve=te[0],ne=te[1],ae=yield h.get("_design/"+ve);if(!(p=ae.views&&ae.views[ne]))throw new Jt(`ddoc ${ae._id} has no view named ${ne}`);r(ae,ne),y(E,p);const Z=yield Mr(h,F,p.map,p.reduce,!1,e);return"ok"===E.stale||"update_after"===E.stale?("update_after"===E.stale&&J()(function(){N(Z,L)}),z(Z,E)):(yield N(Z,L),z(Z,E))}})).apply(this,arguments)}return{query:function je(h,p,E){const L=this;"function"==typeof p&&(E=p,p={}),p=p?function g(h){return h.group_level=B(h.group_level),h.limit=B(h.limit),h.skip=B(h.skip),h}(p):{},"function"==typeof h&&(h={map:h});const F=Promise.resolve().then(function(){return function he(h,p,E){return be.apply(this,arguments)}(L,h,p)});return qr(F,E),F},viewCleanup:function ga(e){return function(...t){var n=t.pop(),r=e.apply(this,t);return"function"==typeof n&&qr(r,n),r}}(function(){const h=this;return"function"==typeof h._viewCleanup?function S(h){return new Promise(function(p,E){h._viewCleanup(function(L,F){if(L)return E(L);p(F)})})}(h):at(h)?function le(h){return Be.apply(this,arguments)}(h):function Xe(h){return ee.apply(this,arguments)}(h)})}}("mrviews",function Da(e,t){if("function"==typeof e&&2===e.length){var n=e;return function(r){return n(r,t)}}return jr(e.toString(),t)},function Oa(e){var t=e.toString();return function Ea(e){if(/^_sum/.test(e))return $n__sum;if(/^_count/.test(e))return $n__count;if(/^_stats/.test(e))return $n__stats;if(/^_/.test(e))throw new Error(e+" is not a supported reduce function.")}(t)||jr(t)},function Ca(e,t){var n=e.views&&e.views[t];if("string"!=typeof n.map)throw new Jt("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+typeof n.map)}),La={query:function Ta(e,t,n){return Fr.query.call(this,e,t,n)},viewCleanup:function Ba(e){return Fr.viewCleanup.call(this,e)}};function Gr(e,t){var n=Object.keys(t._attachments);return Promise.all(n.map(function(r){return e.getAttachment(t._id,r,{rev:t._rev})}))}var Zr="pouchdb";function Mn(e,t,n,r,i){return e.get(t).catch(function(s){if(404===s.status)return("http"===e.adapter||"https"===e.adapter)&&Yt(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:t,history:[],replicator:Zr,version:1};throw s}).then(function(s){if(!i.cancelled&&s.last_seq!==n)return s.history=(s.history||[]).filter(function(a){return a.session_id!==r}),s.history.unshift({last_seq:n,session_id:r}),s.history=s.history.slice(0,5),s.version=1,s.replicator=Zr,s.session_id=r,s.last_seq=n,e.put(s).catch(function(a){if(409===a.status)return Mn(e,t,n,r,i);throw a})})}class Jr{constructor(t,n,r,i,s){this.src=t,this.target=n,this.id=r,this.returnValue=i,this.opts=s||{}}writeCheckpoint(t,n){var r=this;return this.updateTarget(t,n).then(function(){return r.updateSource(t,n)})}updateTarget(t,n){return this.opts.writeTargetCheckpoint?Mn(this.target,this.id,t,n,this.returnValue):Promise.resolve(!0)}updateSource(t,n){if(this.opts.writeSourceCheckpoint){var r=this;return Mn(this.src,this.id,t,n,this.returnValue).catch(function(i){if(Hr(i))return r.opts.writeSourceCheckpoint=!1,!0;throw i})}return Promise.resolve(!0)}getCheckpoint(){var t=this;return t.opts&&t.opts.writeSourceCheckpoint&&!t.opts.writeTargetCheckpoint?t.src.get(t.id).then(function(n){return n.last_seq||0}).catch(function(n){if(404!==n.status)throw n;return 0}):t.target.get(t.id).then(function(n){return t.opts&&t.opts.writeTargetCheckpoint&&!t.opts.writeSourceCheckpoint?n.last_seq||0:t.src.get(t.id).then(function(r){return n.version!==r.version?0:(i=n.version?n.version.toString():"undefined")in zr?zr[i](n,r):0;var i},function(r){if(404===r.status&&n.last_seq)return t.src.put({_id:t.id,last_seq:0}).then(function(){return 0},function(i){return Hr(i)?(t.opts.writeSourceCheckpoint=!1,n.last_seq):0});throw r})}).catch(function(n){if(404!==n.status)throw n;return 0})}}var zr={undefined:function(e,t){return 0===Ge(e.last_seq,t.last_seq)?t.last_seq:0},1:function(e,t){return function $a(e,t){return e.session_id===t.session_id?{last_seq:e.last_seq,history:e.history}:Qr(e.history,t.history)}(t,e).last_seq}};function Qr(e,t){var n=e[0],r=e.slice(1),i=t[0],s=t.slice(1);return n&&0!==t.length?Un(n.session_id,t)?{last_seq:n.last_seq,history:e}:Un(i.session_id,r)?{last_seq:i.last_seq,history:s}:Qr(r,s):{last_seq:0,history:[]}}function Un(e,t){var n=t[0],r=t.slice(1);return!(!e||0===t.length)&&(e===n.session_id||Un(e,r))}function Hr(e){return"number"==typeof e.status&&4===Math.floor(e.status/100)}function Vr(e,t,n,r,i){return this instanceof Jr?Vr:new Jr(e,t,n,r,i)}function Xr(e,t,n,r,i){var a,A,M,s=[],u={seq:0,changes:[],docs:[]},l=!1,w=!1,x=!1,O=0,B=0,g=n.continuous||n.live||!1,m=n.batch_size||100,y=n.batches_limit||10,d=n.style||"all_docs",_=!1,b=n.doc_ids,S=n.selector,T=[],q=Kt();i=i||{ok:!0,start_time:(new Date).toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var k={};function N(){return A?Promise.resolve():function Ka(e,t,n){var r=n.doc_ids?n.doc_ids.sort(Ge):"",i=n.filter?n.filter.toString():"",s="",a="",u="";return n.selector&&(u=JSON.stringify(n.selector)),n.filter&&n.query_params&&(s=JSON.stringify(function Ua(e){return Object.keys(e).sort(Ge).reduce(function(t,n){return t[n]=e[n],t},{})}(n.query_params))),n.filter&&"_view"===n.filter&&(a=n.view.toString()),Promise.all([e.id(),t.id()]).then(function(l){var w=l[0]+l[1]+i+a+s+r+u;return new Promise(function(x){dn(w,x)})}).then(function(l){return"_local/"+l.replace(/\//g,".").replace(/\+/g,"_")})}(e,t,n).then(function(h){A=new Vr(e,t,h,r,!1===n.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===n.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===n.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0})})}function U(){if(T=[],0!==a.docs.length){var h=a.docs;return t.bulkDocs({docs:h,new_edits:!1},{timeout:n.timeout}).then(function(E){if(r.cancelled)throw le(),new Error("cancelled");var L=Object.create(null);E.forEach(function(te){te.error&&(L[te.id]=te)});var F=Object.keys(L).length;i.doc_write_failures+=F,i.docs_written+=h.length-F,h.forEach(function(te){var ve=L[te._id];if(ve){i.errors.push(ve);var ne=(ve.name||"").toLowerCase();if("unauthorized"!==ne&&"forbidden"!==ne)throw ve;r.emit("denied",Oe(ve))}else T.push(te)})},function(E){throw i.doc_write_failures+=h.length,E})}}function oe(){if(a.error)throw new Error("There was a problem getting docs.");i.last_seq=B=a.seq;var h=Oe(i);return T.length&&(h.docs=T,"number"==typeof a.pending&&(h.pending=a.pending,delete a.pending),r.emit("change",h)),l=!0,e.info().then(function(p){var E=e.activeTasks.get(M);if(a&&E){var L=E.completed_items||0,F=parseInt(p.update_seq,10)-parseInt(O,10);e.activeTasks.update(M,{completed_items:L+a.changes.length,total_items:F})}}),A.writeCheckpoint(a.seq,q).then(function(){if(r.emit("checkpoint",{checkpoint:a.seq}),l=!1,r.cancelled)throw le(),new Error("cancelled");a=void 0,he()}).catch(function(p){throw Le(p),p})}function H(){return function Ia(e,t,n,r){n=Oe(n);var i=[],s=!0;return Promise.resolve().then(function a(){var l=function ka(e){var t=[];return Object.keys(e).forEach(function(n){e[n].missing.forEach(function(i){t.push({id:n,rev:i})})}),{docs:t,revs:!0,latest:!0}}(n);if(l.docs.length)return e.bulkGet(l).then(function(w){if(r.cancelled)throw new Error("cancelled");return Promise.all(w.results.map(function(x){return Promise.all(x.docs.map(function(O){var B=O.ok;return O.error&&(s=!1),B&&B._attachments?function qa(e,t,n){var r=at(t)&&!at(e),i=Object.keys(n._attachments);return r?e.get(n._id).then(function(s){return Promise.all(i.map(function(a){return function Ra(e,t,n){return!e._attachments||!e._attachments[n]||e._attachments[n].digest!==t._attachments[n].digest}(s,n,a)?t.getAttachment(n._id,a):e.getAttachment(s._id,a)}))}).catch(function(s){if(404!==s.status)throw s;return Gr(t,n)}):Gr(t,n)}(t,e,B).then(function(g){var m=Object.keys(B._attachments);return g.forEach(function(y,d){var _=B._attachments[m[d]];delete _.stub,delete _.length,_.data=y}),B}):B}))})).then(function(x){i=i.concat(Mt(x).filter(Boolean))})})}).then(function u(){return{ok:s,docs:i}})}(e,t,a.diffs,r).then(function(h){a.error=!h.ok,h.docs.forEach(function(p){delete a.diffs[p._id],i.docs_read++,a.docs.push(p)})})}function z(){if(!r.cancelled&&!a){if(0===s.length)return void X(!0);a=s.shift(),r.emit("checkpoint",{start_next_batch:a.seq}),function se(){var h={};return a.changes.forEach(function(p){r.emit("checkpoint",{revs_diff:p}),"_user/"!==p.id&&(h[p.id]=p.changes.map(function(E){return E.rev}))}),t.revsDiff(h).then(function(p){if(r.cancelled)throw le(),new Error("cancelled");a.diffs=p})}().then(H).then(U).then(oe).then(z).catch(function(h){V("batch processing terminated with error",h)})}}function X(h){0!==u.changes.length?(h||w||u.changes.length>=m)&&(s.push(u),u={seq:0,changes:[],docs:[]},("pending"===r.state||"stopped"===r.state)&&(r.state="active",r.emit("active")),z()):0===s.length&&!a&&((g&&k.live||w)&&(r.state="pending",r.emit("paused")),w&&le())}function V(h,p){x||(p.message||(p.message=h),i.ok=!1,i.status="aborting",s=[],u={seq:0,changes:[],docs:[]},le(p))}function le(h){if(!(x||r.cancelled&&(i.status="cancelled",l)))if(i.status=i.status||"complete",i.end_time=(new Date).toISOString(),i.last_seq=B,x=!0,e.activeTasks.remove(M,h),h){(h=ce(h)).result=i;var p=(h.name||"").toLowerCase();"unauthorized"===p||"forbidden"===p?(r.emit("error",h),r.removeAllListeners()):function Ma(e,t,n,r){if(!1===e.retry)return t.emit("error",n),void t.removeAllListeners();if("function"!=typeof e.back_off_function&&(e.back_off_function=oi),t.emit("requestError",n),"active"===t.state||"pending"===t.state){t.emit("paused",n),t.state="stopped";var i=function(){e.current_back_off=0};t.once("paused",function(){t.removeListener("active",i)}),t.once("active",i)}e.current_back_off=e.current_back_off||0,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(r,e.current_back_off)}(n,r,h,function(){Xr(e,t,n,r)})}else r.emit("complete",i),r.removeAllListeners()}function Be(h,p,E){if(r.cancelled)return le();if("number"==typeof p&&(u.pending=p),rn(n)(h))u.seq=h.seq||E,u.changes.push(h),r.emit("checkpoint",{pending_batch:u.seq}),J()(function(){X(0===s.length&&k.live)});else{var F=e.activeTasks.get(M);if(F){var te=F.completed_items||0;e.activeTasks.update(M,{completed_items:++te})}}}function Xe(h){if(_=!1,r.cancelled)return le();if(h.results.length>0)k.since=h.results[h.results.length-1].seq,he(),X(!0);else{var p=function(){g?(k.live=!0,he()):w=!0,X(!0)};a||0!==h.results.length?p():(l=!0,A.writeCheckpoint(h.last_seq,q).then(function(){if(l=!1,i.last_seq=B=h.last_seq,r.cancelled)throw le(),new Error("cancelled");p()}).catch(Le))}}function ee(h){if(_=!1,r.cancelled)return le();V("changes rejected",h)}function he(){if(!_&&!w&&s.length<y){_=!0,r._changes&&(r.removeListener("cancel",r._abortChanges),r._changes.cancel()),r.once("cancel",h);var E=e.changes(k).on("change",Be);E.then(p,p),E.then(Xe).catch(ee),n.retry&&(r._changes=E,r._abortChanges=h)}function h(){E.cancel()}function p(){r.removeListener("cancel",h)}}function be(h){return e.info().then(function(p){var E=typeof n.since>"u"?parseInt(p.update_seq,10)-parseInt(h,10):parseInt(p.update_seq,10);return M=e.activeTasks.add({name:`${g?"continuous ":""}replication from ${p.db_name}`,total_items:E}),h})}function je(){N().then(function(){if(!r.cancelled)return A.getCheckpoint().then(be).then(function(h){O=h,k={since:B=h,limit:m,batch_size:m,style:d,doc_ids:b,selector:S,return_docs:!0},n.filter&&("string"!=typeof n.filter?k.include_docs=!0:k.filter=n.filter),"heartbeat"in n&&(k.heartbeat=n.heartbeat),"timeout"in n&&(k.timeout=n.timeout),n.query_params&&(k.query_params=n.query_params),n.view&&(k.view=n.view),he()});le()}).catch(function(h){V("getCheckpoint rejected with ",h)})}function Le(h){l=!1,V("writeCheckpoint completed with error",h)}r.ready(e,t),r.cancelled?le():(r._addedListeners||(r.once("cancel",le),"function"==typeof n.complete&&(r.once("error",n.complete),r.once("complete",function(h){n.complete(null,h)})),r._addedListeners=!0),typeof n.since>"u"?je():N().then(function(){return l=!0,A.writeCheckpoint(n.since,q)}).then(function(){l=!1,r.cancelled?le():(B=n.since,je())}).catch(Le))}class Na extends(c()){constructor(){super(),this.cancelled=!1,this.state="pending";const t=new Promise((n,r)=>{this.once("complete",n),this.once("error",r)});this.then=function(n,r){return t.then(n,r)},this.catch=function(n){return t.catch(n)},this.catch(function(){})}cancel(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")}ready(t,n){if(this._readyCalled)return;this._readyCalled=!0;const r=()=>{this.cancel()};function i(){t.removeListener("destroyed",r),n.removeListener("destroyed",r)}t.once("destroyed",r),n.once("destroyed",r),this.once("complete",i),this.once("error",i)}}function Qt(e,t){return"string"==typeof e?new(0,t.PouchConstructor)(e,t):e}function Kn(e,t,n,r){if("function"==typeof n&&(r=n,n={}),typeof n>"u"&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw ce($t,"`doc_ids` filter parameter is not a list.");n.complete=r,(n=Oe(n)).continuous=n.continuous||n.live,n.retry="retry"in n&&n.retry,n.PouchConstructor=n.PouchConstructor||this;var i=new Na(n);return Xr(Qt(e,n),Qt(t,n),n,i),i}function Fa(e,t,n,r){return"function"==typeof n&&(r=n,n={}),typeof n>"u"&&(n={}),(n=Oe(n)).PouchConstructor=n.PouchConstructor||this,e=Qt(e,n),t=Qt(t,n),new Ga(e,t,n,r)}class Ga extends(c()){constructor(t,n,r,i){super(),this.canceled=!1;const s=r.push?ht({},r,r.push):r,a=r.pull?ht({},r,r.pull):r;this.push=Kn(t,n,s),this.pull=Kn(n,t,a),this.pushPaused=!0,this.pullPaused=!0;const u=S=>{this.emit("change",{direction:"pull",change:S})},l=S=>{this.emit("change",{direction:"push",change:S})},w=S=>{this.emit("denied",{direction:"push",doc:S})},x=S=>{this.emit("denied",{direction:"pull",doc:S})},O=()=>{this.pushPaused=!0,this.pullPaused&&this.emit("paused")},B=()=>{this.pullPaused=!0,this.pushPaused&&this.emit("paused")},g=()=>{this.pushPaused=!1,this.pullPaused&&this.emit("active",{direction:"push"})},m=()=>{this.pullPaused=!1,this.pushPaused&&this.emit("active",{direction:"pull"})};let y={};const d=S=>(P,A)=>{("change"===P&&(A===u||A===l)||"denied"===P&&(A===x||A===w)||"paused"===P&&(A===B||A===O)||"active"===P&&(A===m||A===g))&&(P in y||(y[P]={}),y[P][S]=!0,2===Object.keys(y[P]).length&&this.removeAllListeners(P))};function _(S,P,A){-1==S.listeners(P).indexOf(A)&&S.on(P,A)}r.live&&(this.push.on("complete",this.pull.cancel.bind(this.pull)),this.pull.on("complete",this.push.cancel.bind(this.push))),this.on("newListener",function(S){"change"===S?(_(this.pull,"change",u),_(this.push,"change",l)):"denied"===S?(_(this.pull,"denied",x),_(this.push,"denied",w)):"active"===S?(_(this.pull,"active",m),_(this.push,"active",g)):"paused"===S&&(_(this.pull,"paused",B),_(this.push,"paused",O))}),this.on("removeListener",function(S){"change"===S?(this.pull.removeListener("change",u),this.push.removeListener("change",l)):"denied"===S?(this.pull.removeListener("denied",x),this.push.removeListener("denied",w)):"active"===S?(this.pull.removeListener("active",m),this.push.removeListener("active",g)):"paused"===S&&(this.pull.removeListener("paused",B),this.push.removeListener("paused",O))}),this.pull.on("removeListener",d("pull")),this.push.on("removeListener",d("push"));const b=Promise.all([this.push,this.pull]).then(S=>{const P={push:S[0],pull:S[1]};return this.emit("complete",P),i&&i(null,P),this.removeAllListeners(),P},S=>{if(this.cancel(),i?i(S):this.emit("error",S),this.removeAllListeners(),i)throw S});this.then=function(S,P){return b.then(S,P)},this.catch=function(S){return b.catch(S)}}cancel(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())}}fe.plugin(function oa(e){e.adapter("idb",Lr,!0)}).plugin(function _a(e){e.adapter("http",Bn,!1),e.adapter("https",Bn,!1)}).plugin(La).plugin(function Wa(e){e.replicate=Kn,e.sync=Fa,Object.defineProperty(e.prototype,"replicate",{get:function(){var t=this;return typeof this.replicateMethods>"u"&&(this.replicateMethods={from:function(n,r,i){return t.constructor.replicate(n,t,r,i)},to:function(n,r,i){return t.constructor.replicate(t,n,r,i)}}),this.replicateMethods}}),e.prototype.sync=function(t,n,r){return this.constructor.sync(this,t,n,r)}});const ei=fe;var Za=$(92340),ti=$(94650),Ja=$(80529);let za=(()=>{class e{constructor(n){this.http=n,this.localDBs={},this.remoteDBs={},this.syncIntervalMinutes=10}initDB(n){var r=this;return(0,I.Z)(function*(){return r.localDBs[n]||(r.localDBs[n]=new ei(n),yield r.setupSync(n)),r.localDBs[n]})()}setupSync(n){var r=this;return(0,I.Z)(function*(){yield r.loginToCouchDB();const i=r.localDBs[n],s=new ei(`https://node1.4la.vn/couchdb/${n}`,{skip_setup:!0});r.remoteDBs[n]=s,i.sync(s,{live:!0,retry:!0}).on("change",a=>{console.log(`[${n}] Sync change:`,a)}).on("error",a=>{console.error(`[${n}] Sync error:`,a)}),setInterval(()=>{r.loginToCouchDB().then(()=>console.log(`[${n}] Refreshed CouchDB auth cookie`))},60*r.syncIntervalMinutes*1e3)})()}save(n,r){var i=this;return(0,I.Z)(function*(){const s=yield i.initDB(n);try{const a=yield s.get(r._id);r._rev=a._rev}catch(a){if(404!==a.status)throw a}return s.put(r)})()}delete(n,r){var i=this;return(0,I.Z)(function*(){const s=yield i.initDB(n),a=yield s.get(r);return s.remove(a)})()}get(n,r){var i=this;return(0,I.Z)(function*(){return(yield i.initDB(n)).get(r)})()}resolveConflicts(n){var r=this;return(0,I.Z)(function*(){const i=yield r.initDB(n),s=yield i.query((a,u)=>{a._conflicts&&u(a._id,null)},{conflicts:!0,include_docs:!0});for(const a of s.rows){const u=a.doc,l=u._conflicts||[],x=(yield Promise.all([i.get(u._id,{rev:u._rev}),...l.map(O=>i.get(u._id,{rev:O}))])).sort((O,B)=>new Date(B.updatedAt).getTime()-new Date(O.updatedAt).getTime())[0];yield i.put({...x,_rev:u._rev});for(const O of l)yield i.remove(u._id,O);console.log(`[${n}] Resolved conflict for`,u._id)}})()}loginToCouchDB(){return this.http.get(Za.N.apiUrl+"init/ss",{withCredentials:!0,responseType:"text"}).toPromise().then(()=>console.log("[Auth] CouchDB login successful")).catch(r=>{throw console.error("[Auth] CouchDB login failed:",r),r})}}return e.\u0275fac=function(n){return new(n||e)(ti.LFG(Ja.eN))},e.\u0275prov=ti.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},59069:He=>{"use strict";var I,me="object"==typeof Reflect?Reflect:null,$=me&&"function"==typeof me.apply?me.apply:function(c,f,K){return Function.prototype.apply.call(c,f,K)};I=me&&"function"==typeof me.ownKeys?me.ownKeys:Object.getOwnPropertySymbols?function(c){return Object.getOwnPropertyNames(c).concat(Object.getOwnPropertySymbols(c))}:function(c){return Object.getOwnPropertyNames(c)};var J=Number.isNaN||function(c){return c!=c};function G(){G.init.call(this)}He.exports=G,He.exports.once=function C(o,c){return new Promise(function(f,K){function W(ue){o.removeListener(c,ie),K(ue)}function ie(){"function"==typeof o.removeListener&&o.removeListener("error",W),f([].slice.call(arguments))}v(o,c,ie,{once:!0}),"error"!==c&&function D(o,c,f){"function"==typeof o.on&&v(o,"error",c,f)}(o,W,{once:!0})})},G.EventEmitter=G,G.prototype._events=void 0,G.prototype._eventsCount=0,G.prototype._maxListeners=void 0;var de=10;function ge(o){if("function"!=typeof o)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof o)}function Pe(o){return void 0===o._maxListeners?G.defaultMaxListeners:o._maxListeners}function Ne(o,c,f,K){var W,ie,ue;if(ge(f),void 0===(ie=o._events)?(ie=o._events=Object.create(null),o._eventsCount=0):(void 0!==ie.newListener&&(o.emit("newListener",c,f.listener?f.listener:f),ie=o._events),ue=ie[c]),void 0===ue)ue=ie[c]=f,++o._eventsCount;else if("function"==typeof ue?ue=ie[c]=K?[f,ue]:[ue,f]:K?ue.unshift(f):ue.push(f),(W=Pe(o))>0&&ue.length>W&&!ue.warned){ue.warned=!0;var R=new Error("Possible EventEmitter memory leak detected. "+ue.length+" "+String(c)+" listeners added. Use emitter.setMaxListeners() to increase limit");R.name="MaxListenersExceededWarning",R.emitter=o,R.type=c,R.count=ue.length,function _e(o){console&&console.warn&&console.warn(o)}(R)}return o}function ye(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function De(o,c,f){var K={fired:!1,wrapFn:void 0,target:o,type:c,listener:f},W=ye.bind(K);return W.listener=f,K.wrapFn=W,W}function Ie(o,c,f){var K=o._events;if(void 0===K)return[];var W=K[c];return void 0===W?[]:"function"==typeof W?f?[W.listener||W]:[W]:f?function Y(o){for(var c=new Array(o.length),f=0;f<c.length;++f)c[f]=o[f].listener||o[f];return c}(W):We(W,W.length)}function we(o){var c=this._events;if(void 0!==c){var f=c[o];if("function"==typeof f)return 1;if(void 0!==f)return f.length}return 0}function We(o,c){for(var f=new Array(c),K=0;K<c;++K)f[K]=o[K];return f}function v(o,c,f,K){if("function"==typeof o.on)K.once?o.once(c,f):o.on(c,f);else{if("function"!=typeof o.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof o);o.addEventListener(c,function W(ie){K.once&&o.removeEventListener(c,W),f(ie)})}}Object.defineProperty(G,"defaultMaxListeners",{enumerable:!0,get:function(){return de},set:function(o){if("number"!=typeof o||o<0||J(o))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+o+".");de=o}}),G.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},G.prototype.setMaxListeners=function(c){if("number"!=typeof c||c<0||J(c))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+c+".");return this._maxListeners=c,this},G.prototype.getMaxListeners=function(){return Pe(this)},G.prototype.emit=function(c){for(var f=[],K=1;K<arguments.length;K++)f.push(arguments[K]);var W="error"===c,ie=this._events;if(void 0!==ie)W=W&&void 0===ie.error;else if(!W)return!1;if(W){var ue;if(f.length>0&&(ue=f[0]),ue instanceof Error)throw ue;var R=new Error("Unhandled error."+(ue?" ("+ue.message+")":""));throw R.context=ue,R}var j=ie[c];if(void 0===j)return!1;if("function"==typeof j)$(j,this,f);else{var Q=j.length,Te=We(j,Q);for(K=0;K<Q;++K)$(Te[K],this,f)}return!0},G.prototype.on=G.prototype.addListener=function(c,f){return Ne(this,c,f,!1)},G.prototype.prependListener=function(c,f){return Ne(this,c,f,!0)},G.prototype.once=function(c,f){return ge(f),this.on(c,De(this,c,f)),this},G.prototype.prependOnceListener=function(c,f){return ge(f),this.prependListener(c,De(this,c,f)),this},G.prototype.off=G.prototype.removeListener=function(c,f){var K,W,ie,ue,R;if(ge(f),void 0===(W=this._events))return this;if(void 0===(K=W[c]))return this;if(K===f||K.listener===f)0==--this._eventsCount?this._events=Object.create(null):(delete W[c],W.removeListener&&this.emit("removeListener",c,K.listener||f));else if("function"!=typeof K){for(ie=-1,ue=K.length-1;ue>=0;ue--)if(K[ue]===f||K[ue].listener===f){R=K[ue].listener,ie=ue;break}if(ie<0)return this;0===ie?K.shift():function Ee(o,c){for(;c+1<o.length;c++)o[c]=o[c+1];o.pop()}(K,ie),1===K.length&&(W[c]=K[0]),void 0!==W.removeListener&&this.emit("removeListener",c,R||f)}return this},G.prototype.removeAllListeners=function(c){var f,K,W;if(void 0===(K=this._events))return this;if(void 0===K.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==K[c]&&(0==--this._eventsCount?this._events=Object.create(null):delete K[c]),this;if(0===arguments.length){var ue,ie=Object.keys(K);for(W=0;W<ie.length;++W)"removeListener"!==(ue=ie[W])&&this.removeAllListeners(ue);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(f=K[c]))this.removeListener(c,f);else if(void 0!==f)for(W=f.length-1;W>=0;W--)this.removeListener(c,f[W]);return this},G.prototype.listeners=function(c){return Ie(this,c,!0)},G.prototype.rawListeners=function(c){return Ie(this,c,!1)},G.listenerCount=function(o,c){return"function"==typeof o.listenerCount?o.listenerCount(c):we.call(o,c)},G.prototype.listenerCount=we,G.prototype.eventNames=function(){return this._eventsCount>0?I(this._events):[]}},69386:(He,me,$)=>{"use strict";var _e,J,I=[$(65961),$(19048),$(84298),$(6285),$(96387),$(26886)],G=-1,de=[],ge=!1;function Pe(){!_e||!J||(_e=!1,J.length?de=J.concat(de):G=-1,de.length&&Ne())}function Ne(){if(!_e){ge=!1,_e=!0;for(var Ee=de.length,Y=setTimeout(Pe);Ee;){for(J=de,de=[];J&&++G<Ee;)J[G].run();G=-1,Ee=de.length}J=null,G=-1,_e=!1,clearTimeout(Y)}}for(var ye,De=-1,Ie=I.length;++De<Ie;)if(I[De]&&I[De].test&&I[De].test()){ye=I[De].install(Ne);break}function we(Ee,Y){this.fun=Ee,this.array=Y}we.prototype.run=function(){var Ee=this.fun,Y=this.array;switch(Y.length){case 0:return Ee();case 1:return Ee(Y[0]);case 2:return Ee(Y[0],Y[1]);case 3:return Ee(Y[0],Y[1],Y[2]);default:return Ee.apply(null,Y)}},He.exports=function We(Ee){var Y=new Array(arguments.length-1);if(arguments.length>1)for(var C=1;C<arguments.length;C++)Y[C-1]=arguments[C];de.push(new we(Ee,Y)),!ge&&!_e&&(ge=!0,ye())}},6285:(He,me)=>{"use strict";me.test=function(){return!global.setImmediate&&typeof global.MessageChannel<"u"},me.install=function($){var I=new global.MessageChannel;return I.port1.onmessage=$,function(){I.port2.postMessage(0)}}},84298:(He,me)=>{"use strict";var $=global.MutationObserver||global.WebKitMutationObserver;me.test=function(){return $},me.install=function(I){var _e=0,J=new $(I),G=global.document.createTextNode("");return J.observe(G,{characterData:!0}),function(){G.data=_e=++_e%2}}},19048:(He,me)=>{"use strict";me.test=function(){return"function"==typeof global.queueMicrotask},me.install=function($){return function(){global.queueMicrotask($)}}},96387:(He,me)=>{"use strict";me.test=function(){return"document"in global&&"onreadystatechange"in global.document.createElement("script")},me.install=function($){return function(){var I=global.document.createElement("script");return I.onreadystatechange=function(){$(),I.onreadystatechange=null,I.parentNode.removeChild(I),I=null},global.document.documentElement.appendChild(I),$}}},26886:(He,me)=>{"use strict";me.test=function(){return!0},me.install=function($){return function(){setTimeout($,0)}}},51452:He=>{He.exports=function(me){"use strict";var I=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function J(C,D){var v=C[0],o=C[1],c=C[2],f=C[3];o=((o+=((c=((c+=((f=((f+=((v=((v+=(o&c|~o&f)+D[0]-680876936|0)<<7|v>>>25)+o|0)&o|~v&c)+D[1]-389564586|0)<<12|f>>>20)+v|0)&v|~f&o)+D[2]+606105819|0)<<17|c>>>15)+f|0)&f|~c&v)+D[3]-1044525330|0)<<22|o>>>10)+c|0,o=((o+=((c=((c+=((f=((f+=((v=((v+=(o&c|~o&f)+D[4]-176418897|0)<<7|v>>>25)+o|0)&o|~v&c)+D[5]+1200080426|0)<<12|f>>>20)+v|0)&v|~f&o)+D[6]-1473231341|0)<<17|c>>>15)+f|0)&f|~c&v)+D[7]-45705983|0)<<22|o>>>10)+c|0,o=((o+=((c=((c+=((f=((f+=((v=((v+=(o&c|~o&f)+D[8]+1770035416|0)<<7|v>>>25)+o|0)&o|~v&c)+D[9]-1958414417|0)<<12|f>>>20)+v|0)&v|~f&o)+D[10]-42063|0)<<17|c>>>15)+f|0)&f|~c&v)+D[11]-1990404162|0)<<22|o>>>10)+c|0,o=((o+=((c=((c+=((f=((f+=((v=((v+=(o&c|~o&f)+D[12]+1804603682|0)<<7|v>>>25)+o|0)&o|~v&c)+D[13]-40341101|0)<<12|f>>>20)+v|0)&v|~f&o)+D[14]-1502002290|0)<<17|c>>>15)+f|0)&f|~c&v)+D[15]+1236535329|0)<<22|o>>>10)+c|0,o=((o+=((c=((c+=((f=((f+=((v=((v+=(o&f|c&~f)+D[1]-165796510|0)<<5|v>>>27)+o|0)&c|o&~c)+D[6]-1069501632|0)<<9|f>>>23)+v|0)&o|v&~o)+D[11]+643717713|0)<<14|c>>>18)+f|0)&v|f&~v)+D[0]-373897302|0)<<20|o>>>12)+c|0,o=((o+=((c=((c+=((f=((f+=((v=((v+=(o&f|c&~f)+D[5]-701558691|0)<<5|v>>>27)+o|0)&c|o&~c)+D[10]+38016083|0)<<9|f>>>23)+v|0)&o|v&~o)+D[15]-660478335|0)<<14|c>>>18)+f|0)&v|f&~v)+D[4]-405537848|0)<<20|o>>>12)+c|0,o=((o+=((c=((c+=((f=((f+=((v=((v+=(o&f|c&~f)+D[9]+568446438|0)<<5|v>>>27)+o|0)&c|o&~c)+D[14]-1019803690|0)<<9|f>>>23)+v|0)&o|v&~o)+D[3]-187363961|0)<<14|c>>>18)+f|0)&v|f&~v)+D[8]+1163531501|0)<<20|o>>>12)+c|0,o=((o+=((c=((c+=((f=((f+=((v=((v+=(o&f|c&~f)+D[13]-1444681467|0)<<5|v>>>27)+o|0)&c|o&~c)+D[2]-51403784|0)<<9|f>>>23)+v|0)&o|v&~o)+D[7]+1735328473|0)<<14|c>>>18)+f|0)&v|f&~v)+D[12]-1926607734|0)<<20|o>>>12)+c|0,o=((o+=((c=((c+=((f=((f+=((v=((v+=(o^c^f)+D[5]-378558|0)<<4|v>>>28)+o|0)^o^c)+D[8]-2022574463|0)<<11|f>>>21)+v|0)^v^o)+D[11]+1839030562|0)<<16|c>>>16)+f|0)^f^v)+D[14]-35309556|0)<<23|o>>>9)+c|0,o=((o+=((c=((c+=((f=((f+=((v=((v+=(o^c^f)+D[1]-1530992060|0)<<4|v>>>28)+o|0)^o^c)+D[4]+1272893353|0)<<11|f>>>21)+v|0)^v^o)+D[7]-155497632|0)<<16|c>>>16)+f|0)^f^v)+D[10]-1094730640|0)<<23|o>>>9)+c|0,o=((o+=((c=((c+=((f=((f+=((v=((v+=(o^c^f)+D[13]+681279174|0)<<4|v>>>28)+o|0)^o^c)+D[0]-358537222|0)<<11|f>>>21)+v|0)^v^o)+D[3]-722521979|0)<<16|c>>>16)+f|0)^f^v)+D[6]+76029189|0)<<23|o>>>9)+c|0,o=((o+=((c=((c+=((f=((f+=((v=((v+=(o^c^f)+D[9]-640364487|0)<<4|v>>>28)+o|0)^o^c)+D[12]-421815835|0)<<11|f>>>21)+v|0)^v^o)+D[15]+530742520|0)<<16|c>>>16)+f|0)^f^v)+D[2]-995338651|0)<<23|o>>>9)+c|0,o=((o+=((f=((f+=(o^((v=((v+=(c^(o|~f))+D[0]-198630844|0)<<6|v>>>26)+o|0)|~c))+D[7]+1126891415|0)<<10|f>>>22)+v|0)^((c=((c+=(v^(f|~o))+D[14]-1416354905|0)<<15|c>>>17)+f|0)|~v))+D[5]-57434055|0)<<21|o>>>11)+c|0,o=((o+=((f=((f+=(o^((v=((v+=(c^(o|~f))+D[12]+1700485571|0)<<6|v>>>26)+o|0)|~c))+D[3]-1894986606|0)<<10|f>>>22)+v|0)^((c=((c+=(v^(f|~o))+D[10]-1051523|0)<<15|c>>>17)+f|0)|~v))+D[1]-2054922799|0)<<21|o>>>11)+c|0,o=((o+=((f=((f+=(o^((v=((v+=(c^(o|~f))+D[8]+1873313359|0)<<6|v>>>26)+o|0)|~c))+D[15]-30611744|0)<<10|f>>>22)+v|0)^((c=((c+=(v^(f|~o))+D[6]-1560198380|0)<<15|c>>>17)+f|0)|~v))+D[13]+1309151649|0)<<21|o>>>11)+c|0,o=((o+=((f=((f+=(o^((v=((v+=(c^(o|~f))+D[4]-145523070|0)<<6|v>>>26)+o|0)|~c))+D[11]-1120210379|0)<<10|f>>>22)+v|0)^((c=((c+=(v^(f|~o))+D[2]+718787259|0)<<15|c>>>17)+f|0)|~v))+D[9]-343485551|0)<<21|o>>>11)+c|0,C[0]=v+C[0]|0,C[1]=o+C[1]|0,C[2]=c+C[2]|0,C[3]=f+C[3]|0}function G(C){var v,D=[];for(v=0;v<64;v+=4)D[v>>2]=C.charCodeAt(v)+(C.charCodeAt(v+1)<<8)+(C.charCodeAt(v+2)<<16)+(C.charCodeAt(v+3)<<24);return D}function de(C){var v,D=[];for(v=0;v<64;v+=4)D[v>>2]=C[v]+(C[v+1]<<8)+(C[v+2]<<16)+(C[v+3]<<24);return D}function ge(C){var o,c,f,K,W,ie,D=C.length,v=[1732584193,-271733879,-1732584194,271733878];for(o=64;o<=D;o+=64)J(v,G(C.substring(o-64,o)));for(c=(C=C.substring(o-64)).length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;o<c;o+=1)f[o>>2]|=C.charCodeAt(o)<<(o%4<<3);if(f[o>>2]|=128<<(o%4<<3),o>55)for(J(v,f),o=0;o<16;o+=1)f[o]=0;return K=(K=8*D).toString(16).match(/(.*?)(.{0,8})$/),W=parseInt(K[2],16),ie=parseInt(K[1],16)||0,f[14]=W,f[15]=ie,J(v,f),v}function Ne(C){var v,D="";for(v=0;v<4;v+=1)D+=I[C>>8*v+4&15]+I[C>>8*v&15];return D}function ye(C){var D;for(D=0;D<C.length;D+=1)C[D]=Ne(C[D]);return C.join("")}function De(C){return/[\u0080-\uFFFF]/.test(C)&&(C=unescape(encodeURIComponent(C))),C}function Ee(C){var o,D=[],v=C.length;for(o=0;o<v-1;o+=2)D.push(parseInt(C.substr(o,2),16));return String.fromCharCode.apply(String,D)}function Y(){this.reset()}return ye(ge("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function C(D,v){return(D=0|D||0)<0?Math.max(D+v,0):Math.min(D,v)}ArrayBuffer.prototype.slice=function(D,v){var K,W,ie,ue,o=this.byteLength,c=C(D,o),f=o;return undefined!==v&&(f=C(v,o)),c>f?new ArrayBuffer(0):(K=f-c,W=new ArrayBuffer(K),ie=new Uint8Array(W),ue=new Uint8Array(this,c,K),ie.set(ue),W)}}(),Y.prototype.append=function(C){return this.appendBinary(De(C)),this},Y.prototype.appendBinary=function(C){this._buff+=C,this._length+=C.length;var v,D=this._buff.length;for(v=64;v<=D;v+=64)J(this._hash,G(this._buff.substring(v-64,v)));return this._buff=this._buff.substring(v-64),this},Y.prototype.end=function(C){var o,f,D=this._buff,v=D.length,c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(o=0;o<v;o+=1)c[o>>2]|=D.charCodeAt(o)<<(o%4<<3);return this._finish(c,v),f=ye(this._hash),C&&(f=Ee(f)),this.reset(),f},Y.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},Y.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},Y.prototype.setState=function(C){return this._buff=C.buff,this._length=C.length,this._hash=C.hash,this},Y.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},Y.prototype._finish=function(C,D){var o,c,f,v=D;if(C[v>>2]|=128<<(v%4<<3),v>55)for(J(this._hash,C),v=0;v<16;v+=1)C[v]=0;o=(o=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),c=parseInt(o[2],16),f=parseInt(o[1],16)||0,C[14]=c,C[15]=f,J(this._hash,C)},Y.hash=function(C,D){return Y.hashBinary(De(C),D)},Y.hashBinary=function(C,D){var o=ye(ge(C));return D?Ee(o):o},(Y.ArrayBuffer=function(){this.reset()}).prototype.append=function(C){var o,D=function We(C,D,v){var o=new Uint8Array(C.byteLength+D.byteLength);return o.set(new Uint8Array(C)),o.set(new Uint8Array(D),C.byteLength),v?o:o.buffer}(this._buff.buffer,C,!0),v=D.length;for(this._length+=C.byteLength,o=64;o<=v;o+=64)J(this._hash,de(D.subarray(o-64,o)));return this._buff=o-64<v?new Uint8Array(D.buffer.slice(o-64)):new Uint8Array(0),this},Y.ArrayBuffer.prototype.end=function(C){var c,f,D=this._buff,v=D.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(c=0;c<v;c+=1)o[c>>2]|=D[c]<<(c%4<<3);return this._finish(o,v),f=ye(this._hash),C&&(f=Ee(f)),this.reset(),f},Y.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},Y.ArrayBuffer.prototype.getState=function(){var C=Y.prototype.getState.call(this);return C.buff=function we(C){return String.fromCharCode.apply(null,new Uint8Array(C))}(C.buff),C},Y.ArrayBuffer.prototype.setState=function(C){return C.buff=function Ie(C,D){var f,v=C.length,o=new ArrayBuffer(v),c=new Uint8Array(o);for(f=0;f<v;f+=1)c[f]=C.charCodeAt(f);return D?c:o}(C.buff,!0),Y.prototype.setState.call(this,C)},Y.ArrayBuffer.prototype.destroy=Y.prototype.destroy,Y.ArrayBuffer.prototype._finish=Y.prototype._finish,Y.ArrayBuffer.hash=function(C,D){var o=ye(function Pe(C){var o,c,f,K,W,ie,D=C.length,v=[1732584193,-271733879,-1732584194,271733878];for(o=64;o<=D;o+=64)J(v,de(C.subarray(o-64,o)));for(c=(C=o-64<D?C.subarray(o-64):new Uint8Array(0)).length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;o<c;o+=1)f[o>>2]|=C[o]<<(o%4<<3);if(f[o>>2]|=128<<(o%4<<3),o>55)for(J(v,f),o=0;o<16;o+=1)f[o]=0;return K=(K=8*D).toString(16).match(/(.*?)(.{0,8})$/),W=parseInt(K[2],16),ie=parseInt(K[1],16)||0,f[14]=W,f[15]=ie,J(v,f),v}(new Uint8Array(C)));return D?Ee(o):o},Y}()},42899:(He,me)=>{"use strict";function $(I,_e,J){var G=J[J.length-1];I===G.element&&(J.pop(),G=J[J.length-1]);var de=G.element,ge=G.index;Array.isArray(de)?de.push(I):ge===_e.length-2?de[_e.pop()]=I:_e.push(I)}me.stringify=function(_e){var J=[];J.push({obj:_e});for(var de,ge,Ne,ye,Ie,we,We,Ee,Y,G="";de=J.pop();)if(ge=de.obj,G+=de.prefix||"",Ne=de.val||"")G+=Ne;else if("object"!=typeof ge)G+=typeof ge>"u"?null:JSON.stringify(ge);else if(null===ge)G+="null";else if(Array.isArray(ge)){for(J.push({val:"]"}),ye=ge.length-1;ye>=0;ye--)J.push({obj:ge[ye],prefix:0===ye?"":","});J.push({val:"["})}else{for(we in Ie=[],ge)ge.hasOwnProperty(we)&&Ie.push(we);for(J.push({val:"}"}),ye=Ie.length-1;ye>=0;ye--)Ee=ge[We=Ie[ye]],Y=ye>0?",":"",Y+=JSON.stringify(We)+":",J.push({obj:Ee,prefix:Y});J.push({val:"{"})}return G},me.parse=function(I){for(var de,ge,Pe,Ne,ye,De,Ie,we,We,_e=[],J=[],G=0;;)if("}"===(de=I[G++])||"]"===de||typeof de>"u"){if(1===_e.length)return _e.pop();$(_e.pop(),_e,J)}else switch(de){case" ":case"\t":case"\n":case":":case",":break;case"n":G+=3,$(null,_e,J);break;case"t":G+=3,$(!0,_e,J);break;case"f":G+=4,$(!1,_e,J);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(ge="",G--;;){if(Pe=I[G++],!/[\d\.\-e\+]/.test(Pe)){G--;break}ge+=Pe}$(parseFloat(ge),_e,J);break;case'"':for(Ne="",ye=void 0,De=0;'"'!==(Ie=I[G++])||"\\"===ye&&De%2==1;)Ne+=Ie,"\\"===(ye=Ie)?De++:De=0;$(JSON.parse('"'+Ne+'"'),_e,J);break;case"[":_e.push((we={element:[],index:_e.length}).element),J.push(we);break;case"{":_e.push((We={element:{},index:_e.length}).element),J.push(We);break;default:throw new Error("unexpectedly reached end of input: "+de)}}},65961:()=>{}}]);